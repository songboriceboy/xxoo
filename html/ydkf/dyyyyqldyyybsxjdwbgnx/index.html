<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>【单页应用】一起来单页应用吧，实现简单微博功能！（下）</div><br><h1>前言</h1>
<p>PS：<span style="color: #ff0000;"><strong>回家发现代码没拷贝回来，明天继续吧。。。</strong></span></p>
<p>开始之前先扯点其它的，我上午去理发，居然才7元，但是那个阿妈给我搞成和尚的造型了，我想说点什么，但转念一想节约点洗头水也好！！！</p>
<p>PS：其实主要原因是我掉头发。。。。。。</p>
<p>好了，接昨天的内容：<a id="homepage1_HomePageDays_DaysList_DayItem_0_DayList_0_TitleUrl_0" class="postTitle2" style="font: bold 15px/22px Verdana, Geneva, Arial, Helvetica, sans-serif; color: #1a8bc8; text-transform: none; text-indent: 0px; letter-spacing: normal; text-decoration: none; word-spacing: 0px; white-space: normal; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-stroke-width: 0px;" href="http://www.cnblogs.com/yexiaochai/p/3236544.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></p>
<p>昨天我们一起准备了两大核心，继承与view，虽说有问题，而且必定有问题，但是我们暂时不管他。</p>
<p>我们先继续先往下面写，到最后整体流程拉通后再一起优化就好，现在去纠结也不一定有结果，于是我们开始吧。</p>
<h1>继承之实现APP</h1>
<p>我们这里APP要干的事情，与其说担任MVC中控制器的角色，不如说他就是充当了一下路由选择的角色，根据不同的URL导向不同的view，并且会管理hash。</p>
<p>由于我们会处理request请求，压入hash以达到后退功能有效，所以这里先来实现一个hash类吧</p>
<h2>实现Hash对象</h2>
<p>先来一个辅助函数，用于计算某个字符在数组的位置：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> indexOf = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, arr) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">arr) {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 5</span>     <span style="color: #008000;">//</span><span style="color: #008000;">若是对象本身便居然indexof，便使用自身的，比如字符串</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (arr.indexOf) {
</span><span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> arr.indexOf(k);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = arr.length; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">if</span> (arr[i] ==<span style="color: #000000;"> k) {
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> i;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">15</span> };</pre>
</div>
<p>PS：这个hash的实现不算太好，后面也许会改动</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> b.Hash =<span style="color: #000000;"> b.Class({
</span><span style="color: #008080;"> 2</span>     _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">this</span>.keys =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">this</span>.values =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 6</span>     init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (obj) {
</span><span style="color: #008080;"> 7</span>         (<span style="color: #0000ff;">typeof</span> obj == 'object') || (obj = {}); <span style="color: #008000;">//</span><span style="color: #008000;">???</span>
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> obj) {
</span><span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (obj.hasOwnProperty(k)) {
</span><span style="color: #008080;">10</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push(k);
</span><span style="color: #008080;">11</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push(obj[k]);
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">15</span>     length: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.length;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">18</span>     getItem: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">if</span> (index &lt; 0<span style="color: #000000;">) {
</span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">25</span>     getKey: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[i];
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">28</span>     getValue: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">31</span>     add: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(k, v);
</span><span style="color: #008080;">33</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">34</span>     del: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">36</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.delByIndex(index);
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">38</span>     delByIndex: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (index) {
</span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">if</span> (index &lt; 0) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">40</span>         <span style="color: #0000ff;">this</span>.keys.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">this</span>.vaules.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">42</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">43</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">44</span>     <span style="color: #008000;">//</span><span style="color: #008000;">移除栈顶hash，并返回</span>
<span style="color: #008080;">45</span>     pop: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">46</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.keys.length) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">47</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.pop();
</span><span style="color: #008080;">48</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.pop();
</span><span style="color: #008080;">49</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">50</span>     push: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v, order) {
</span><span style="color: #008080;">51</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> k == 'object' &amp;&amp; !<span style="color: #000000;">v) {
</span><span style="color: #008080;">52</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> k) {
</span><span style="color: #008080;">53</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (k.hasOwnProperty(i)) {
</span><span style="color: #008080;">54</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(i, k[i], order);
</span><span style="color: #008080;">55</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">56</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">57</span>         } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">58</span>             <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">59</span>             <span style="color: #0000ff;">if</span> (index &lt; 0 ||<span style="color: #000000;"> order) {
</span><span style="color: #008080;">60</span>                 <span style="color: #0000ff;">if</span> (order) <span style="color: #0000ff;">this</span><span style="color: #000000;">.del(k);
</span><span style="color: #008080;">61</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push[k];
</span><span style="color: #008080;">62</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push[v];
</span><span style="color: #008080;">63</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">64</span>                 <span style="color: #0000ff;">this</span>.values[index] =<span style="color: #000000;"> v;
</span><span style="color: #008080;">65</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">66</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">67</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">68</span>     <span style="color: #008000;">//</span><span style="color: #008000;">查找hash表，返回key</span>
<span style="color: #008080;">69</span>     indexOf: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (v) {
</span><span style="color: #008080;">70</span>         <span style="color: #0000ff;">var</span> index = indexOf(v, <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules);
</span><span style="color: #008080;">71</span>         <span style="color: #0000ff;">if</span> (index &gt;= 0<span style="color: #000000;">) {
</span><span style="color: #008080;">72</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">73</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">74</span>         <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">75</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">76</span>     each: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (handler) {
</span><span style="color: #008080;">77</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> handler == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">78</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">79</span>                 handler.call(<span style="color: #0000ff;">this</span>, <span style="color: #0000ff;">this</span>.keys[i], <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules[i]);
</span><span style="color: #008080;">80</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">81</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">82</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">83</span>     getObj: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">84</span>         <span style="color: #0000ff;">var</span> obj =<span style="color: #000000;"> {};
</span><span style="color: #008080;">85</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">86</span>             obj[<span style="color: #0000ff;">this</span>.keys[i]] = <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;">87</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">88</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">89</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">90</span> });</pre>
</div>
<p>此hash对象基本就是数组的写照，各位可以对照着看，于是我们继续我们的app</p>
<h2>app雏形</h2>
<div class="cnblogs_code">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">var</span> Application = <span style="color: #0000ff;">new</span><span style="color: #000000;"> b.Class({
</span><span style="color: #008080;">  2</span>     _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">  3</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">  4</span>         <span style="color: #0000ff;">this</span>.webRoot = ''; <span style="color: #008000;">//</span><span style="color: #008000;">应用跟目录</span>
<span style="color: #008080;">  5</span>         <span style="color: #0000ff;">this</span>.head = $('head'<span style="color: #000000;">);
</span><span style="color: #008080;">  6</span>         <span style="color: #0000ff;">this</span>.body = $('body'<span style="color: #000000;">);
</span><span style="color: #008080;">  7</span>         <span style="color: #0000ff;">this</span>.viewRoot = 'views/'; <span style="color: #008000;">//</span><span style="color: #008000;">视图所在目录</span>
<span style="color: #008080;">  8</span>         <span style="color: #0000ff;">this</span>.defaultView = 'index'; <span style="color: #008000;">//</span><span style="color: #008000;">默认加载视图</span>
<span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span>         <span style="color: #0000ff;">this</span>.request; <span style="color: #008000;">//</span><span style="color: #008000;">请求对象</span>
<span style="color: #008080;"> 11</span>         <span style="color: #0000ff;">this</span>.viewPath; <span style="color: #008000;">//</span><span style="color: #008000;">当前请求视图路径，解析request得出</span>
<span style="color: #008080;"> 12</span>         <span style="color: #0000ff;">this</span>.mainFrame; <span style="color: #008000;">//</span><span style="color: #008000;">主框架</span>
<span style="color: #008080;"> 13</span>         <span style="color: #0000ff;">this</span>.viewPort; <span style="color: #008000;">//</span><span style="color: #008000;">视图框架</span>
<span style="color: #008080;"> 14</span>         <span style="color: #0000ff;">this</span>.stateDom; <span style="color: #008000;">//</span><span style="color: #008000;">状态栏</span>
<span style="color: #008080;"> 15</span> 
<span style="color: #008080;"> 16</span>         <span style="color: #0000ff;">this</span>.views = <span style="color: #0000ff;">new</span> b.Hash(); <span style="color: #008000;">//</span><span style="color: #008000;">views保存浏览器存储的hash</span>
<span style="color: #008080;"> 17</span>         <span style="color: #0000ff;">this</span>.curView; <span style="color: #008000;">//</span><span style="color: #008000;">当前视图</span>
<span style="color: #008080;"> 18</span>         <span style="color: #0000ff;">this</span>.interface = {}; <span style="color: #008000;">//</span><span style="color: #008000;">提供给视图访问的接口，暂时不管</span>
<span style="color: #008080;"> 19</span>         <span style="color: #0000ff;">this</span>.history = []; <span style="color: #008000;">//</span><span style="color: #008000;">历史记录</span>
<span style="color: #008080;"> 20</span> 
<span style="color: #008080;"> 21</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        this.stopListening = false;//是否开启监听</span>
<span style="color: #008080;"> 22</span> 
<span style="color: #008080;"> 23</span>         <span style="color: #0000ff;">this</span>.onHashChange = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 24</span> <span style="color: #000000;">            scope.history.push(window.location.href);
</span><span style="color: #008080;"> 25</span>             <span style="color: #0000ff;">var</span> url = decodeURIComponent(window.location.hash.replace(/^#+/i, ''<span style="color: #000000;">)).toLowerCase();
</span><span style="color: #008080;"> 26</span> <span style="color: #000000;">            scope._onHashChange(url);
</span><span style="color: #008080;"> 27</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 28</span> 
<span style="color: #008080;"> 29</span>         <span style="color: #0000ff;">this</span>.lastHash = ''<span style="color: #000000;">;
</span><span style="color: #008080;"> 30</span>         <span style="color: #0000ff;">this</span>.lastFullHash = ''<span style="color: #000000;">;
</span><span style="color: #008080;"> 31</span>         <span style="color: #0000ff;">this</span>.isChangeHash = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">hash是否发生变化</span>
<span style="color: #008080;"> 32</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 33</span>     init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
</span><span style="color: #008080;"> 34</span>         <span style="color: #008000;">//</span><span style="color: #008000;">为属性赋值</span>
<span style="color: #008080;"> 35</span>         opts = opts ||<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 36</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> opts) {
</span><span style="color: #008080;"> 37</span>             <span style="color: #0000ff;">this</span>[k] =<span style="color: #000000;"> opts[k];
</span><span style="color: #008080;"> 38</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.createViewPort();
</span><span style="color: #008080;"> 40</span>         <span style="color: #0000ff;">this</span>.bindEvent(); <span style="color: #008000;">//</span><span style="color: #008000;">事件绑定</span>
<span style="color: #008080;"> 41</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 42</span> 
<span style="color: #008080;"> 43</span>     <span style="color: #008000;">//</span><span style="color: #008000;">创建app页面基本框架，此处不能使用id，因为。。。</span>
<span style="color: #008080;"> 44</span>     createViewPort: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 45</span>         <span style="color: #0000ff;">var</span> htm =<span style="color: #000000;"> [
</span><span style="color: #008080;"> 46</span>             '&lt;div class="main-frame"&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 47</span>                 '&lt;div class="main-viewport"&gt;&lt;/div&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 48</span>                 '&lt;div class="main-state"&gt;&lt;/div&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 49</span>             '&lt;/div&gt;'
<span style="color: #008080;"> 50</span>         ].join(''<span style="color: #000000;">);
</span><span style="color: #008080;"> 51</span>         <span style="color: #0000ff;">this</span>.mainframe =<span style="color: #000000;"> $(htm);

</span><span style="color: #008080;"> 52</span>         <span style="color: #0000ff;">this</span>.viewport = <span style="color: #0000ff;">this</span>.mainframe.find('.main-viewport'<span style="color: #000000;">);
</span><span style="color: #008080;"> 53</span>         <span style="color: #0000ff;">this</span>.statedom = <span style="color: #0000ff;">this</span>.mainframe.find('.main-state'<span style="color: #000000;">);
</span><span style="color: #008080;"> 54</span>         <span style="color: #0000ff;">var</span> body = $('body'<span style="color: #000000;">);
</span><span style="color: #008080;"> 55</span>         body.html(''<span style="color: #000000;">);
</span><span style="color: #008080;"> 56</span>         body.append(<span style="color: #0000ff;">this</span><span style="color: #000000;">.mainframe);
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 58</span>     <span style="color: #008000;">//</span><span style="color: #008000;">！！！！！！非常重要哦！！！！！！</span>
<span style="color: #008080;"> 59</span>     bindEvent: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 60</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 61</span>         <span style="color: #008000;">//</span><span style="color: #008000;">暂时不使用requireJS</span>
<span style="color: #008080;"> 62</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        requirejs.onError = function () {};</span>
<span style="color: #008080;"> 63</span>         $(window).bind('hashchange', <span style="color: #0000ff;">this</span><span style="color: #000000;">.onHashChange);
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 65</span>     _onHashChange: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (url) {
</span><span style="color: #008080;"> 66</span>         url = url.replace(/^#+/i, ''<span style="color: #000000;">);
</span><span style="color: #008080;"> 67</span>         <span style="color: #0000ff;">var</span> req = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parseHash(url);
</span><span style="color: #008080;"> 68</span> 
<span style="color: #008080;"> 69</span>         <span style="color: #0000ff;">this</span>.request =<span style="color: #000000;"> req;
</span><span style="color: #008080;"> 70</span>         <span style="color: #0000ff;">this</span>.viewPath = <span style="color: #0000ff;">this</span>.viewPath || <span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultView;
</span><span style="color: #008080;"> 71</span>         <span style="color: #0000ff;">this</span>.loadView(<span style="color: #0000ff;">this</span>.viewPath); <span style="color: #008000;">//</span><span style="color: #008000;">！！！重要的视图加载</span>
<span style="color: #008080;"> 72</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 73</span>     <span style="color: #008000;">//</span><span style="color: #008000;">该方法慢慢看吧。。。</span>
<span style="color: #008080;"> 74</span>     parseHash: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (hash) {
</span><span style="color: #008080;"> 75</span>         <span style="color: #0000ff;">var</span> fullhash =<span style="color: #000000;"> hash,
</span><span style="color: #008080;"> 76</span>                 hash = hash.replace(/([^\|]*)(?:\|.*)?$/img, '$1'<span style="color: #000000;">),
</span><span style="color: #008080;"> 77</span>                 h = /^([^?&amp;|]*)(.*)?$/<span style="color: #000000;">i.exec(hash),
</span><span style="color: #008080;"> 78</span>                 vp = h[1] ? h[1].split('!'<span style="color: #000000;">) : [],
</span><span style="color: #008080;"> 79</span>                 viewpath = (vp.shift() || '').replace(/(^\/+|\/+$)/i, ''<span style="color: #000000;">),
</span><span style="color: #008080;"> 80</span>                 path = vp.length ? vp.join('!').replace(/(^\/+|\/+$)/i, '').split('/'<span style="color: #000000;">) : [],
</span><span style="color: #008080;"> 81</span>                 q = (h[2] || '').replace(/^\?*/i, '').split('&amp;'<span style="color: #000000;">),
</span><span style="color: #008080;"> 82</span>                 query =<span style="color: #000000;"> {}, y;
</span><span style="color: #008080;"> 83</span>         <span style="color: #0000ff;">this</span>.isChangeHash = !!(!<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; fullhash === <span style="color: #0000ff;">this</span>.lashFullHash) || !!(<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; <span style="color: #0000ff;">this</span>.lastHash !==<span style="color: #000000;"> hash);
</span><span style="color: #008080;"> 84</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (q) {
</span><span style="color: #008080;"> 85</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; q.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 86</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (q[i]) {
</span><span style="color: #008080;"> 87</span>                     y = q[i].split('='<span style="color: #000000;">);
</span><span style="color: #008080;"> 88</span>                     y[1] ? (query[y[0]] = y[1]) : (query[y[0]] = <span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 89</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 90</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 92</span> 
<span style="color: #008080;"> 93</span>         <span style="color: #0000ff;">this</span>.lastHash =<span style="color: #000000;"> hash;
</span><span style="color: #008080;"> 94</span>         <span style="color: #0000ff;">this</span>.lashFullHash =<span style="color: #000000;"> fullhash;
</span><span style="color: #008080;"> 95</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">            viewpath: viewpath,
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">            path: path,
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">            query: query,
</span><span style="color: #008080;"> 99</span>             root: location.pathname +<span style="color: #000000;"> location.search
</span><span style="color: #008080;">100</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">101</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">102</span>     <span style="color: #008000;">//</span><span style="color: #008000;">!!!非常重要</span>
<span style="color: #008080;">103</span>     loadView: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewPath) {
</span><span style="color: #008080;">104</span>         <span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> viewPath;
</span><span style="color: #008080;">105</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">106</span>         <span style="color: #008000;">//</span><span style="color: #008000;">此处本来应该判断是否已经有该视图，但是我们暂时不管，我们只要加载了相关视图就算成功</span>
<span style="color: #008080;">107</span>         <span style="color: #008000;">/*</span>
<span style="color: #008080;">108</span> <span style="color: #008000;">        一些操作
</span><span style="color: #008080;">109</span>         <span style="color: #008000;">*/</span>
<span style="color: #008080;">110</span> 
<span style="color: #008080;">111</span>         <span style="color: #008000;">//</span><span style="color: #008000;">此处应该加载我们的js文件</span>
<span style="color: #008080;">112</span>         $.getScript(<span style="color: #0000ff;">this</span>.buildUrl(viewPath), <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">113</span>             <span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> PageView();
</span><span style="color: #008080;">114</span> <span style="color: #000000;">            view.show();
</span><span style="color: #008080;">115</span> <span style="color: #000000;">            scope.viewport.append(curView.$el);
</span><span style="color: #008080;">116</span>             <span style="color: #0000ff;">var</span> s = ''<span style="color: #000000;">; 
</span><span style="color: #008080;">117</span> <span style="color: #000000;">        });
</span><span style="color: #008080;">118</span>         <span style="color: #008000;">//</span><span style="color: #008000;">！！！暂时不使用requireJS</span>
<span style="color: #008080;">119</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        var self = this;</span>
<span style="color: #008080;">120</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        requirejs([this.buildUrl(path)], function (View) {</span>
<span style="color: #008080;">121</span>         <span style="color: #008000;">//</span><span style="color: #008000;">            callback &amp;&amp; callback.call(self, View);</span>
<span style="color: #008080;">122</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        });</span>
<span style="color: #008080;">123</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">124</span>     buildUrl: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (path) {
</span><span style="color: #008080;">125</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.viewRoot =<span style="color: #000000;"> path;
</span><span style="color: #008080;">126</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">127</span> });</pre>
</div>
<p>好了，至此，我们粗制滥造版app结束，我们来试试先，再一并讲解其主要流程。</p>
<h2>简单测试</h2>
<p>html代码：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="utf-8"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="res/libs/jquery.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="res/test/c.base.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="res/test/app.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Application();
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="color: #ff0000;"><strong>base代码</strong></span>：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('3759d90f-5784-4867-a4de-c2779b5acd89')"><img id="code_img_closed_3759d90f-5784-4867-a4de-c2779b5acd89" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_3759d90f-5784-4867-a4de-c2779b5acd89" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('3759d90f-5784-4867-a4de-c2779b5acd89',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_3759d90f-5784-4867-a4de-c2779b5acd89" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/underscore.js" /&gt;</span>
<span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/jquery.js" /&gt;</span>
<span style="color: #008080;">  4</span> 
<span style="color: #008080;">  5</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/require.js" /&gt;</span>
<span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/require.text.js" /&gt;</span>
<span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span> 
<span style="color: #008080;"> 11</span> 
<span style="color: #008080;"> 12</span> <span style="color: #0000ff;">var</span> b = {};<span style="color: #008000;">//</span><span style="color: #008000;">base</span>
<span style="color: #008080;"> 13</span> <span style="color: #0000ff;">var</span> slice =<span style="color: #000000;"> [].slice;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">var</span> indexOf = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, arr) {
</span><span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">arr) {
</span><span style="color: #008080;"> 16</span>         <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;"> 17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 18</span>     <span style="color: #008000;">//</span><span style="color: #008000;">若是对象本身便居然indexof，便使用自身的，比如字符串</span>
<span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (arr.indexOf) {
</span><span style="color: #008080;"> 20</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> arr.indexOf(k);
</span><span style="color: #008080;"> 21</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = arr.length; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 23</span>         <span style="color: #0000ff;">if</span> (arr[i] ==<span style="color: #000000;"> k) {
</span><span style="color: #008080;"> 24</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> i;
</span><span style="color: #008080;"> 25</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 27</span>     <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;"> 28</span> <span style="color: #000000;">};
</span><span style="color: #008080;"> 29</span> 
<span style="color: #008080;"> 30</span> b.Class = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (supClass, childAttr) {
</span><span style="color: #008080;"> 31</span>     <span style="color: #008000;">//</span><span style="color: #008000;">若是传了第一个类，便继承之；否则实现新类</span>
<span style="color: #008080;"> 32</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> supClass === 'object'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 33</span>         childAttr =<span style="color: #000000;"> supClass;
</span><span style="color: #008080;"> 34</span>         supClass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 36</span> 
<span style="color: #008080;"> 37</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    var supProto = supClass.prototype;</span>
<span style="color: #008080;"> 38</span>     <span style="color: #0000ff;">var</span> newClass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">this</span>._propertys_ &amp;&amp; <span style="color: #0000ff;">this</span><span style="color: #000000;">._propertys_();
</span><span style="color: #008080;"> 40</span>         <span style="color: #0000ff;">this</span>.init &amp;&amp; <span style="color: #0000ff;">this</span>.init.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments);
</span><span style="color: #008080;"> 41</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 42</span>     newClass.prototype = <span style="color: #0000ff;">new</span><span style="color: #000000;"> supClass();
</span><span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span>     <span style="color: #0000ff;">var</span> supInit = newClass.prototype.init || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 45</span>     <span style="color: #0000ff;">var</span> childInit = childAttr.init || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 46</span>     <span style="color: #0000ff;">var</span> _supAttr = newClass.prototype._propertys_ || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 47</span>     <span style="color: #0000ff;">var</span> _childAttr = childAttr._propertys_ || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 48</span> 
<span style="color: #008080;"> 49</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> childAttr) {
</span><span style="color: #008080;"> 50</span>         <span style="color: #008000;">//</span><span style="color: #008000;">_propertys_中作为私有属性</span>
<span style="color: #008080;"> 51</span>         childAttr.hasOwnProperty(k) &amp;&amp; (newClass.prototype[k] =<span style="color: #000000;"> childAttr[k]);
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 53</span> 
<span style="color: #008080;"> 54</span>     <span style="color: #008000;">//</span><span style="color: #008000;">继承的属性有可能重写init方法</span>
<span style="color: #008080;"> 55</span>     <span style="color: #0000ff;">if</span> (arguments.length &amp;&amp; arguments[0].prototype &amp;&amp; arguments[0].prototype.init ===<span style="color: #000000;"> supInit) {
</span><span style="color: #008080;"> 56</span>         <span style="color: #008000;">//</span><span style="color: #008000;">重写新建类，初始化方法，传入其继承类的init方法</span>
<span style="color: #008080;"> 57</span>         newClass.prototype.init = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 58</span>             <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 59</span>             <span style="color: #0000ff;">var</span> args = [<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">                supInit.apply(scope, arguments);
</span><span style="color: #008080;"> 61</span> <span style="color: #000000;">            } ];
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">            childInit.apply(scope, args.concat(slice.call(arguments)));
</span><span style="color: #008080;"> 63</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 65</span> 
<span style="color: #008080;"> 66</span>     <span style="color: #008000;">//</span><span style="color: #008000;">内部属性赋值</span>
<span style="color: #008080;"> 67</span>     newClass.prototype._propertys_ = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 68</span>         _supAttr.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 69</span>         _childAttr.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 71</span> 
<span style="color: #008080;"> 72</span>     <span style="color: #008000;">//</span><span style="color: #008000;">成员属性</span>
<span style="color: #008080;"> 73</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> supClass) {
</span><span style="color: #008080;"> 74</span>         supClass.hasOwnProperty(k) &amp;&amp; (newClass[k] =<span style="color: #000000;"> supClass[k]);
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 76</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> newClass;
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">};
</span><span style="color: #008080;"> 78</span> 
<span style="color: #008080;"> 79</span> b.AbstractView =<span style="color: #000000;"> b.Class({
</span><span style="color: #008080;"> 80</span>     <span style="color: #008000;">//</span><span style="color: #008000;">基本view应该具有的属性</span>
<span style="color: #008080;"> 81</span>     _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 82</span>         <span style="color: #0000ff;">this</span>.id = (<span style="color: #0000ff;">new</span> Date()).getTime(); <span style="color: #008000;">//</span><span style="color: #008000;">唯一pageID</span>
<span style="color: #008080;"> 83</span>         <span style="color: #0000ff;">this</span>.rootBox = $('body'); <span style="color: #008000;">//</span><span style="color: #008000;">视图容器</span>
<span style="color: #008080;"> 84</span>         <span style="color: #0000ff;">this</span>.root = $('&lt;div/&gt;'); <span style="color: #008000;">//</span><span style="color: #008000;">视图的根元素，可进行设置</span>
<span style="color: #008080;"> 85</span>         <span style="color: #0000ff;">this</span>.header = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 86</span>         <span style="color: #0000ff;">this</span>.footer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 87</span>         <span style="color: #0000ff;">this</span>.template = '';<span style="color: #008000;">//</span><span style="color: #008000;">可能的模板</span>
<span style="color: #008080;"> 88</span>         <span style="color: #0000ff;">this</span>.isCreated = <span style="color: #0000ff;">false</span>;<span style="color: #008000;">//</span><span style="color: #008000;">是否创建完毕</span>
<span style="color: #008080;"> 89</span>         <span style="color: #0000ff;">this</span>.status = b.AbstractView.STATE_NOTCREATE;<span style="color: #008000;">//</span><span style="color: #008000;">当前状态</span>
<span style="color: #008080;"> 90</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 91</span>     init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 93</span>     <span style="color: #008000;">//</span><span style="color: #008000;">定义将要用到的事件，其中元素选取都会以root为标准，所以使用内部提供函数吧</span>
<span style="color: #008080;"> 94</span> <span style="color: #000000;">    events: {
</span><span style="color: #008080;"> 95</span>         'selector,eventType': 'func'
<span style="color: #008080;"> 96</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 97</span>     <span style="color: #008000;">//</span><span style="color: #008000;">默认属性</span>
<span style="color: #008080;"> 98</span> <span style="color: #000000;">    attrs: {
</span><span style="color: #008080;"> 99</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">100</span>     <span style="color: #008000;">//</span><span style="color: #008000;">获取视图元素</span>
<span style="color: #008080;">101</span>     find: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (selector) {
</span><span style="color: #008080;">102</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.find(selector);
</span><span style="color: #008080;">103</span> <span style="color: #000000;">    }, 
</span><span style="color: #008080;">104</span>     <span style="color: #008000;">//</span><span style="color: #008000;">创建dom</span>
<span style="color: #008080;">105</span>     create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
</span><span style="color: #008080;">106</span>         <span style="color: #0000ff;">if</span>(!<span style="color: #0000ff;">this</span>.isCreated &amp;&amp; <span style="color: #0000ff;">this</span>.status !=<span style="color: #000000;"> b.AbstractView.STATE_ONCREATE) {
</span><span style="color: #008080;">107</span>             <span style="color: #0000ff;">var</span> attr = opts &amp;&amp;<span style="color: #000000;"> opts.attr;
</span><span style="color: #008080;">108</span>             <span style="color: #0000ff;">var</span> html = <span style="color: #0000ff;">this</span><span style="color: #000000;">.createHtml();
</span><span style="color: #008080;">109</span>             <span style="color: #0000ff;">this</span>.initRoot(attr);<span style="color: #008000;">//</span><span style="color: #008000;">初始化root</span>
<span style="color: #008080;">110</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.hide();
</span><span style="color: #008080;">111</span>             <span style="color: #0000ff;">this</span>.rootBox.append(<span style="color: #0000ff;">this</span><span style="color: #000000;">.root);
</span><span style="color: #008080;">112</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.html(html);
</span><span style="color: #008080;">113</span>             <span style="color: #0000ff;">this</span>.trigger('onCreate');<span style="color: #008000;">//</span><span style="color: #008000;">触发正在创建事件，其实这里都创建完了</span>
<span style="color: #008080;">114</span>             <span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> b.AbstractView.STATE_ONCREATE;
</span><span style="color: #008080;">115</span>             <span style="color: #0000ff;">this</span>.isCreated = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">116</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.bindEvent();
</span><span style="color: #008080;">117</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">118</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">119</span>     <span style="color: #008000;">//</span><span style="color: #008000;">呈现/渲染视图</span>
<span style="color: #008080;">120</span>     show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (callback) {
</span><span style="color: #008080;">121</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">this</span>.status ==<span style="color: #000000;"> b.AbstractView.STATE_ONSHOW) {
</span><span style="color: #008080;">122</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">123</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">124</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.create();
</span><span style="color: #008080;">125</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.show();
</span><span style="color: #008080;">126</span>         <span style="color: #0000ff;">this</span>.trigger('onShow'<span style="color: #000000;">);
</span><span style="color: #008080;">127</span>         <span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> b.AbstractView.STATE_ONSHOW
</span><span style="color: #008080;">128</span>         callback &amp;&amp; (<span style="color: #0000ff;">typeof</span> callback == 'function') &amp;&amp; callback.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">129</span>         <span style="color: #0000ff;">this</span>.trigger('onLoad'<span style="color: #000000;">);
</span><span style="color: #008080;">130</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">131</span>     <span style="color: #008000;">//</span><span style="color: #008000;">隐藏dom</span>
<span style="color: #008080;">132</span>     hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (callback) {
</span><span style="color: #008080;">133</span>         <span style="color: #0000ff;">if</span>(!<span style="color: #0000ff;">this</span>.root || <span style="color: #0000ff;">this</span>.status ==<span style="color: #000000;"> b.AbstractView.STATE_ONHIDE) {
</span><span style="color: #008080;">134</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">135</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">136</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.hide();
</span><span style="color: #008080;">137</span>         <span style="color: #0000ff;">this</span>.trigger('onHide'<span style="color: #000000;">);
</span><span style="color: #008080;">138</span>         <span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> b.AbstractView.STATE_ONHIDE;
</span><span style="color: #008080;">139</span>         callback &amp;&amp; (<span style="color: #0000ff;">typeof</span> callback == 'function') &amp;&amp;<span style="color: #000000;"> callback();
</span><span style="color: #008080;">140</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">141</span>     <span style="color: #008000;">//</span><span style="color: #008000;">事件绑定</span>
<span style="color: #008080;">142</span>     bindEvent: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">143</span>         <span style="color: #0000ff;">var</span> events = <span style="color: #0000ff;">this</span><span style="color: #000000;">.events;
</span><span style="color: #008080;">144</span>         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> events) {
</span><span style="color: #008080;">145</span>             <span style="color: #0000ff;">var</span> sec_type = k.replace(/\s/i, '').split(','<span style="color: #000000;">);
</span><span style="color: #008080;">146</span>             <span style="color: #0000ff;">var</span> func =<span style="color: #000000;"> events[k];
</span><span style="color: #008080;">147</span>             <span style="color: #0000ff;">if</span>(sec_type &amp;&amp;sec_type.length == 2 &amp;&amp; <span style="color: #0000ff;">typeof</span> func == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">148</span>                 <span style="color: #0000ff;">var</span> selector = sec_type[0<span style="color: #000000;">];
</span><span style="color: #008080;">149</span>                 <span style="color: #0000ff;">var</span> type = sec_type[1<span style="color: #000000;">];
</span><span style="color: #008080;">150</span>                 <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">151</span>                 <span style="color: #0000ff;">this</span>.find(selector).on(type, <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">152</span>                     func.call(scope, $(<span style="color: #0000ff;">this</span><span style="color: #000000;">));
</span><span style="color: #008080;">153</span> <span style="color: #000000;">                })
</span><span style="color: #008080;">154</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">155</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">156</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">157</span>     <span style="color: #008000;">//</span><span style="color: #008000;">此处可以配合模板与相关参数组成html</span>
<span style="color: #008080;">158</span>     <span style="color: #008000;">//</span><span style="color: #008000;">解析模板也放到此处</span>
<span style="color: #008080;">159</span>     createHtml: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">160</span>         <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> Error('请重新定义createHtml方法'<span style="color: #000000;">);
</span><span style="color: #008080;">161</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">162</span>     initRoot: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">163</span>         <span style="color: #0000ff;">var</span> attr = <span style="color: #0000ff;">this</span><span style="color: #000000;">.attrs;
</span><span style="color: #008080;">164</span>         <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">attr) {
</span><span style="color: #008080;">165</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">166</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">167</span>         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> attr) {
</span><span style="color: #008080;">168</span>             <span style="color: #0000ff;">if</span>(k == 'className'<span style="color: #000000;">) {
</span><span style="color: #008080;">169</span>                 <span style="color: #0000ff;">this</span>.root.attr('class'<span style="color: #000000;">, attr[k]);
</span><span style="color: #008080;">170</span>             }<span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">171</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k, attr[k]);
</span><span style="color: #008080;">172</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">173</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">174</span>        <span style="color: #0000ff;">this</span>.root.attr('id', <span style="color: #0000ff;">this</span><span style="color: #000000;">.id);
</span><span style="color: #008080;">175</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">176</span>     <span style="color: #008000;">//</span><span style="color: #008000;">触发事件</span>
<span style="color: #008080;">177</span>     trigger: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, args) {
</span><span style="color: #008080;">178</span>         <span style="color: #0000ff;">var</span> event = <span style="color: #0000ff;">this</span><span style="color: #000000;">[k];
</span><span style="color: #008080;">179</span>         args = args ||<span style="color: #000000;"> [];
</span><span style="color: #008080;">180</span>         <span style="color: #0000ff;">if</span>(event &amp;&amp; <span style="color: #0000ff;">typeof</span> event == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">181</span>             event.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, args)
</span><span style="color: #008080;">182</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">183</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">184</span>     setRootBox: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (dom) {
</span><span style="color: #008080;">185</span>         <span style="color: #0000ff;">this</span>.rootBox =<span style="color: #000000;"> dom;
</span><span style="color: #008080;">186</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">187</span>     setAttr: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
</span><span style="color: #008080;">188</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k, v);
</span><span style="color: #008080;">189</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">190</span>     getAttr: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">191</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k);
</span><span style="color: #008080;">192</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">193</span>     setCss: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
</span><span style="color: #008080;">194</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.css(k, v);
</span><span style="color: #008080;">195</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">196</span>     getCss: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">197</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.css(k);
</span><span style="color: #008080;">198</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">199</span>     <span style="color: #008000;">//</span><span style="color: #008000;">dom创建后执行</span>
<span style="color: #008080;">200</span>     onCreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">201</span> 
<span style="color: #008080;">202</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">203</span>     <span style="color: #008000;">//</span><span style="color: #008000;">dom创建后数据加载时执行，用于加载后执行我们的逻辑</span>
<span style="color: #008080;">204</span>     onLoad: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">205</span> 
<span style="color: #008080;">206</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">207</span>     <span style="color: #008000;">//</span><span style="color: #008000;">dom创建后，未显示</span>
<span style="color: #008080;">208</span>     onShow: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">209</span> 
<span style="color: #008080;">210</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">211</span>     <span style="color: #008000;">//</span><span style="color: #008000;">dom隐藏前</span>
<span style="color: #008080;">212</span>     onHide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">213</span> 
<span style="color: #008080;">214</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">215</span> <span style="color: #000000;">});
</span><span style="color: #008080;">216</span> 
<span style="color: #008080;">217</span> <span style="color: #008000;">//</span><span style="color: #008000;">组件状态,未创建</span>
<span style="color: #008080;">218</span> b.AbstractView.STATE_NOTCREATE = 'notCreate'<span style="color: #000000;">;
</span><span style="color: #008080;">219</span> <span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已创建但未显示</span>
<span style="color: #008080;">220</span> b.AbstractView.STATE_ONCREATE = 'onCreate'<span style="color: #000000;">;
</span><span style="color: #008080;">221</span> <span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已显示</span>
<span style="color: #008080;">222</span> b.AbstractView.STATE_ONSHOW = 'onShow'<span style="color: #000000;">;
</span><span style="color: #008080;">223</span> <span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已隐藏</span>
<span style="color: #008080;">224</span> b.AbstractView.STATE_ONHIDE = 'onHide'<span style="color: #000000;">;
</span><span style="color: #008080;">225</span> 
<span style="color: #008080;">226</span> b.Hash =<span style="color: #000000;"> b.Class({
</span><span style="color: #008080;">227</span>     _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">228</span>         <span style="color: #0000ff;">this</span>.keys =<span style="color: #000000;"> [];
</span><span style="color: #008080;">229</span>         <span style="color: #0000ff;">this</span>.values =<span style="color: #000000;"> [];
</span><span style="color: #008080;">230</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">231</span>     init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (obj) {
</span><span style="color: #008080;">232</span>         (<span style="color: #0000ff;">typeof</span> obj == 'object') || (obj = {}); <span style="color: #008000;">//</span><span style="color: #008000;">???</span>
<span style="color: #008080;">233</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> obj) {
</span><span style="color: #008080;">234</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (obj.hasOwnProperty(k)) {
</span><span style="color: #008080;">235</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push(k);
</span><span style="color: #008080;">236</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push(obj[k]);
</span><span style="color: #008080;">237</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">238</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">239</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">240</span>     length: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">241</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.length;
</span><span style="color: #008080;">242</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">243</span>     getItem: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">244</span>         <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">245</span>         <span style="color: #0000ff;">if</span> (index &lt; 0<span style="color: #000000;">) {
</span><span style="color: #008080;">246</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">247</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">248</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">249</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">250</span>     getKey: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;">251</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[i];
</span><span style="color: #008080;">252</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">253</span>     getValue: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;">254</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;">255</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">256</span>     add: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
</span><span style="color: #008080;">257</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(k, v);
</span><span style="color: #008080;">258</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">259</span>     del: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">260</span>         <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">261</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.delByIndex(index);
</span><span style="color: #008080;">262</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">263</span>     delByIndex: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (index) {
</span><span style="color: #008080;">264</span>         <span style="color: #0000ff;">if</span> (index &lt; 0) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">265</span>         <span style="color: #0000ff;">this</span>.keys.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">266</span>         <span style="color: #0000ff;">this</span>.vaules.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">267</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">268</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">269</span>     <span style="color: #008000;">//</span><span style="color: #008000;">移除栈顶hash，并返回</span>
<span style="color: #008080;">270</span>     pop: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">271</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.keys.length) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">272</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.pop();
</span><span style="color: #008080;">273</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.pop();
</span><span style="color: #008080;">274</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">275</span>     push: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v, order) {
</span><span style="color: #008080;">276</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> k == 'object' &amp;&amp; !<span style="color: #000000;">v) {
</span><span style="color: #008080;">277</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> k) {
</span><span style="color: #008080;">278</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (k.hasOwnProperty(i)) {
</span><span style="color: #008080;">279</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(i, k[i], order);
</span><span style="color: #008080;">280</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">281</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">282</span>         } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">283</span>             <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">284</span>             <span style="color: #0000ff;">if</span> (index &lt; 0 ||<span style="color: #000000;"> order) {
</span><span style="color: #008080;">285</span>                 <span style="color: #0000ff;">if</span> (order) <span style="color: #0000ff;">this</span><span style="color: #000000;">.del(k);
</span><span style="color: #008080;">286</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push[k];
</span><span style="color: #008080;">287</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push[v];
</span><span style="color: #008080;">288</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">289</span>                 <span style="color: #0000ff;">this</span>.values[index] =<span style="color: #000000;"> v;
</span><span style="color: #008080;">290</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">291</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">292</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">293</span>     <span style="color: #008000;">//</span><span style="color: #008000;">查找hash表，返回key</span>
<span style="color: #008080;">294</span>     indexOf: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (v) {
</span><span style="color: #008080;">295</span>         <span style="color: #0000ff;">var</span> index = indexOf(v, <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules);
</span><span style="color: #008080;">296</span>         <span style="color: #0000ff;">if</span> (index &gt;= 0<span style="color: #000000;">) {
</span><span style="color: #008080;">297</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">298</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">299</span>         <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">300</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">301</span>     each: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (handler) {
</span><span style="color: #008080;">302</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> handler == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">303</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">304</span>                 handler.call(<span style="color: #0000ff;">this</span>, <span style="color: #0000ff;">this</span>.keys[i], <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules[i]);
</span><span style="color: #008080;">305</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">306</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">307</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">308</span>     getObj: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">309</span>         <span style="color: #0000ff;">var</span> obj =<span style="color: #000000;"> {};
</span><span style="color: #008080;">310</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">311</span>             obj[<span style="color: #0000ff;">this</span>.keys[i]] = <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;">312</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">313</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">314</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">315</span> });</pre>
</div>
<span class="cnblogs_code_collapse">base核心</span></div>
<p><strong><span style="color: #ff0000;">app代码</span></strong>：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('bb5aa0e8-cdc2-4a71-a0cf-95e3b084a4d6')"><img id="code_img_closed_bb5aa0e8-cdc2-4a71-a0cf-95e3b084a4d6" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_bb5aa0e8-cdc2-4a71-a0cf-95e3b084a4d6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bb5aa0e8-cdc2-4a71-a0cf-95e3b084a4d6',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_bb5aa0e8-cdc2-4a71-a0cf-95e3b084a4d6" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/underscore.js" /&gt;</span>
<span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/jquery.js" /&gt;</span>
<span style="color: #008080;">  4</span> 
<span style="color: #008080;">  5</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/require.js" /&gt;</span>
<span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span> <span style="color: #008000;">//</span><span style="color: #008000;">/ &lt;reference path="../libs/require.text.js" /&gt;</span>
<span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span> 
<span style="color: #008080;"> 11</span> <span style="color: #0000ff;">var</span> Application = <span style="color: #0000ff;">new</span><span style="color: #000000;"> b.Class({
</span><span style="color: #008080;"> 12</span>     _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 13</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 14</span>         <span style="color: #0000ff;">this</span>.webRoot = ''; <span style="color: #008000;">//</span><span style="color: #008000;">应用跟目录</span>
<span style="color: #008080;"> 15</span>         <span style="color: #0000ff;">this</span>.head = $('head'<span style="color: #000000;">);
</span><span style="color: #008080;"> 16</span>         <span style="color: #0000ff;">this</span>.body = $('body'<span style="color: #000000;">);
</span><span style="color: #008080;"> 17</span>         <span style="color: #0000ff;">this</span>.viewRoot = 'res/test/'; <span style="color: #008000;">//</span><span style="color: #008000;">视图所在目录</span>
<span style="color: #008080;"> 18</span>         <span style="color: #0000ff;">this</span>.defaultView = 'index'; <span style="color: #008000;">//</span><span style="color: #008000;">默认加载视图</span>
<span style="color: #008080;"> 19</span> 
<span style="color: #008080;"> 20</span>         <span style="color: #0000ff;">this</span>.request; <span style="color: #008000;">//</span><span style="color: #008000;">请求对象</span>
<span style="color: #008080;"> 21</span>         <span style="color: #0000ff;">this</span>.viewPath; <span style="color: #008000;">//</span><span style="color: #008000;">当前请求视图路径，解析request得出</span>
<span style="color: #008080;"> 22</span>         <span style="color: #0000ff;">this</span>.mainFrame; <span style="color: #008000;">//</span><span style="color: #008000;">主框架</span>
<span style="color: #008080;"> 23</span>         <span style="color: #0000ff;">this</span>.viewPort; <span style="color: #008000;">//</span><span style="color: #008000;">视图框架</span>
<span style="color: #008080;"> 24</span>         <span style="color: #0000ff;">this</span>.stateDom; <span style="color: #008000;">//</span><span style="color: #008000;">状态栏</span>
<span style="color: #008080;"> 25</span> 
<span style="color: #008080;"> 26</span>         <span style="color: #0000ff;">this</span>.views = <span style="color: #0000ff;">new</span> b.Hash(); <span style="color: #008000;">//</span><span style="color: #008000;">views保存浏览器存储的hash</span>
<span style="color: #008080;"> 27</span>         <span style="color: #0000ff;">this</span>.curView; <span style="color: #008000;">//</span><span style="color: #008000;">当前视图</span>
<span style="color: #008080;"> 28</span>         <span style="color: #0000ff;">this</span>.interface = {}; <span style="color: #008000;">//</span><span style="color: #008000;">提供给视图访问的接口，暂时不管</span>
<span style="color: #008080;"> 29</span>         <span style="color: #0000ff;">this</span>.history = []; <span style="color: #008000;">//</span><span style="color: #008000;">历史记录</span>
<span style="color: #008080;"> 30</span> 
<span style="color: #008080;"> 31</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        this.stopListening = false;//是否开启监听</span>
<span style="color: #008080;"> 32</span> 
<span style="color: #008080;"> 33</span>         <span style="color: #0000ff;">this</span>.onHashChange = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 34</span> <span style="color: #000000;">            scope.history.push(window.location.href);
</span><span style="color: #008080;"> 35</span>             <span style="color: #0000ff;">var</span> url = decodeURIComponent(window.location.hash.replace(/^#+/i, ''<span style="color: #000000;">)).toLowerCase();
</span><span style="color: #008080;"> 36</span> <span style="color: #000000;">            scope._onHashChange(url);
</span><span style="color: #008080;"> 37</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 38</span> 
<span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">this</span>.lastHash = ''<span style="color: #000000;">;
</span><span style="color: #008080;"> 40</span>         <span style="color: #0000ff;">this</span>.lastFullHash = ''<span style="color: #000000;">;
</span><span style="color: #008080;"> 41</span>         <span style="color: #0000ff;">this</span>.isChangeHash = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">hash是否发生变化</span>
<span style="color: #008080;"> 42</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 43</span>     init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
</span><span style="color: #008080;"> 44</span>         console.log('app init'<span style="color: #000000;">);
</span><span style="color: #008080;"> 45</span>         <span style="color: #008000;">//</span><span style="color: #008000;">为属性赋值</span>
<span style="color: #008080;"> 46</span>         opts = opts ||<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 47</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> opts) {
</span><span style="color: #008080;"> 48</span>             <span style="color: #0000ff;">this</span>[k] =<span style="color: #000000;"> opts[k];
</span><span style="color: #008080;"> 49</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 50</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.createViewPort();
</span><span style="color: #008080;"> 51</span>         <span style="color: #0000ff;">this</span>.bindEvent(); <span style="color: #008000;">//</span><span style="color: #008000;">事件绑定</span>
<span style="color: #008080;"> 52</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 53</span> 
<span style="color: #008080;"> 54</span>     <span style="color: #008000;">//</span><span style="color: #008000;">创建app页面基本框架，此处不能使用id，因为。。。</span>
<span style="color: #008080;"> 55</span>     createViewPort: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 56</span>         <span style="color: #0000ff;">var</span> htm =<span style="color: #000000;"> [
</span><span style="color: #008080;"> 57</span>             '&lt;div class="main-frame"&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 58</span>                 '&lt;div class="main-viewport"&gt;&lt;/div&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 59</span>                 '&lt;div class="main-state"&gt;&lt;/div&gt;'<span style="color: #000000;">,
</span><span style="color: #008080;"> 60</span>             '&lt;/div&gt;'
<span style="color: #008080;"> 61</span>         ].join(''<span style="color: #000000;">);
</span><span style="color: #008080;"> 62</span>         <span style="color: #0000ff;">this</span>.mainframe =<span style="color: #000000;"> $(htm);
</span><span style="color: #008080;"> 63</span>         <span style="color: #0000ff;">this</span>.viewport = <span style="color: #0000ff;">this</span>.mainframe.find('.main-viewport'<span style="color: #000000;">);
</span><span style="color: #008080;"> 64</span>         <span style="color: #0000ff;">this</span>.statedom = <span style="color: #0000ff;">this</span>.mainframe.find('.main-state'<span style="color: #000000;">);
</span><span style="color: #008080;"> 65</span>         <span style="color: #0000ff;">var</span> body = $('body'<span style="color: #000000;">);
</span><span style="color: #008080;"> 66</span>         body.html(''<span style="color: #000000;">);
</span><span style="color: #008080;"> 67</span>         body.append(<span style="color: #0000ff;">this</span><span style="color: #000000;">.mainframe);
</span><span style="color: #008080;"> 68</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 69</span>     <span style="color: #008000;">//</span><span style="color: #008000;">！！！！！！非常重要哦！！！！！！</span>
<span style="color: #008080;"> 70</span>     bindEvent: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 71</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 72</span>         <span style="color: #008000;">//</span><span style="color: #008000;">暂时不使用requireJS</span>
<span style="color: #008080;"> 73</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        requirejs.onError = function () {};</span>
<span style="color: #008080;"> 74</span>         $(window).bind('hashchange', <span style="color: #0000ff;">this</span><span style="color: #000000;">.onHashChange);
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 76</span>     _onHashChange: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (url) {
</span><span style="color: #008080;"> 77</span>         url = url.replace(/^#+/i, ''<span style="color: #000000;">);
</span><span style="color: #008080;"> 78</span>         <span style="color: #0000ff;">var</span> req = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parseHash(url);
</span><span style="color: #008080;"> 79</span> 
<span style="color: #008080;"> 80</span>         <span style="color: #0000ff;">this</span>.request =<span style="color: #000000;"> req;
</span><span style="color: #008080;"> 81</span>         <span style="color: #0000ff;">this</span>.viewPath = <span style="color: #0000ff;">this</span>.viewPath || <span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultView;
</span><span style="color: #008080;"> 82</span>         <span style="color: #0000ff;">this</span>.loadView(<span style="color: #0000ff;">this</span>.viewPath); <span style="color: #008000;">//</span><span style="color: #008000;">！！！重要的视图加载</span>
<span style="color: #008080;"> 83</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 84</span>     <span style="color: #008000;">//</span><span style="color: #008000;">该方法慢慢看吧。。。</span>
<span style="color: #008080;"> 85</span>     parseHash: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (hash) {
</span><span style="color: #008080;"> 86</span>         <span style="color: #0000ff;">var</span> fullhash =<span style="color: #000000;"> hash,
</span><span style="color: #008080;"> 87</span>                 hash = hash.replace(/([^\|]*)(?:\|.*)?$/img, '$1'<span style="color: #000000;">),
</span><span style="color: #008080;"> 88</span>                 h = /^([^?&amp;|]*)(.*)?$/<span style="color: #000000;">i.exec(hash),
</span><span style="color: #008080;"> 89</span>                 vp = h[1] ? h[1].split('!'<span style="color: #000000;">) : [],
</span><span style="color: #008080;"> 90</span>                 viewpath = (vp.shift() || '').replace(/(^\/+|\/+$)/i, ''<span style="color: #000000;">),
</span><span style="color: #008080;"> 91</span>                 path = vp.length ? vp.join('!').replace(/(^\/+|\/+$)/i, '').split('/'<span style="color: #000000;">) : [],
</span><span style="color: #008080;"> 92</span>                 q = (h[2] || '').replace(/^\?*/i, '').split('&amp;'<span style="color: #000000;">),
</span><span style="color: #008080;"> 93</span>                 query =<span style="color: #000000;"> {}, y;
</span><span style="color: #008080;"> 94</span>         <span style="color: #0000ff;">this</span>.isChangeHash = !!(!<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; fullhash === <span style="color: #0000ff;">this</span>.lashFullHash) || !!(<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; <span style="color: #0000ff;">this</span>.lastHash !==<span style="color: #000000;"> hash);
</span><span style="color: #008080;"> 95</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (q) {
</span><span style="color: #008080;"> 96</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; q.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 97</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (q[i]) {
</span><span style="color: #008080;"> 98</span>                     y = q[i].split('='<span style="color: #000000;">);
</span><span style="color: #008080;"> 99</span>                     y[1] ? (query[y[0]] = y[1]) : (query[y[0]] = <span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">100</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">101</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">102</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">103</span> 
<span style="color: #008080;">104</span>         <span style="color: #0000ff;">this</span>.lastHash =<span style="color: #000000;"> hash;
</span><span style="color: #008080;">105</span>         <span style="color: #0000ff;">this</span>.lashFullHash =<span style="color: #000000;"> fullhash;
</span><span style="color: #008080;">106</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">107</span> <span style="color: #000000;">            viewpath: viewpath,
</span><span style="color: #008080;">108</span> <span style="color: #000000;">            path: path,
</span><span style="color: #008080;">109</span> <span style="color: #000000;">            query: query,
</span><span style="color: #008080;">110</span>             root: location.pathname +<span style="color: #000000;"> location.search
</span><span style="color: #008080;">111</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">112</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">113</span>     <span style="color: #008000;">//</span><span style="color: #008000;">!!!非常重要</span>
<span style="color: #008080;">114</span>     loadView: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewPath) {
</span><span style="color: #008080;">115</span>         <span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> viewPath;
</span><span style="color: #008080;">116</span>         <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">117</span>         <span style="color: #008000;">//</span><span style="color: #008000;">此处本来应该判断是否已经有该视图，但是我们暂时不管，我们只要加载了相关视图就算成功</span>
<span style="color: #008080;">118</span>         <span style="color: #008000;">/*</span>
<span style="color: #008080;">119</span> <span style="color: #008000;">        一些操作
</span><span style="color: #008080;">120</span>         <span style="color: #008000;">*/</span>
<span style="color: #008080;">121</span> 
<span style="color: #008080;">122</span>         <span style="color: #0000ff;">var</span> path = <span style="color: #0000ff;">this</span><span style="color: #000000;">.buildUrl(viewPath);
</span><span style="color: #008080;">123</span> 
<span style="color: #008080;">124</span>         <span style="color: #008000;">//</span><span style="color: #008000;">此处应该加载我们的js文件</span>
<span style="color: #008080;">125</span>         $.getScript(<span style="color: #0000ff;">this</span>.buildUrl(viewPath) + '.js', <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">126</span>             <span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> PageView();
</span><span style="color: #008080;">127</span> <span style="color: #000000;">            view.show();
</span><span style="color: #008080;">128</span> <span style="color: #000000;">            scope.viewport.append(view.root);
</span><span style="color: #008080;">129</span>             <span style="color: #0000ff;">var</span> s = ''<span style="color: #000000;">;
</span><span style="color: #008080;">130</span> <span style="color: #000000;">        });
</span><span style="color: #008080;">131</span>         <span style="color: #008000;">//</span><span style="color: #008000;">！！！暂时不使用requireJS</span>
<span style="color: #008080;">132</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        var self = this;</span>
<span style="color: #008080;">133</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        requirejs([this.buildUrl(path)], function (View) {</span>
<span style="color: #008080;">134</span>         <span style="color: #008000;">//</span><span style="color: #008000;">            callback &amp;&amp; callback.call(self, View);</span>
<span style="color: #008080;">135</span>         <span style="color: #008000;">//</span><span style="color: #008000;">        });</span>
<span style="color: #008080;">136</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">137</span>     buildUrl: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (path) {
</span><span style="color: #008080;">138</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.viewRoot +<span style="color: #000000;"> path;
</span><span style="color: #008080;">139</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">140</span> });</pre>
</div>
<span class="cnblogs_code_collapse">APP</span></div>
<p><strong>文件结构</strong>：</p>
<p><img src="14719937511384.png" alt=""></p>
<p><strong>测试结果</strong></p>
<p><img src="44121158377886.png" alt=""></p>
<p>我可耻的觉得自己成功了一半了。。。</p>
<h2>基本流程讲解</h2>
<p>app是我们整个框架的核心，我们来简单讲解一下：</p>
<p>① 在整个_propertys_函数中，定义了我们app会用到的一些实例属性、方法</p>
<p>② init方法（一定会执行，因为我们使用了c.base的方法创建类），他主要干了两件事：</p>
<p>创建基本dom结构；</p>
<p>绑定事件，这个绑定事件就非常重要了</p>
<p>③ 59行开始，便是该文件的核心之一，这里为window绑定了hashchange事件，于是hash一旦改变（以#号方式），那么就会触发onhashchange事件</p>
<p>④ 触发hashchange事件后，会获得请求url#后面的参数，根据约定，他就是我们请求的view的路径，所以开始执行loadView方法，开始加载视图</p>
<p>⑤ 102行，开始加载视图，这里本应该使用requireJS，但是这里便于讲解，便于各位理解，我们暂时没有使用，于是动态加载我们的index文件，在成功后实例化view并且将view装入我们的视口中。</p>
<p>⑥ 整体流程结束</p>
<p>于是我们的粗制滥造版本也结束了。</p>
<h2>阶段总结</h2>
<p>好了，我们现在回过头来看看我们整个框架现在变成什么样了。</p>
<p>① 我们拥有实现类的通用b.class</p>
<p>② 我们有了我们的抽象视图类</p>
<p>③ 我们有了我们的control application</p>
<p>假使以上流程都流程问题不大，那么我们整个功能其实就七七八八了，因为还差的model可以轻松补上。</p>
<p>但是明显我们现在的APP是有缺陷的，而且缺陷比较大，比如我们的hash相关其实根本没有用上，所以现在我们来完善他们吧！</p>
<h1>RequireJS组织代码</h1>
<p>在这里，我们便开始使用我们的RequireJS了，然后将我们的整个逻辑慢慢铺开，首先我将我们的文件目录分开。</p>
<p><img src="13875747734691.png" alt=""></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('b3aa4dfd-ca85-4ef6-926d-3eaa9c173d27')"><img id="code_img_closed_b3aa4dfd-ca85-4ef6-926d-3eaa9c173d27" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_b3aa4dfd-ca85-4ef6-926d-3eaa9c173d27" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b3aa4dfd-ca85-4ef6-926d-3eaa9c173d27',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_b3aa4dfd-ca85-4ef6-926d-3eaa9c173d27" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="utf-8"</span> <span style="color: #0000ff;">/&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="res/libs/require.js"</span><span style="color: #ff0000;"> data-main</span><span style="color: #0000ff;">="main"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">html页</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c1dd5d0d-194b-4bd6-9f88-645db67a9872')"><img id="code_img_closed_c1dd5d0d-194b-4bd6-9f88-645db67a9872" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_c1dd5d0d-194b-4bd6-9f88-645db67a9872" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c1dd5d0d-194b-4bd6-9f88-645db67a9872',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_c1dd5d0d-194b-4bd6-9f88-645db67a9872" class="cnblogs_code_hide">
<pre>window.BASEURL = ''<span style="color: #000000;">;
require.config({
    baseUrl: BASEURL,
    shim: {
        $: {
            exports: </span>'jQuery'<span style="color: #000000;">
        },
        _: {
            exports: </span>'_'<span style="color: #000000;">
        }
    },
    paths: {
        </span>'$': 'res/libs/jquery'<span style="color: #000000;">,
        </span>'_': 'res/libs/underscore'<span style="color: #000000;">,
        </span>'text': 'res/libs/require.text'<span style="color: #000000;">,

        </span>'c': 'res/common/c'<span style="color: #000000;">,
        </span>'cBase': 'res/common/c.base'<span style="color: #000000;">,
        </span>'cView': 'res/common/c.view'<span style="color: #000000;">,
        </span>'app': 'res/app'<span style="color: #000000;">,


        </span>'s': 's'<span style="color: #000000;">
    }
});

require([</span>'app'], <span style="color: #0000ff;">function</span><span style="color: #000000;"> (APP) {
    </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> APP();
});</span></pre>
</div>
<span class="cnblogs_code_collapse">main</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('1c285090-ba72-4e6f-a89a-0a0e06334d14')"><img id="code_img_closed_1c285090-ba72-4e6f-a89a-0a0e06334d14" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_1c285090-ba72-4e6f-a89a-0a0e06334d14" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1c285090-ba72-4e6f-a89a-0a0e06334d14',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_1c285090-ba72-4e6f-a89a-0a0e06334d14" class="cnblogs_code_hide">
<pre>define(['$', 'c'], <span style="color: #0000ff;">function</span><span style="color: #000000;"> ($, c) {
    
    </span><span style="color: #0000ff;">var</span> Application = <span style="color: #0000ff;">new</span><span style="color: #000000;"> c.base.Class({
        _propertys_: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span>.webRoot = ''; <span style="color: #008000;">//</span><span style="color: #008000;">应用跟目录</span>
            <span style="color: #0000ff;">this</span>.head = $('head'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.body = $('body'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.viewRoot = 'views/'; <span style="color: #008000;">//</span><span style="color: #008000;">视图所在目录</span>
            <span style="color: #0000ff;">this</span>.defaultView = 'index'; <span style="color: #008000;">//</span><span style="color: #008000;">默认加载视图</span>

            <span style="color: #0000ff;">this</span>.request; <span style="color: #008000;">//</span><span style="color: #008000;">请求对象</span>
            <span style="color: #0000ff;">this</span>.viewPath; <span style="color: #008000;">//</span><span style="color: #008000;">当前请求视图路径，解析request得出</span>
            <span style="color: #0000ff;">this</span>.mainFrame; <span style="color: #008000;">//</span><span style="color: #008000;">主框架</span>
            <span style="color: #0000ff;">this</span>.viewPort; <span style="color: #008000;">//</span><span style="color: #008000;">视图框架</span>
            <span style="color: #0000ff;">this</span>.stateDom; <span style="color: #008000;">//</span><span style="color: #008000;">状态栏</span>

            <span style="color: #0000ff;">this</span>.views = <span style="color: #0000ff;">new</span> c.base.Hash(); <span style="color: #008000;">//</span><span style="color: #008000;">views保存浏览器存储的hash</span>
            <span style="color: #0000ff;">this</span>.curView; <span style="color: #008000;">//</span><span style="color: #008000;">当前视图</span>
            <span style="color: #0000ff;">this</span>.interface = {}; <span style="color: #008000;">//</span><span style="color: #008000;">提供给视图访问的接口，暂时不管</span>
            <span style="color: #0000ff;">this</span>.history = []; <span style="color: #008000;">//</span><span style="color: #008000;">历史记录</span>

            <span style="color: #008000;">//</span><span style="color: #008000;">        this.stopListening = false;//是否开启监听</span>

            <span style="color: #0000ff;">this</span>.onHashChange = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                scope.history.push(window.location.href);
                </span><span style="color: #0000ff;">var</span> url = decodeURIComponent(window.location.hash.replace(/^#+/i, ''<span style="color: #000000;">)).toLowerCase();
                scope._onHashChange(url);
            };

            </span><span style="color: #0000ff;">this</span>.lastHash = ''<span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span>.lastFullHash = ''<span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span>.isChangeHash = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">hash是否发生变化</span>
<span style="color: #000000;">        },
        init: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
            console.log(</span>'app init'<span style="color: #000000;">);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">为属性赋值</span>
            opts = opts ||<span style="color: #000000;"> {};
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> opts) {
                </span><span style="color: #0000ff;">this</span>[k] =<span style="color: #000000;"> opts[k];
            }
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.createViewPort();
            </span><span style="color: #0000ff;">this</span>.bindEvent(); <span style="color: #008000;">//</span><span style="color: #008000;">事件绑定</span>
<span style="color: #000000;">        },

        </span><span style="color: #008000;">//</span><span style="color: #008000;">创建app页面基本框架，此处不能使用id，因为。。。</span>
        createViewPort: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> htm =<span style="color: #000000;"> [
            </span>'&lt;div class="main-frame"&gt;'<span style="color: #000000;">,
                </span>'&lt;div class="main-viewport"&gt;&lt;/div&gt;'<span style="color: #000000;">,
                </span>'&lt;div class="main-state"&gt;&lt;/div&gt;'<span style="color: #000000;">,
            </span>'&lt;/div&gt;'<span style="color: #000000;">
        ].join(</span>''<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.mainframe =<span style="color: #000000;"> $(htm);
            </span><span style="color: #0000ff;">this</span>.viewport = <span style="color: #0000ff;">this</span>.mainframe.find('.main-viewport'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.statedom = <span style="color: #0000ff;">this</span>.mainframe.find('.main-state'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">var</span> body = $('body'<span style="color: #000000;">);
            body.html(</span>''<span style="color: #000000;">);
            body.append(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.mainframe);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">！！！！！！非常重要哦！！！！！！</span>
        bindEvent: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
            requirejs.onError </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
                </span><span style="color: #0000ff;">if</span> (e &amp;&amp;<span style="color: #000000;"> e.requireModules) {
                    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; e.requireModules.length; i++<span style="color: #000000;">) {
                        console.error((e.requireModules[i] </span>|| '').replace(self.viewRootPath, '') + '页面不存在!'<span style="color: #000000;">);
                    }
                }
            };

            $(window).bind(</span>'hashchange', <span style="color: #0000ff;">this</span><span style="color: #000000;">.onHashChange);
        },
        _onHashChange: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (url) {
            url </span>= url.replace(/^#+/i, ''<span style="color: #000000;">);
            </span><span style="color: #0000ff;">var</span> req = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parseHash(url);

            </span><span style="color: #0000ff;">this</span>.request =<span style="color: #000000;"> req;
            </span><span style="color: #0000ff;">this</span>.viewPath = <span style="color: #0000ff;">this</span>.viewPath || <span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultView;
            </span><span style="color: #0000ff;">this</span>.loadView(<span style="color: #0000ff;">this</span>.viewPath); <span style="color: #008000;">//</span><span style="color: #008000;">！！！重要的视图加载</span>
<span style="color: #000000;">        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">该方法慢慢看吧。。。</span>
        parseHash: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (hash) {
            </span><span style="color: #0000ff;">var</span> fullhash =<span style="color: #000000;"> hash,
                hash </span>= hash.replace(/([^\|]*)(?:\|.*)?$/img, '$1'<span style="color: #000000;">),
                h </span>= /^([^?&amp;|]*)(.*)?$/<span style="color: #000000;">i.exec(hash),
                vp </span>= h[1] ? h[1].split('!'<span style="color: #000000;">) : [],
                viewpath </span>= (vp.shift() || '').replace(/(^\/+|\/+$)/i, ''<span style="color: #000000;">),
                path </span>= vp.length ? vp.join('!').replace(/(^\/+|\/+$)/i, '').split('/'<span style="color: #000000;">) : [],
                q </span>= (h[2] || '').replace(/^\?*/i, '').split('&amp;'<span style="color: #000000;">),
                query </span>=<span style="color: #000000;"> {}, y;
            </span><span style="color: #0000ff;">this</span>.isChangeHash = !!(!<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; fullhash === <span style="color: #0000ff;">this</span>.lashFullHash) || !!(<span style="color: #0000ff;">this</span>.lastHash &amp;&amp; <span style="color: #0000ff;">this</span>.lastHash !==<span style="color: #000000;"> hash);
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (q) {
                </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; q.length; i++<span style="color: #000000;">) {
                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (q[i]) {
                        y </span>= q[i].split('='<span style="color: #000000;">);
                        y[</span>1] ? (query[y[0]] = y[1]) : (query[y[0]] = <span style="color: #0000ff;">true</span><span style="color: #000000;">);
                    }
                }
            }

            </span><span style="color: #0000ff;">this</span>.lastHash =<span style="color: #000000;"> hash;
            </span><span style="color: #0000ff;">this</span>.lashFullHash =<span style="color: #000000;"> fullhash;
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
                viewpath: viewpath,
                path: path,
                query: query,
                root: location.pathname </span>+<span style="color: #000000;"> location.search
            };
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">!!!非常重要</span>
        loadView: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewPath) {
            </span><span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> viewPath;
            </span><span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">var</span> path = <span style="color: #0000ff;">this</span><span style="color: #000000;">.buildUrl(viewPath);

            requirejs([path], </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (View) {
                </span><span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> View();
                view.show();
                scope.viewport.append(view.root);
                </span><span style="color: #0000ff;">var</span> s = ''<span style="color: #000000;">;
            });
        },
        buildUrl: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (path) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.viewRoot +<span style="color: #000000;"> path;
        }
    });

    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> Application;
});</span></pre>
</div>
<span class="cnblogs_code_collapse">app</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('626e9ba5-2d6a-4fe6-b7ff-acb41bf1e194')"><img id="code_img_closed_626e9ba5-2d6a-4fe6-b7ff-acb41bf1e194" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_626e9ba5-2d6a-4fe6-b7ff-acb41bf1e194" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('626e9ba5-2d6a-4fe6-b7ff-acb41bf1e194',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_626e9ba5-2d6a-4fe6-b7ff-acb41bf1e194" class="cnblogs_code_hide">
<pre><span style="color: #008080;">1</span> define(['cBase', 'cView'], <span style="color: #0000ff;">function</span><span style="color: #000000;"> (base, view) {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">var</span> c =<span style="color: #000000;"> {
</span><span style="color: #008080;">3</span> <span style="color: #000000;">        base: base,
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        view: view
</span><span style="color: #008080;">5</span> <span style="color: #000000;">    };
</span><span style="color: #008080;">6</span> 
<span style="color: #008080;">7</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> c;
</span><span style="color: #008080;">8</span> });</pre>
</div>
<span class="cnblogs_code_collapse">c</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('833bdfa9-6ddf-4b3d-9136-fb3628d7fbf7')"><img id="code_img_closed_833bdfa9-6ddf-4b3d-9136-fb3628d7fbf7" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_833bdfa9-6ddf-4b3d-9136-fb3628d7fbf7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('833bdfa9-6ddf-4b3d-9136-fb3628d7fbf7',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_833bdfa9-6ddf-4b3d-9136-fb3628d7fbf7" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> define([], <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span>     <span style="color: #0000ff;">var</span> base = {}; <span style="color: #008000;">//</span><span style="color: #008000;">base</span>
<span style="color: #008080;">  4</span>     <span style="color: #0000ff;">var</span> slice =<span style="color: #000000;"> [].slice;
</span><span style="color: #008080;">  5</span>     <span style="color: #0000ff;">var</span> indexOf = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, arr) {
</span><span style="color: #008080;">  6</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">arr) {
</span><span style="color: #008080;">  7</span>             <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">  8</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">  9</span>         <span style="color: #008000;">//</span><span style="color: #008000;">若是对象本身便居然indexof，便使用自身的，比如字符串</span>
<span style="color: #008080;"> 10</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (arr.indexOf) {
</span><span style="color: #008080;"> 11</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> arr.indexOf(k);
</span><span style="color: #008080;"> 12</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 13</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = arr.length; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 14</span>             <span style="color: #0000ff;">if</span> (arr[i] ==<span style="color: #000000;"> k) {
</span><span style="color: #008080;"> 15</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> i;
</span><span style="color: #008080;"> 16</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 17</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 18</span>         <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;"> 19</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 20</span> 
<span style="color: #008080;"> 21</span>     base.Class = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (supClass, childAttr) {
</span><span style="color: #008080;"> 22</span>         <span style="color: #008000;">//</span><span style="color: #008000;">若是传了第一个类，便继承之；否则实现新类</span>
<span style="color: #008080;"> 23</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> supClass === 'object'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 24</span>             childAttr =<span style="color: #000000;"> supClass;
</span><span style="color: #008080;"> 25</span>             supClass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 26</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 27</span> 
<span style="color: #008080;"> 28</span>         <span style="color: #008000;">//</span><span style="color: #008000;">    var supProto = supClass.prototype;</span>
<span style="color: #008080;"> 29</span>         <span style="color: #0000ff;">var</span> newClass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 30</span>             <span style="color: #0000ff;">this</span>._propertys_ &amp;&amp; <span style="color: #0000ff;">this</span><span style="color: #000000;">._propertys_();
</span><span style="color: #008080;"> 31</span>             <span style="color: #0000ff;">this</span>.init &amp;&amp; <span style="color: #0000ff;">this</span>.init.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments);
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 33</span>         newClass.prototype = <span style="color: #0000ff;">new</span><span style="color: #000000;"> supClass();
</span><span style="color: #008080;"> 34</span> 
<span style="color: #008080;"> 35</span>         <span style="color: #0000ff;">var</span> supInit = newClass.prototype.init || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 36</span>         <span style="color: #0000ff;">var</span> childInit = childAttr.init || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 37</span>         <span style="color: #0000ff;">var</span> _supAttr = newClass.prototype._propertys_ || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 38</span>         <span style="color: #0000ff;">var</span> _childAttr = childAttr._propertys_ || <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 39</span> 
<span style="color: #008080;"> 40</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> childAttr) {
</span><span style="color: #008080;"> 41</span>             <span style="color: #008000;">//</span><span style="color: #008000;">_propertys_中作为私有属性</span>
<span style="color: #008080;"> 42</span>             childAttr.hasOwnProperty(k) &amp;&amp; (newClass.prototype[k] =<span style="color: #000000;"> childAttr[k]);
</span><span style="color: #008080;"> 43</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 44</span> 
<span style="color: #008080;"> 45</span>         <span style="color: #008000;">//</span><span style="color: #008000;">继承的属性有可能重写init方法</span>
<span style="color: #008080;"> 46</span>         <span style="color: #0000ff;">if</span> (arguments.length &amp;&amp; arguments[0].prototype &amp;&amp; arguments[0].prototype.init ===<span style="color: #000000;"> supInit) {
</span><span style="color: #008080;"> 47</span>             <span style="color: #008000;">//</span><span style="color: #008000;">重写新建类，初始化方法，传入其继承类的init方法</span>
<span style="color: #008080;"> 48</span>             newClass.prototype.init = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 49</span>                 <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 50</span>                 <span style="color: #0000ff;">var</span> args = [<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">                    supInit.apply(scope, arguments);
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">                } ];
</span><span style="color: #008080;"> 53</span> <span style="color: #000000;">                childInit.apply(scope, args.concat(slice.call(arguments)));
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">            };
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 56</span> 
<span style="color: #008080;"> 57</span>         <span style="color: #008000;">//</span><span style="color: #008000;">内部属性赋值</span>
<span style="color: #008080;"> 58</span>         newClass.prototype._propertys_ = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 59</span>             _supAttr.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 60</span>             _childAttr.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 61</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 62</span> 
<span style="color: #008080;"> 63</span>         <span style="color: #008000;">//</span><span style="color: #008000;">成员属性</span>
<span style="color: #008080;"> 64</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> supClass) {
</span><span style="color: #008080;"> 65</span>             supClass.hasOwnProperty(k) &amp;&amp; (newClass[k] =<span style="color: #000000;"> supClass[k]);
</span><span style="color: #008080;"> 66</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 67</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> newClass;
</span><span style="color: #008080;"> 68</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 69</span>     
<span style="color: #008080;"> 70</span>     base.Hash =<span style="color: #000000;"> base.Class({
</span><span style="color: #008080;"> 71</span>         _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 72</span>             <span style="color: #0000ff;">this</span>.keys =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 73</span>             <span style="color: #0000ff;">this</span>.values =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 74</span> <span style="color: #000000;">        },
</span><span style="color: #008080;"> 75</span>         init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (obj) {
</span><span style="color: #008080;"> 76</span>             (<span style="color: #0000ff;">typeof</span> obj == 'object') || (obj = {}); <span style="color: #008000;">//</span><span style="color: #008000;">???</span>
<span style="color: #008080;"> 77</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> obj) {
</span><span style="color: #008080;"> 78</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (obj.hasOwnProperty(k)) {
</span><span style="color: #008080;"> 79</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push(k);
</span><span style="color: #008080;"> 80</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push(obj[k]);
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 82</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 83</span> <span style="color: #000000;">        },
</span><span style="color: #008080;"> 84</span>         length: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 85</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.length;
</span><span style="color: #008080;"> 86</span> <span style="color: #000000;">        },
</span><span style="color: #008080;"> 87</span>         getItem: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;"> 88</span>             <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;"> 89</span>             <span style="color: #0000ff;">if</span> (index &lt; 0<span style="color: #000000;">) {
</span><span style="color: #008080;"> 90</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 92</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">        },
</span><span style="color: #008080;"> 94</span>         getKey: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;"> 95</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[i];
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">        },
</span><span style="color: #008080;"> 97</span>         getValue: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i) {
</span><span style="color: #008080;"> 98</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;"> 99</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">100</span>         add: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
</span><span style="color: #008080;">101</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(k, v);
</span><span style="color: #008080;">102</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">103</span>         del: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;">104</span>             <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">105</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.delByIndex(index);
</span><span style="color: #008080;">106</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">107</span>         delByIndex: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (index) {
</span><span style="color: #008080;">108</span>             <span style="color: #0000ff;">if</span> (index &lt; 0) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">109</span>             <span style="color: #0000ff;">this</span>.keys.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">110</span>             <span style="color: #0000ff;">this</span>.vaules.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">111</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">112</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">113</span>         <span style="color: #008000;">//</span><span style="color: #008000;">移除栈顶hash，并返回</span>
<span style="color: #008080;">114</span>         pop: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">115</span>             <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.keys.length) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">116</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.pop();
</span><span style="color: #008080;">117</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.pop();
</span><span style="color: #008080;">118</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">119</span>         push: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v, order) {
</span><span style="color: #008080;">120</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> k == 'object' &amp;&amp; !<span style="color: #000000;">v) {
</span><span style="color: #008080;">121</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> k) {
</span><span style="color: #008080;">122</span>                     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (k.hasOwnProperty(i)) {
</span><span style="color: #008080;">123</span>                         <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(i, k[i], order);
</span><span style="color: #008080;">124</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">125</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">126</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">127</span>                 <span style="color: #0000ff;">var</span> index = indexOf(k, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">128</span>                 <span style="color: #0000ff;">if</span> (index &lt; 0 ||<span style="color: #000000;"> order) {
</span><span style="color: #008080;">129</span>                     <span style="color: #0000ff;">if</span> (order) <span style="color: #0000ff;">this</span><span style="color: #000000;">.del(k);
</span><span style="color: #008080;">130</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push[k];
</span><span style="color: #008080;">131</span>                     <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.push[v];
</span><span style="color: #008080;">132</span>                 } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">133</span>                     <span style="color: #0000ff;">this</span>.values[index] =<span style="color: #000000;"> v;
</span><span style="color: #008080;">134</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">135</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">136</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">137</span>         <span style="color: #008000;">//</span><span style="color: #008000;">查找hash表，返回key</span>
<span style="color: #008080;">138</span>         indexOf: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (v) {
</span><span style="color: #008080;">139</span>             <span style="color: #0000ff;">var</span> index = indexOf(v, <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules);
</span><span style="color: #008080;">140</span>             <span style="color: #0000ff;">if</span> (index &gt;= 0<span style="color: #000000;">) {
</span><span style="color: #008080;">141</span>                 <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">142</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">143</span>             <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">144</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">145</span>         each: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (handler) {
</span><span style="color: #008080;">146</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> handler == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">147</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">148</span>                     handler.call(<span style="color: #0000ff;">this</span>, <span style="color: #0000ff;">this</span>.keys[i], <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules[i]);
</span><span style="color: #008080;">149</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">150</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">151</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">152</span>         getObj: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">153</span>             <span style="color: #0000ff;">var</span> obj =<span style="color: #000000;"> {};
</span><span style="color: #008080;">154</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = <span style="color: #0000ff;">this</span>.length(); i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">155</span>                 obj[<span style="color: #0000ff;">this</span>.keys[i]] = <span style="color: #0000ff;">this</span><span style="color: #000000;">.values[i];
</span><span style="color: #008080;">156</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">157</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">158</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">159</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">160</span> 
<span style="color: #008080;">161</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> base;
</span><span style="color: #008080;">162</span> 
<span style="color: #008080;">163</span> });</pre>
</div>
<span class="cnblogs_code_collapse">c.base</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('2c36d472-07ab-4a19-96d5-a34fba06a358')"><img id="code_img_closed_2c36d472-07ab-4a19-96d5-a34fba06a358" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_2c36d472-07ab-4a19-96d5-a34fba06a358" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2c36d472-07ab-4a19-96d5-a34fba06a358',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_2c36d472-07ab-4a19-96d5-a34fba06a358" class="cnblogs_code_hide">
<pre>define(['$', 'cBase'], <span style="color: #0000ff;">function</span><span style="color: #000000;"> ($, b) {

    </span><span style="color: #0000ff;">var</span> AbstractView =<span style="color: #000000;"> b.Class({
        </span><span style="color: #008000;">//</span><span style="color: #008000;">基本view应该具有的属性</span>
        _propertys_: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">this</span>.id = (<span style="color: #0000ff;">new</span> Date()).getTime(); <span style="color: #008000;">//</span><span style="color: #008000;">唯一pageID</span>
            <span style="color: #0000ff;">this</span>.rootBox = $('body'); <span style="color: #008000;">//</span><span style="color: #008000;">视图容器</span>
            <span style="color: #0000ff;">this</span>.root = $('&lt;div/&gt;'); <span style="color: #008000;">//</span><span style="color: #008000;">视图的根元素，可进行设置</span>
            <span style="color: #0000ff;">this</span>.header = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span>.footer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
            </span><span style="color: #0000ff;">this</span>.template = ''; <span style="color: #008000;">//</span><span style="color: #008000;">可能的模板</span>
            <span style="color: #0000ff;">this</span>.isCreated = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">是否创建完毕</span>
            <span style="color: #0000ff;">this</span>.status = AbstractView.STATE_NOTCREATE; <span style="color: #008000;">//</span><span style="color: #008000;">当前状态</span>
<span style="color: #000000;">        },
        init: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">定义将要用到的事件，其中元素选取都会以root为标准，所以使用内部提供函数吧</span>
<span style="color: #000000;">        events: {
            </span>'selector,eventType': 'func'<span style="color: #000000;">
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">默认属性</span>
<span style="color: #000000;">        attrs: {
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">获取视图元素</span>
        find: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (selector) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.find(selector);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">创建dom</span>
        create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.isCreated &amp;&amp; <span style="color: #0000ff;">this</span>.status !=<span style="color: #000000;"> AbstractView.STATE_ONCREATE) {
                </span><span style="color: #0000ff;">var</span> attr = opts &amp;&amp;<span style="color: #000000;"> opts.attr;
                </span><span style="color: #0000ff;">var</span> html = <span style="color: #0000ff;">this</span><span style="color: #000000;">.createHtml();
                </span><span style="color: #0000ff;">this</span>.initRoot(attr); <span style="color: #008000;">//</span><span style="color: #008000;">初始化root</span>
                <span style="color: #0000ff;">this</span><span style="color: #000000;">.hide();
                </span><span style="color: #0000ff;">this</span>.rootBox.append(<span style="color: #0000ff;">this</span><span style="color: #000000;">.root);
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.html(html);
                </span><span style="color: #0000ff;">this</span>.trigger('onCreate'); <span style="color: #008000;">//</span><span style="color: #008000;">触发正在创建事件，其实这里都创建完了</span>
                <span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> AbstractView.STATE_ONCREATE;
                </span><span style="color: #0000ff;">this</span>.isCreated = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.bindEvent();
            }
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">呈现/渲染视图</span>
        show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (callback) {
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.status ==<span style="color: #000000;"> AbstractView.STATE_ONSHOW) {
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.create();
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.show();
            </span><span style="color: #0000ff;">this</span>.trigger('onShow'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> AbstractView.STATE_ONSHOW
            callback </span>&amp;&amp; (<span style="color: #0000ff;">typeof</span> callback == 'function') &amp;&amp; callback.call(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.trigger('onLoad'<span style="color: #000000;">);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">隐藏dom</span>
        hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (callback) {
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.root || <span style="color: #0000ff;">this</span>.status ==<span style="color: #000000;"> AbstractView.STATE_ONHIDE) {
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.hide();
            </span><span style="color: #0000ff;">this</span>.trigger('onHide'<span style="color: #000000;">);
            </span><span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> AbstractView.STATE_ONHIDE;
            callback </span>&amp;&amp; (<span style="color: #0000ff;">typeof</span> callback == 'function') &amp;&amp;<span style="color: #000000;"> callback();
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">事件绑定</span>
        bindEvent: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> events = <span style="color: #0000ff;">this</span><span style="color: #000000;">.events;
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> events) {
                </span><span style="color: #0000ff;">var</span> sec_type = k.replace(/\s/i, '').split(','<span style="color: #000000;">);
                </span><span style="color: #0000ff;">var</span> func =<span style="color: #000000;"> events[k];
                </span><span style="color: #0000ff;">if</span> (sec_type &amp;&amp; sec_type.length == 2 &amp;&amp; <span style="color: #0000ff;">typeof</span> func == 'function'<span style="color: #000000;">) {
                    </span><span style="color: #0000ff;">var</span> selector = sec_type[0<span style="color: #000000;">];
                    </span><span style="color: #0000ff;">var</span> type = sec_type[1<span style="color: #000000;">];
                    </span><span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
                    </span><span style="color: #0000ff;">this</span>.find(selector).on(type, <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                        func.call(scope, $(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">));
                    })
                }
            }
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">此处可以配合模板与相关参数组成html</span>
        <span style="color: #008000;">//</span><span style="color: #008000;">解析模板也放到此处</span>
        createHtml: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> Error('请重新定义createHtml方法'<span style="color: #000000;">);
        },
        initRoot: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> attr = <span style="color: #0000ff;">this</span><span style="color: #000000;">.attrs;
            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">attr) {
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
            }
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> attr) {
                </span><span style="color: #0000ff;">if</span> (k == 'className'<span style="color: #000000;">) {
                    </span><span style="color: #0000ff;">this</span>.root.attr('class'<span style="color: #000000;">, attr[k]);
                } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k, attr[k]);
                }
            }
            </span><span style="color: #0000ff;">this</span>.root.attr('id', <span style="color: #0000ff;">this</span><span style="color: #000000;">.id);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">触发事件</span>
        trigger: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, args) {
            </span><span style="color: #0000ff;">var</span> event = <span style="color: #0000ff;">this</span><span style="color: #000000;">[k];
            args </span>= args ||<span style="color: #000000;"> [];
            </span><span style="color: #0000ff;">if</span> (event &amp;&amp; <span style="color: #0000ff;">typeof</span> event == 'function'<span style="color: #000000;">) {
                event.apply(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">, args)
            }
        },
        setRootBox: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (dom) {
            </span><span style="color: #0000ff;">this</span>.rootBox =<span style="color: #000000;"> dom;
        },
        setAttr: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k, v);
        },
        getAttr: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.attr(k);
        },
        setCss: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (k, v) {
            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.root.css(k, v);
        },
        getCss: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.root.css(k);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom创建后执行</span>
        onCreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom创建后数据加载时执行，用于加载后执行我们的逻辑</span>
        onLoad: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom创建后，未显示</span>
        onShow: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom隐藏前</span>
        onHide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

        }
    });

    </span><span style="color: #008000;">//</span><span style="color: #008000;">组件状态,未创建</span>
    AbstractView.STATE_NOTCREATE = 'notCreate'<span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已创建但未显示</span>
    AbstractView.STATE_ONCREATE = 'onCreate'<span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已显示</span>
    AbstractView.STATE_ONSHOW = 'onShow'<span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">组件状态,已隐藏</span>
    AbstractView.STATE_ONHIDE = 'onHide'<span style="color: #000000;">;

    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> AbstractView;

});</span></pre>
</div>
<span class="cnblogs_code_collapse">c.view</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('053aba0e-e589-4c69-ba68-61000f256ba9')"><img id="code_img_closed_053aba0e-e589-4c69-ba68-61000f256ba9" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_053aba0e-e589-4c69-ba68-61000f256ba9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('053aba0e-e589-4c69-ba68-61000f256ba9',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_053aba0e-e589-4c69-ba68-61000f256ba9" class="cnblogs_code_hide">
<pre>define(['$', 'cBase', 'cView'], <span style="color: #0000ff;">function</span><span style="color: #000000;"> ($, b, AbstractView) {
    </span><span style="color: #0000ff;">var</span> View =<span style="color: #000000;"> b.Class(AbstractView, {
        _propertys_: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">this</span>.template = '我是叶小钗'<span style="color: #000000;">;
        },
        init: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (superInit) {
            console.log(superInit);
            console.log(</span>'init'<span style="color: #000000;">);
        },
        createHtml: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            </span><span style="color: #0000ff;">var</span> htm =<span style="color: #000000;"> [
            </span>'&lt;header&gt;标题&lt;/header&gt;'<span style="color: #000000;">,
            </span>'&lt;div class="main"&gt;'<span style="color: #000000;">,
                </span>'&lt;input type="text" id="txt" /&gt;'<span style="color: #000000;">,
                </span>'&lt;input type="button" id="bt" value="点击我" /&gt;'<span style="color: #000000;">,
                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.template,
            </span>'&lt;/div&gt;'<span style="color: #000000;">,
            </span>'&lt;footer&gt;页尾&lt;/footer&gt;'<span style="color: #000000;">
            ].join(</span>''<span style="color: #000000;">);
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> htm;
        },
        attrs: {
            </span>'data-id': 'test'<span style="color: #000000;">,
            className: </span>'yexiaoc'<span style="color: #000000;">
        },
        events: {
            </span>'#bt,click': <span style="color: #0000ff;">function</span><span style="color: #000000;"> (el) {
                </span><span style="color: #0000ff;">var</span> txt = <span style="color: #0000ff;">this</span>.find('#txt'<span style="color: #000000;">);
                alert(txt.val())
            }
        },
        onCreate: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            console.log(</span>'onCreate'<span style="color: #000000;">);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom创建后数据加载时执行，用于加载后执行我们的逻辑</span>
        onLoad: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            console.log(</span>'onLoad'<span style="color: #000000;">);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom创建后，未显示</span>
        onShow: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            console.log(</span>'onShow'<span style="color: #000000;">);
        },
        </span><span style="color: #008000;">//</span><span style="color: #008000;">dom隐藏前</span>
        onHide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            console.log(</span>'onHide'<span style="color: #000000;">);
        }
    });

    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> View;
});</span></pre>
</div>
<span class="cnblogs_code_collapse">index</span></div>
<p>至此我们的代码便完全分离开了，接下来我们来细化我们的app文件。</p>
<h2>细化app</h2>
<p>待续......</p>
<p>&nbsp;</p>
<h1>结语</h1>
<p>写了几个小时了，有点累，休息下，我们晚上在继续</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf01jhyp/index.html">【初探移动前端开发01】惊鸿一瞥</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf02ydsbdym/index.html">【初探移动前端开发02】移动设备的页面</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf03jQueryMobiles/index.html">【初探移动前端开发03】jQueryMobile（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf04jQueryMobile(z)/index.html">【初探移动前端开发04】jQueryMobile(中)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf05jQueryMobile(x)/index.html">【初探移动前端开发05】jQueryMobile(下)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ctydqdkf05jQueryMobile(zhb)/index.html">【初探移动前端开发05】jQueryMobile(整合版)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/dyyyyqldyyybsxjdwbgnx/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（下）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/dyyyyqldyyybsxjdwbgnzj/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（总结）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/dfastclickymygcdjjtapdttsydddjxysd/index.html">【读fastclick源码有感】彻底解决tap“点透”，提升移动端点击响应速度</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/fiphonerlcj(beta)/index.html">仿iphone日历插件(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/ydzmlwmyqlyjlqrhjcsfazappb/index.html">又到周末了，我们一起来研究【浏览器如何检测是否安装app】吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/tsscsbdjsdztouchsjdldk/index.html">提升手持设备点击速度之touch事件带来的坑！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>