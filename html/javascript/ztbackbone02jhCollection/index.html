<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>【再探backbone02】集合Collection</div><br><h1>前言</h1>
<p>昨天我们一起学习了backbone的model，我个人对backbone的熟悉程度提高了，但是也发现一个严重的问题！！！</p>
<p>我平时压根没有用到model这块的东西，事实上我只用到了view，所以昨天学习的效果其实不佳，比起上次对underscore的熟悉，对zepto的熟悉，甚至对fastclick的熟悉</p>
<p>学习效率打了折扣，而且一些地方不明不白，所以，我今天决定将速度放慢，我们学习collection时候先做小例子，争取覆盖关键点，然后再从源码学习，于是开始吧</p>
<p><a id="homepage1_HomePageDays_DaysList_DayItem_0_DayList_0_TitleUrl_0" class="postTitle2" href="http://www.cnblogs.com/yexiaochai/p/3485109.html">【再探backbone 01】模型-Model</a></p>
<p><a id="PostsList1_rpPosts_TitleUrl_2" href="http://www.cnblogs.com/yexiaochai/p/3221081.html">RequireJS与Backbone简单整合</a></p>
<p><a id="PostsList1_rpPosts_TitleUrl_3" href="http://www.cnblogs.com/yexiaochai/p/3219402.html">初探Backbone</a><span>&nbsp;</span></p>
<h1><span>集合-Collection</span></h1>
<h2><span>实例解析</span></h2>
<p><span>首先回到我们熟悉的官方例子，其中关于集合的叙述不多，官方的例子流程如下：</span></p>
<h3><span>① 定义模型Model</span></h3>
<p><span>这个model很简单，基本没有干什么有意义的事情，验证的事情都没有干，说到这里有一点需要注意：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #800000;">我们在实际项目中，无论是使用backbone的model或者自己实现了model
都一定要提供validate验证机制，或者验证方法，这个可以让我们的程序更加稳健！</span></pre>
</div>
<p><span style="line-height: 1.5;">举个例子来说，我们的程序中model会读取来自服务器端的数据，正常情况下是这样的：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">{
data1: [{name: </span>'叶小钗'<span style="color: #000000;">, ......},],
data2: ......
}</span></pre>
</div>
<p>但是如果有一天我们的服务器出错了，他会返回错误的数据，或者空数据，而前端的代码没有做容错处理的话，这个数据就会被写入localstorage</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">{
data1: {},
data2: {}
}</span></pre>
</div>
<p>这个json对象当然不为空，因为我们model的机制是为空时候会拉取数据，不为空则直接读取localstorage数据，但是事实上，在业务逻辑上这个数据是为空的！！！</p>
<p>所以，我们的程序表现上就是列表为空，读不到数据了，这可以引发很不好的问题</p>
<p>但是如果我们这个model有一个validate方法用于验证model的正确性的话，就可以避免这个问题了！</p>
<p>以我们官方的例子来说，他这个Todo的model事实上应该验证title为空的情况，但他没有这么做，他将数据的验证放到了view里面</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> createOnEnter: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">2</span>   <span style="color: #0000ff;">if</span> (e.keyCode != 13) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">3</span>   <span style="color: #ff0000;">if (!this.input.val()) return;
</span><span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span>   Todos.create({ title: <span style="color: #0000ff;">this</span><span style="color: #000000;">.input.val() });
</span><span style="color: #008080;">6</span>   <span style="color: #0000ff;">this</span>.input.val(''<span style="color: #000000;">);
</span><span style="color: #008080;">7</span> },</pre>
</div>
<p>但是如果我们导入model数据的方式不止一种，或者要批量导入时候，view要面临的问题就相对复杂一点了，总而言之Todo模型应该具有validate验证函数</p>
<p>validate函数不返回数据就是验证成功，否则失败是不会执行set方法的，所以，我这里将view中的验证去掉，将验证写入model，我们先走一次流程：</p>
<p>1 AppView会触发createOnEnter事件，本来这里有一个为空验证，被我破坏掉了</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> createOnEnter: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">2</span>   <span style="color: #0000ff;">if</span> (e.keyCode != 13) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">3</span> <span style="color: #008000;">//</span><span style="color: #008000;">    if (this.input.val() == '') return;</span>
<span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span>   Todos.create({ title: <span style="color: #0000ff;">this</span><span style="color: #000000;">.input.val() });
</span><span style="color: #008080;">6</span>   <span style="color: #0000ff;">this</span>.input.val(''<span style="color: #000000;">);
</span><span style="color: #008080;">7</span> },</pre>
</div>
<p>2 执行集合的create方法</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 向集合中添加并创建一个模型, 同时将该模型保存到服务器</span>
<span style="color: #008080;"> 2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是通过数据对象来创建模型, 需要在集合中声明model属性对应的模型类</span>
<span style="color: #008080;"> 3</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 如果在options中声明了wait属性, 则会在服务器创建成功后再将模型添加到集合, 否则先将模型添加到集合, 再保存到服务器(无论保存是否成功)</span>
<span style="color: #008080;"> 4</span> create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (model, options) {
</span><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">var</span> coll = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 6</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 定义options对象</span>
<span style="color: #008080;"> 7</span>   options = options ?<span style="color: #000000;"> _.clone(options) : {};
</span><span style="color: #008080;"> 8</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 通过_prepareModel获取模型类的实例</span>
<span style="color: #008080;"> 9</span>   model = <span style="color: #0000ff;">this</span><span style="color: #000000;">._prepareModel(model, options);
</span><span style="color: #008080;">10</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 模型创建失败</span>
<span style="color: #008080;">11</span>   <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">model)
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">13</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 如果没有声明wait属性, 则通过add方法将模型添加到集合中</span>
<span style="color: #008080;">14</span>   <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">options.wait)
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    coll.add(model, options);
</span><span style="color: #008080;">16</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> success存储保存到服务器成功之后的自定义回调函数(通过options.success声明)</span>
<span style="color: #008080;">17</span>   <span style="color: #0000ff;">var</span> success =<span style="color: #000000;"> options.success;
</span><span style="color: #008080;">18</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 监听模型数据保存成功后的回调函数</span>
<span style="color: #008080;">19</span>   options.success = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (nextModel, resp, xhr) {
</span><span style="color: #008080;">20</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果声明了wait属性, 则在只有在服务器保存成功后才会将模型添加到集合中</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (options.wait)
</span><span style="color: #008080;">22</span> <span style="color: #000000;">      coll.add(nextModel, options);
</span><span style="color: #008080;">23</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果声明了自定义成功回调, 则执行自定义函数, 否则将默认触发模型的sync事件</span>
<span style="color: #008080;">24</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (success) {
</span><span style="color: #008080;">25</span> <span style="color: #000000;">      success(nextModel, resp);
</span><span style="color: #008080;">26</span>     } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">27</span>       nextModel.trigger('sync'<span style="color: #000000;">, model, resp, options);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">30</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 调用模型的save方法, 将模型数据保存到服务器</span>
<span style="color: #008080;">31</span>   model.save(<span style="color: #0000ff;">null</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">32</span>   <span style="color: #0000ff;">return</span><span style="color: #000000;"> model;
</span><span style="color: #008080;">33</span> },</pre>
</div>
<p>3 这里的model需要通过_prepareModel进行处理</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 将模型添加到集合中之前的一些准备工作</span>
<span style="color: #008080;"> 2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 包括将数据实例化为一个模型对象, 和将集合引用到模型的collection属性</span>
<span style="color: #008080;"> 3</span> _prepareModel: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (model, options) {
</span><span style="color: #008080;"> 4</span>   options || (options =<span style="color: #000000;"> {});
</span><span style="color: #008080;"> 5</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 检查model是否是一个模型对象(即Model类的实例)</span>
<span style="color: #008080;"> 6</span>   <span style="color: #0000ff;">if</span> (!(model <span style="color: #0000ff;">instanceof</span><span style="color: #000000;"> Model)) {
</span><span style="color: #008080;"> 7</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 传入的model是模型数据对象, 而并非模型对象</span>
<span style="color: #008080;"> 8</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 将数据作为参数传递给Model, 以创建一个新的模型对象</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">var</span> attrs =<span style="color: #000000;"> model;
</span><span style="color: #008080;">10</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 设置模型引用的集合</span>
<span style="color: #008080;">11</span>     options.collection = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 将数据转化为模型</span>
<span style="color: #008080;">13</span>     <span style="color: #ff0000;">model = new this.model(attrs, options);
</span><span style="color: #008080;">14</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 对模型中的数据进行验证</span>
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">model._validate(model.attributes, options))
</span><span style="color: #008080;">16</span>       model = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">17</span>   } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">model.collection) {
</span><span style="color: #008080;">18</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果传入的是一个模型对象但没有建立与集合的引用, 则设置模型的collection属性为当前集合</span>
<span style="color: #008080;">19</span>     model.collection = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">20</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">21</span>   <span style="color: #0000ff;">return</span><span style="color: #000000;"> model;
</span><span style="color: #008080;">22</span> },</pre>
</div>
<p>他在13行进行了model实例化，但是并没有执行我们的validate验证，接下来便是执行了一次validate验证，如果验证不通过就完蛋</p>
<p>这里比较烦的是，他这里没有走我们的验证流程，因为在第一个判断就直接跳出来了，而save时候验证了数据有效性，所以数据没有写往localstorage但是页面上却多了一条记录</p>
<p><img src="30194927064451.png" alt=""><img src="22473968528105.png" alt=""></p>
<p>这里的处理，我其实是认为有问题的，这里未验证其实是因为初始化时候不需要验证，但是我们传一个参数就会发生验证</p>
<div class="cnblogs_code">
<pre>Todos.create({ title: <span style="color: #0000ff;">this</span>.input.val() }, {validate: <span style="color: #0000ff;">true</span>});</pre>
</div>
<p>在这里，我们扯得有点远了，稍微回顾了下昨天学习的model的知识，现在继续向后面走</p>
<h3>② 定义collection</h3>
<p>有了Todo模型后，于是便定义了一个集合，并且对其进行了实例化</p>
<p>这个例子作为demo没什么问题，但是一般项目中，list不可能像这样全局化，多是与view进行关联，view之间以localstorage进行数据通信</p>
<p>所以跳往 b view时候数据早在a view时候已经准备好，因为我也没有使用backbone的collection进行项目开发，这里不太能看清意图，但是在view里面进行实例化比较靠谱</p>
<p>比如在APPView的initialize中进行实例化，而构造函数以require的方式进行引入</p>
<p>backbone的集合本身方法多源于underscore的集合方法：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> methods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl'<span style="color: #000000;">,
</span><span style="color: #008080;"> 2</span>   'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select'<span style="color: #000000;">,
</span><span style="color: #008080;"> 3</span>   'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke'<span style="color: #000000;">,
</span><span style="color: #008080;"> 4</span>   'max', 'min', 'toArray', 'size', 'first', 'head', 'take', 'initial', 'rest'<span style="color: #000000;">,
</span><span style="color: #008080;"> 5</span>   'tail', 'drop', 'last', 'without', 'indexOf', 'shuffle', 'lastIndexOf'<span style="color: #000000;">,
</span><span style="color: #008080;"> 6</span>   'isEmpty', 'chain'<span style="color: #000000;">];
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Mix in each Underscore method as a proxy to `Collection#models`.</span>
<span style="color: #008080;"> 9</span> _.each(methods, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (method) {
</span><span style="color: #008080;">10</span>   Collection.prototype[method] = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">var</span> args =<span style="color: #000000;"> slice.call(arguments);
</span><span style="color: #008080;">12</span>     args.unshift(<span style="color: #0000ff;">this</span><span style="color: #000000;">.models);
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> _[method].apply(_, args);
</span><span style="color: #008080;">14</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">15</span> });</pre>
</div>
<p>这里依然有几点需要注意：</p>
<p>1 因为这里未与服务器发生交互，用于存储数据的就是localstorage</p>
<div class="cnblogs_code">
<pre>localStorage: <span style="color: #0000ff;">new</span> Backbone.LocalStorage("todos-backbone"),</pre>
</div>
<p>持久层我们一般会自己实现，与服务器的交互也不会使用backbone本身的，所以model与持久层通信这块可以选择放弃</p>
<p>2 这里TodoList提供了几个方法多用于筛选数据，本身底层是调用underscore的方法筛选/排序自己内部models</p>
<p>但是model里面居然使用了集合中的nextOrder方法获取顺序标识，这里不知道各位怎么看，我反正觉得怪怪的.....</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">2</span>   title: "empty todo..."<span style="color: #000000;">,
</span><span style="color: #008080;">3</span> <span style="color: #000000;">  order: Todos.nextOrder(),
</span><span style="color: #008080;">4</span>   done: <span style="color: #0000ff;">false</span>
<span style="color: #008080;">5</span> };</pre>
</div>
<p>model里面的这个order我个人觉得十分不好，有可能我这个模型还得用于其它集合，而其它集合未必是Todos，但是这里写死了</p>
<p>而且其它集合未必具有nextOrder这个方法，所以官方这个例子真的就只是一个demo啊......</p>
<p>list方面本身没什么难度，根据我们这两天的学习可以做一个总结：</p>
<div class="cnblogs_code">
<pre><span style="color: #800000;">Backbone Model
用于封装数据对象，并且提供数据改变时候的change事件以及数据正确性验证的validate方法
总而言之，这个model就是用于数据操作，并且数据改变时候可以通知到view

Backbone Collection
用于封装Model对象，其中提供了很多处理model的方法，比如排序分组什么的</span></pre>
</div>
<p>当然，这个只是第一阶段的认识，更多的了解根据学习的深入会逐步展开，而且我感觉要深入学习Backbone还是得好好的用一用</p>
<h3>③ 绑定事件</h3>
<p>从程序可以看出Todos（实例化的TodoList）只用于了AppView，而这里的AppView有点担当了控制器的意思，</p>
<p>在实例化AppView时，便为Todos注册了三大事件，我们Todolist继承了Events对象，各位不要忘了哦</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">this</span>.listenTo(Todos, 'add', <span style="color: #0000ff;">this</span><span style="color: #000000;">.addOne);
</span><span style="color: #008080;">2</span> <span style="color: #0000ff;">this</span>.listenTo(Todos, 'reset', <span style="color: #0000ff;">this</span><span style="color: #000000;">.addAll);
</span><span style="color: #008080;">3</span> <span style="color: #0000ff;">this</span>.listenTo(Todos, 'all', <span style="color: #0000ff;">this</span>.render);</pre>
</div>
<p>初始化结束后会执行fetch函数获得数据，数据获取结束便又会调用model set方法装入数据，并且触发model的change事件，而导致TodoView的render触发</p>
<p>然后AppView获取TodoView的dom结构后将其dom结构展示到页面即可</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">this</span>.listenTo(<span style="color: #0000ff;">this</span>.model, 'change', <span style="color: #0000ff;">this</span><span style="color: #000000;">.render);
</span><span style="color: #0000ff;">this</span>.listenTo(<span style="color: #0000ff;">this</span>.model, 'destroy', <span style="color: #0000ff;">this</span>.remove);</pre>
</div>
<p>于是我们实例解析便基本结束了，接下来看看源码相关</p>
<h2>构造函数</h2>
<p>backbone中的集合时模型的有序组合，我们可以在集合上绑定change事件，从而当集合中的模型发生变化时获得通知</p>
<p>集合也可以注册事件，从服务器端得到更新，集合中的模型触发的任何事件都可以在集合上直接触发，我们可以监听集合中模型的变化</p>
<p><span>首先依然来看看他的初始化的构造函数：</span></p>
<div class="cnblogs_code">
<pre><span>1</span> <span>var</span> Collection = Backbone.Collection = <span>function</span><span> (models, options) {
</span><span>2</span>   options || (options =<span> {});
</span><span>3</span>   <span>if</span> (options.url) <span>this</span>.url =<span> options.url;
</span><span>4</span>   <span>if</span> (options.model) <span>this</span>.model =<span> options.model;
</span><span>5</span>   <span>if</span> (options.comparator !== <span>void</span> 0) <span>this</span>.comparator =<span> options.comparator;
</span><span>6</span>   <span>this</span><span>._reset();
</span><span>7</span>   <span>this</span>.initialize.apply(<span>this</span><span>, arguments);
</span><span>8</span>   <span>if</span> (models) <span>this</span>.reset(models, _.extend({ silent: <span>true</span><span> }, options));
</span><span>9</span> };</pre>
</div>
<p>前几行没什么好说的，其中实例化时会重置集合内部的状态，第一次定义即为初始化，第二次为重置</p>
<div class="cnblogs_code">
<pre><span>1</span> _reset: <span>function</span><span> () {
</span><span>2</span>   <span>this</span>.length = 0<span>;
</span><span>3</span>   <span>this</span>.models =<span> [];
</span><span>4</span>   <span>this</span>._byId =<span> {};
</span><span>5</span> },</pre>
</div>
<p>让后调用初始化方法initialize，如果这里设置了多个models的话，会执行reset方法，如果指定了models数据, 则调用reset方法将数据添加到集合中</p>
<p>首次调用时设置了silent参数, 因此不会触发"reset"事件</p>
<div class="cnblogs_code">
<pre><span> 1</span> reset: <span>function</span><span> (models, options) {
</span><span> 2</span>   options || (options =<span> {});
</span><span> 3</span>   <span>for</span> (<span>var</span> i = 0, l = <span>this</span>.models.length; i &lt; l; i++<span>) {
</span><span> 4</span>     <span>this</span>._removeReference(<span>this</span><span>.models[i]);
</span><span> 5</span> <span>  }
</span><span> 6</span>   options.previousModels = <span>this</span><span>.models;
</span><span> 7</span>   <span>this</span><span>._reset();
</span><span> 8</span>   <span>this</span>.add(models, _.extend({ silent: <span>true</span><span> }, options));
</span><span> 9</span>   <span>if</span> (!options.silent) <span>this</span>.trigger('reset', <span>this</span><span>, options);
</span><span>10</span>   <span>return</span> <span>this</span><span>;
</span><span>11</span> },</pre>
</div>
<p>reset用于替换集合中所有模型数据，该操作将删除集合中当前的数据和状态，重新设置models，models一般为二维数据对象</p>
<p>这里会删除原model与集合的映射关系，但是并没有删除model本身</p>
<div class="cnblogs_code">
<pre>_removeReference: <span>function</span><span> (model) {
  </span><span>if</span> (<span>this</span> === model.collection) <span>delete</span><span> model.collection;
  model.off(</span>'all', <span>this</span>._onModelEvent, <span>this</span><span>);
},</span></pre>
</div>
<p><span style="line-height: 1.5;">其实从官网的代码来看，构造函数里面的东西基本没有用到，官网的代码的集合充其量就是一个容器，所以要学习这块还需要更好的例子</span></p>
<h1><span style="line-height: 1.5;">结语</span></h1>
<p><span style="line-height: 1.5;">这篇博客暂时到这里，我发现没有好的例子学习效率确实不高，下来先写一个例子，再根据例子学习吧</span></p>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptzdyxhxzsdyjxyzyddf/index.html">javascript中的一些核心知识点以及需要注意的地方</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]webappdyhzlyzydqdyhdpyjlkkb/index.html">[置顶]【webapp的优化整理】要做移动前端优化的朋友进来看看吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]yddjrwtyjjavascriptsjjzxjsjydjr/index.html">[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntzhb30fzxhsygruntdbqddm/index.html">【grunt整合版】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdyd30fzxhsygruntdbqddm/index.html">【grunt第一弹】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdsdgruntzqdsjxmzdyy/index.html">【grunt第三弹】grunt在前端实际项目中的应用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntded30fzxhsygruntdbqddm02/index.html">【grunt第二弹】30分钟学会使用grunt打包前端代码（02）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxtpyddhadlqs/index.html">【IScroll深入学习】突破移动端黑暗的利器（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxjjIScrollynzz/index.html">【IScroll深入学习】解决IScroll疑难杂症</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx00mniScroll/index.html">【iScroll源码学习00】模拟iScroll</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx01zbjd/index.html">【iScroll源码学习01】准备阶段</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx02fjiScrollsghxsjd/index.html">【iScroll源码学习02】分解iScroll三个核心事件点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx03iScrollsjjzygdtdsx/index.html">【iScroll源码学习03】iScroll事件机制与滚动条的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx04flIScrollhx/index.html">【iScroll源码学习04】分离IScroll核心</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdytyyjc/index.html">【javascript培训第一天】语言基础</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdstcybl/index.html">【javascript培训第三天】查遗补漏</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdetDOMyBOM/index.html">【javascript培训第二天】DOM与BOM</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk01mkhbc/index.html">【javascript激增的思考01】模块化编程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk02mkhyMVC/index.html">【javascript激增的思考02】模块化与MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk03MVVMyKnockout/index.html">【javascript激增的思考03】MVVM与Knockout</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk04MVCyBackbonejs(beta)/index.html">【javascript激增的思考04】MVC与Backbonejs(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptmxdxzlrwmyqltkdzb01/index.html">【javascript面向对象之路】让我们一起来坦克大战吧01</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/NodeJSxxbj04xwfbxt/index.html">【NodeJS学习笔记04】新闻发布系统</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx01ljzgrequireJSdjg/index.html">【requireJS源码学习01】了解整个requireJS的结构</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx02datamainjzdsx/index.html">【requireJS源码学习02】datamain加载的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx03xjrequireJSdjzlc/index.html">【requireJS源码学习03】细究requireJS的加载流程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjkfygjdrlcjs/index.html">【UI插件】开发一个简单日历插件（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjjddrlcjxxxMVCsx/index.html">【UI插件】简单的日历插件（下）——学习MVC思想</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()/index.html">【zepto学习笔记01】核心方法$()</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()b/index.html">【zepto学习笔记01】核心方法$()（补）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj02lsd/index.html">【zepto学习笔记02】零碎点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj03sjjz/index.html">【zepto学习笔记03】事件机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmsztjavascriptzdjc/index.html">【一次面试】再谈javascript中的继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone01mxModel/index.html">【再探backbone01】模型Model</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone02jhCollection/index.html">【再探backbone02】集合Collection</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone03bkydyyysltgym/index.html">【再探backbone03】博客园单页应用实例（提供源码）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone04dyyydjslycl/index.html">【再探backbone04】单页应用的基石路由处理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ctUnderscorezsmbyq/index.html">【初探Underscore】再说模版引擎</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzAjaxjsxnszddAjax/index.html">【初窥javascript奥秘之Ajax】简述下你所知道的Ajax？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjmpnxnwmyqmdp/index.html">【初窥javascript奥秘之事件冒泡】那些年我们一起冒的泡</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjjzldtygdj/index.html">【初窥javascript奥秘之事件机制】论“点透”与“鬼点击”</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzrrzmbddthisnzdxzthiszxnlm/index.html">【初窥javascript奥秘之让人捉摸不定的this】你知道现在this指向哪里吗？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzbbydxbdhlqbcl/index.html">【初窥javascript奥秘之闭包】叶大侠病都好了，求不踩了：）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzmxdxfzyjc/index.html">【初窥javascript奥秘之面向对象】封装与继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/qdmdsjdjgjdnzdljm/index.html">【前端盲点】事件的几个阶段你真的了解么？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyviewymodelxgsl/index.html">【单页应用】view与model相关梳理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyyqldyyybsxjdwbgns/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyqjkzqappyggxsm/index.html">【单页应用】全局控制器app应该干些什么？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyywmgrhclkjdcccjgx/index.html">【单页应用】我们该如何处理框架弹出层层级关系？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyljMVC/index.html">【单页应用】理解MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyztxjzviewzjygrhtx/index.html">【单页应用之通信机制】view之间应该如何通信</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyjkzHistoryxsHistorydgdyyydm/index.html">【单页应用巨坑之History】细数History带给单页应用的噩梦</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtszeptofindysyjiosdcjpknrnhtt/index.html">【小贴士】zeptofind元素以及ios弹出键盘可能让你很头疼</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgytransitionEndanimatedygyqgs/index.html">【小贴士】关于transitionEndanimate的一个有趣故事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgzzdbbysjwtdzzmp/index.html">【小贴士】工作中的”闭包“与事件委托的”阻止冒泡“</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtstytjavascriptzdreplace/index.html">【小贴士】探一探javascript中的replace</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsxnjpyfixeddgydddt/index.html">【小贴士】虚拟键盘与fixed带给移动端的痛！</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ttjavascriptsjjzdcsxyl/index.html">【探讨】javascript事件机制底层实现原理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mkhbcljrequireJSsxygjddmkjzq/index.html">【模块化编程】理解requireJS实现一个简单的模块加载器</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zyJavaScriptmfjmtsdqlxkjzbfgndcljz/index.html">【转】【译】JavaScript魔法揭秘探索当前流行框架中部分功能的处理机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl01javascriptcszds/index.html">【追寻javascript高手之路01】javascript参数知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl02blzyyzds/index.html">【追寻javascript高手之路02】变量、作用域知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl03javascriptdxdld/index.html">【追寻javascript高手之路03】javascript对象大乱斗</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl04ljprototype/index.html">【追寻javascript高手之路04】理解prototype</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl05ljsjl/index.html">【追寻javascript高手之路05】理解事件流</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj04zxzzsj(2)/index.html">【重构笔记04】重新组织数据(2)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj05jhtjbds/index.html">【重构笔记05】简化条件表达式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj06jhhsdy/index.html">【重构笔记06】简化函数调用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmshgttbxysjfl/index.html">一次面试回顾——探讨表现与数据分离</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dhzwebappzdxz/index.html">动画在webapp中的现状</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ysandriodlqhthdomclicksjqtsxwttj/index.html">原生andriod浏览器回退后dom（click）事件全体失效问题探究</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/scsbdjxysdsbsjytouchsjdnxs/index.html">手持设备点击响应速度，鼠标事件与touch事件的那些事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mnbjQueryzeptohxymfx/index.html">迷你版jQuery——zepto核心源码分析</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dbsgzdlwmlyqxjdddomxzqb/index.html">都别说工资低了，我们来一起写简单的dom选择器吧！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>