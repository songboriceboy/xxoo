<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</div><br><h1>前言</h1>
<p>这篇博客有点长，如果你是高手请您读一读，能对其中的一些误点提出来，以免我误人子弟，并且帮助我提高</p>
<p>如果你是javascript菜鸟，建议您好好读一读，真的理解下来会有不一样的收获</p>
<p>在下才疏学浅，文中难免会有不同程度的错误，请您指正留言<span style="font-size: 14px; line-height: 1.5;">&nbsp;</span></p>
<p><span style="font-size: 14px; line-height: 1.5; color: #ff0000;">PS：事件阶段一节请看最新博客，之前理解有误</span></p>
<h1>javascript事件基础</h1>
<p>我们的网页之所以丰富多彩并具有交互功能，是因为我们的javascript脚本语言，而javascript与HTML之间的交互又是通过事件机制实现的</p>
<p>所以，事件是javascript一大核心，深入了解事件机制在我们遇到较困难问题时候十分有帮助</p>
<p>所谓事件，就是网页发生的一些瞬间（比如点击、滑动），在这些瞬间我们使用事件监听器（回调函数）去订阅事件，在事件发生时候我们的回调函数就会触发</p>
<p>观察者模式的javascript事件机制的基石，这种异步事件编程模型，就是用户产生特定的操作，浏览器就会产生特定的事件，我们若是订阅了事件，回调就会触发</p>
<p>好了，我们下面就来研究下javascript事件机制的几个关键点。</p>
<h2>事件捕获/冒泡</h2>
<p>网页上的布局很复杂，我们对页面的单一操作有可能产生预计以外的影响：</p>
<p>比如我点击一个span，我可能就想点击一个span，试试上他是先点击document，然后点击事件传递到span的，而且并不会在span停下，span有子元素就会继续往下，最后会依次回传至document，我们这里偷一张图：</p>
<p><img src="411157710318383.png" alt=""></p>
<p>我们这里偷了一张图，这张图很好的说明了事件的传播方式</p>
<div class="cnblogs_code">
<pre><span style="color: #800000;">事件冒泡即由最具体的元素（文档嵌套最深节点）接收，然后逐步上传至document

事件捕获会由最先接收到事件的元素然后传向最里边（我们可以将元素想象成一个盒子装一个盒子，而不是一个积木堆积）</span></pre>
</div>
<p><span style="line-height: 1.5;">这里我们进入dom事件流，这里我们详细看看javascript事件的传递方式</span></p>
<h3>DOM事件流</h3>
<p>DOM2级事件规定事件包括三个阶段：</p>
<p>① 事件捕获阶段</p>
<p>② 处于目标阶段</p>
<p>③ 事件冒泡阶段</p>
<p>这里说起来不太明显，我们来一个例子吧：</p>
<p>15708845301073.jpg</p>
<p><iframe src="15708845301073.jpg" width="80%" height="200"></iframe></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="background-color: #f5f5f5; color: #800000;">         #p </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">  border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #800000;">         #c </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid red</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="p"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">        parent
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="c"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">            child
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> p </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">p</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">),
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            c </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">c</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点捕获</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点冒泡</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">26</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">27</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">28</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;这个代码比较简单，我们主要点击child即可，这里要证明的就是点击事件是先捕获再冒泡，所以我们这里来一个复杂点的关系：</p>
<p>274411910134217.jpg</p>
<p><iframe src="274411910134217.jpg" width="80%" height="200"></iframe></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="background-color: #f5f5f5; color: #800000;">         #p </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">  border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #800000;">         #c </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid red</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="p"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">        parent
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="c"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">            child
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> p </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">p</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">),
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        c </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">c</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点捕获</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点冒泡</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        p.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">父节点捕获</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">        p.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">父节点冒泡</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">33</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">34</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">35</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">36</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="line-height: 1.5;">现在这个家伙就比较实在了，不注意就容易晕的，我们来稍微理一理：</span></p>
<p><span style="line-height: 1.5;">① 点击parent，事件首先在document上然后parent捕获到事件，处于目标阶段然后event.target也等于parent，所以触发捕获事件</span></p>
<p><span style="line-height: 1.5;">由于target与currentTarget相等了，</span><span style="line-height: 1.5;">所以认为到底了，开始冒泡，执行冒泡事件</span></p>
<p><span style="line-height: 1.5;">② 点击child情况有所不同，事件由document传向parent执行事件，然后传向child最后开始冒泡，所以执行顺序各位一定要清晰</span></p>
<p><span style="line-height: 1.5;"><img src="440399910030708.png" alt=""></span></p>
<p>至此，我们事件传输结束，下面开始研究事件参数<span style="line-height: 1.5;">&nbsp;</span></p>
<h2>事件对象</h2>
<p>所谓事件对象，是与特定对象相关，并且包含该事件详细信息的对象。</p>
<p>事件对象作为参数传递给事件处理程序（IE8之前通过window.event获得），所有事件对象都有事件类型type与事件目标target（IE8之前的srcElement我们不关注了）</p>
<p>各个事件的事件参数不一样，比如鼠标事件就会有相关坐标，包含和创建他的特定事件有关的属性和方法，触发的事件不一样，参数也不一样（比如鼠标事件就会有坐标信息），我们这里题几个较重要的</p>
<p>PS：以下的兄弟全部是只读的，所以不要妄想去随意更改，IE之前的问题我们就不关注了</p>
<h3>bubbles</h3>
<p>表明事件是否冒泡</p>
<h3>cancelable</h3>
<p>表明是否可以取消事件的默认行为</p>
<h3>currentTarget</h3>
<p>某事件处理程序当前正在处理的那个元素</p>
<h3>defaultPrevented</h3>
<p>为true表明已经调用了preventDefault（DOM3新增）</p>
<h3>eventPhase</h3>
<p>调用事件处理程序的阶段：1 捕获；2 处于阶段；3 冒泡阶段</p>
<p>这个属性的变化需要在断点中查看，不然你看到的总是0</p>
<h3>target</h3>
<p>事件目标（绑定事件那个dom）</p>
<h3>trusted</h3>
<p>true表明是系统的，false为开发人员自定义的（DOM3新增）</p>
<h3>type</h3>
<p>事件类型</p>
<h3>view</h3>
<p>与事件关联的抽象视图，发生事件的window对象</p>
<h3>preventDefault</h3>
<p>取消事件默认行为，cancelable是true时可以使用</p>
<h3>stopPropagation</h3>
<p>取消事件捕获/冒泡，bubbles为true才能使用</p>
<h3>stopImmediatePropagation</h3>
<p>取消事件进一步冒泡，并且组织任何事件处理程序被调用（DOM3新增）</p>
<p>在我们的事件处理内部，this与currentTarget相同</p>
<h3>createEvent</h3>
<p>可以在document对象上使用createEvent创建一个event对象</p>
<p>&nbsp; &nbsp; &nbsp;DOM3新增以下事件： <br>&nbsp;&nbsp;&nbsp;&nbsp; UIEvents    <br>&nbsp;&nbsp;&nbsp;&nbsp; MouseEvents    <br>&nbsp;&nbsp;&nbsp;&nbsp; MutationEvents，一般化dom变动    <br>&nbsp;&nbsp;&nbsp;&nbsp; HTMLEvents一般dom事件</p>
<p>创建鼠标事件时需要创建的事件对象需要提供指定的信息（鼠标位置信息），我们这里提供以下参数：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> type = 'click'; <span style="color: #008000;">//</span><span style="color: #008000;">要触发的事件类型</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">var</span> bubbles = <span style="color: #0000ff;">true</span>; <span style="color: #008000;">//</span><span style="color: #008000;">事件是否可以冒泡</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">var</span> cancelable = <span style="color: #0000ff;">true</span>; <span style="color: #008000;">//</span><span style="color: #008000;">事件是否可以阻止浏览器默认事件</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">var</span> view = document.defaultView; <span style="color: #008000;">//</span><span style="color: #008000;">与事件关联的视图，该属性默认即可，不管</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">var</span> detail = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">var</span> screenX = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">var</span> screenY = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">var</span> clientX = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">var</span> clientY = 0<span style="color: #000000;">;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">var</span> ctrlKey = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">是否按下ctrl</span>
<span style="color: #008080;">11</span> <span style="color: #0000ff;">var</span> altKey = <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//</span><span style="color: #008000;">是否按下alt</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">var</span> shiftKey = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">var</span> metaKey = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">var</span> button = 0;<span style="color: #008000;">//</span><span style="color: #008000;">表示按下哪一个鼠标键</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">var</span> relatedTarget = 0; <span style="color: #008000;">//</span><span style="color: #008000;">模拟mousemove或者out时候用到，与事件相关的对象</span>
<span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #0000ff;">var</span> event = document.createEvent('MouseEvents'<span style="color: #000000;">);
</span><span style="color: #008080;">18</span> <span style="color: #000000;">event.initMouseEvent(type, bubbles, cancelable, view, detail, screenX, screenY, clientX, clientY, 
</span><span style="color: #008080;">19</span> ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget);</pre>
</div>
<p>如此，我们就自己创建了一个event对象，然后可以传给我们自己创建的事件，这个知识点，我们下面再说</p>
<p>PS：值得注意的是，我们自己创建的event对象可以有一点不一样的东西，比如我们的事件对象可能多了一个这种属性：</p>
<div class="cnblogs_code">
<pre>event.flag = '叶小钗'</pre>
</div>
<h2><span style="font-size: 1.5em; line-height: 1.5;">事件模拟</span></h2>
<p><span style="line-height: 1.5;">事件模拟是javascript事件机制中相当有用的功能，理解事件模拟与善用事件模拟是判别一个前端的重要依据，所以各位一定要深入理解（我理解较水）</span></p>
<p><span style="line-height: 1.5;">事件一般是由用户操作触发，其实javascript也是可以触发的，比较重要的是，<strong><span style="color: #ff0000;">javascript的触发事件还会冒泡</span></strong>哦！！！</span></p>
<p><span style="line-height: 1.5;">意思就是，javascript触发的事件与浏览器本身触发其实是一样的（并不完全一致）</span></p>
<p><span style="line-height: 1.5;">如此，我们这里来通过键盘事件触发刚刚的点击事件吧，我们这里点击键盘便触发child的点击，看看他的表现如何</span></p>
<p><span style="line-height: 1.5;">PS：由于是键盘触发，便不具有相关参数了，我们可以捕捉event参数，这对我们队事件传输的理解有莫大的帮助：</span></p>
<p><span style="line-height: 1.5;">我们这里先创建事件参数，然后给键盘注册事件，在点击键盘时候便触发child的点击事件，各位试试看：</span></p>
<p><span style="line-height: 1.5; color: #ff0000;">PS：这个可能需要打开网页点击空格测试了</span></p>
<p><span style="line-height: 1.5;">31964246085156.jpg</span></p>
<p><iframe src="31964246085156.jpg" width="80%" height="200"></iframe></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="background-color: #f5f5f5; color: #800000;">         #p </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">  border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #800000;">         #c </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid red</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="p"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">        parent
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="c"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">            child
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">        alert </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (msg) {
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(msg);
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> p </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">p</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">),
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        c </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">c</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(e);
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点捕获</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        c.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(e);
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">子节点冒泡</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">        p.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">33</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(e);
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">父节点捕获</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">35</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> <span style="background-color: #f5f5f5; color: #000000;">        p.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(e);
</span><span style="color: #008080;">39</span> <span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">父节点冒泡</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">40</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span> <span style="background-color: #f5f5f5; color: #000000;">        document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">keydown</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">43</span>             <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (e.keyCode </span><span style="background-color: #f5f5f5; color: #000000;">==</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">32</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">) {
</span><span style="color: #008080;">44</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> type </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">要触发的事件类型</span>
<span style="color: #008080;">45</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> bubbles </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">事件是否可以冒泡</span>
<span style="color: #008080;">46</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> cancelable </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">事件是否可以阻止浏览器默认事件</span>
<span style="color: #008080;">47</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> view </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.defaultView; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">与事件关联的视图，该属性默认即可，不管</span>
<span style="color: #008080;">48</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> detail </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">49</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> screenX </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">50</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> screenY </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">51</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> clientX </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">52</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> clientY </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">53</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> ctrlKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">是否按下ctrl</span>
<span style="color: #008080;">54</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> altKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">是否按下alt</span>
<span style="color: #008080;">55</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> shiftKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">56</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> metaKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">57</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> button </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">表示按下哪一个鼠标键</span>
<span style="color: #008080;">58</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> relatedTarget </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">模拟mousemove或者out时候用到，与事件相关的对象</span>
<span style="color: #008080;">59</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> event </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.createEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">Events</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">60</span> <span style="background-color: #f5f5f5; color: #000000;">                event.myFlag </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">叶小钗</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">61</span> <span style="background-color: #f5f5f5; color: #000000;">                event.initEvent(type, bubbles, cancelable, view, detail, screenX, screenY, clientX, clientY,
</span><span style="color: #008080;">62</span> <span style="background-color: #f5f5f5; color: #000000;">ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget);
</span><span style="color: #008080;">63</span>                 
<span style="color: #008080;">64</span> <span style="background-color: #f5f5f5; color: #000000;">                console.log(event);
</span><span style="color: #008080;">65</span> <span style="background-color: #f5f5f5; color: #000000;">                c.dispatchEvent(event);
</span><span style="color: #008080;">66</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">67</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">68</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">69</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">70</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><span style="line-height: 1.5;">各位，这里看到了与之前的相同或者不同吗？？？这些都是很关键的哦，其实主要不同就是我们的事件参数没了鼠标位置，多了一个属性：</span></p>
<p><span style="line-height: 1.5;"><img src="35104669831876.png" alt=""></span></p>
<p>&nbsp;</p>
<p>这里有两点容易让各位造成错觉：</p>
<p>① firefox并不会将myFlag显示到console下面</p>
<p>② chrome如果使用原生alert会阻止第一次父元素捕获，所以各位一定要注意</p>
<p>然后这里还有一个小小知识点：</p>
<div class="cnblogs_code">
<pre><span style="color: #800000;">使用dom.dispatchEvent(event)触发模拟事件</span></pre>
</div>
<h1>移动端响应速度</h1>
<p>有了以上知识点，其实对PC端来说基本够用了，如果再稍微研究下jquery源码就善莫大焉了，但是在移动端却有所不同，我们这里还得来理一理</p>
<p>PS：我这里主要针对点击事件</p>
<h2>PC与移动端鼠标事件差异</h2>
<p><span style="line-height: 1.5;">首先，在移动端mouse事件好像就有点不那么适用了，倒不是说touch事件要比mouse事件好，其实他们底层原理相距不大，主要不同点就是：</span></p>
<p><span style="line-height: 1.5; color: #ff0000;">移动端会多点触屏</span></p>
<p><span style="line-height: 1.5;">多点触屏就带来了事件对象参数的差异，比如说：</span></p>
<p><span style="line-height: 1.5;"><img src="50860278351784.png" alt=""><img src="4222796140838.png" alt=""></span></p>
<p>&nbsp;</p>
<h3>changedTouches/touches/targetTouches</h3>
<p>touches：为屏幕上所有手指的信息</p>
<p>PS：因为手机屏幕支持多点触屏，所以这里的参数就与手机有所不同</p>
<p>targetTouches：手指在目标区域的手指信息</p>
<p>changedTouches：最近一次触发该事件的手指信息</p>
<p>比如两个手指同时触发事件，2个手指都在区域内，则容量为2，如果是先后离开的的话，就会先触发一次再触发一次，这里的length就是1，只统计最新的</p>
<p>PS：一般changedTouches的length都是1</p>
<div class="cnblogs_code">
<pre><span>touchend时，touches与targetTouches信息会被删除，changedTouches保存的最后一次的信息，最好用于计算手指信息</span></pre>
</div>
<p>这里要使用哪个数据各位自己看着办吧，我也不是十分清晰（我这里还是使用changedTouches吧）</p>
<p><span style="line-height: 1.5;">以上就是mouse与touch主要不同点，但这些并不是太影响我们的操作，因为到现在为止，我们一般还是使用的是单击</span></p>
<h3><span style="line-height: 1.5;">小贴士</span></h3>
<p><span style="line-height: 1.5;">国内SPA网站模式较少，目前为止还是以单个网页为主，spa模式对javascript技术要求较高不说，首次加载量大也是不可避免的问题</span></p>
<p><span style="line-height: 1.5;">加之移动端设备今年才普及，而且各自争夺领地、争夺入口，还有其他原因，反正现况是有时做移动端的兼容比做IE的兼容还难</span></p>
<p><span style="line-height: 1.5;">就拿简单的CSS3动画来说，在ios下就有闪动现象，而且还是iPhone4s，就现今更新换代来说，此种情况并不会得到明显好转，而且CSS3动画状态保存问题亦是一大难题</span></p>
<p><span style="line-height: 1.5;">另外，网页想要检测手机是否安装APP也是有很大缺陷，移动端的fixed更不要说，这些问题都需要我们乃至开发商解决</span></p>
<p><span style="line-height: 1.5;">PS：这里扯得有点远，我们继续下面的话题</span></p>
<h2>touch与click响应速度问题</h2>
<p><span style="line-height: 1.5;">click本身在移动端响应是没有问题的，但是我们点击下来300ms 的延迟却是事实，这种事实造成的原因就是</span></p>
<p><strong><span style="line-height: 1.5; color: #ff0000;">手机需要知道你是不是想双击放大网页内容</span></strong></p>
<p><span style="line-height: 1.5;">所以click点击响应慢，而touch却不会有这样的限制，于是移动端的touch相当受欢迎，至于鼠标慢，他究竟有多慢，我们来看看：</span></p>
<p>现在我们在手机上同时触发两者事件看看区别：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('0f1b9302-245a-4be1-a843-532fb08f2292')"><img id="code_img_closed_0f1b9302-245a-4be1-a843-532fb08f2292" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_0f1b9302-245a-4be1-a843-532fb08f2292" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0f1b9302-245a-4be1-a843-532fb08f2292',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_0f1b9302-245a-4be1-a843-532fb08f2292" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="others_zepto_10rc1"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="library"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="http://sandbox.runjs.cn/js/sandbox/other/zepto.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="d"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="width: 100px; height: 100px; border: 1px solid black;"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> startTime;
</span><span style="color: #008080;">13</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> log </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (msg) {
</span><span style="color: #008080;">14</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> div </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">        div.html((</span><span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime()) </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime() </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> startTime) </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> msg)
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">        $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">body</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).append(div);
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">19</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> touchStart </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        startTime </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime();
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchStart</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">23</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> touchEnd </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchEnd</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">27</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> mouseDown </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">mouseDown</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">30</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> mouseClick </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">mouseClick</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">33</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> mouseUp </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">mouseUp</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">37</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> d </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#d</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">    d.bind(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">mousedown</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, mouseDown);
</span><span style="color: #008080;">39</span> <span style="background-color: #f5f5f5; color: #000000;">    d.bind(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, mouseClick);
</span><span style="color: #008080;">40</span> <span style="background-color: #f5f5f5; color: #000000;">    d.bind(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">mouseup</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, mouseUp);
</span><span style="color: #008080;">41</span> <span style="background-color: #f5f5f5; color: #000000;">    d.bind(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchstart</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, touchStart);
</span><span style="color: #008080;">42</span> <span style="background-color: #f5f5f5; color: #000000;">    d.bind(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchend</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, touchEnd);
</span><span style="color: #008080;">43</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">44</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p><span style="font-size: 1.17em; line-height: 1.5;">测试地址:(<span style="color: #ff0000;">使用手机</span>)</span></p>
<p><a href="http://sandbox.runjs.cn/show/ey54cgqf">http://sandbox.runjs.cn/show/ey54cgqf</a></p>
<p>此处手机与电脑有非常大的区别！！！</p>
<p><img src="45410427210419.png" alt=""></p>
<p><img src="20762068768344.png" alt=""></p>
<h2>结论</h2>
<h3>不要同时给document绑定鼠标与touch事件</h3>
<div class="cnblogs_code">
<pre>document.addEventListener('mousedown'<span>, mouseDown);
document.addEventListener(</span>'click'<span>, mouseClick);
document.addEventListener(</span>'mouseup'<span>, mouseUp);
document.addEventListener(</span>'touchstart'<span>, touchStart);
document.addEventListener(</span>'touchend', touchEnd);</pre>
</div>
<p>这个样子，在手机上不会触发click事件，click事件要绑定到具体元素</p>
<p>PS：<span><span style="color: #ff0000;">此处在ios与android上有不一样的表现</span>，我们后面会涉及</span></p>
<h3>手机上mousedown响应慢</h3>
<p>经过测试，电脑上touch与click事件的差距不大，但是手机上，当我们手触碰屏幕时，要过300ms左右才会触发mousedown事件</p>
<p>所以click事件在手机上响应就是慢一拍，我们前面说过为什么click慢了</p>
<h3>数据说明</h3>
<p><img src="285871810232493.png" alt=""></p>
<p>可以看到，在手机上使用click事件其实对用户体验并不好，所以我们可能会逐步使用touch事件，但是真正操作时候你就会知道click的好</p>
<p>好了，此处内容暂时到这，我们先看看zepto的事件机制，下面会提到如何使用touch提升click的响应速度</p>
<h1>zepto事件机制</h1>
<p><span style="line-height: 1.5;">zepto是以轻巧的dom库，这家伙可以说是jquery的html5版本，而且在移动端有媲美jqueryPC端的趋势，如果jquery不予以回击，可能移动端的份额就不行了</span></p>
<p><span style="line-height: 1.5;">我们这里不讨论zepto的其他地方了，我们单独讲他的事件相关提出来看看</span><span style="line-height: 1.5;">&nbsp;</span></p>
<h2>注册/注销事件</h2>
<p><span style="line-height: 1.5;">事件注册是我们项目开发中用得最多的一块，我们一般会使用以下几种方式绑定事件：</span></p>
<div class="cnblogs_code">
<pre>el.on(type, <span style="color: #0000ff;">function</span> () {});<span style="color: #008000;">//</span><span style="color: #008000;">力推</span>
<span style="color: #000000;">
el.bind(</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(){});

el.click(</span><span style="color: #0000ff;">function</span>() {});<span style="color: #008000;">//</span><span style="color: #008000;">不推荐</span>
<span style="color: #000000;">
dom.onclick </span>= <span style="color: #0000ff;">function</span>() {};<span style="color: #008000;">//</span><span style="color: #008000;">需要淘汰</span></pre>
</div>
<p>以上几种方式用得较多，最后一种在真实的项目中基本不用，单数第二也极少使用，那么zepto内部是怎么实现的呢？</p>
<p>PS：这里，我就不详细说明zepto事件机制了，这里点一下即可</p>
<p>zepto事件机制其实比较简单，他具体流程如下：</p>
<p>① 事件注册时在全局保存事件句柄(handlers = {})</p>
<p>② 提供全局的事件注册点</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('edfdf17a-7c78-4acc-999e-622c733532f3')"><img id="code_img_closed_edfdf17a-7c78-4acc-999e-622c733532f3" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_edfdf17a-7c78-4acc-999e-622c733532f3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('edfdf17a-7c78-4acc-999e-622c733532f3',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_edfdf17a-7c78-4acc-999e-622c733532f3" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;">给元素绑定监听事件,可同时绑定多个事件类型，如['click','mouseover','mouseout'],也可以是'click mouseover mouseout'</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> add(element, events, fn, selector, getDelegate, capture) {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> zid(element),
</span><span style="color: #008080;"> 4</span>       set = (handlers[id] || (handlers[id] = [])) <span style="color: #008000;">//</span><span style="color: #008000;">元素上已经绑定的所有事件处理函数</span>
<span style="color: #008080;"> 5</span>     eachEvent(events, fn, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, fn) {
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">var</span> handler =<span style="color: #000000;"> parse(event)
</span><span style="color: #008080;"> 7</span>         <span style="color: #008000;">//</span><span style="color: #008000;">保存fn,下面为了处理mouseenter, mouseleave时，对fn进行了修改</span>
<span style="color: #008080;"> 8</span>         handler.fn =<span style="color: #000000;"> fn
</span><span style="color: #008080;"> 9</span>         handler.sel =<span style="color: #000000;"> selector
</span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 模仿 mouseenter, mouseleave</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">if</span> (handler.e <span style="color: #0000ff;">in</span> hover) fn = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">12</span>             <span style="color: #008000;">/*</span> 
<span style="color: #008080;">13</span> <span style="color: #008000;">            relatedTarget为事件相关对象，只有在mouseover和mouseout事件时才有值
</span><span style="color: #008080;">14</span> <span style="color: #008000;">            mouseover时表示的是鼠标移出的那个对象，mouseout时表示的是鼠标移入的那个对象
</span><span style="color: #008080;">15</span> <span style="color: #008000;">            当related不存在，表示事件不是mouseover或者mouseout,mouseover时!$.contains(this, related)当相关对象不在事件对象内
</span><span style="color: #008080;">16</span> <span style="color: #008000;">            且related !== this相关对象不是事件对象时，表示鼠标已经从事件对象外部移入到了对象本身，这个时间是要执行处理函数的
</span><span style="color: #008080;">17</span> <span style="color: #008000;">            当鼠标从事件对象上移入到子节点的时候related就等于this了，且!$.contains(this, related)也不成立，这个时间是不需要执行处理函数的
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">*/</span>
<span style="color: #008080;">19</span>             <span style="color: #0000ff;">var</span> related =<span style="color: #000000;"> e.relatedTarget
</span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">if</span> (!related || (related !== <span style="color: #0000ff;">this</span> &amp;&amp; !$.contains(<span style="color: #0000ff;">this</span>, related))) <span style="color: #0000ff;">return</span> handler.fn.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments)
</span><span style="color: #008080;">21</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">22</span>         <span style="color: #008000;">//</span><span style="color: #008000;">事件委托</span>
<span style="color: #008080;">23</span>         handler.del = getDelegate &amp;&amp;<span style="color: #000000;"> getDelegate(fn, event)
</span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">var</span> callback = handler.del ||<span style="color: #000000;"> fn
</span><span style="color: #008080;">25</span>         handler.proxy = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">26</span>             <span style="color: #0000ff;">var</span> result =<span style="color: #000000;"> callback.apply(element, [e].concat(e.data))
</span><span style="color: #008080;">27</span>             <span style="color: #008000;">//</span><span style="color: #008000;">当事件处理函数返回false时，阻止默认操作和冒泡</span>
<span style="color: #008080;">28</span>             <span style="color: #0000ff;">if</span> (result === <span style="color: #0000ff;">false</span><span style="color: #000000;">) e.preventDefault(), e.stopPropagation()
</span><span style="color: #008080;">29</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> result
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;">设置处理函数的在函数集中的位置</span>
<span style="color: #008080;">32</span>         handler.i =<span style="color: #000000;"> set.length
</span><span style="color: #008080;">33</span>         <span style="color: #008000;">//</span><span style="color: #008000;">将函数存入函数集中</span>
<span style="color: #008080;">34</span> <span style="color: #000000;">        set.push(handler)
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">37</span> }</pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p>③ 提供全局的事件注销点</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('03216343-9e15-4f4f-b98c-058f38f25d9a')"><img id="code_img_closed_03216343-9e15-4f4f-b98c-058f38f25d9a" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_03216343-9e15-4f4f-b98c-058f38f25d9a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('03216343-9e15-4f4f-b98c-058f38f25d9a',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_03216343-9e15-4f4f-b98c-058f38f25d9a" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> $.fn.off = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, selector, callback) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">return</span> !selector || $.isFunction(selector) ? <span style="color: #0000ff;">this</span>.unbind(event, selector || callback) : <span style="color: #0000ff;">this</span><span style="color: #000000;">.undelegate(selector, event, callback)
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> $.fn.unbind = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, callback) {
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.each(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 7</span>         remove(<span style="color: #0000ff;">this</span><span style="color: #000000;">, event, callback)
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    })
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">}
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> remove(element, events, fn, selector, capture) {
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> zid(element)
</span><span style="color: #008080;">13</span>     eachEvent(events || '', fn, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, fn) {
</span><span style="color: #008080;">14</span>         findHandlers(element, event, fn, selector).forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;"> (handler) {
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">delete</span><span style="color: #000000;"> handlers[id][handler.i]
</span><span style="color: #008080;">16</span> <span style="color: #000000;">            element.removeEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))
</span><span style="color: #008080;">17</span> <span style="color: #000000;">        })
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">19</span> }</pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p>④ 提供简便写法</p>
<div class="cnblogs_code">
<pre>$.fn.click = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (fn) {
    </span><span style="color: #0000ff;">this</span>.bind('click'<span style="color: #000000;">, callback)
}</span></pre>
</div>
<p><span style="line-height: 1.5;">如果需要详细了解的朋友请看此篇博客：</span></p>
<p>http://www.cnblogs.com/yexiaochai/p/3448500.html</p>
<p>我这里就不详细说明了，这里需要说明的是，zepto提供了两个语法糖：<span style="line-height: 1.5;"><br></span></p>
<h3>创建事件参数/触发事件</h3>
<p>这两个方法，完全是我们上面代码的缩写，当然他更加健壮，我们后面就可以使用他了</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> $.fn.trigger = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, data) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> event == 'string' || $.isPlainObject(event)) event =<span style="color: #000000;"> $.Event(event)
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    fix(event)
</span><span style="color: #008080;"> 4</span>     event.data =<span style="color: #000000;"> data
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.each(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 6</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> items in the collection might not be DOM elements</span>
<span style="color: #008080;"> 7</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> (todo: possibly support events on plain old objects)</span>
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">if</span> ('dispatchEvent' <span style="color: #0000ff;">in</span> <span style="color: #0000ff;">this</span>) <span style="color: #0000ff;">this</span><span style="color: #000000;">.dispatchEvent(event)
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">10</span> }</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> specialEvents =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 2</span> specialEvents.click = specialEvents.mousedown = specialEvents.mouseup = specialEvents.mousemove = 'MouseEvents'
<span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #008000;">//</span><span style="color: #008000;">根据参数创建一个event对象</span>
<span style="color: #008080;"> 5</span> $.Event = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (type, props) {
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;">当type是个对象时</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> type != 'string') props = type, type =<span style="color: #000000;"> props.type
</span><span style="color: #008080;"> 8</span>     <span style="color: #008000;">//</span><span style="color: #008000;">创建一个event对象，如果是click,mouseover,mouseout时，创建的是MouseEvent,bubbles为是否冒泡</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">var</span> event = document.createEvent(specialEvents[type] || 'Events'<span style="color: #000000;">),
</span><span style="color: #008080;">10</span>     bubbles = <span style="color: #0000ff;">true</span>
<span style="color: #008080;">11</span>     <span style="color: #008000;">//</span><span style="color: #008000;">确保bubbles的值为true或false,并将props参数的属性扩展到新创建的event对象上</span>
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">if</span> (props) <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> name <span style="color: #0000ff;">in</span> props) (name == 'bubbles') ? (bubbles = !!props[name]) : (event[name] =<span style="color: #000000;"> props[name])
</span><span style="color: #008080;">13</span>     <span style="color: #008000;">//</span><span style="color: #008000;">初始化event对象，type为事件类型，如click，bubbles为是否冒泡，第三个参数表示是否可以用preventDefault方法来取消默认操作</span>
<span style="color: #008080;">14</span>     event.initEvent(type, bubbles, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span>, <span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">15</span>     <span style="color: #008000;">//</span><span style="color: #008000;">添加isDefaultPrevented方法，event.defaultPrevented返回一个布尔值,表明当前事件的默认动作是否被取消,也就是是否执行了 event.preventDefault()方法.</span>
<span style="color: #008080;">16</span>     event.isDefaultPrevented = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultPrevented
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> event
</span><span style="color: #008080;">20</span> }</pre>
</div>
<h2><span style="font-size: 1.5em; line-height: 1.5;">zepto模拟tap事件</span></h2>
<p><span style="line-height: 1.5;">前面，我们提到过，我们移动端的点击响应很慢，但是touch不会有这种限制，所以zepto为我们封装了一个touch库：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('076698c7-cda0-47f7-a267-c6a9b844623a')"><img id="code_img_closed_076698c7-cda0-47f7-a267-c6a9b844623a" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_076698c7-cda0-47f7-a267-c6a9b844623a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('076698c7-cda0-47f7-a267-c6a9b844623a',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_076698c7-cda0-47f7-a267-c6a9b844623a" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> (<span style="color: #0000ff;">function</span><span style="color: #000000;"> ($) {
</span><span style="color: #008080;">  2</span>     <span style="color: #0000ff;">var</span> touch =<span style="color: #000000;"> {},
</span><span style="color: #008080;">  3</span> <span style="color: #000000;">    touchTimeout, tapTimeout, swipeTimeout,
</span><span style="color: #008080;">  4</span>     longTapDelay = 750<span style="color: #000000;">, longTapTimeout
</span><span style="color: #008080;">  5</span> 
<span style="color: #008080;">  6</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> parentIfText(node) {
</span><span style="color: #008080;">  7</span>         <span style="color: #0000ff;">return</span> 'tagName' <span style="color: #0000ff;">in</span> node ?<span style="color: #000000;"> node : node.parentNode
</span><span style="color: #008080;">  8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> swipeDirection(x1, x2, y1, y2) {
</span><span style="color: #008080;"> 11</span>         <span style="color: #0000ff;">var</span> xDelta = Math.abs(x1 - x2), yDelta = Math.abs(y1 -<span style="color: #000000;"> y2)
</span><span style="color: #008080;"> 12</span>         <span style="color: #0000ff;">return</span> xDelta &gt;= yDelta ? (x1 - x2 &gt; 0 ? 'Left' : 'Right') : (y1 - y2 &gt; 0 ? 'Up' : 'Down'<span style="color: #000000;">)
</span><span style="color: #008080;"> 13</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 14</span> 
<span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> longTap() {
</span><span style="color: #008080;"> 16</span>         longTapTimeout = <span style="color: #0000ff;">null</span>
<span style="color: #008080;"> 17</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (touch.last) {
</span><span style="color: #008080;"> 18</span>             touch.el.trigger('longTap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 19</span>             touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 20</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 21</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 22</span> 
<span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> cancelLongTap() {
</span><span style="color: #008080;"> 24</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (longTapTimeout) clearTimeout(longTapTimeout)
</span><span style="color: #008080;"> 25</span>         longTapTimeout = <span style="color: #0000ff;">null</span>
<span style="color: #008080;"> 26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 27</span> 
<span style="color: #008080;"> 28</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> cancelAll() {
</span><span style="color: #008080;"> 29</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (touchTimeout) clearTimeout(touchTimeout)
</span><span style="color: #008080;"> 30</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (tapTimeout) clearTimeout(tapTimeout)
</span><span style="color: #008080;"> 31</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (swipeTimeout) clearTimeout(swipeTimeout)
</span><span style="color: #008080;"> 32</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (longTapTimeout) clearTimeout(longTapTimeout)
</span><span style="color: #008080;"> 33</span>         touchTimeout = tapTimeout = swipeTimeout = longTapTimeout = <span style="color: #0000ff;">null</span>
<span style="color: #008080;"> 34</span>         touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 36</span> 
<span style="color: #008080;"> 37</span>     $(document).ready(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 38</span>         <span style="color: #0000ff;">var</span><span style="color: #000000;"> now, delta
</span><span style="color: #008080;"> 39</span> 
<span style="color: #008080;"> 40</span> <span style="color: #000000;">        $(document.body)
</span><span style="color: #008080;"> 41</span>       .bind('touchstart', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;"> 42</span>           now =<span style="color: #000000;"> Date.now()
</span><span style="color: #008080;"> 43</span>           delta = now - (touch.last ||<span style="color: #000000;"> now)
</span><span style="color: #008080;"> 44</span>           touch.el = $(parentIfText(e.touches[0<span style="color: #000000;">].target))
</span><span style="color: #008080;"> 45</span>           touchTimeout &amp;&amp;<span style="color: #000000;"> clearTimeout(touchTimeout)
</span><span style="color: #008080;"> 46</span>           touch.x1 = e.touches[0<span style="color: #000000;">].pageX
</span><span style="color: #008080;"> 47</span>           touch.y1 = e.touches[0<span style="color: #000000;">].pageY
</span><span style="color: #008080;"> 48</span>           <span style="color: #0000ff;">if</span> (delta &gt; 0 &amp;&amp; delta &lt;= 250) touch.isDoubleTap = <span style="color: #0000ff;">true</span>
<span style="color: #008080;"> 49</span>           touch.last =<span style="color: #000000;"> now
</span><span style="color: #008080;"> 50</span>           longTapTimeout =<span style="color: #000000;"> setTimeout(longTap, longTapDelay)
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">      })
</span><span style="color: #008080;"> 52</span>       .bind('touchmove', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;"> 53</span> <span style="color: #000000;">          cancelLongTap()
</span><span style="color: #008080;"> 54</span>           touch.x2 = e.touches[0<span style="color: #000000;">].pageX
</span><span style="color: #008080;"> 55</span>           touch.y2 = e.touches[0<span style="color: #000000;">].pageY
</span><span style="color: #008080;"> 56</span>           <span style="color: #0000ff;">if</span> (Math.abs(touch.x1 - touch.x2) &gt; 10<span style="color: #000000;">)
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">              e.preventDefault()
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">      })
</span><span style="color: #008080;"> 59</span>       .bind('touchend', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">          cancelLongTap()
</span><span style="color: #008080;"> 61</span> 
<span style="color: #008080;"> 62</span>           <span style="color: #008000;">//</span><span style="color: #008000;"> swipe</span>
<span style="color: #008080;"> 63</span>           <span style="color: #0000ff;">if</span> ((touch.x2 &amp;&amp; Math.abs(touch.x1 - touch.x2) &gt; 30) ||
<span style="color: #008080;"> 64</span>             (touch.y2 &amp;&amp; Math.abs(touch.y1 - touch.y2) &gt; 30<span style="color: #000000;">))
</span><span style="color: #008080;"> 65</span> 
<span style="color: #008080;"> 66</span>               swipeTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 67</span>                   touch.el.trigger('swipe'<span style="color: #000000;">)
</span><span style="color: #008080;"> 68</span>                   touch.el.trigger('swipe' +<span style="color: #000000;"> (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2)))
</span><span style="color: #008080;"> 69</span>                   touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 70</span>               }, 0<span style="color: #000000;">)
</span><span style="color: #008080;"> 71</span> 
<span style="color: #008080;"> 72</span>           <span style="color: #008000;">//</span><span style="color: #008000;"> normal tap</span>
<span style="color: #008080;"> 73</span>           <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> ('last' <span style="color: #0000ff;">in</span><span style="color: #000000;"> touch)
</span><span style="color: #008080;"> 74</span> 
<span style="color: #008080;"> 75</span>           <span style="color: #008000;">//</span><span style="color: #008000;"> delay by one tick so we can cancel the 'tap' event if 'scroll' fires</span>
<span style="color: #008080;"> 76</span>           <span style="color: #008000;">//</span><span style="color: #008000;"> ('tap' fires before 'scroll')</span>
<span style="color: #008080;"> 77</span>               tapTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 78</span> 
<span style="color: #008080;"> 79</span>                   <span style="color: #008000;">//</span><span style="color: #008000;"> trigger universal 'tap' with the option to cancelTouch()</span>
<span style="color: #008080;"> 80</span>                   <span style="color: #008000;">//</span><span style="color: #008000;"> (cancelTouch cancels processing of single vs double taps for faster 'tap' response)</span>
<span style="color: #008080;"> 81</span>                   <span style="color: #0000ff;">var</span> event = $.Event('tap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 82</span>                   event.cancelTouch =<span style="color: #000000;"> cancelAll
</span><span style="color: #008080;"> 83</span> <span style="color: #000000;">                  touch.el.trigger(event)
</span><span style="color: #008080;"> 84</span> 
<span style="color: #008080;"> 85</span>                   <span style="color: #008000;">//</span><span style="color: #008000;"> trigger double tap immediately</span>
<span style="color: #008080;"> 86</span>                   <span style="color: #0000ff;">if</span><span style="color: #000000;"> (touch.isDoubleTap) {
</span><span style="color: #008080;"> 87</span>                       touch.el.trigger('doubleTap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 88</span>                       touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 89</span> <span style="color: #000000;">                  }
</span><span style="color: #008080;"> 90</span> 
<span style="color: #008080;"> 91</span>                   <span style="color: #008000;">//</span><span style="color: #008000;"> trigger single tap after 250ms of inactivity</span>
<span style="color: #008080;"> 92</span>                   <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 93</span>                       touchTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 94</span>                           touchTimeout = <span style="color: #0000ff;">null</span>
<span style="color: #008080;"> 95</span>                           touch.el.trigger('singleTap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 96</span>                           touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;"> 97</span>                       }, 250<span style="color: #000000;">)
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">                  }
</span><span style="color: #008080;"> 99</span> 
<span style="color: #008080;">100</span>               }, 0<span style="color: #000000;">)
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span> <span style="color: #000000;">      })
</span><span style="color: #008080;">103</span>       .bind('touchcancel'<span style="color: #000000;">, cancelAll)
</span><span style="color: #008080;">104</span> 
<span style="color: #008080;">105</span>         $(window).bind('scroll'<span style="color: #000000;">, cancelAll)
</span><span style="color: #008080;">106</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">107</span> 
<span style="color: #008080;">108</span>   ; ['swipe', 'swipeLeft', 'swipeRight', 'swipeUp', 'swipeDown', 'doubleTap', 'tap', 'singleTap', 'longTap'].forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;"> (m) {
</span><span style="color: #008080;">109</span>       $.fn[m] = <span style="color: #0000ff;">function</span> (callback) { <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.bind(m, callback) }
</span><span style="color: #008080;">110</span> <span style="color: #000000;">  })
</span><span style="color: #008080;">111</span> })(Zepto)</pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p>这个touch库个人觉得写得不行，虽然我写不出来......</p>
<p>抛开其他东西，我们将其中点击的核心给剥离出来</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> tapTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> trigger universal 'tap' with the option to cancelTouch()</span>
<span style="color: #008080;"> 4</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> (cancelTouch cancels processing of single vs double taps for faster 'tap' response)</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">var</span> event = $.Event('tap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 6</span>     event.cancelTouch =<span style="color: #000000;"> cancelAll
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    touch.el.trigger(event)
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> trigger double tap immediately</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (touch.isDoubleTap) {
</span><span style="color: #008080;">11</span>         touch.el.trigger('doubleTap'<span style="color: #000000;">)
</span><span style="color: #008080;">12</span>         touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> trigger single tap after 250ms of inactivity</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">17</span>         touchTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">18</span>             touchTimeout = <span style="color: #0000ff;">null</span>
<span style="color: #008080;">19</span>             touch.el.trigger('singleTap'<span style="color: #000000;">)
</span><span style="color: #008080;">20</span>             touch =<span style="color: #000000;"> {}
</span><span style="color: #008080;">21</span>         }, 250<span style="color: #000000;">)
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> }, 0)</pre>
</div>
<p>抛开其他问题，这里5-7行就是触发TAP事件的核心，我们这里简单说下流程：</p>
<p>① 我们在程序过程中为dom（包装过的）tap事件（使用addEventListener方式注册/zepto使用bind即可）</p>
<p>② 点击目标元素，触发document的touchstart与touchend，在end时候判断是否为一次点击事件（是否touchmove过多）</p>
<p>③ 如果是便触发tap事件，于是我们的事件监听器便会触发了</p>
<p>以程序逻辑来说，他这个是没问题的，他甚至考虑了双击与滑动事件，结合前面的知识点，这里应该很好理解</p>
<p>但就是这段代码却带来了这样那样的问题，这些问题就是移动端兼容的血泪史，且听我一一道来<span style="line-height: 1.5;">&nbsp;</span></p>
<h2>tap事件的问题一览</h2>
<h3>body区域外点击无效</h3>
<p>我们看看我们的touch事件的绑定点</p>
<div class="cnblogs_code">
<pre>$(document.body).bind(......)</pre>
</div>
<p>这段代码本身没什么问题，在PC端毫无问题，但就是这样的代码在手机端（多个手机/多个浏览器）下产生了一些区域不可点击的现象</p>
<p>这其实不完全是兼容问题，是因为我们在手机端时候往往喜欢将body设置为height: 100%，于是这样会产生一个问题</p>
<p>如果我们的view长度过程那么body区域事实上不会增加，所以我们点击下面区域时候手机就不认为我们点击的是body了......</p>
<p>这个BUG只能说无语，但是min-height虽然可以解决点击BUG却会带来全局布局的问题，所以这个问题依然纠结</p>
<p>好在后面zepto意识到了这个问题将事件绑定改成了这个：</p>
<div class="cnblogs_code">
<pre>$(document).bind(......)</pre>
</div>
<p>于是修复了这个问题</p>
<h3>e.preventDefault失效（settimeout小贴士）</h3>
<p><span style="line-height: 1.5;">如果说第一个问题导致点是我们自己的布局的话，第二个问题的引发点我就觉得是开发人员的问题了</span></p>
<p><span style="line-height: 1.5;">PS：zepto多数是抄写jquery，touch是自己写的，就是这个touch就搞了很多问题出来......</span></p>
<p><span style="line-height: 1.5;">这里我们先不忙看tap代码本身带来的问题，我这里出一个题各位试试：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> sum1 = 0, sum2 = 0, sum3 = 0; len = 2<span style="color: #000000;">;
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    arr.push(i)
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 7</span>     setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 8</span>         sum1 +=<span style="color: #000000;"> arr[i];
</span><span style="color: #008080;"> 9</span>     }, 0<span style="color: #000000;">);
</span><span style="color: #008080;">10</span> <span style="color: #000000;">}
</span><span style="color: #008080;">11</span> $.each(arr, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (i, v) {
</span><span style="color: #008080;">12</span>     setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">13</span>         sum2 +=<span style="color: #000000;"> v;
</span><span style="color: #008080;">14</span>     }, 0<span style="color: #000000;">);
</span><span style="color: #008080;">15</span> <span style="color: #000000;">});
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">17</span>     sum3++<span style="color: #000000;">;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">}
</span><span style="color: #008080;">19</span> <span style="color: #008000;">//</span><span style="color: #008000;">sum3不管，答出len=2与len=200000时，sum1,sum2的值</span>
<span style="color: #008080;">20</span> <span style="color: #000000;">console.log(sum1);
</span><span style="color: #008080;">21</span> <span style="color: #000000;">console.log(sum2);
</span><span style="color: #008080;">22</span> console.log(sum3);</pre>
</div>
<p>各位仔细观察这个题，会有不一样的感觉，在sum很大的时候第三个循环肯定会耗费超过一秒的时间</p>
<p>按道理说这里的sum1/sum2会进行相关计算，事实却是：</p>
<div class="cnblogs_code">
<pre><span style="color: #800000;">settimeout将优先级降到了最低，他会在主干流程执行结束后才会执行</span></pre>
</div>
<p>于是我们这里引出了一个非常有趣的问题，且看zepto源码：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> tapTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">var</span> event = $.Event('tap'<span style="color: #000000;">)
</span><span style="color: #008080;">3</span>     event.cancelTouch =<span style="color: #000000;"> cancelAll
</span><span style="color: #008080;">4</span> <span style="color: #000000;">    touch.el.trigger(event)
</span><span style="color: #008080;">5</span> }, 0)</pre>
</div>
<p>各位小伙伴，你认为我们在第四行后执行e.preventDefault()等操作会有效么？？？</p>
<p>或者说，我们在触发tap事件后，会执行我们的回调函数我们在我们的回调函数中执行e.preventDefault()等操作会有效么？？？</p>
<p>各位小伙伴可以去试试，我这里就不做说明了</p>
<p>PS：标题好像泄露了我的行踪......</p>
<h2>点透问题</h2>
<p><span style="line-height: 1.5;">其实上面的问题是导致点透的因素之一，所谓点透就是：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('95004036-ad41-4611-b990-e0e7264e3c98')"><img id="code_img_closed_95004036-ad41-4611-b990-e0e7264e3c98" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_95004036-ad41-4611-b990-e0e7264e3c98" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('95004036-ad41-4611-b990-e0e7264e3c98',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_95004036-ad41-4611-b990-e0e7264e3c98" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #800000;">        #list </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> position</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> absolute</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> top</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 0px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> left</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 200px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #800000;">        #d </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100%</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="d"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="input"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="width: 80px; height: 200px;"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="list"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="res/libs/zepto.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">19</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">    window.log </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (msg) {
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        console.log(msg);
</span><span style="color: #008080;">22</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> div </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#myMsg</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">23</span>         <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">div[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">]) div </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div id="myMsg"&gt;&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#d</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).append(div);
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        div.click(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">            div.html(</span><span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        });
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">        div.append($(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> msg </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">));
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;">30</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> list </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#list</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">31</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> d </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#d</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">32</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> input </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#input</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">    input.tap(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">35</span> <span style="background-color: #f5f5f5; color: #000000;">        input.val(</span><span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime());
</span><span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">    list.tap(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">39</span> <span style="background-color: #f5f5f5; color: #000000;">        list.hide();
</span><span style="color: #008080;">40</span> <span style="background-color: #f5f5f5; color: #000000;">        setTimeout(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">41</span> <span style="background-color: #f5f5f5; color: #000000;">            list.show();
</span><span style="color: #008080;">42</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #000000;">1000</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">43</span> 
<span style="color: #008080;">44</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span> <span style="background-color: #f5f5f5; color: #000000;">    d.tap(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">47</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">div tap</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">48</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">49</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">50</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p>这个页面有三个元素</p>
<p>① 父容器div，我们为他绑定了一个tap事件，会打印文字</p>
<p>② 在上的div，我们为其绑定了一个tap事件，点击便消失</p>
<p>③ input，主要用于测试focus问题</p>
<p>现在开启touch事件的情况下，我们点击上面的div，他会消失，于是：</p>
<p><span style="color: #ff0000;"><strong>div消失会触发div（list）的tap事件</strong></span></p>
<p><span style="color: #ff0000;"><strong>div消失会触发input获取焦点事件</strong></span></p>
<h4><span>提示层一闪而过</span></h4>
<p><span>表单提交页，用户提交时如果信息有误，会弹出一个提示，并且为蒙版添加click的关闭事件</span></p>
<p><span>但是有tap在的情况效果就不一样了，我们极有可能点击提交，弹出提示层，触发蒙版点击事件，蒙版关闭！！！</span></p>
<h4><span>input获取焦点弹出键盘</span></h4>
<p><span>我们可能遇到这种情况，我们在弹出层上做了一些操作后，点击弹出层关闭弹出层，但是下面有一个input（div有事件也行）</span></p>
<p><span>于是触发了div事件，于是input获取了焦点，某明奇妙的弹出来键盘！！！</span></p>
<p><span style="line-height: 1.5;">以上都属于touch事件导致的点透现象，有问题就有解决方案，于是我们就来说针对zepto如何解决点透现象</span></p>
<h3>神奇菊花解决点透</h3>
<p><span style="line-height: 1.5;">此方案只针对zepto的tap事件</span></p>
<p><span style="line-height: 1.5;">其实并不是所有的tap事件都会产生点透，只不过在页面切换/有弹出层时候容易出现这个问题</span></p>
<p><span style="line-height: 1.5;">根据zepto事件注册机制我这里做了一点修改便可以解决zepto点透问题：于是这里便引进一个新的事件lazyTap</span></p>
<p><span style="line-height: 1.5;">lazyTap只是名字变了，其实他还是tap，首先我们说事件注册：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">el.on('lazyTap', function () {
});</span></pre>
</div>
<p>如此我们就注册了一个lazyTap事件，但是我们的zepto并不会因此而买账，而且我也说了他就是tap事件，于是我们进入事件注册入口：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> add(element, events, fn, selector, getDelegate, capture) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">var</span> id =<span style="color: #000000;"> zid(element),
</span><span style="color: #008080;"> 3</span>       set = (handlers[id] || (handlers[id] = [])) <span style="color: #008000;">//</span><span style="color: #008000;">元素上已经绑定的所有事件处理函数</span>
<span style="color: #008080;"> 4</span>     eachEvent(events, fn, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (event, fn) {
</span><strong><span style="color: #ff0000;"> 5         if (event == 'lazyTap') event = 'tap';
 6         element.lazyTap = true;
</span></strong><span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">var</span> handler =<span style="color: #000000;"> parse(event)
</span><span style="color: #008080;"> 8</span>         <span style="color: #008000;">//</span><span style="color: #008000;">保存fn,下面为了处理mouseenter, mouseleave时，对fn进行了修改</span>
<span style="color: #008080;"> 9</span>         handler.fn =<span style="color: #000000;"> fn
</span><span style="color: #008080;">10</span>         handler.sel =<span style="color: #000000;"> selector
</span><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 模仿 mouseenter, mouseleave</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">if</span> (handler.e <span style="color: #0000ff;">in</span> hover) fn = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">13</span>             <span style="color: #008000;">/*</span> 
<span style="color: #008080;">14</span> <span style="color: #008000;">            relatedTarget为事件相关对象，只有在mouseover和mouseout事件时才有值
</span><span style="color: #008080;">15</span> <span style="color: #008000;">            mouseover时表示的是鼠标移出的那个对象，mouseout时表示的是鼠标移入的那个对象
</span><span style="color: #008080;">16</span> <span style="color: #008000;">            当related不存在，表示事件不是mouseover或者mouseout,mouseover时!$.contains(this, related)当相关对象不在事件对象内
</span><span style="color: #008080;">17</span> <span style="color: #008000;">            且related !== this相关对象不是事件对象时，表示鼠标已经从事件对象外部移入到了对象本身，这个时间是要执行处理函数的
</span><span style="color: #008080;">18</span> <span style="color: #008000;">            当鼠标从事件对象上移入到子节点的时候related就等于this了，且!$.contains(this, related)也不成立，这个时间是不需要执行处理函数的
</span><span style="color: #008080;">19</span>             <span style="color: #008000;">*/</span>
<span style="color: #008080;">20</span>             <span style="color: #0000ff;">var</span> related =<span style="color: #000000;"> e.relatedTarget
</span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">if</span> (!related || (related !== <span style="color: #0000ff;">this</span> &amp;&amp; !$.contains(<span style="color: #0000ff;">this</span>, related))) <span style="color: #0000ff;">return</span> handler.fn.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments)
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">23</span>         <span style="color: #008000;">//</span><span style="color: #008000;">事件委托</span>
<span style="color: #008080;">24</span>         handler.del = getDelegate &amp;&amp;<span style="color: #000000;"> getDelegate(fn, event)
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">var</span> callback = handler.del ||<span style="color: #000000;"> fn
</span><span style="color: #008080;">26</span>         handler.proxy = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">27</span>             <span style="color: #0000ff;">var</span> result =<span style="color: #000000;"> callback.apply(element, [e].concat(e.data))
</span><span style="color: #008080;">28</span>             <span style="color: #008000;">//</span><span style="color: #008000;">当事件处理函数返回false时，阻止默认操作和冒泡</span>
<span style="color: #008080;">29</span>             <span style="color: #0000ff;">if</span> (result === <span style="color: #0000ff;">false</span><span style="color: #000000;">) e.preventDefault(), e.stopPropagation()
</span><span style="color: #008080;">30</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> result
</span><span style="color: #008080;">31</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">32</span>         <span style="color: #008000;">//</span><span style="color: #008000;">设置处理函数的在函数集中的位置</span>
<span style="color: #008080;">33</span>         handler.i =<span style="color: #000000;"> set.length
</span><span style="color: #008080;">34</span>         <span style="color: #008000;">//</span><span style="color: #008000;">将函数存入函数集中</span>
<span style="color: #008080;">35</span> <span style="color: #000000;">        set.push(handler)
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">38</span> }</pre>
</div>
<p>这里5、6行，我们对我们传入的事件类型进行了出来，将它改成了tap事件，并且在dom上打了一个标记</p>
<p>PS：zepto记录事件句柄的zid也是记录至dom属性的</p>
<p>于是我们在触发的时候可以这样干：</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> $.showLazyTap = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">var</span> forTap = $('#forTap'<span style="color: #000000;">);
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span> (!forTap[0<span style="color: #000000;">]) {
</span><span style="color: #008080;"> 4</span>         forTap = $('<span style="color: #000000;">&lt;div id="forTap" style="background: black;color: White; display: none;  border-radius: 60px; position: absolute; 
</span><span style="color: #008080;"> 5</span> z-index: 99999; width: 60px; height: 60px"&gt;&lt;/div&gt;'<span style="color: #000000;">);
</span><span style="color: #008080;"> 6</span>         $('body'<span style="color: #000000;">).append(forTap);
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    forTap.css({
</span><span style="color: #008080;"> 9</span>         top: (e.changedTouches[0].pageY - 30) + 'px'<span style="color: #000000;">,
</span><span style="color: #008080;">10</span>         left: (e.changedTouches[0].pageX - 30) + 'px'
<span style="color: #008080;">11</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    forTap.show();
</span><span style="color: #008080;">13</span>     setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        forTap.hide();
</span><span style="color: #008080;">15</span>     }, 350<span style="color: #000000;">);
</span><span style="color: #008080;">16</span> <span style="color: #000000;">}
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> tapTimeout = setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">var</span> event = $.Event('tap'<span style="color: #000000;">)
</span><span style="color: #008080;">20</span>     event.cancelTouch =<span style="color: #000000;"> cancelAll
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    touch.el.trigger(event)
</span><span style="color: #ff0000;">22     if (touch.el.lazyTap) {
23         $.showLazyTap(e);
24     }
</span><span style="color: #008080;">25</span> }, 0)</pre>
</div>
<p>如此一来，在我们tap事件执行后，我们会弹出一朵菊花，阻止我们与下面的元素触碰，然后350ms后消失</p>
<p><img src="19159977687744.png" alt=""></p>
<p>这里去掉菊花的背景就完全没有影响了，然后我们就解决了tap事件带来的点透问题</p>
<h3>放弃tap</h3>
<p><span style="line-height: 1.5;">最后我们开始评估，评估后的结果是放弃tap事件，放弃他主要有以下原因：</span></p>
<p><span style="line-height: 1.5;">① 兼容问题，使用tap事件在电脑上操作不便，自动化测试无法进行</span></p>
<p><span style="line-height: 1.5;">② 兼容问题，IE内核的手机会完蛋</span></p>
<p><span style="line-height: 1.5;">③ 点透解决方案不完美，蒙版形式不是所有人能接受，并且凭空多出一个lazyTap事件更是不该</span></p>
<p><span style="line-height: 1.5;">所以我们放弃了这一方案，开始从根本上追寻问题，这正是我们最初的知识点的交合了</span><span style="line-height: 1.5;">&nbsp;</span></p>
<h1>fastclick思想提升点击响应</h1>
<p><span style="line-height: 1.5;">程序界是一个神奇的地方，每当方案不够完美时便会更加靠近真相，但当你真的想对真相着手时候，却发现已经有人干了！</span></p>
<p><span style="line-height: 1.5;">前面已经说过tap的种种弊端，所以原生的click事件依旧是最优方案，于是我们可以在click上面打主意了</span></p>
<h2>实现原理</h2>
<p><span style="line-height: 1.5;">依旧使用touch事件模拟点击，却在tap触发那一步自己创建一个click的Event对象触发之：</span></p>
<p><span style="line-height: 1.5; color: #ff0000;">PS：这里需要手机测试了</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #800000;">         #p </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 300px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">  border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid black</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #800000;">         #c </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 100px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 1px solid red</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="tap1"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="button"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="我是tap"</span> <span style="color: #0000ff;">/&gt;&lt;</span><span style="color: #800000;">br </span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="click1"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="button"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="我是click"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> tap1 </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">tap1</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">17</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> click1 </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click1</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">18</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> t </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">, el;
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchstart</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            t </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.timeStamp;
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">            el </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.target;
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        });
</span><span style="color: #008080;">23</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">注意，此处鼠标信息我没有管他</span>
<span style="color: #008080;">24</span>         <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> createEvent(type) {
</span><span style="color: #008080;">25</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> bubbles </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">事件是否可以冒泡</span>
<span style="color: #008080;">26</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> cancelable </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">事件是否可以阻止浏览器默认事件</span>
<span style="color: #008080;">27</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> view </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.defaultView; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">与事件关联的视图，该属性默认即可，不管</span>
<span style="color: #008080;">28</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> detail </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">29</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> screenX </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">30</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> screenY </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">31</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> clientX </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">32</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> clientY </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">33</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> ctrlKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">是否按下ctrl</span>
<span style="color: #008080;">34</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> altKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">是否按下alt</span>
<span style="color: #008080;">35</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> shiftKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">36</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> metaKey </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">37</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> button </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">表示按下哪一个鼠标键</span>
<span style="color: #008080;">38</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> relatedTarget </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">模拟mousemove或者out时候用到，与事件相关的对象</span>
<span style="color: #008080;">39</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> event </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.createEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">MouseEvents</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">40</span> <span style="background-color: #f5f5f5; color: #000000;">            event.initMouseEvent(type, bubbles, cancelable, view, detail, screenX, screenY, clientX, clientY, ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget);
</span><span style="color: #008080;">41</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> event;
</span><span style="color: #008080;">42</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">43</span> <span style="background-color: #f5f5f5; color: #000000;">        document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchend</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">44</span> <span style="background-color: #f5f5f5; color: #000000;">            t </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.timeStamp;
</span><span style="color: #008080;">45</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> event </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> createEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">tap</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">46</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">触发tap事件</span>
<span style="color: #008080;">47</span> <span style="background-color: #f5f5f5; color: #000000;">            el.dispatchEvent(event);
</span><span style="color: #008080;">48</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">触发click</span>
<span style="color: #008080;">49</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> cEvent </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> createEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">50</span> <span style="background-color: #f5f5f5; color: #000000;">            el.dispatchEvent(cEvent);
</span><span style="color: #008080;">51</span> <span style="background-color: #f5f5f5; color: #000000;">        });
</span><span style="color: #008080;">52</span>         <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> fnDom(el, msg, e) {
</span><span style="color: #008080;">53</span> <span style="background-color: #f5f5f5; color: #000000;">            el.value </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> msg </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">(</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> (e.timeStamp </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> t) </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">54</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">55</span> <span style="background-color: #f5f5f5; color: #000000;">        tap1.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">tap</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">56</span> <span style="background-color: #f5f5f5; color: #000000;">            fnDom(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">我是tap，我响应时间：</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, e);
</span><span style="color: #008080;">57</span> <span style="background-color: #f5f5f5; color: #000000;">        });
</span><span style="color: #008080;">58</span> <span style="background-color: #f5f5f5; color: #000000;">        click1.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">59</span> <span style="background-color: #f5f5f5; color: #000000;">            fnDom(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">我是click，我响应时间：</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, e);
</span><span style="color: #008080;">60</span> <span style="background-color: #f5f5f5; color: #000000;">        });
</span><span style="color: #008080;">61</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">62</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">63</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p><a style="line-height: 1.5;" href="18431425405366.jpg">18431425405366.jpg</a></p>
<p>&nbsp;</p>
<p><span><iframe src="18431425405366.jpg" width="80%" height="200"></iframe></span></p>
<p>&nbsp;</p>
<p><span>这里我们点击按钮后就明显看到了按钮开始响应时间是80左右，马上变成了300多ms，因为click事件被执行了两次</span></p>
<p>&nbsp;</p>
<p><span>一次是touchend我们手动执行，一次是系统自建的click，这就是传说中的鬼点击，于是我们接下来说一说这个鬼点击</span></p>
<h2>鬼点击</h2>
<p><span style="line-height: 1.5;">所谓鬼点击，就是一次点击执行了两次，以程序来说，他这个是正常的现象，没有问题的，但是我们的业务逻辑不允许这个事情存在</span></p>
<p><span>初步解决鬼点击是比较容易的，直接在touchend处阻止浏览器默认事件即可：</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> document.addEventListener('touchend', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;"> 2</span>     t =<span style="color: #000000;"> e.timeStamp;
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">var</span> event = createEvent('tap'<span style="color: #000000;">)
</span><span style="color: #008080;"> 4</span>     <span style="color: #008000;">//</span><span style="color: #008000;">触发tap事件</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">    el.dispatchEvent(event);
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;">触发click</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">var</span> cEvent = createEvent('click'<span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    el.dispatchEvent(cEvent);
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    e.preventDefault();
</span><span style="color: #008080;">10</span> });</pre>
</div>
<p><span style="line-height: 1.5;">按道理来说，这个代码是没有问题的（而且同时可以解决我们的点透问题），但是在android上情况有所不同</span></p>
<p>我们的click依旧执行了两次！！！！！由此又引入了下一话题，android与ios鼠标事件差异<span style="line-height: 1.5;">&nbsp;</span></p>
<h2>ios与android鼠标事件差异</h2>
<p><strong><span style="line-height: 1.5; color: #ff0000;">PS：此点还要做详细研究，今天浅浅的说几点</span></strong></p>
<p><span>在android上获得的结果是惊人的，这个劳什子android里面moveover事件偶然比尼玛touchstart还快！！！</span></p>
<p><span>而ios压根就不理睬mouseover事件，这是主要问题产生原因！！！</span></p>
<p><span>而android在movedown时候，开开心心触发了input的focus事件，然后键盘就弹起来了！！！</span></p>
<p><span>所以针对android，我们还得将mousedown干掉才行！！！！</span></p>
<p><span>而事实上，我们input获取焦点，就是通过mousedown触发的，ios也是，所以要解决android下面的问题还得从其它层面抓起</span><span style="line-height: 1.5;">&nbsp;</span></p>
<h2>事件捕获解决鬼点击</h2>
<p><span>现在回到我们最初的知识点：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('2a6f0b60-5801-4057-9d9f-38ebc5587988')"><img id="code_img_closed_2a6f0b60-5801-4057-9d9f-38ebc5587988" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_2a6f0b60-5801-4057-9d9f-38ebc5587988" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2a6f0b60-5801-4057-9d9f-38ebc5587988',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_2a6f0b60-5801-4057-9d9f-38ebc5587988" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.w3.org/1999/xhtml"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #800000;">        .bt </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> position</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> absolute</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> top</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 250px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> display</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> block</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 50px</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="button"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="bt"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="我是快速点击事件"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="fastclick"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="width: 150px; height: 200px;"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="div"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="width: 200px; height: 200px; border: 1px solid black"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> fastclick </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">fastclick</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">18</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> div </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">19</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> touch </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {};
</span><span style="color: #008080;">20</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> t </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime();
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">    window.log </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (msg) {
</span><span style="color: #008080;">23</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> d </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.createElement(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        d.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> msg;
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        div.appendChild(d);
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        console.log(msg);
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">    document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (event) {
</span><span style="color: #008080;">30</span>         <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (event.myclick </span><span style="background-color: #f5f5f5; color: #000000;">==</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">) {
</span><span style="color: #008080;">31</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">33</span>         <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (event.stopImmediatePropagation) {
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">            event.stopImmediatePropagation();
</span><span style="color: #008080;">35</span> <span style="background-color: #f5f5f5; color: #000000;">        } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">            event.propagationStopped </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">37</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">        event.stopPropagation();
</span><span style="color: #008080;">39</span> <span style="background-color: #f5f5f5; color: #000000;">        event.preventDefault();
</span><span style="color: #008080;">40</span>         <span style="background-color: #f5f5f5; color: #0000ff;">return</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">41</span> <span style="background-color: #f5f5f5; color: #000000;">    }, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span> <span style="background-color: #f5f5f5; color: #000000;">    document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchstart</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">44</span> <span style="background-color: #f5f5f5; color: #000000;">        touch.startTime </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.timeStamp;
</span><span style="color: #008080;">45</span> <span style="background-color: #f5f5f5; color: #000000;">        touch.el </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.target;
</span><span style="color: #008080;">46</span> <span style="background-color: #f5f5f5; color: #000000;">        t </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.timeStamp;
</span><span style="color: #008080;">47</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">48</span> <span style="background-color: #f5f5f5; color: #000000;">    document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchmove</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) { });
</span><span style="color: #008080;">49</span> <span style="background-color: #f5f5f5; color: #000000;">    document.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">touchend</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">50</span> <span style="background-color: #f5f5f5; color: #000000;">        touch.last </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> e.timeStamp;
</span><span style="color: #008080;">51</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> event </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.createEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">Events</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">52</span> <span style="background-color: #f5f5f5; color: #000000;">        event.initEvent(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">, window, </span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">, e.changedTouches[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">].screenX, e.changedTouches[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">].screenY, e.changedTouches[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">].clientX, e.changedTouches[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">].clientY, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">null</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">53</span> <span style="background-color: #f5f5f5; color: #000000;">        event.myclick </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">54</span> <span style="background-color: #f5f5f5; color: #000000;">        touch.el </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> touch.el.dispatchEvent(event);
</span><span style="color: #008080;">55</span>         <span style="background-color: #f5f5f5; color: #0000ff;">return</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">56</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span>     <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> fnDom(el, msg, e) {
</span><span style="color: #008080;">59</span> <span style="background-color: #f5f5f5; color: #000000;">        el.value </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> msg </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">(</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> (e.timeStamp </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> t) </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">60</span> <span style="background-color: #f5f5f5; color: #000000;">                el.style.display </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">none</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">61</span> <span style="background-color: #f5f5f5; color: #000000;">                setTimeout(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">62</span> <span style="background-color: #f5f5f5; color: #000000;">                    el.style.display </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">63</span> <span style="background-color: #f5f5f5; color: #000000;">                }, </span><span style="background-color: #f5f5f5; color: #000000;">1000</span><span style="background-color: #f5f5f5; color: #000000;">)
</span><span style="color: #008080;">64</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;">65</span> 
<span style="color: #008080;">66</span> <span style="background-color: #f5f5f5; color: #000000;">    fastclick.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">67</span> <span style="background-color: #f5f5f5; color: #000000;">        fnDom(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">我是快速点击事件</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, e);
</span><span style="color: #008080;">68</span> <span style="background-color: #f5f5f5; color: #000000;">        log(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">快速点击</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">69</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">70</span> 
<span style="color: #008080;">71</span> <span style="background-color: #f5f5f5; color: #000000;">    div.addEventListener(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">72</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">+=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">div&lt;br/&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
<span style="color: #008080;">73</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">74</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">75</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p><strong style="line-height: 1.5;"><a href="http://sandbox.runjs.cn/show/muk6q2br">http://sandbox.runjs.cn/show/muk6q2br</a></strong></p>
<p><span>最后追寻很久找到一个解决方案，该方案将上述知识点全部联系起来了：</span></p>
<p><span>① 我们程序逻辑时先触发touch事件，在touchend时候模拟click事件</span></p>
<p><span>② 这时我们给click事件对象一个属性：</span></p>
<div class="cnblogs_code">
<pre>1 <span style="color: #0000ff;">var</span> event = document.createEvent('Events'<span style="color: #000000;">);
</span>2 event.initEvent('click', <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span>, window, 1, e.changedTouches[0<span style="color: #000000;">].screenX,
</span>3  e.changedTouches[0].screenY, e.changedTouches[0].clientX, e.changedTouches[0].clientY, <span style="color: #0000ff;">false</span>, <span style="color: #0000ff;">false</span>, <span style="color: #0000ff;">false</span>, <span style="color: #0000ff;">false</span>, 0, <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #ff0000;">4 event.myclick = true;
</span>5 touch.el &amp;&amp; touch.el.dispatchEvent(event);</pre>
</div>
<p><span style="line-height: 1.5;">③ 然后按照我们基础篇的逻辑，我们事实上会先执行document上的click事件</span></p>
<p>我们这里做了一个操作，判断是否包含myclick属性，有就直接跳出（事件会向下传递），如果没有就阻止传递</p>
<p>到此，我们就解决了鬼点击问题，当然，不够完善</p>
<h1>结语</h1>
<p>此文有点过长，但是对javascript事件机制描述较为详细，希望对各位有帮助。</p>
<p>&nbsp;</p>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptzdyxhxzsdyjxyzyddf/index.html">javascript中的一些核心知识点以及需要注意的地方</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]webappdyhzlyzydqdyhdpyjlkkb/index.html">[置顶]【webapp的优化整理】要做移动前端优化的朋友进来看看吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]yddjrwtyjjavascriptsjjzxjsjydjr/index.html">[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntzhb30fzxhsygruntdbqddm/index.html">【grunt整合版】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdyd30fzxhsygruntdbqddm/index.html">【grunt第一弹】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdsdgruntzqdsjxmzdyy/index.html">【grunt第三弹】grunt在前端实际项目中的应用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntded30fzxhsygruntdbqddm02/index.html">【grunt第二弹】30分钟学会使用grunt打包前端代码（02）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxtpyddhadlqs/index.html">【IScroll深入学习】突破移动端黑暗的利器（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxjjIScrollynzz/index.html">【IScroll深入学习】解决IScroll疑难杂症</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx00mniScroll/index.html">【iScroll源码学习00】模拟iScroll</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx01zbjd/index.html">【iScroll源码学习01】准备阶段</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx02fjiScrollsghxsjd/index.html">【iScroll源码学习02】分解iScroll三个核心事件点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx03iScrollsjjzygdtdsx/index.html">【iScroll源码学习03】iScroll事件机制与滚动条的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx04flIScrollhx/index.html">【iScroll源码学习04】分离IScroll核心</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdytyyjc/index.html">【javascript培训第一天】语言基础</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdstcybl/index.html">【javascript培训第三天】查遗补漏</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdetDOMyBOM/index.html">【javascript培训第二天】DOM与BOM</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk01mkhbc/index.html">【javascript激增的思考01】模块化编程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk02mkhyMVC/index.html">【javascript激增的思考02】模块化与MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk03MVVMyKnockout/index.html">【javascript激增的思考03】MVVM与Knockout</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk04MVCyBackbonejs(beta)/index.html">【javascript激增的思考04】MVC与Backbonejs(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptmxdxzlrwmyqltkdzb01/index.html">【javascript面向对象之路】让我们一起来坦克大战吧01</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/NodeJSxxbj04xwfbxt/index.html">【NodeJS学习笔记04】新闻发布系统</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx01ljzgrequireJSdjg/index.html">【requireJS源码学习01】了解整个requireJS的结构</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx02datamainjzdsx/index.html">【requireJS源码学习02】datamain加载的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx03xjrequireJSdjzlc/index.html">【requireJS源码学习03】细究requireJS的加载流程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjkfygjdrlcjs/index.html">【UI插件】开发一个简单日历插件（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjjddrlcjxxxMVCsx/index.html">【UI插件】简单的日历插件（下）——学习MVC思想</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()/index.html">【zepto学习笔记01】核心方法$()</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()b/index.html">【zepto学习笔记01】核心方法$()（补）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj02lsd/index.html">【zepto学习笔记02】零碎点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj03sjjz/index.html">【zepto学习笔记03】事件机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmsztjavascriptzdjc/index.html">【一次面试】再谈javascript中的继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone01mxModel/index.html">【再探backbone01】模型Model</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone02jhCollection/index.html">【再探backbone02】集合Collection</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone03bkydyyysltgym/index.html">【再探backbone03】博客园单页应用实例（提供源码）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone04dyyydjslycl/index.html">【再探backbone04】单页应用的基石路由处理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ctUnderscorezsmbyq/index.html">【初探Underscore】再说模版引擎</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzAjaxjsxnszddAjax/index.html">【初窥javascript奥秘之Ajax】简述下你所知道的Ajax？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjmpnxnwmyqmdp/index.html">【初窥javascript奥秘之事件冒泡】那些年我们一起冒的泡</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjjzldtygdj/index.html">【初窥javascript奥秘之事件机制】论“点透”与“鬼点击”</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzrrzmbddthisnzdxzthiszxnlm/index.html">【初窥javascript奥秘之让人捉摸不定的this】你知道现在this指向哪里吗？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzbbydxbdhlqbcl/index.html">【初窥javascript奥秘之闭包】叶大侠病都好了，求不踩了：）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzmxdxfzyjc/index.html">【初窥javascript奥秘之面向对象】封装与继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/qdmdsjdjgjdnzdljm/index.html">【前端盲点】事件的几个阶段你真的了解么？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyviewymodelxgsl/index.html">【单页应用】view与model相关梳理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyyqldyyybsxjdwbgns/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyqjkzqappyggxsm/index.html">【单页应用】全局控制器app应该干些什么？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyywmgrhclkjdcccjgx/index.html">【单页应用】我们该如何处理框架弹出层层级关系？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyljMVC/index.html">【单页应用】理解MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyztxjzviewzjygrhtx/index.html">【单页应用之通信机制】view之间应该如何通信</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyjkzHistoryxsHistorydgdyyydm/index.html">【单页应用巨坑之History】细数History带给单页应用的噩梦</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtszeptofindysyjiosdcjpknrnhtt/index.html">【小贴士】zeptofind元素以及ios弹出键盘可能让你很头疼</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgytransitionEndanimatedygyqgs/index.html">【小贴士】关于transitionEndanimate的一个有趣故事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgzzdbbysjwtdzzmp/index.html">【小贴士】工作中的”闭包“与事件委托的”阻止冒泡“</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtstytjavascriptzdreplace/index.html">【小贴士】探一探javascript中的replace</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsxnjpyfixeddgydddt/index.html">【小贴士】虚拟键盘与fixed带给移动端的痛！</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ttjavascriptsjjzdcsxyl/index.html">【探讨】javascript事件机制底层实现原理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mkhbcljrequireJSsxygjddmkjzq/index.html">【模块化编程】理解requireJS实现一个简单的模块加载器</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zyJavaScriptmfjmtsdqlxkjzbfgndcljz/index.html">【转】【译】JavaScript魔法揭秘探索当前流行框架中部分功能的处理机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl01javascriptcszds/index.html">【追寻javascript高手之路01】javascript参数知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl02blzyyzds/index.html">【追寻javascript高手之路02】变量、作用域知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl03javascriptdxdld/index.html">【追寻javascript高手之路03】javascript对象大乱斗</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl04ljprototype/index.html">【追寻javascript高手之路04】理解prototype</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl05ljsjl/index.html">【追寻javascript高手之路05】理解事件流</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj04zxzzsj(2)/index.html">【重构笔记04】重新组织数据(2)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj05jhtjbds/index.html">【重构笔记05】简化条件表达式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj06jhhsdy/index.html">【重构笔记06】简化函数调用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmshgttbxysjfl/index.html">一次面试回顾——探讨表现与数据分离</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dhzwebappzdxz/index.html">动画在webapp中的现状</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ysandriodlqhthdomclicksjqtsxwttj/index.html">原生andriod浏览器回退后dom（click）事件全体失效问题探究</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/scsbdjxysdsbsjytouchsjdnxs/index.html">手持设备点击响应速度，鼠标事件与touch事件的那些事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mnbjQueryzeptohxymfx/index.html">迷你版jQuery——zepto核心源码分析</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dbsgzdlwmlyqxjdddomxzqb/index.html">都别说工资低了，我们来一起写简单的dom选择器吧！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>