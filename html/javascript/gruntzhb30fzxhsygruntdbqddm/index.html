<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>【grunt整合版】30分钟学会使用grunt打包前端代码</div><br><h1>grunt</h1>
<p>是一套前端自动化工具，一个基于nodeJs的命令行工具，一般用于：<br>① 压缩文件<br>② 合并文件<br>③ 简单语法检查</p>
<p>对于其他用法，我还不太清楚，我们这里简单介绍下grunt的压缩、合并文件，初学，有误请包涵</p>
<h1>准备阶段</h1>
<h2>1、nodeJs环境</h2>
<p>因为grunt是基于nodeJs的，所以首先各位需要安装nodeJS环境，这块我们便不管了<br>http://www.cnblogs.com/yexiaochai/p/3527418.html</p>
<h2>2、安装grunt</h2>
<p>有了nodeJs环境后，我们便可以开始搞grunt了，因为我们可能在任何目录下运行打包程序，所以我们需要安装CLI<br>官方推荐在全局安装CLI（grunt的命令行接口）</p>
<div class="cnblogs_code">
<pre><span>npm install -g grunt-cli</span></pre>
</div>
<p><span>这条命令将会把grunt命令植入系统路径，这样就能在任意目录运行他，原因是</span></p>
<p>每次运行grunt时，它都会使用node的require查找本地是否安装grunt，如果找到CLI便加载这个本地grunt库<br>然后应用我们项目中的GruntFile配置，并执行任务<br>PS：这段先不要管，安装完了往下看</p>
<h1>实例学习：打包zepto</h1>
<p>一些东西说多了都是泪，直接先上实例吧，实例结束后再说其它的<br>首先在D盘新建一个项目（文件夹就好）<br>在里面新增两个文件（不要问为什么，搞进去先）</p>
<h2>① package.json</h2>
<div class="cnblogs_code">
<pre><span>{
  </span>"name": "demo"<span>,
  </span>"file": "zepto"<span>,
  </span>"version": "0.1.0"<span>,
  </span>"description": "demo"<span>,
  </span>"license": "MIT"<span>,
  </span>"devDependencies"<span>: {
    </span>"grunt": "~0.4.1"<span>,
    </span>"grunt-contrib-jshint": "~0.6.3"<span>,
    </span>"grunt-contrib-uglify": "~0.2.1"<span>,
    </span>"grunt-contrib-requirejs": "~0.4.1"<span>,
    </span>"grunt-contrib-copy": "~0.4.1"<span>,
    </span>"grunt-contrib-clean": "~0.5.0"<span>,
    </span>"grunt-strip": "~0.2.1"<span>
  },
  </span>"dependencies"<span>: {
    </span>"express": "3.x"<span>
  }
}</span></pre>
</div>
<h2>② Gruntfile.js</h2>
<p>完了我们需要在grunt目录下执行 npm install将相关的文件下载下来：</p>
<div class="cnblogs_code">
<pre><span>$ cd d:
$ cd grunt</span></pre>
</div>
<p><img src="51142158544467.png" alt=""></p>
<p>然后我们的目录就会多一点东西：</p>
<p><img src="253389610316040.png" alt=""></p>
<p>多了很多东西，先别管事干什么的，我们后面都会用到，这个时候在目录下新建src文件夹，并且搞一个zepto进去</p>
<p><img src="347799810327866.png" alt=""></p>
<p>然后在Gruntfile中新增以下代码（先别管，增加再说）</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  </span><span>//</span><span> 项目配置</span>
<span>  grunt.initConfig({
    pkg: grunt.file.readJSON(</span>'package.json'<span>),
    uglify: {
      options: {
        banner: </span>'/*! &lt;%= pkg.file %&gt; &lt;%= grunt.template.today("yyyy-mm-dd") %&gt; */\n'<span>
      },
      build: {
        src: </span>'src/&lt;%=pkg.file %&gt;.js'<span>,
        dest: </span>'dest/&lt;%= pkg.file %&gt;.min.js'<span>
      }
    }
  });
  </span><span>//</span><span> 加载提供"uglify"任务的插件</span>
  grunt.loadNpmTasks('grunt-contrib-uglify'<span>);
  </span><span>//</span><span> 默认任务</span>
  grunt.registerTask('default', ['uglify'<span>]);
}</span></pre>
</div>
<p>然后运行 grunt命令后</p>
<div class="cnblogs_code">
<pre><span>grunt</span></pre>
</div>
<p><img src="15931369750941.png" alt=""></p>
<p>嗯嗯，多了一个文件，并且是压缩的，不差！！！第一步结束</p>
<h1>认识Gruntdile与package.json</h1>
<p><span>不出意外，每一个gurnt都会需要这两个文件，并且很可能就只有这两个文件（复杂的情况有所不同）</span></p>
<h2><span>package.json</span></h2>
<p>这个文件用来存储npm模块的依赖项（比如我们的打包若是依赖requireJS的插件，这里就需要配置）<br>然后，我们会在里面配置一些不一样的信息，比如我们上面的file，这些数据都会放到package中<br>对于package的灵活配置，我们会在后面提到</p>
<h2>Gruntfile</h2>
<p>这个文件尤其关键，他一般干两件事情：<br>① 读取package信息<br>② 插件加载、注册任务，运行任务（grunt对外的接口全部写在这里面）</p>
<p>Gruntfile一般由四个部分组成<br>① 包装函数<br>这个包装函数没什么东西，意思就是我们所有的代码必须放到这个函数里面</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
</span><span>//</span><span>你的代码</span>
}</pre>
</div>
<p>这个不用知道为什么，直接将代码放入即可</p>
<p>② 项目/任务配置<br>我们在Gruntfile一般第一个用到的就是initConfig方法配置依赖信息</p>
<div class="cnblogs_code">
<pre>pkg: grunt.file.readJSON('package.json')</pre>
</div>
<p><span>这里的 grunt.file.readJSON就会将我们的配置文件读出，并且转换为json对象</span></p>
<p>然后我们在后面的地方就可以采用pkg.XXX的方式访问其中的数据了<br>值得注意的是这里使用的是underscore模板引擎，所以你在这里可以写很多东西</p>
<p>uglify是一个插件的，我们在package依赖项进行了配置，这个时候我们为系统配置了一个任务<br>uglify（压缩），他会干这几个事情：</p>
<p>① 在src中找到zepto进行压缩（具体名字在package中找到）<br>② 找到dest目录，没有就新建，然后将压缩文件搞进去<br>③ 在上面加几个描述语言</p>
<p>这个任务配置其实就是一个方法接口调用，按照规范来就好，暂时不予关注，内幕后期来<br>这里只是定义了相关参数，但是并未加载实际函数，所以后面马上就有一句：</p>
<div class="cnblogs_code">
<pre>grunt.loadNpmTasks('grunt-contrib-uglify');</pre>
</div>
<p>用于加载相关插件</p>
<p><span>最后注册一个自定义任务（其实也是默认任务），所以我们下面的命令行是等效的：</span></p>
<div class="cnblogs_code">
<pre>grunt == grunt uglify</pre>
</div>
<p>至此，我们就简单解析了一番grunt的整个操作，下面来合并文件的例子</p>
<h1>合并文件</h1>
<p><span>合并文件依赖于grunt-contrib-concat插件，所以我们的package依赖项要新增一项</span></p>
<div class="cnblogs_code">
<pre>"devDependencies"<span>: {
  </span>"grunt": "~0.4.1"<span>,
  </span>"grunt-contrib-jshint": "~0.6.3"<span>,
  </span>"grunt-contrib-concat": "~0.3.0"<span>,
  </span>"grunt-contrib-uglify": "~0.2.1"<span>,
  </span>"grunt-contrib-requirejs": "~0.4.1"<span>,
  </span>"grunt-contrib-copy": "~0.4.1"<span>,
  </span>"grunt-contrib-clean": "~0.5.0"<span>,
  </span>"grunt-strip": "~0.2.1"<span>
},</span></pre>
</div>
<p>然后再将代码写成这个样子</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  </span><span>//</span><span> 项目配置</span>
<span>  grunt.initConfig({
    pkg: grunt.file.readJSON(</span>'package.json'<span>),
    concat: {
      options: {
        separator: </span>';'<span>
      },
      dist: {
        src: [</span>'src/zepto.js', 'src/underscore.js', 'src/backbone.js'<span>],
        dest: </span>'dest/libs.js'<span>
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
  </span><span>//</span><span> 默认任务</span>
  grunt.registerTask('default', ['concat'<span>]);
}</span></pre>
</div>
<p>运行后，神奇的一幕发生了：</p>
<p><img src="7274737510242.png" alt=""></p>
<p>三个文件被压缩成了一个，但是没有压缩，所以，我们这里再加一步操作，将之压缩后再合并</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  </span><span>//</span><span> 项目配置</span>
<span>  grunt.initConfig({
    pkg: grunt.file.readJSON(</span>'package.json'<span>),
    concat: {
      options: {
        separator: </span>';'<span>
      },
      dist: {
        src: [</span>'src/zepto.js', 'src/underscore.js', 'src/backbone.js'<span>],
        dest: </span>'dest/libs.js'<span>
      }
    },
    uglify: {
      build: {
        src: </span>'dest/libs.js'<span>,
        dest: </span>'dest/libs.min.js'<span>
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-uglify'<span>);
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
  </span><span>//</span><span> 默认任务</span>
  grunt.registerTask('default', ['concat', 'uglify'<span>]);
}</span></pre>
</div>
<p>我这里的做法是先合并形成一个libs，然后再将libs压缩成libs.min.js</p>
<p><img src="42146406938419.png" alt=""></p>
<p>所以我们这里换个做法，先压缩再合并，其实unglify已经干了这些事情了</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  </span><span>//</span><span> 项目配置</span>
<span>  grunt.initConfig({
    pkg: grunt.file.readJSON(</span>'package.json'<span>),
    uglify: {
      </span>"my_target"<span>: {
        </span>"files"<span>: {
          </span>'dest/libs.min.js': ['src/zepto.js', 'src/underscore.js', 'src/backbone.js'<span>]
        }
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-uglify'<span>);
  </span><span>//</span><span> 默认任务</span>
  grunt.registerTask('default', ['uglify'<span>]);
}</span></pre>
</div>
<p>所以，我们就暂时不去关注concat了</p>
<p>最后，今天时间不早了，我们最后研究下grunt配合require于是便结束今天的学习吧</p>
<h1>合并requireJS管理的文件</h1>
<p>有了前面基础后，我们来干一件平时很头疼的事情，便是将require管理的所有js文件给压缩了合并为一个文件<br>首先我们建立一个简单的程序，里面使用了zepto、backbone、underscore（事实上我并未使用什么）</p>
<p><img src="15540785404970.png" alt=""></p>
<p><span>在main.js中新增代码：</span></p>
<div class="cnblogs_code">
<pre><span>require.config({
 baseUrl: </span>''<span>,
 shim: {
  $: {
      exports: </span>'zepto'<span>
  },
  _: {
   exports: </span>'_'<span>
  },
  B: {
   deps: [
    </span>'_'<span>,
    </span>'$'<span>
     ],
   exports: </span>'Backbone'<span>
  }
 },
 paths: {
  </span>'$': 'src/zepto'<span>,
  </span>'_': 'src/underscore'<span>,
  </span>'B': 'src/backbone'<span>
 }
});
requirejs([</span>'B'], <span>function</span><span> (b) {
});</span></pre>
</div>
<p>这样的话运行会自动加载几个文件，我们现在希望将之合并为一个libs.js该怎么干呢？？？</p>
<p>我们这里使用自定义任务方法来做，因为我们好像没有介绍他</p>
<p>要使用requireJS相关需要插件&nbsp;</p>
<div class="cnblogs_code">
<pre>grunt.loadNpmTasks('grunt-contrib-requirejs');</pre>
</div>
<p><span>因为我们以后可能存在配置文件存在各个项目文件的情况，所以我们这里将requireJs相关的配置放入gruntCfg.json中</span></p>
<p>这样我们的package.json就没有什么实际意义了：</p>
<div class="cnblogs_code">
<pre><span>{
  </span>"name": "demo"<span>,
  </span>"version": "0.1.0"<span>,
  </span>"description": "demo"<span>,
  </span>"license": "MIT"<span>,
  </span>"devDependencies"<span>: {
 </span>"grunt": "~0.4.1"<span>,
 </span>"grunt-contrib-jshint": "~0.6.3"<span>,
 </span>"grunt-contrib-concat": "~0.3.0"<span>,
 </span>"grunt-contrib-uglify": "~0.2.1"<span>,
 </span>"grunt-contrib-requirejs": "~0.4.1"<span>,
 </span>"grunt-contrib-copy": "~0.4.1"<span>,
 </span>"grunt-contrib-clean": "~0.5.0"<span>,
 </span>"grunt-strip": "~0.2.1"<span>
 
  },
  </span>"dependencies"<span>: {
    </span>"express": "3.x"<span>
  }
}</span></pre>
</div>
<p>我们这里设置的require相关的grunt配置文件如下（gruntCfg.json）：</p>
<div class="cnblogs_code">
<pre><span>{
  </span>"requirejs"<span>: {
    </span>"main"<span>: {
      </span>"options"<span>: {
        </span>"baseUrl": ""<span>,
        </span>"paths"<span>: {
          </span>"$": "src/zepto"<span>,
          </span>"_": "src/underscore"<span>,
          </span>"B": "src/backbone"<span>,
          </span>"Test": "src/Test"<span>
        },
        </span>"web"<span>: {
          </span>"include"<span>: [
            </span>"$"<span>,
            </span>"_"<span>,
            </span>"B"<span>,
            </span>"Test"<span>
          ],
          </span>"out": "dest/libs.js"<span>
        }
      }
    }
  }
}</span></pre>
</div>
<p>这里我们要打包这些文件搞到dest的libs.js文件中，这个文件照做就行，最后核心代码如下：</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);
  </span><span>//</span><span>为了介绍自定义任务搞了一个这个</span>
  grunt.registerTask('build', 'require demo', <span>function</span><span> () {
    </span><span>//</span><span>任务列表</span>
    <span>var</span> tasks = ['requirejs'<span>];
    </span><span>//</span><span>源码文件</span>
    <span>var</span> srcDir = 'src'<span>;
    </span><span>//</span><span>目标文件</span>
    <span>var</span> destDir = 'dest'<span>;
    </span><span>//</span><span>设置参数</span>
    grunt.config.set('config'<span>, {
      srcDir: srcDir,
      destDir: destDir
    });
    </span><span>//</span><span>设置requireJs的信息</span>
    <span>var</span> taskCfg = grunt.file.readJSON('gruntCfg.json'<span>);
    </span><span>var</span> options =<span> taskCfg.requirejs.main.options,
        platformCfg </span>=<span> options.web,
        includes </span>=<span> platformCfg.include,
        paths </span>=<span> options.paths;
    </span><span>var</span> pos = -1<span>;
    </span><span>var</span> requireTask =<span> taskCfg.requirejs;
    options.path </span>=<span> paths;
    options.out </span>=<span> platformCfg.out;
    options.include </span>=<span> includes;
    </span><span>//</span><span>运行任务</span>
<span>    grunt.task.run(tasks);
    grunt.config.set(</span>"requirejs"<span>, requireTask);
  });
}</span></pre>
</div>
<p>搞完了运行就好：grunt build</p>
<div class="cnblogs_code">
<pre><span>grunt build</span></pre>
</div>
<p><img src="38835026168581.png" alt=""></p>
<p><img src="32951285938665.png" alt=""></p>
<p>最后发现叶小钗三字，我就放心了，安全！！！！！！</p>
<h1>配置任务/grunt.initConfig</h1>
<p>前面我们简单的介绍了grunt相关的知识，这里我们这里还需要再熟悉下Gruntfile相关的知识点，比如说配置任务</p>
<p>grunt的任务配置都是在Gruntfile中的grunt.initConfig方法中指定的，这个配置主要都是一些命名性属性<br>比如我们上次用到的合并以及压缩的任务配置：</p>
<div class="cnblogs_code">
<pre><span>grunt.initConfig({
    concat: {
        </span><span>//</span><span>这里是concat任务的配置信息</span>
<span>    },
    uglify: {
        </span><span>//</span><span>这里是uglify任务的配置信息</span>
<span>    },
    </span><span>//</span><span>任意非任务特定属性</span>
    my_property: 'whatever'<span>,
    my_src_file: [</span>'foo/*.js', 'bar/*.js'<span>]
});</span></pre>
</div>
<p>其中的my_property完全可能读取外部json配置文件，然后在上面任务配置中便可以，比如我们要压缩的文件为准或者最后要放到哪里，便可以在此配置</p>
<p>我们使用grunt的时候，主要工作就是配置任务或者创建任务，实际上就是做一个事件注册，然后由我们触发之，所以grunt的核心还是事件注册<br>每次运行grunt时，我们可以指定运行一个或者多个任务，通过任务决定要做什么，比如我们同时要压缩和合并还要做代码检查</p>
<div class="cnblogs_code">
<pre>grunt.registerTask('default', ['jshint','qunit','concat','uglify']);</pre>
</div>
<p>当运行一个基本任务时，grunt并不会查找配置和检查运行环境，他仅仅运行指定的任务函数，可以传递冒号分割参数，比如：</p>
<div class="cnblogs_code">
<pre>grunt.registerTask('foo', 'A sample task that logs stuff.', <span>function</span><span> (arg1, arg2) {
  </span><span>if</span> (arguments.length === 0<span>) {
    grunt.log.writeln(</span><span>this</span>.name + ", no args"<span>);
  } </span><span>else</span><span> {
    grunt.log.writeln(</span><span>this</span>.name + ", " + arg1 + " " +<span> arg2);
  }
});</span></pre>
</div>
<p>运行结果如下：</p>
<div class="cnblogs_code">
<pre>$ grunt foo:testing:123<span>
Running </span>"foo:testing:123"<span> (foo) task
foo, testing </span>123<span>

$ grunt foo:testing
Running </span>"foo:testing"<span> (foo) task
foo, testing undefined

$ grunt foo
Running </span>"foo"<span> task
foo, no args</span></pre>
</div>
<p>这里有个多任务的情况，就是一个任务里面实际上第一了多个东东，这个时候就有所不同</p>
<div class="cnblogs_code">
<pre><span>grunt.initConfig({
    log: {
        demo01: [</span>1,2,3<span>],
        demo02: </span>'hello world'<span>,
        demo03: </span><span>false</span><span>
    }
});
grunt.registerTask(</span>'log','log stuff.', <span>function</span><span>(){
    grunt.log.writeln(</span><span>this</span>.target + ': ' + <span>this</span><span>.data);
});</span></pre>
</div>
<p>如果我们运行，运行情况如下：</p>
<p>???????</p>
<p>更多时候，我们实际场景中都会需要自定义任务，而在我们任务内部使用 grunt.task.run({}) 运行任务<br>这块的知识点，我们后面以实际例子说明</p>
<h1>grunt插件</h1>
<p>学习grunt主要就是学习grunt的插件使用，所以我们今天先来学习常用的几个插件</p>
<h2>grunt-contrib-unglify</h2>
<p>我们仍然以简单例子学习</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    uglify: {
      my_target: {
        files: {
          </span>'dest/libs.min.js': ['src/zepto.js', 'src/underscoce.js'<span>]
        }
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-uglify'<span>);
}</span></pre>
</div>
<p>这样会将src里面的zepto等文件打包值dest的lib.min.js中</p>
<h3>压缩一个文件夹的所有文件</h3>
<p>然后这段代码非常有意思，他会将一个文件目录里面的所有js文件打包到另一个文件夹</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    uglify: {
      my_target: {
        files: [{
          expand: </span><span>true</span><span>,
          cwd: </span>'src'<span>,
          src: </span>'**/*.js'<span>,
          dest: </span>'dest'<span>
        }]
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-uglify'<span>);
}</span></pre>
</div>
<p><img src="42147710315986.png" alt=""></p>
<p>若是你希望给你文件的头部加一段注释性语言配置banner信息即可</p>
<div class="cnblogs_code">
<pre><span>grunt.initConfig({
  pkg: grunt.file.readJSON(</span>'package.json'<span>),
  uglify: {
    options: {
      banner: </span>'/*! 注释信息 */'<span>
    },
    my_target: {
      files: {
        </span>'dest/output.min.js': ['src/input.js'<span>]
      }
    }
  }
});</span></pre>
</div>
<h2>grunt-contrib-concat</h2>
<p>该插件主要用于代码合并，将多个文件合并为一个，我们前面的uglify也提供了一定合并的功能<br>在可选属性中我们可以设置以下属性：<br>① separator 用于分割各个文件的文字，<br>② banner 前面说到的文件头注释信息，只会出现一次<br>③ footer 文件尾信息，只会出现一次<br>④ stripBanners去掉源代码注释信息（只会清楚/**/这种注释）</p>
<p>一个简单的例子：</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
  concat: {
    options: {
      separator: </span>'/*分割*/'<span>,
      banner: </span>'/*测试*/'<span>,
      footer: </span>'/*footer*/'<span>
     
    },
    dist: {
      src: [</span>'src/zepto.js', 'src/underscore.js', 'src/backbone.js'<span>],
      dest: </span>'dist/built.js'<span>,
    }
  }
});
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
}</span></pre>
</div>
<p>合并三个文件为一个，这种在我们源码调试时候很有意义</p>
<h3>构建两个文件夹</h3>
<p>有时候我们可能需要将合并的代码放到不同的文件，这个时候可以这样干</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    concat: {
      basic: {
        src: [</span>'src/zepto.js'<span>],
        dest: </span>'dest/basic.js'<span>
      },
      extras: {
        src: [</span>'src/underscore.js', 'src/backbone.js'<span>],
        dest: </span>'dest/with_extras.js'<span>
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
}</span></pre>
</div>
<p>这种功能还有这样的写法：</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    concat: {
      basic_and_extras: {
        files: {
          </span>'dist/basic.js': ['src/test.js', 'src/zepto.js'<span>],
          </span>'dist/with_extras.js': ['src/underscore.js', 'src/backbone.js'<span>]
        }
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
}</span></pre>
</div>
<p>第二种写法便于使用配置文件，具体各位选取吧，至于读取配置文件的东西我们这里就先不关注了</p>
<h2>grunt-contrib-jshint</h2>
<p>该插件用于检测文件中的js语法问题，比如我test.js是这样写的：</p>
<div class="cnblogs_code">
<pre>alert('我是叶小钗')</pre>
</div>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    jshint: { 
      all: [</span>'src/test.js'<span>]
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-jshint'<span>);
}</span></pre>
</div>
<p>运行结果是：</p>
<div class="cnblogs_code">
<pre><span>$ grunt jshint
Running </span>"jshint:all"<span> (jshint) task
Linting src</span>/test.js ...ERROR
<span>[L1:C15] W033: Missing semicolon.
alert(</span>'我是叶小钗')</pre>
</div>
<p>说我缺少一个分号，好像确实缺少.....如果在里面写明显的BUG的话会报错<br>多数时候，我们认为没有分号无伤大雅，所以，我们文件会忽略这个错误：</p>
<div class="cnblogs_code">
<pre><span>jshint: {
  options: {
    </span>'-W033': <span>true</span><span>
  },
  all: [</span>'src/test.js'<span>]
}</span></pre>
</div>
<p>这里有一个稍微复杂的应用，就是我们合并之前做一次检查，合并之后再做一次检查，我们可以这样写</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    concat: {
      dist: {
        src: [</span>'src/test01.js', 'src/test02.js'<span>],
        dest: </span>'dist/output.js'<span>
      }
    },
    jshint: {
      options: {
        </span>'-W033': <span>true</span><span> 
      },
      pre: [</span>'src/test01.js', 'src/test02.js'<span>],
      after: [</span>'dist/output.js'<span>]
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-concat'<span>);
  grunt.loadNpmTasks(</span>'grunt-contrib-jshint'<span>);
}</span></pre>
</div>
<div class="cnblogs_code">
<pre><span>$ grunt jshint:pre concat jshint:after
Running </span>"jshint:pre"<span> (jshint) task
</span>&gt;&gt; 2<span> files lint free.
Running </span>"concat:dist"<span> (concat) task
File </span>"dist/output.js"<span> created.
Running </span>"jshint:after"<span> (jshint) task
</span>&gt;&gt; 1 file lint free.</pre>
</div>
<p>这里连续运行了三个任务，先做检查再合并，然后做检测，我这里写了两个简单的文件，如果将jquery搞进去的话，好像还出了不少BUG......<br>所以真的要用它还要自定一些规范，我们这里暂时到这里，先进入下一个插件学习</p>
<h2>grunt-contrib-requirejs</h2>
<p>我们的grunt打包程序极有可能与requirejs一起使用，但是几个插件学习下来又属requireJs的使用最为麻烦，因为网上资源很少，搞到这一段耗掉了我很多精力</p>
<p>这个时候你就会感叹，英语好不一定编程好，英语差想成为高手还是不简单啊！！！</p>
<div class="cnblogs_code">
<pre><span>requirejs: {
  compile: {
    options: {
      baseUrl: </span>"path/to/base"<span>,
      mainConfigFile: </span>"path/to/config.js"<span>,
      name: </span>"path/to/almond", <span>//</span><span> assumes a production build using almond</span>
      out: "path/to/optimized.js"<span>
    }
  }
}</span></pre>
</div>
<p>官方的例子首先就是这几个属性：</p>
<p>baseUrl 代表所有的js文件都会相对于这个目录</p>
<p>mainConfigFile 配置文件目录</p>
<p>name ？？？</p>
<p>out 输出文件</p>
<p>一些参数我们不太了解，这个时候就只能以例子破之了</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    requirejs: {
      compile: {
        </span>"options"<span>: {
          </span>"baseUrl": "./"<span>,
          </span>"paths"<span>: {
            </span>"$": "src/zepto"<span>,
            </span>"_": "src/underscore"<span>,
            </span>"B": "src/backbone"<span>,
            </span>"Test": "src/Test01"<span>
          },
          </span>"include"<span>: [
            </span>"$"<span>,
            </span>"_"<span>,
            </span>"B"<span>,
            </span>"Test"<span>
          ],
          </span>"out": "dest/libs.js"<span>
        }
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);
}</span></pre>
</div>
<p><img src="52271007687092.png" alt=""></p>
<p>这样配置后，会将include里面的文件打包为out对应的文件，paths的本身意义不大，就是用于配置include里面的指向</p>
<p>这个时候我们来加个name看看有神马作用：</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    requirejs: {
      compile: {
        </span>"options"<span>: {
          </span>"baseUrl": "./"<span>,
          </span>"name": 'src/test02.js'<span>,
          </span>"paths"<span>: {
            </span>"$": "src/zepto"<span>,
            </span>"_": "src/underscore"<span>,
            </span>"B": "src/backbone"<span>,
            </span>"Test": "src/Test01"<span>
          },
          </span>"include"<span>: [
            </span>"$"<span>,
            </span>"_"<span>,
            </span>"B"<span>,
            </span>"Test"<span>
          ],
          </span>"out": "dest/libs.js"<span>
        }
      }
    }
  });
  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);
}</span></pre>
</div>
<p>这样的话，会将name对应文件压缩到压缩文件的最前面，但是具体是干什么的，还是不太清楚，其英文注释说是单个文件或者其依赖项优化，不知道优化什么啊。。。囧！！！</p>
<p><span>requireJS基本的用法就是这样了，其详细信息，我们过段时间再来看看，下面说一下requireJS的其它用法</span></p>
<p><span>我们这里将requireJS的配置信息放在外面，而Gruntfile采用自定义任务的方式完成上面的功能</span></p>
<p><span>配置文件/cfg.json</span></p>
<div class="cnblogs_code">
<pre><span>{requirejs: {
  </span>"options"<span>: {
    </span>"baseUrl": "./"<span>,
    </span>"paths"<span>: {
      </span>"$": "src/zepto"<span>,
      </span>"_": "src/underscore"<span>,
      </span>"B": "src/backbone"<span>,
      </span>"Test": "src/Test01"<span>
    },
    </span>"include"<span>: [
      </span>"$"<span>,
      </span>"_"<span>,
      </span>"B"<span>,
      </span>"Test"<span>
    ],
    </span>"out": "dest/libs.js"<span>
  }
}}</span></pre>
</div>
<p>然后，这里我们便不是有initConfig的做法了，直接使用自定义任务</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {

  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);

  grunt.registerTask(</span>'build', 'require demo', <span>function</span><span> () {

    </span><span>//</span><span>第一步，读取配置信息</span>
    <span>var</span> cfg = grunt.file.readJSON('cfg.json'<span>);
    cfg </span>=<span> cfg.requirejs;
    grunt.config.set(</span>'requirejs'<span>, { test: cfg });

    </span><span>//</span><span>第二步，设置参数</span>
    grunt.log.debug('参数：' +<span> JSON.stringify(grunt.config()));

    </span><span>//</span><span>第三步跑任务</span>
    grunt.task.run(['requirejs'<span>]);
    
  });

}</span></pre>
</div>
<div class="cnblogs_code">
<pre>$ grunt build --<span>debug
Running </span>"build"<span> task
[D] Task source: d:\grunt\Gruntfile.js
[D] 参数：{</span>"requirejs":{"test":{"options":{"baseUrl":"./","paths":{"$":"<span>src/zept
o</span>","_":"src/underscore","B":"src/backbone","Test":"src/Test01"},"include":["$","<span>
_</span>","B","Test"],"out":"dest/libs.js"<span>}}}}

Running </span>"requirejs:test"<span> (requirejs) task
[D] Task source: d:\grunt\node_modules\grunt</span>-contrib-<span>requirejs\tasks\requirejs.j
s
</span>&gt;&gt; Tracing dependencies <span>for</span>: d:/grunt/dest/libs.js
&gt;&gt; Uglifying file: d:/grunt/dest/libs.js
&gt;&gt; d:/grunt/dest/libs.js
&gt;&gt; ----------------
&gt;&gt; d:/grunt/src/zepto.js
&gt;&gt; d:/grunt/src/underscore.js
&gt;&gt; d:/grunt/src/backbone.js
&gt;&gt; d:/grunt/src/Test01.js</pre>
</div>
<p>效果还是有的，最后我们介绍下requireJS打包模板文件</p>
<h1>require与模板文件</h1>
<p>我们知道，模板文件一般都是html，比如我们这里的demo01.html，对于这个文件我们应该怎么打包呢？其实很简单......</p>
<p><span>需要干两件事情：</span></p>
<p><span>① 引入require.text</span></p>
<p><span>② 加入模板文件</span></p>
<div class="cnblogs_code">
<pre><span>{
  </span>"requirejs"<span>: {
    </span>"options"<span>: {
      </span>"baseUrl": "./"<span>,
      </span>"paths"<span>: {
        </span>"$": "src/zepto"<span>,
        </span>"_": "src/underscore"<span>,
        </span>"B": "src/backbone"<span>,
        </span>"test": "src/test01"<span>,
        </span>"text": "src/require.text"<span>

      },
      </span>"include"<span>: [
        </span>"$"<span>,
        </span>"_"<span>,
        </span>"B"<span>,
        </span>"test"<span>,
        </span>"text!src/demo01.html"<span>
      ],
      </span>"out": "dest/libs.js"<span>
    }
  }
}</span></pre>
</div>
<p>于是，我们便成功将模板打入了</p>
<div class="cnblogs_code">
<pre>$ grunt build --<span>debug
Running </span>"build"<span> task
[D] Task source: d:\grunt\Gruntfile.js
[D] 参数：{</span>"requirejs":{"test":{"options":{"baseUrl":"./","paths":{"$":"<span>src/zept
o</span>","_":"src/underscore","B":"src/backbone","test":"src/test01","text":"<span>src/requi
re.text</span>"},"include":["$","_","B","test","text!src/demo01.html"],"out":"<span>dest/libs
.js</span>"<span>}}}}

Running </span>"requirejs:test"<span> (requirejs) task
[D] Task source: d:\grunt\node_modules\grunt</span>-contrib-<span>requirejs\tasks\requirejs.j
s
</span>&gt;&gt; Tracing dependencies <span>for</span>: d:/grunt/dest/libs.js
&gt;&gt; Uglifying file: d:/grunt/dest/libs.js
&gt;&gt; d:/grunt/dest/libs.js
&gt;&gt; ----------------
&gt;&gt; d:/grunt/src/zepto.js
&gt;&gt; d:/grunt/src/underscore.js
&gt;&gt; d:/grunt/src/backbone.js
&gt;&gt; d:/grunt/src/test01.js
&gt;&gt; d:/grunt/src/require.text.js
&gt;&gt; text!src/demo01.html</pre>
</div>
<p>在文件中我们引用方式是：</p>
<div class="cnblogs_code">
<pre>"text!src/demo01.html" =&gt; '具体文件'</pre>
</div>
<h1><span>打包样式文件</span></h1>
<p><span>样式文件的打包方式与js不太一样，这里我们下载css-min插件，并且在package.json中新增依赖项</span></p>
<div class="cnblogs_code">
<pre><span>{
  </span>"name": "demo"<span>,
  </span>"version":         "0.1.0"<span>,
  </span>"description":     "demo"<span>,
  </span>"license":         "MIT"<span>,
  </span>"devDependencies"<span>: {
    </span>"grunt":                   "~0.4.1"<span>,
    </span>"grunt-contrib-jshint":    "~0.6.3"<span>,
    </span>"grunt-contrib-concat":    "~0.3.0"<span>,
    </span>"grunt-contrib-uglify":    "~0.2.1"<span>,
    </span>"grunt-contrib-requirejs": "~0.4.1"<span>,
    </span>"grunt-contrib-copy":      "~0.4.1"<span>,
    </span>"grunt-contrib-clean":     "~0.5.0"<span>,
    </span>"grunt-strip":             "~0.2.1"<span>,
    </span>"grunt-contrib-watch": "~0.6.0"<span>,
    </span>"grunt-contrib-cssmin": "~0.5.0"<span>
  },
  </span>"dependencies"<span>:    {
    </span>"express": "3.x"<span>
  }
}</span></pre>
</div>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {
  grunt.initConfig({
    cssmin: {
      compress: {
        files: {
          </span>'dest/car.min.css'<span>: [
          </span>"src/car.css"<span>,
          </span>"src/car01.css"<span>
        ]
        }
      }
    }
  });

  grunt.loadNpmTasks(</span>'grunt-contrib-cssmin'<span>);

}</span></pre>
</div>
<p>如此一来我们便可以压缩合并CSS文件了：</p>
<div class="cnblogs_code">
<pre>$ grunt cssmin --<span>debug
Running </span>"cssmin:compress"<span> (cssmin) task
[D] Task source: d:\grunt\node_modules\grunt</span>-contrib-<span>cssmin\tasks\cssmin.js
File dest</span>/car.min.css created.</pre>
</div>
<h1>移动打包文件</h1>
<p>其实，grunt本身具有这样的功能，但是我们实际项目重会出现这种可能：</p>
<p>我们核心框架会有一套压缩代码，并且会在对应目录生成文件用于发布，但是这个地方的权限对各个频道团队是不可见的</p>
<p>所以，我们在各个频道的公共文件夹内应该将刚刚的文件给复制过去，这块代码其实很简单，不需要任何新知识都能实现：</p>
<p>我们这里依旧采用昨天的require相关的代码，但是一有个不同的地方就是，我们要同时在D盘的common文件夹中生成该文件</p>
<p>这个代码其实比较简单，这里我们先介绍一个新的插件copy</p>
<h2>grunt-contrib-copy</h2>
<p>该插件用于复制文件到你想要的文件夹处</p>
<div class="cnblogs_code">
<pre><span>grunt.initConfig({ copy: {
  main: {
    flatten: </span><span>true</span><span>,
    src: </span>'src/*.js'<span>,
    dest: </span>'dest/'<span>
  }
}
});</span></pre>
</div>
<p>这段代码就会将src中的js文件搞到dest里面，并且新建src文件夹：</p>
<div class="cnblogs_code">
<pre><span>$ grunt copy
Running </span>"copy:main"<span> (copy) task
Copied </span>7 files</pre>
</div>
<p><img src="39395997488850.png" alt=""></p>
<p>若是不想复制文件夹只要文件应该这样干：</p>
<div class="cnblogs_code">
<pre><span>grunt.initConfig({ copy: {
  main: {
    flatten: </span><span>true</span><span>,
    </span><span>//</span><span>    filter: 'isFile',</span>
    expand: <span>true</span><span>,
    src: </span>'src/**.js'<span>,
    dest: </span>'dest/'<span>
  }
}
});</span></pre>
</div>
<p>这块完了，我们就来移动打包文件至D盘了</p>
<h2>移动打包文件</h2>
<p>这个时候代码这样写就好（也许移动前我们还想将其文件夹里面的东西销毁，暂时不考虑了）</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {

  grunt.initConfig({ copy: {
    main: {
      </span><span>//</span><span>      flatten: true,</span>
      <span>//</span><span>      expand: true,</span>
      src: 'dest/**.js'<span>,
      dest: </span>'d:/common/'<span>
    }
  }
  });

  grunt.loadNpmTasks(</span>'grunt-contrib-copy'<span>);
  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);

  grunt.registerTask(</span>'build', 'require demo', <span>function</span><span> () {

    </span><span>//</span><span>第一步，读取配置信息</span>
    <span>var</span> cfg = grunt.file.readJSON('cfg.json'<span>);
    cfg </span>=<span> cfg.requirejs;
    grunt.config.set(</span>'requirejs'<span>, { test: cfg });

    </span><span>//</span><span>第二步，设置参数</span>
    grunt.log.debug('参数：' +<span> JSON.stringify(grunt.config()));

    </span><span>//</span><span>第三步跑任务</span>
    grunt.task.run(['requirejs'<span>]);

  });

  grunt.registerTask(</span>'default', 'test demo', ['build', 'copy'<span>]);

}</span></pre>
</div>
<div class="cnblogs_code">
<pre>Running "build"<span> task

Running </span>"requirejs:test"<span> (requirejs) task
</span>&gt;&gt; Tracing dependencies <span>for</span>: d:/grunt/dest/libs.js
&gt;&gt; Uglifying file: d:/grunt/dest/libs.js
&gt;&gt; d:/grunt/dest/libs.js
&gt;&gt; ----------------
&gt;&gt; d:/grunt/src/zepto.js
&gt;&gt; d:/grunt/src/underscore.js
&gt;&gt; d:/grunt/src/backbone.js
&gt;&gt; d:/grunt/src/test01.js
&gt;&gt; d:/grunt/src/require.text.js
&gt;&gt; text!src/demo01.html
<span>
Running </span>"copy:main"<span> (copy) task
Copied </span>8 files</pre>
</div>
<p><img src="49467699583904.png" alt=""></p>
<p>关于移动相关的知识点暂时介绍到这里，我们进入下一话题</p>
<h1><span>分支/频道处理</span></h1>
<p><span>我们在实际项目重会遇到这种情况，我们一个主干分支上可能拉出很多分支完成不同的功能，而各个分支就有那么一点点不同，那么这个时候打包工具该怎么办呢？</span></p>
<p><span>我们一般是这样处理的：</span></p>
<p><span>① 首先全局只会有一个打包工具</span></p>
<p><span>② 其次每一个分支都会有一个gruntCfg.json的配置文件，存储相关的打包信息</span></p>
<p><span>③ 每次打包时候便把响应的分支打印到各自的dest目录里面</span></p>
<p><span>为了模拟这一情况我们将grunt打包相关的文件放到D盘的grunt目录里面，并在D盘新建gruntDemo目录</span></p>
<p><span>然后我们在gruntDemo中建立一个项目，并且为这个项目拉一个分支，比如现在项目是地demo01与demo02</span></p>
<p>现在文件结构如下：</p>
<div class="cnblogs_code">
<pre><span>D:\GRUNTDEMO
├─demo01
│  │  gruntCfg.json
│  │
│  └─src
│          backbone.js
│          require.js
│          require.text.js
│          test01.js
│          test02.js
│          underscore.js
│          zepto.js
│
└─demo02
    │  gruntCfg.json
    │
    └─src
            backbone.js
            require.js
            require.text.js
            test01.js
            test02.js
            underscore.js
            zepto.js</span></pre>
</div>
<p>这个时候，要实现功能最好的方法就是写自定义任务了，其它方案不好使，这个时候起配置文件也需要有一定修改，比如其中的路径需要加入参数信息</p>
<div class="cnblogs_code">
<pre><span>{
  </span>"requirejs"<span>: {
    </span>"options"<span>: {
      </span>"baseUrl": "&lt;%= config.srcDir %&gt;"<span>,
      </span>"paths"<span>: {
        </span>"$": "src/zepto"<span>,
        </span>"_": "src/underscore"<span>,
        </span>"B": "src/backbone"<span>,
        </span>"test": "src/test01"<span>,
        </span>"text": "src/require.text"<span>

      },
      </span>"include"<span>: [
        </span>"$"<span>,
        </span>"_"<span>,
        </span>"B"<span>,
        </span>"test"<span>,
        </span>"text!src/demo01.html"<span>
        ],
        </span>"out": "&lt;%= config.destDir %&gt;/libs.js"<span>
      }
  }
}</span></pre>
</div>
<p>这个时候initConfig相关信息时候，首先得传入path依赖的文件目录，以及输出的文件目录</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {

  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);

  </span><span>//</span><span>channel为频道名称，project为项目名称，这里对应gruntDemo，branch为其分支，默认与grunt目录为平行关系，佛则package.json里面应该有配置信息</span>
  grunt.registerTask('build', 'require demo', <span>function</span><span> (channel, project, branch) {

    </span><span>var</span> path = '../' + channel + '/' + project +<span> branch;
    grunt.log.debug(</span>'path: ' +<span> path);

    </span><span>//</span><span>第一步，读取配置信息</span>
    <span>var</span> cfg = grunt.file.readJSON(path + '/gruntCfg.json'<span>);
    cfg </span>=<span> cfg.requirejs;

    grunt.config.set(</span>'config'<span>, {
      srcDir: path,
      destDir: path </span>+ '/dest'<span>
    });

    grunt.config.set(</span>'requirejs'<span>, { main: cfg });

    </span><span>//</span><span>第二步，设置参数</span>
    grunt.log.debug('param: ' +<span> JSON.stringify(grunt.config()));

    </span><span>//</span><span>第三步跑任务</span>
    grunt.task.run(['requirejs'<span>]);

  });

  grunt.registerTask(</span>'default', 'test demo', ['build', 'copy'<span>]);

}</span></pre>
</div>
<p>于是我们第一步工作成功了：</p>
<div class="cnblogs_code">
<pre>$ grunt build:gruntDemo:demo:02 --<span>debug
Running </span>"build:gruntDemo:demo:02"<span> (build) task
[D] Task source: d:\grunt\Gruntfile.js
[D] path: ..</span>/gruntDemo/<span>demo02
[D] param: {</span>"config":{"srcDir":"../gruntDemo/demo02","destDir":"<span>../gruntDemo/dem
o02/dest</span>"},"requirejs":{"main":{"options":{"baseUrl":"../gruntDemo/demo02","<span>path
s</span>":{"$":"src/zepto","_":"src/underscore","B":"src/backbone","test":"src/test01"<span>,
</span>"text":"src/require.text"},"include":["$","_","B","test","text!src/demo01.html"<span>]
,</span>"out":"../gruntDemo/demo02/dest/libs.js"<span>}}}}

Running </span>"requirejs:main"<span> (requirejs) task
[D] Task source: d:\grunt\node_modules\grunt</span>-contrib-<span>requirejs\tasks\requirejs.j
s
</span>&gt;&gt; Tracing dependencies <span>for</span>: d:/gruntDemo/demo02/dest/<span>libs.js
</span>&gt;&gt; Uglifying file: d:/gruntDemo/demo02/dest/<span>libs.js
</span>&gt;&gt; d:/gruntDemo/demo02/dest/<span>libs.js
</span>&gt;&gt; ----------------
&gt;&gt; d:/gruntDemo/demo02/src/<span>zepto.js
</span>&gt;&gt; d:/gruntDemo/demo02/src/<span>underscore.js
</span>&gt;&gt; d:/gruntDemo/demo02/src/<span>backbone.js
</span>&gt;&gt; d:/gruntDemo/demo02/src/<span>test01.js
</span>&gt;&gt; d:/gruntDemo/demo02/src/<span>require.text.js
</span>&gt;&gt; text!src/demo01.html</pre>
</div>
<p><img src="46831147014782.png" alt=""></p>
<p>如果改变一下任务命令呢：</p>
<div class="cnblogs_code">
<pre>grunt build:gruntDemo:demo:01 --debug</pre>
</div>
<p>结果证明也是没有问题的，这个地方我就不贴出来了，各位自己去试试，我们分支处理一块暂时到这里</p>
<p>频道处理其实我们这里已经做了，第一个参数是频道，第二个参数是项目，第三个参数为分支，所以频道相关我们暂时就不说了</p>
<h1>native与HTML5打包</h1>
<p>最后让我们来看看如何打包native文件，native文件的打包其实与打包HTML5的方式类似，只不过我们这里需要一点点配置，让一个项目可以打包成不同的效果</p>
<p>仍然以上面demo01为例，他的配置文件可能就需要做一定调整：</p>
<div class="cnblogs_code">
<pre><span>{
    </span>"requirejs"<span>: {
        </span>"options"<span>: {
            </span>"baseUrl": "&lt;%= config.srcDir %&gt;"<span>, 
            </span>"paths"<span>: {
                </span>"$": "src/zepto"<span>, 
                </span>"_": "src/underscore"<span>, 
                </span>"B": "src/backbone"<span>, 
                </span>"test": "src/test01"<span>, 
                </span>"text": "src/require.text"<span>
            }, 
            </span>"web"<span>: {
                </span>"include"<span>: [
                    </span>"$"<span>, 
                    </span>"_"<span>, 
                    </span>"B"<span>, 
                    </span>"test"<span>
                ], 
                </span>"out": "&lt;%= config.destDir %&gt;/libs.js"<span>
            }, 
            </span>"app"<span>: {
                </span>"include"<span>: [
                    </span>"$"<span>, 
                    </span>"_"<span>, 
                    </span>"B"<span>, 
                    </span>"test"<span>, 
                    </span>"text!src/demo01.html"<span>
                ], 
                </span>"out": "&lt;%= config.destDir %&gt;/libs_app.js"<span>
            }
        }
    }
}</span></pre>
</div>
<p><span>这里为了表现一点web与native的不同，我特意将web中少包含一个text文件，具体还得各位项目中去实践</span></p>
<p>如此一来，我们的代码需要做些许调整：</p>
<div class="cnblogs_code">
<pre>module.exports = <span>function</span><span> (grunt) {

  grunt.loadNpmTasks(</span>'grunt-contrib-requirejs'<span>);

  </span><span>//</span><span>type 打包app包还是web包，channel为频道名称，project为项目名称，这里对应gruntDemo，branch为其分支，默认与grunt目录为平行关系，佛则package.json里面应该有配置信息</span>
  grunt.registerTask('build', 'require demo', <span>function</span><span> (type, channel, project, branch) {

    </span><span>var</span> path = '../' + channel + '/' + project +<span> branch;
    grunt.log.debug(</span>'path: ' +<span> path);

    </span><span>//</span><span>第一步，读取配置信息</span>
    <span>var</span> cfg = grunt.file.readJSON(path + '/gruntCfg.json'<span>);
    cfg </span>=<span> cfg.requirejs.options;

    grunt.config.set(</span>'config'<span>, {
      srcDir: path,
      destDir: path </span>+ '/dest'<span>
    });

    grunt.log.debug(</span>'param: ' +<span> JSON.stringify(cfg));
    grunt.log.debug(</span>'param: ' + cfg[type]['include'<span>]);


    </span><span>var</span> taskCfg =<span> {};
    taskCfg.options </span>=<span> {};
    taskCfg.options.baseUrl </span>=<span> cfg.baseUrl;
    taskCfg.options.paths </span>=<span> cfg.paths;
    taskCfg.options[</span>'include'] = cfg[type]['include'<span>];
    taskCfg.options.out </span>=<span> cfg[type].out;


    grunt.config.set(</span>'requirejs'<span>, { main: taskCfg });

    </span><span>//</span><span>第二步，设置参数</span>
    grunt.log.debug('param: ' +<span> JSON.stringify(grunt.config()));

    </span><span>//</span><span>第三步跑任务</span>
    grunt.task.run(['requirejs'<span>]);

  });

  grunt.registerTask(</span>'default', 'test demo', ['build', 'copy'<span>]);

}</span></pre>
</div>
<p>于是便可以运行了！！！</p>
<div class="cnblogs_code">
<pre>$ grunt build:app:gruntDemo:demo:01 --<span>debug
Running </span>"build:app:gruntDemo:demo:01"<span> (build) task
[D] Task source: d:\grunt\Gruntfile.js
[D] path: ..</span>/gruntDemo/<span>demo01
[D] param: {</span>"baseUrl":"&lt;%= config.srcDir %&gt;","paths":{"$":"src/zepto","_":"<span>src/u
nderscore</span>","B":"src/backbone","test":"src/test01","text":"src/require.text"},"<span>we
b</span>":{"include":["$","_","B","test"],"out":"&lt;%= config.destDir %&gt;/libs.js"},"app"<span>:
{</span>"include":["$","_","B","test","text!src/demo01.html"],"out":"<span>&lt;%= config.destDir
 %&gt;/libs_app.js</span>"<span>}}
[D] param: $,_,B,test,text</span>!src/demo01.html
[D] param: {"config":{"srcDir":"../gruntDemo/demo01","destDir":"<span>../gruntDemo/dem
o01/dest</span>"},"requirejs":{"main":{"options":{"baseUrl":"../gruntDemo/demo01","<span>path
s</span>":{"$":"src/zepto","_":"src/underscore","B":"src/backbone","test":"src/test01"<span>,
</span>"text":"src/require.text"},"include":["$","_","B","test","text!src/demo01.html"<span>]
,</span>"out":"../gruntDemo/demo01/dest/libs_app.js"<span>}}}}

Running </span>"requirejs:main"<span> (requirejs) task
[D] Task source: d:\grunt\node_modules\grunt</span>-contrib-<span>requirejs\tasks\requirejs.j
s
</span>&gt;&gt; Tracing dependencies <span>for</span>: d:/gruntDemo/demo01/dest/<span>libs_app.js
</span>&gt;&gt; Uglifying file: d:/gruntDemo/demo01/dest/<span>libs_app.js
</span>&gt;&gt; d:/gruntDemo/demo01/dest/<span>libs_app.js
</span>&gt;&gt; ----------------
&gt;&gt; d:/gruntDemo/demo01/src/<span>zepto.js
</span>&gt;&gt; d:/gruntDemo/demo01/src/<span>underscore.js
</span>&gt;&gt; d:/gruntDemo/demo01/src/<span>backbone.js
</span>&gt;&gt; d:/gruntDemo/demo01/src/<span>test01.js
</span>&gt;&gt; d:/gruntDemo/demo01/src/<span>require.text.js
</span>&gt;&gt; text!src/demo01.html</pre>
</div>
<h1>结语</h1>
<p>我们这个星期花了三天时间一起学习了grunt打包相关的知识点，需要这些知识对您有用，搞这个东西还花费了不少心血呢！！！</p>
<p>若是文中有误请一并提出，后续若是这块有所得我们再一起总结吧</p>
<p>原来是分成三段，这里将之合一方便各位连贯阅读，篇幅大，记得<span style="color: #ff0000;"><strong>点赞</strong></span>！</p>
<p>&nbsp;</p>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptzdyxhxzsdyjxyzyddf/index.html">javascript中的一些核心知识点以及需要注意的地方</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]webappdyhzlyzydqdyhdpyjlkkb/index.html">[置顶]【webapp的优化整理】要做移动前端优化的朋友进来看看吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]yddjrwtyjjavascriptsjjzxjsjydjr/index.html">[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntzhb30fzxhsygruntdbqddm/index.html">【grunt整合版】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdyd30fzxhsygruntdbqddm/index.html">【grunt第一弹】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdsdgruntzqdsjxmzdyy/index.html">【grunt第三弹】grunt在前端实际项目中的应用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntded30fzxhsygruntdbqddm02/index.html">【grunt第二弹】30分钟学会使用grunt打包前端代码（02）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxtpyddhadlqs/index.html">【IScroll深入学习】突破移动端黑暗的利器（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxjjIScrollynzz/index.html">【IScroll深入学习】解决IScroll疑难杂症</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx00mniScroll/index.html">【iScroll源码学习00】模拟iScroll</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx01zbjd/index.html">【iScroll源码学习01】准备阶段</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx02fjiScrollsghxsjd/index.html">【iScroll源码学习02】分解iScroll三个核心事件点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx03iScrollsjjzygdtdsx/index.html">【iScroll源码学习03】iScroll事件机制与滚动条的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx04flIScrollhx/index.html">【iScroll源码学习04】分离IScroll核心</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdytyyjc/index.html">【javascript培训第一天】语言基础</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdstcybl/index.html">【javascript培训第三天】查遗补漏</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdetDOMyBOM/index.html">【javascript培训第二天】DOM与BOM</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk01mkhbc/index.html">【javascript激增的思考01】模块化编程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk02mkhyMVC/index.html">【javascript激增的思考02】模块化与MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk03MVVMyKnockout/index.html">【javascript激增的思考03】MVVM与Knockout</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk04MVCyBackbonejs(beta)/index.html">【javascript激增的思考04】MVC与Backbonejs(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptmxdxzlrwmyqltkdzb01/index.html">【javascript面向对象之路】让我们一起来坦克大战吧01</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/NodeJSxxbj04xwfbxt/index.html">【NodeJS学习笔记04】新闻发布系统</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx01ljzgrequireJSdjg/index.html">【requireJS源码学习01】了解整个requireJS的结构</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx02datamainjzdsx/index.html">【requireJS源码学习02】datamain加载的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx03xjrequireJSdjzlc/index.html">【requireJS源码学习03】细究requireJS的加载流程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjkfygjdrlcjs/index.html">【UI插件】开发一个简单日历插件（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjjddrlcjxxxMVCsx/index.html">【UI插件】简单的日历插件（下）——学习MVC思想</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()/index.html">【zepto学习笔记01】核心方法$()</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()b/index.html">【zepto学习笔记01】核心方法$()（补）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj02lsd/index.html">【zepto学习笔记02】零碎点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj03sjjz/index.html">【zepto学习笔记03】事件机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmsztjavascriptzdjc/index.html">【一次面试】再谈javascript中的继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone01mxModel/index.html">【再探backbone01】模型Model</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone02jhCollection/index.html">【再探backbone02】集合Collection</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone03bkydyyysltgym/index.html">【再探backbone03】博客园单页应用实例（提供源码）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone04dyyydjslycl/index.html">【再探backbone04】单页应用的基石路由处理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ctUnderscorezsmbyq/index.html">【初探Underscore】再说模版引擎</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzAjaxjsxnszddAjax/index.html">【初窥javascript奥秘之Ajax】简述下你所知道的Ajax？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjmpnxnwmyqmdp/index.html">【初窥javascript奥秘之事件冒泡】那些年我们一起冒的泡</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjjzldtygdj/index.html">【初窥javascript奥秘之事件机制】论“点透”与“鬼点击”</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzrrzmbddthisnzdxzthiszxnlm/index.html">【初窥javascript奥秘之让人捉摸不定的this】你知道现在this指向哪里吗？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzbbydxbdhlqbcl/index.html">【初窥javascript奥秘之闭包】叶大侠病都好了，求不踩了：）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzmxdxfzyjc/index.html">【初窥javascript奥秘之面向对象】封装与继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/qdmdsjdjgjdnzdljm/index.html">【前端盲点】事件的几个阶段你真的了解么？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyviewymodelxgsl/index.html">【单页应用】view与model相关梳理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyyqldyyybsxjdwbgns/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyqjkzqappyggxsm/index.html">【单页应用】全局控制器app应该干些什么？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyywmgrhclkjdcccjgx/index.html">【单页应用】我们该如何处理框架弹出层层级关系？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyljMVC/index.html">【单页应用】理解MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyztxjzviewzjygrhtx/index.html">【单页应用之通信机制】view之间应该如何通信</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyjkzHistoryxsHistorydgdyyydm/index.html">【单页应用巨坑之History】细数History带给单页应用的噩梦</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtszeptofindysyjiosdcjpknrnhtt/index.html">【小贴士】zeptofind元素以及ios弹出键盘可能让你很头疼</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgytransitionEndanimatedygyqgs/index.html">【小贴士】关于transitionEndanimate的一个有趣故事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgzzdbbysjwtdzzmp/index.html">【小贴士】工作中的”闭包“与事件委托的”阻止冒泡“</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtstytjavascriptzdreplace/index.html">【小贴士】探一探javascript中的replace</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsxnjpyfixeddgydddt/index.html">【小贴士】虚拟键盘与fixed带给移动端的痛！</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ttjavascriptsjjzdcsxyl/index.html">【探讨】javascript事件机制底层实现原理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mkhbcljrequireJSsxygjddmkjzq/index.html">【模块化编程】理解requireJS实现一个简单的模块加载器</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zyJavaScriptmfjmtsdqlxkjzbfgndcljz/index.html">【转】【译】JavaScript魔法揭秘探索当前流行框架中部分功能的处理机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl01javascriptcszds/index.html">【追寻javascript高手之路01】javascript参数知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl02blzyyzds/index.html">【追寻javascript高手之路02】变量、作用域知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl03javascriptdxdld/index.html">【追寻javascript高手之路03】javascript对象大乱斗</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl04ljprototype/index.html">【追寻javascript高手之路04】理解prototype</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl05ljsjl/index.html">【追寻javascript高手之路05】理解事件流</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj04zxzzsj(2)/index.html">【重构笔记04】重新组织数据(2)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj05jhtjbds/index.html">【重构笔记05】简化条件表达式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj06jhhsdy/index.html">【重构笔记06】简化函数调用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmshgttbxysjfl/index.html">一次面试回顾——探讨表现与数据分离</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dhzwebappzdxz/index.html">动画在webapp中的现状</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ysandriodlqhthdomclicksjqtsxwttj/index.html">原生andriod浏览器回退后dom（click）事件全体失效问题探究</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/scsbdjxysdsbsjytouchsjdnxs/index.html">手持设备点击响应速度，鼠标事件与touch事件的那些事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mnbjQueryzeptohxymfx/index.html">迷你版jQuery——zepto核心源码分析</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dbsgzdlwmlyqxjdddomxzqb/index.html">都别说工资低了，我们来一起写简单的dom选择器吧！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>