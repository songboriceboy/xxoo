<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>【单页应用】理解MVC</div><br><h1>前言</h1>
<div>之前我们为view引入了wrapperSet的概念，想以此解决view局部刷新问题，后来发现这个方案不太合理</div>
<div>view里面插入了业务相关的代码，事实上这个是应该剥离出去，业务的需求千奇百怪，我们不应该去处理</div>
<div>&nbsp;</div>
<div>view现在只提供最基础的功能：</div>
<div>① 定义各个状态的模板</div>
<div>② 渲染模板</div>
<div>整个view的逻辑便该结束了，有一个比较特殊的情况是，当状态值不变的情况就应该是更新，这个可能会有不一样的逻辑也应该划出去</div>
<div><span style="line-height: 1.5;">&nbsp;</span></div>
<div>Adapter的意义在于存储view渲染过程中需要的data数据，从组成上分为</div>
<div>① datamodel</div>
<div>② viewmodel</div>
<div>datamodel用于具体操作，viewmodel被干掉了，提供一个getViewModel的方法替换，并且对外提供一个format方法用于用户继承</div>
<div>format的参数便是datamodel，这里通过处理返回的数据便是我们所谓的viewModel，他将会用于view生成对应html</div>
<div>然后datamodel的改变会引起对应view的变化，这个变化发起端与控制端皆在viewController，最后viewController会通知到view重新渲染</div>
<div><span style="line-height: 1.5;">&nbsp;</span></div>
<div>Controller依旧是交互的核心，他是连接Adapter以及view的桥梁</div>
<div>view与Adapter本身并没有关联，Controller将之联系到了一起：</div>
<div>① 在实例化时候便会关联一个Adapter以及view的实例，这里Adapter不是必须的</div>
<div>② viewController会保留一个view的根节点，view的根节点只会存在一个</div>
<div>③ viewController会在Adapter实例上监听自身，在adpter datamodel发生变化时候通知到自己，便会触发update事件</div>
<div>④ 传入初始状态的status以及Adapter的datamodel，调用view的render方法，会生成当前状态的view的html</div>
<div>⑤ 将之装入view的根节点，并且为viewController的this.$el赋值，create的逻辑结束</div>
<div>⑥ 触发viewController show事件，将events绑定到根节点，将$el append到container容器中并显示，初步逻辑结束</div>
<div>⑦ viewController有几个事件点用于用户注册，本身也具有很多一系列dom事件，可能导致datamodel的变化</div>
<div>⑧ 若是Adapter的datamodel发生变化便会触发dataAdpter改变的notify事件，这个时候viewController便会有所反应</div>
<div>⑨ datamodel的改变会触发viewController的update事件，默认会再次触发render事件重新新渲染结构</div>
<div>由于render会放给view自定义，所以其中需要执行的逻辑便不需要我们的关注了</div>
<h1>实例</h1>
<div>这个便是一个标准的MVC模型，借IOS MVC的模型来说</div>
<div>&nbsp;</div>
<div><img src="46114648631827.png" alt=""></div>
<div><img src="218787610064142.png" alt=""></div>
<div>
<div>核心操控点在于Controller，Controller会组织model以及view</div>
<div>由于Controller上注册的各系列事件，会引起model的变化，</div>
<div>每次model产生变化后会重新通知，Controller 通知view update操作</div>
<div>这个时候view会获取viewController的状态值以及model的数据渲染出新的view</div>
<div>&nbsp;</div>
<div>view只负责html渲染</div>
<div>model只负责操作数据，并且通知观察者改变事件</div>
<div>Controller将view以及model联系起来，所有的事件全部注册至Controller</div>
<div>PS：传统的View会包含事件交互，这里放到了Controller上</div>
<div>&nbsp;</div>
<div>模型会把datamodel的改变通知到控制器，控制器会更新视图信息，控制器根据view组成dom结构，并且注册各种UI事件，又会触发datamodel的各种改变</div>
<div>这就达到了理想情况的view与model的分离，一个model（adpter可用于多个viewController），一个dataAdpter的改变会影响两个视图的改变</div>
<div>&nbsp;</div>
<div>这个MVC可以完全解耦view以及model，view的变化相当频繁，若是model控制view渲染便会降低model的重用</div>
<div>&nbsp;</div>
<div>这里首先举一个例子做简单说明：</div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code" onclick="cnblogs_code_show('bb066cf1-8410-43a5-829d-55f28fc6bbf0')"><img id="code_img_closed_bb066cf1-8410-43a5-829d-55f28fc6bbf0" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_bb066cf1-8410-43a5-829d-55f28fc6bbf0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bb066cf1-8410-43a5-829d-55f28fc6bbf0',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_bb066cf1-8410-43a5-829d-55f28fc6bbf0" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">doctype html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>ToDoList<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/css/flat-ui.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  9</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="../style/main.css"</span><span style="color: #ff0000;"> rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;"> 10</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 11</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui-alert </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> auto</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> position</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> static</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 12</span> <span style="background-color: #f5f5f5; color: #800000;">    .txt </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> #cfcfcf 1px solid</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 80%</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 13</span> <span style="background-color: #f5f5f5; color: #800000;">    ul, li </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 14</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui_calendar, .cui_week </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> list-style</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> none</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 15</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui_calendar li, .cui_week li </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> float</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> left</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 14%</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> overflow</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> hidden</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 4px 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> text-align</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> center</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 16</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 17</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 18</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 19</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 20</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 21</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-ajax-init"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 22</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-alert</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 23</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-pop-box</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 24</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-hd</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 25</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">title</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 26</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 27</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-bd</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 28</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-error-tips</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 29</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 30</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-roller-btns</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> style</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">padding: 4px; </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">input type</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">text</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> placeholder</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">设置最低价 {day: '', price: ''}</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> style</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">margin: 2px; width: 100%; </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> id</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">ajax_data</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">txt</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> value</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">{day: , price: }</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 31</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-roller-btns</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 32</span>               <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-flexbd cui-btns-sure</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">confirm</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 33</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 34</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 35</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 36</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 37</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 38</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-ajax-suc"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 39</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 40</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">最低价：本月</span><span style="background-color: #f5f5f5; color: #000000;">&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">ajaxData.day </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span><span style="background-color: #f5f5f5; color: #000000;">号，价格：</span><span style="background-color: #f5f5f5; color: #000000;">&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">ajaxData.price </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span><span style="background-color: #f5f5f5; color: #000000;"> 元</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;"> 41</span>   <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;"> 42</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-ajax-loading"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 45</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">span</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">loading....</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">span&gt;</span>
<span style="color: #008080;"> 46</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 47</span> 
<span style="color: #008080;"> 48</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../vendor/underscore-min.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 49</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../vendor/zepto.min.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 50</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/underscore-extend.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 51</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/util.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 52</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/mvc.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 53</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 54</span> 
<span style="color: #008080;"> 55</span> <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">模拟Ajax请求</span>
<span style="color: #008080;"> 56</span> <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> getAjaxData(callback, data) {
</span><span style="color: #008080;"> 57</span> <span style="background-color: #f5f5f5; color: #000000;">  setTimeout(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;"> 58</span>     <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">data) {
</span><span style="color: #008080;"> 59</span> <span style="background-color: #f5f5f5; color: #000000;">      data </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {day: </span><span style="background-color: #f5f5f5; color: #000000;">3</span><span style="background-color: #f5f5f5; color: #000000;">, price: </span><span style="background-color: #f5f5f5; color: #000000;">20</span><span style="background-color: #f5f5f5; color: #000000;">};
</span><span style="color: #008080;"> 60</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;"> 61</span> <span style="background-color: #f5f5f5; color: #000000;">    callback(data);
</span><span style="color: #008080;"> 62</span> <span style="background-color: #f5f5f5; color: #000000;">  }, </span><span style="background-color: #f5f5f5; color: #000000;">1000</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;"> 63</span> <span style="background-color: #f5f5f5; color: #000000;">}
</span><span style="color: #008080;"> 64</span> 
<span style="color: #008080;"> 65</span> <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxView </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;"> 66</span> <span style="background-color: #f5f5f5; color: #000000;">  _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 67</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设置默认属性</span>
<span style="color: #008080;"> 68</span> <span style="background-color: #f5f5f5; color: #000000;">    $super();
</span><span style="color: #008080;"> 69</span> 
<span style="color: #008080;"> 70</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.templateSet </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 71</span> <span style="background-color: #f5f5f5; color: #000000;">      init: $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-ajax-init</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html(),
</span><span style="color: #008080;"> 72</span> <span style="background-color: #f5f5f5; color: #000000;">      loading: $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-ajax-loading</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html(),
</span><span style="color: #008080;"> 73</span> <span style="background-color: #f5f5f5; color: #000000;">      ajaxSuc: $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-ajax-suc</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html()
</span><span style="color: #008080;"> 74</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;"> 75</span> 
<span style="color: #008080;"> 76</span> <span style="background-color: #f5f5f5; color: #000000;">  }
</span><span style="color: #008080;"> 77</span> <span style="background-color: #f5f5f5; color: #000000;">});
</span><span style="color: #008080;"> 78</span> 
<span style="color: #008080;"> 79</span> <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxAdapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;"> 80</span> <span style="background-color: #f5f5f5; color: #000000;">  _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 81</span> <span style="background-color: #f5f5f5; color: #000000;">    $super();
</span><span style="color: #008080;"> 82</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 83</span> <span style="background-color: #f5f5f5; color: #000000;">      title: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">标题</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 84</span> <span style="background-color: #f5f5f5; color: #000000;">      confirm: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">刷新数据</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
<span style="color: #008080;"> 85</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;"> 86</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel.ajaxData </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {};
</span><span style="color: #008080;"> 87</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span> <span style="background-color: #f5f5f5; color: #000000;">  format: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (datamodel) {
</span><span style="color: #008080;"> 90</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">处理datamodel生成viewModel的逻辑</span>
<span style="color: #008080;"> 91</span>     <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> datamodel;
</span><span style="color: #008080;"> 92</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;"> 93</span> 
<span style="color: #008080;"> 94</span> <span style="background-color: #f5f5f5; color: #000000;">  ajaxLoading: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;"> 95</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.notifyDataChanged();
</span><span style="color: #008080;"> 96</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;"> 97</span> 
<span style="color: #008080;"> 98</span> <span style="background-color: #f5f5f5; color: #000000;">  ajaxSuc: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
</span><span style="color: #008080;"> 99</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel.ajaxData </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> data;
</span><span style="color: #008080;">100</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.notifyDataChanged();
</span><span style="color: #008080;">101</span> <span style="background-color: #f5f5f5; color: #000000;">  }
</span><span style="color: #008080;">102</span> <span style="background-color: #f5f5f5; color: #000000;">});
</span><span style="color: #008080;">103</span> 
<span style="color: #008080;">104</span> <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxViewController </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;">105</span> <span style="background-color: #f5f5f5; color: #000000;">  _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;">106</span> <span style="background-color: #f5f5f5; color: #000000;">    $super();
</span><span style="color: #008080;">107</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设置基本的属性</span>
<span style="color: #008080;">108</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxView();
</span><span style="color: #008080;">109</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxAdapter();
</span><span style="color: #008080;">110</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">init</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">111</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.container </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#container</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">112</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;">113</span> 
<span style="color: #008080;">114</span>   <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">处理datamodel变化引起的dom改变</span>
<span style="color: #008080;">115</span> <span style="background-color: #f5f5f5; color: #000000;">  render: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
</span><span style="color: #008080;">116</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">这里用户明确知道自己有没有viewdata</span>
<span style="color: #008080;">117</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> viewdata </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.getViewModel();
</span><span style="color: #008080;">118</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> wrapperSet </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">119</span> <span style="background-color: #f5f5f5; color: #000000;">      loading: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">.cui-error-tips</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">120</span> <span style="background-color: #f5f5f5; color: #000000;">      ajaxSuc: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">.cui-error-tips</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
<span style="color: #008080;">121</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">122</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">view具有唯一包裹器</span>
<span style="color: #008080;">123</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> root </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.root;
</span><span style="color: #008080;">124</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> selector </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> wrapperSet[</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus];
</span><span style="color: #008080;">125</span> 
<span style="color: #008080;">126</span>     <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (selector) {
</span><span style="color: #008080;">127</span> <span style="background-color: #f5f5f5; color: #000000;">      root </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> root.find(selector);
</span><span style="color: #008080;">128</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;">129</span> 
<span style="color: #008080;">130</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.render(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.getViewModel());
</span><span style="color: #008080;">131</span> 
<span style="color: #008080;">132</span> <span style="background-color: #f5f5f5; color: #000000;">    root.html(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.html);
</span><span style="color: #008080;">133</span> 
<span style="color: #008080;">134</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;">135</span> 
<span style="color: #008080;">136</span>   <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">显示后Ajax请求数据</span>
<span style="color: #008080;">137</span> <span style="background-color: #f5f5f5; color: #000000;">  onViewAfterShow: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">138</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">._handleAjax();
</span><span style="color: #008080;">139</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;">140</span> 
<span style="color: #008080;">141</span> <span style="background-color: #f5f5f5; color: #000000;">  _handleAjax: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
</span><span style="color: #008080;">142</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.setViewStatus(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">loading</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">143</span>     <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.ajaxLoading();
</span><span style="color: #008080;">144</span> <span style="background-color: #f5f5f5; color: #000000;">    getAjaxData($.proxy(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
</span><span style="color: #008080;">145</span>       <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.setViewStatus(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">ajaxSuc</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">146</span>       <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.ajaxSuc(data);
</span><span style="color: #008080;">147</span> <span style="background-color: #f5f5f5; color: #000000;">    }, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">), data);
</span><span style="color: #008080;">148</span> <span style="background-color: #f5f5f5; color: #000000;">  },
</span><span style="color: #008080;">149</span> 
<span style="color: #008080;">150</span> <span style="background-color: #f5f5f5; color: #000000;">  events: {
</span><span style="color: #008080;">151</span>     <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click .cui-btns-sure</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">152</span>       <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> data </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$el.find(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#ajax_data</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).val();
</span><span style="color: #008080;">153</span> <span style="background-color: #f5f5f5; color: #000000;">      data </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> eval(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">(</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> data </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">)</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">154</span>       <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">._handleAjax(data);
</span><span style="color: #008080;">155</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;">156</span> <span style="background-color: #f5f5f5; color: #000000;">  }
</span><span style="color: #008080;">157</span> <span style="background-color: #f5f5f5; color: #000000;">});
</span><span style="color: #008080;">158</span> 
<span style="color: #008080;">159</span> <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> a </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> AjaxViewController();
</span><span style="color: #008080;">160</span> <span style="background-color: #f5f5f5; color: #000000;">a.show();
</span><span style="color: #008080;">161</span> 
<span style="color: #008080;">162</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">163</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">164</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">完成HTML</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('a3ae9842-ed3f-4e83-9d33-ae5e01a38a9e')"><img id="code_img_closed_a3ae9842-ed3f-4e83-9d33-ae5e01a38a9e" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_a3ae9842-ed3f-4e83-9d33-ae5e01a38a9e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a3ae9842-ed3f-4e83-9d33-ae5e01a38a9e',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_a3ae9842-ed3f-4e83-9d33-ae5e01a38a9e" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> (<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">  2</span>   <span style="color: #0000ff;">var</span> _ =<span style="color: #000000;"> window._;
</span><span style="color: #008080;">  3</span>   <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> require === 'function' &amp;&amp; !<span style="color: #000000;">_) {
</span><span style="color: #008080;">  4</span>     _ = require('underscore'<span style="color: #000000;">);
</span><span style="color: #008080;">  5</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 全局可能用到的变量</span>
<span style="color: #008080;">  8</span>   <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [];
</span><span style="color: #008080;">  9</span>   <span style="color: #0000ff;">var</span> slice =<span style="color: #000000;"> arr.slice;
</span><span style="color: #008080;"> 10</span> 
<span style="color: #008080;"> 11</span>   <span style="color: #0000ff;">var</span> method = method ||<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 12</span> 
<span style="color: #008080;"> 13</span> 
<span style="color: #008080;"> 14</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 15</span> <span style="color: #008000;">  * @description inherit方法，js的继承，默认为两个参数
</span><span style="color: #008080;"> 16</span> <span style="color: #008000;">  * @param {function} supClass 可选，要继承的类
</span><span style="color: #008080;"> 17</span> <span style="color: #008000;">  * @param {object} subProperty 被创建类的成员
</span><span style="color: #008080;"> 18</span> <span style="color: #008000;">  * @return {function} 被创建的类
</span><span style="color: #008080;"> 19</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 20</span>   method.inherit = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 21</span> 
<span style="color: #008080;"> 22</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 参数检测，该继承方法，只支持一个参数创建类，或者两个参数继承类</span>
<span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">if</span> (arguments.length === 0 || arguments.length &gt; 2) <span style="color: #0000ff;">throw</span> '参数错误'<span style="color: #000000;">;
</span><span style="color: #008080;"> 24</span> 
<span style="color: #008080;"> 25</span>     <span style="color: #0000ff;">var</span> parent = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 将参数转换为数组</span>
<span style="color: #008080;"> 28</span>     <span style="color: #0000ff;">var</span> properties =<span style="color: #000000;"> slice.call(arguments);
</span><span style="color: #008080;"> 29</span> 
<span style="color: #008080;"> 30</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 如果第一个参数为类（function），那么就将之取出</span>
<span style="color: #008080;"> 31</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> properties[0] === 'function'<span style="color: #000000;">)
</span><span style="color: #008080;"> 32</span>       parent =<span style="color: #000000;"> properties.shift();
</span><span style="color: #008080;"> 33</span>     properties = properties[0<span style="color: #000000;">];
</span><span style="color: #008080;"> 34</span> 
<span style="color: #008080;"> 35</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 创建新类用于返回</span>
<span style="color: #008080;"> 36</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> klass() {
</span><span style="color: #008080;"> 37</span>       <span style="color: #0000ff;">if</span> (_.isFunction(<span style="color: #0000ff;">this</span><span style="color: #000000;">.initialize))
</span><span style="color: #008080;"> 38</span>         <span style="color: #0000ff;">this</span>.initialize.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments);
</span><span style="color: #008080;"> 39</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 40</span> 
<span style="color: #008080;"> 41</span>     klass.superclass =<span style="color: #000000;"> parent;
</span><span style="color: #008080;"> 42</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses = [];</span>
<span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (parent) {
</span><span style="color: #008080;"> 45</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> @description 中间过渡类，防止parent的构造函数被执行</span>
<span style="color: #008080;"> 46</span>       <span style="color: #0000ff;">var</span> subclass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 47</span>       subclass.prototype =<span style="color: #000000;"> parent.prototype;
</span><span style="color: #008080;"> 48</span>       klass.prototype = <span style="color: #0000ff;">new</span><span style="color: #000000;"> subclass();
</span><span style="color: #008080;"> 49</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses.push(klass);</span>
<span style="color: #008080;"> 50</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 51</span> 
<span style="color: #008080;"> 52</span>     <span style="color: #0000ff;">var</span> ancestor = klass.superclass &amp;&amp;<span style="color: #000000;"> klass.superclass.prototype;
</span><span style="color: #008080;"> 53</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> properties) {
</span><span style="color: #008080;"> 54</span>       <span style="color: #0000ff;">var</span> value =<span style="color: #000000;"> properties[k];
</span><span style="color: #008080;"> 55</span> 
<span style="color: #008080;"> 56</span>       <span style="color: #008000;">//</span><span style="color: #008000;">满足条件就重写</span>
<span style="color: #008080;"> 57</span>       <span style="color: #0000ff;">if</span> (ancestor &amp;&amp; <span style="color: #0000ff;">typeof</span> value == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 58</span>         <span style="color: #0000ff;">var</span> argslist = /^\s*function\s*\(([^\(\)]*?)\)\s*?\{/i.exec(value.toString())[1].replace(/\s/i, '').split(','<span style="color: #000000;">);
</span><span style="color: #008080;"> 59</span>         <span style="color: #008000;">//</span><span style="color: #008000;">只有在第一个参数为$super情况下才需要处理（是否具有重复方法需要用户自己决定）</span>
<span style="color: #008080;"> 60</span>         <span style="color: #0000ff;">if</span> (argslist[0] === '$super' &amp;&amp;<span style="color: #000000;"> ancestor[k]) {
</span><span style="color: #008080;"> 61</span>           value = (<span style="color: #0000ff;">function</span><span style="color: #000000;"> (methodName, fn) {
</span><span style="color: #008080;"> 62</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 63</span>               <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 64</span>               <span style="color: #0000ff;">var</span> args = [<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 65</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> ancestor[methodName].apply(scope, arguments);
</span><span style="color: #008080;"> 66</span> <span style="color: #000000;">              } ];
</span><span style="color: #008080;"> 67</span>               <span style="color: #0000ff;">return</span> fn.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, args.concat(slice.call(arguments)));
</span><span style="color: #008080;"> 68</span> <span style="color: #000000;">            };
</span><span style="color: #008080;"> 69</span> <span style="color: #000000;">          })(k, value);
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 72</span> 
<span style="color: #008080;"> 73</span>       <span style="color: #008000;">//</span><span style="color: #008000;">此处对对象进行扩展，当前原型链已经存在该对象，便进行扩展</span>
<span style="color: #008080;"> 74</span>       <span style="color: #0000ff;">if</span> (_.isObject(klass.prototype[k]) &amp;&amp; _.isObject(value) &amp;&amp; (<span style="color: #0000ff;">typeof</span> klass.prototype[k] != 'function' &amp;&amp; <span style="color: #0000ff;">typeof</span> value != 'fuction'<span style="color: #000000;">)) {
</span><span style="color: #008080;"> 75</span>         <span style="color: #008000;">//</span><span style="color: #008000;">原型链是共享的，这里不好办</span>
<span style="color: #008080;"> 76</span>         <span style="color: #0000ff;">var</span> temp =<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">        _.extend(temp, klass.prototype[k]);
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">        _.extend(temp, value);
</span><span style="color: #008080;"> 79</span>         klass.prototype[k] =<span style="color: #000000;"> temp;
</span><span style="color: #008080;"> 80</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 81</span>         klass.prototype[k] =<span style="color: #000000;"> value;
</span><span style="color: #008080;"> 82</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 83</span> 
<span style="color: #008080;"> 84</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 85</span> 
<span style="color: #008080;"> 86</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">klass.prototype.initialize)
</span><span style="color: #008080;"> 87</span>       klass.prototype.initialize = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span>     klass.prototype.constructor =<span style="color: #000000;"> klass;
</span><span style="color: #008080;"> 90</span> 
<span style="color: #008080;"> 91</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> klass;
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 93</span> 
<span style="color: #008080;"> 94</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 返回需要的函数</span>
<span style="color: #008080;"> 95</span>   method.getNeedFn = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, scope) {
</span><span style="color: #008080;"> 96</span>     scope = scope ||<span style="color: #000000;"> window;
</span><span style="color: #008080;"> 97</span>     <span style="color: #0000ff;">if</span> (_.isFunction(key)) <span style="color: #0000ff;">return</span><span style="color: #000000;"> key;
</span><span style="color: #008080;"> 98</span>     <span style="color: #0000ff;">if</span> (_.isFunction(scope[key])) <span style="color: #0000ff;">return</span><span style="color: #000000;"> scope[key];
</span><span style="color: #008080;"> 99</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;">100</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span>   method.callmethod = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (method, scope, params) {
</span><span style="color: #008080;">103</span>     scope = scope || <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">104</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isFunction(method)) {
</span><span style="color: #008080;">105</span>       <span style="color: #0000ff;">return</span> _.isArray(params) ?<span style="color: #000000;"> method.apply(scope, params) : method.call(scope, params);
</span><span style="color: #008080;">106</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">107</span> 
<span style="color: #008080;">108</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">109</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">110</span> 
<span style="color: #008080;">111</span>   <span style="color: #008000;">//</span><span style="color: #008000;">获取url参数</span>
<span style="color: #008080;">112</span>   method.getUrlParam = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (url, name) {
</span><span style="color: #008080;">113</span>     <span style="color: #0000ff;">var</span> i, arrQuery, _tmp, query =<span style="color: #000000;"> {};
</span><span style="color: #008080;">114</span>     <span style="color: #0000ff;">var</span> index = url.lastIndexOf('//'<span style="color: #000000;">);
</span><span style="color: #008080;">115</span>     <span style="color: #0000ff;">var</span> http =<span style="color: #000000;"> url.substr(index, url.length);
</span><span style="color: #008080;">116</span> 
<span style="color: #008080;">117</span>     url = url.substr(0<span style="color: #000000;">, index);
</span><span style="color: #008080;">118</span>     arrQuery = url.split('&amp;'<span style="color: #000000;">);
</span><span style="color: #008080;">119</span> 
<span style="color: #008080;">120</span>     <span style="color: #0000ff;">for</span> (i = 0, len = arrQuery.length; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">121</span>       _tmp = arrQuery[i].split('='<span style="color: #000000;">);
</span><span style="color: #008080;">122</span>       <span style="color: #0000ff;">if</span> (i == len - 1) _tmp[1] +=<span style="color: #000000;"> http;
</span><span style="color: #008080;">123</span>       query[_tmp[0]] = _tmp[1<span style="color: #000000;">];
</span><span style="color: #008080;">124</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">125</span> 
<span style="color: #008080;">126</span>     <span style="color: #0000ff;">return</span> name ?<span style="color: #000000;"> query[name] : query;
</span><span style="color: #008080;">127</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">128</span> 
<span style="color: #008080;">129</span> 
<span style="color: #008080;">130</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">131</span> <span style="color: #008000;">  * @description 在fn方法的前后通过键值设置两个传入的回调
</span><span style="color: #008080;">132</span> <span style="color: #008000;">  * @param fn {function} 调用的方法
</span><span style="color: #008080;">133</span> <span style="color: #008000;">  * @param beforeFnKey {string} 从context对象中获得的函数指针的键值，该函数在fn前执行
</span><span style="color: #008080;">134</span> <span style="color: #008000;">  * @param afterFnKey {string} 从context对象中获得的函数指针的键值，该函数在fn后执行
</span><span style="color: #008080;">135</span> <span style="color: #008000;">  * @param context {object} 执行环节的上下文
</span><span style="color: #008080;">136</span> <span style="color: #008000;">  * @return {function}
</span><span style="color: #008080;">137</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">138</span>   method.wrapmethod = method.insert = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (fn, beforeFnKey, afterFnKey, context) {
</span><span style="color: #008080;">139</span> 
<span style="color: #008080;">140</span>     <span style="color: #0000ff;">var</span> scope = context || <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">141</span>     <span style="color: #0000ff;">var</span> action = _.wrap(fn, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (func) {
</span><span style="color: #008080;">142</span> 
<span style="color: #008080;">143</span> <span style="color: #000000;">      _.callmethod(_.getNeedFn(beforeFnKey, scope), scope);
</span><span style="color: #008080;">144</span> 
<span style="color: #008080;">145</span> <span style="color: #000000;">      func.call(scope);
</span><span style="color: #008080;">146</span> 
<span style="color: #008080;">147</span> <span style="color: #000000;">      _.callmethod(_.getNeedFn(afterFnKey, scope), scope);
</span><span style="color: #008080;">148</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">149</span> 
<span style="color: #008080;">150</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> _.callmethod(action, scope);
</span><span style="color: #008080;">151</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">152</span> 
<span style="color: #008080;">153</span>   method.Hash =<span style="color: #000000;"> method.inherit({
</span><span style="color: #008080;">154</span>     inisilize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (opts) {
</span><span style="color: #008080;">155</span>       <span style="color: #0000ff;">this</span>.keys =<span style="color: #000000;"> [];
</span><span style="color: #008080;">156</span>       <span style="color: #0000ff;">this</span>.values =<span style="color: #000000;"> [];
</span><span style="color: #008080;">157</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">158</span> 
<span style="color: #008080;">159</span>     length: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">160</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.length;
</span><span style="color: #008080;">161</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">162</span> 
<span style="color: #008080;">163</span>     <span style="color: #008000;">//</span><span style="color: #008000;">传入order，若是数组中存在的话会将之放到最后，保证数组的唯一性，因为这个是hash，不能存在重复的键</span>
<span style="color: #008080;">164</span>     push: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, value, order) {
</span><span style="color: #008080;">165</span>       <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isObject(key)) {
</span><span style="color: #008080;">166</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> key) {
</span><span style="color: #008080;">167</span>           <span style="color: #0000ff;">if</span> (key.hasOwnProperty(i)) <span style="color: #0000ff;">this</span><span style="color: #000000;">.push(i, key[i], order);
</span><span style="color: #008080;">168</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">169</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">170</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">171</span> 
<span style="color: #008080;">172</span>       <span style="color: #0000ff;">var</span> index = _.indexOf(key, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys);
</span><span style="color: #008080;">173</span> 
<span style="color: #008080;">174</span>       <span style="color: #0000ff;">if</span> (index != -1 &amp;&amp; !<span style="color: #000000;">order) {
</span><span style="color: #008080;">175</span>         <span style="color: #0000ff;">this</span>.values[index] =<span style="color: #000000;"> value;
</span><span style="color: #008080;">176</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">177</span>         <span style="color: #0000ff;">if</span> (order) <span style="color: #0000ff;">this</span><span style="color: #000000;">.remove(key);
</span><span style="color: #008080;">178</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.push(key);
</span><span style="color: #008080;">179</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules.push(value);
</span><span style="color: #008080;">180</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">181</span> 
<span style="color: #008080;">182</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">183</span> 
<span style="color: #008080;">184</span>     remove: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key) {
</span><span style="color: #008080;">185</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.removeByIndex(_.indexOf(key, <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys));
</span><span style="color: #008080;">186</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">187</span> 
<span style="color: #008080;">188</span>     removeByIndex: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (index) {
</span><span style="color: #008080;">189</span>       <span style="color: #0000ff;">if</span> (index == -1) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">190</span> 
<span style="color: #008080;">191</span>       <span style="color: #0000ff;">this</span>.keys.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">192</span>       <span style="color: #0000ff;">this</span>.values.splice(index, 1<span style="color: #000000;">);
</span><span style="color: #008080;">193</span> 
<span style="color: #008080;">194</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">195</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">196</span> 
<span style="color: #008080;">197</span>     pop: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">198</span>       <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.length()) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">199</span> 
<span style="color: #008080;">200</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.pop();
</span><span style="color: #008080;">201</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.pop();
</span><span style="color: #008080;">202</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">203</span> 
<span style="color: #008080;">204</span>     <span style="color: #008000;">//</span><span style="color: #008000;">根据索引返回对应键值</span>
<span style="color: #008080;">205</span>     indexOf: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (value) {
</span><span style="color: #008080;">206</span>       <span style="color: #0000ff;">var</span> index = _.indexOf(value, <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules);
</span><span style="color: #008080;">207</span>       <span style="color: #0000ff;">if</span> (index != -1) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys[index];
</span><span style="color: #008080;">208</span>       <span style="color: #0000ff;">return</span> -1<span style="color: #000000;">;
</span><span style="color: #008080;">209</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">210</span> 
<span style="color: #008080;">211</span>     <span style="color: #008000;">//</span><span style="color: #008000;">移出栈底值</span>
<span style="color: #008080;">212</span>     shift: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">213</span>       <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.length()) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">214</span> 
<span style="color: #008080;">215</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.shift();
</span><span style="color: #008080;">216</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.values.shift();
</span><span style="color: #008080;">217</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">218</span> 
<span style="color: #008080;">219</span>     <span style="color: #008000;">//</span><span style="color: #008000;">往栈顶压入值</span>
<span style="color: #008080;">220</span>     unShift: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, vaule, order) {
</span><span style="color: #008080;">221</span>       <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isObject(key)) {
</span><span style="color: #008080;">222</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i <span style="color: #0000ff;">in</span><span style="color: #000000;"> key) {
</span><span style="color: #008080;">223</span>           <span style="color: #0000ff;">if</span> (key.hasOwnProperty(i)) <span style="color: #0000ff;">this</span><span style="color: #000000;">.unShift(i, key[i], order);
</span><span style="color: #008080;">224</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">225</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">226</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">227</span>       <span style="color: #0000ff;">if</span> (order) <span style="color: #0000ff;">this</span><span style="color: #000000;">.remove(key);
</span><span style="color: #008080;">228</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.keys.unshift(key);
</span><span style="color: #008080;">229</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.vaules.unshift(value);
</span><span style="color: #008080;">230</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">231</span> 
<span style="color: #008080;">232</span>     <span style="color: #008000;">//</span><span style="color: #008000;">返回hash表的一段数据</span>
<span style="color: #008080;">233</span>     <span style="color: #008000;">//
</span><span style="color: #008080;">234</span>     slice: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (start, end) {
</span><span style="color: #008080;">235</span>       <span style="color: #0000ff;">var</span> keys = <span style="color: #0000ff;">this</span>.keys.slice(start, end || <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">236</span>       <span style="color: #0000ff;">var</span> values = <span style="color: #0000ff;">this</span>.values.slice(start, end || <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">237</span>       <span style="color: #0000ff;">var</span> hash = <span style="color: #0000ff;">new</span><span style="color: #000000;"> _.Hash();
</span><span style="color: #008080;">238</span> 
<span style="color: #008080;">239</span>       <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; keys.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">240</span> <span style="color: #000000;">        hash.push(keys[i], values[i]);
</span><span style="color: #008080;">241</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">242</span> 
<span style="color: #008080;">243</span>       <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">244</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">245</span> 
<span style="color: #008080;">246</span>     <span style="color: #008000;">//</span><span style="color: #008000;">由start开始，移除元素</span>
<span style="color: #008080;">247</span>     splice: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (start, count) {
</span><span style="color: #008080;">248</span>       <span style="color: #0000ff;">var</span> keys = <span style="color: #0000ff;">this</span>.keys.splice(start, end || <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">249</span>       <span style="color: #0000ff;">var</span> values = <span style="color: #0000ff;">this</span>.values.splice(start, end || <span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">250</span>       <span style="color: #0000ff;">var</span> hash = <span style="color: #0000ff;">new</span><span style="color: #000000;"> _.Hash();
</span><span style="color: #008080;">251</span> 
<span style="color: #008080;">252</span>       <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; keys.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;">253</span> <span style="color: #000000;">        hash.push(keys[i], values[i]);
</span><span style="color: #008080;">254</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">255</span> 
<span style="color: #008080;">256</span>       <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">257</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">258</span> 
<span style="color: #008080;">259</span>     exist: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, value) {
</span><span style="color: #008080;">260</span>       <span style="color: #0000ff;">var</span> b = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">261</span> 
<span style="color: #008080;">262</span>       <span style="color: #0000ff;">if</span> (_.indexOf(key, <span style="color: #0000ff;">this</span>.keys) == -1) b = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">263</span> 
<span style="color: #008080;">264</span>       <span style="color: #0000ff;">if</span> (!_.isUndefined(value) &amp;&amp; _.indexOf(value, <span style="color: #0000ff;">this</span>.values) == -1) b = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">265</span> 
<span style="color: #008080;">266</span>       <span style="color: #0000ff;">return</span><span style="color: #000000;"> b;
</span><span style="color: #008080;">267</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">268</span> 
<span style="color: #008080;">269</span> 
<span style="color: #008080;">270</span>     filter: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">271</span> 
<span style="color: #008080;">272</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">273</span> 
<span style="color: #008080;">274</span> <span style="color: #000000;">  });
</span><span style="color: #008080;">275</span> 
<span style="color: #008080;">276</span> <span style="color: #000000;">  _.extend(_, method);
</span><span style="color: #008080;">277</span> 
<span style="color: #008080;">278</span> 
<span style="color: #008080;">279</span> <span style="color: #008000;">//</span><span style="color: #008000;">  if (module &amp;&amp; module.exports)</span>
<span style="color: #008080;">280</span> <span style="color: #008000;">//</span><span style="color: #008000;">    module.exports = _;</span>
<span style="color: #008080;">281</span> 
<span style="color: #008080;">282</span> }).call(<span style="color: #0000ff;">this</span>);</pre>
</div>
<span class="cnblogs_code_collapse">underscore-extend</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('e8d3a8b7-ac0d-4798-9fef-d16b49de31c5')"><img id="code_img_closed_e8d3a8b7-ac0d-4798-9fef-d16b49de31c5" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_e8d3a8b7-ac0d-4798-9fef-d16b49de31c5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e8d3a8b7-ac0d-4798-9fef-d16b49de31c5',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_e8d3a8b7-ac0d-4798-9fef-d16b49de31c5" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">  2</span> <span style="color: #008000;">* @description 静态日期操作类，封装系列日期操作方法
</span><span style="color: #008080;">  3</span> <span style="color: #008000;">* @description 输入时候月份自动减一，输出时候自动加一
</span><span style="color: #008080;">  4</span> <span style="color: #008000;">* @return {object} 返回操作方法
</span><span style="color: #008080;">  5</span> <span style="color: #008000;">*/</span>
<span style="color: #008080;">  6</span> <span style="color: #0000ff;">var</span> dateUtil =<span style="color: #000000;"> {
</span><span style="color: #008080;">  7</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">  8</span> <span style="color: #008000;">  * @description 数字操作，
</span><span style="color: #008080;">  9</span> <span style="color: #008000;">  * @return {string} 返回处理后的数字
</span><span style="color: #008080;"> 10</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 11</span>   formatNum: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (n) {
</span><span style="color: #008080;"> 12</span>     <span style="color: #0000ff;">if</span> (n &lt; 10) <span style="color: #0000ff;">return</span> '0' +<span style="color: #000000;"> n;
</span><span style="color: #008080;"> 13</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> n;
</span><span style="color: #008080;"> 14</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 15</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 16</span> <span style="color: #008000;">  * @description 将字符串转换为日期，支持格式y-m-d ymd (y m r)以及标准的
</span><span style="color: #008080;"> 17</span> <span style="color: #008000;">  * @return {Date} 返回日期对象
</span><span style="color: #008080;"> 18</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 19</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (dateStr, formatStr) {
</span><span style="color: #008080;"> 20</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> dateStr === 'undefined') <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 21</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> formatStr === 'string'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 22</span>       <span style="color: #0000ff;">var</span> _d = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date(formatStr);
</span><span style="color: #008080;"> 23</span>       <span style="color: #008000;">//</span><span style="color: #008000;">首先取得顺序相关字符串</span>
<span style="color: #008080;"> 24</span>       <span style="color: #0000ff;">var</span> arrStr = formatStr.replace(/[^ymd]/g, '').split(''<span style="color: #000000;">);
</span><span style="color: #008080;"> 25</span>       <span style="color: #0000ff;">if</span> (!arrStr &amp;&amp; arrStr.length != 3) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span>       <span style="color: #0000ff;">var</span> formatStr = formatStr.replace(/y|m|d/g, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;"> 28</span>         <span style="color: #0000ff;">switch</span><span style="color: #000000;"> (k) {
</span><span style="color: #008080;"> 29</span>           <span style="color: #0000ff;">case</span> 'y': <span style="color: #0000ff;">return</span> '(\\d{4})'<span style="color: #000000;">;
</span><span style="color: #008080;"> 30</span>           <span style="color: #0000ff;">case</span> 'm'<span style="color: #000000;">: ;
</span><span style="color: #008080;"> 31</span>           <span style="color: #0000ff;">case</span> 'd': <span style="color: #0000ff;">return</span> '(\\d{1,2})'<span style="color: #000000;">;
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 33</span> <span style="color: #000000;">      });
</span><span style="color: #008080;"> 34</span> 
<span style="color: #008080;"> 35</span>       <span style="color: #0000ff;">var</span> reg = <span style="color: #0000ff;">new</span> RegExp(formatStr, 'g'<span style="color: #000000;">);
</span><span style="color: #008080;"> 36</span>       <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> reg.exec(dateStr)
</span><span style="color: #008080;"> 37</span> 
<span style="color: #008080;"> 38</span>       <span style="color: #0000ff;">var</span> dateObj =<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 39</span>       <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, len = arrStr.length; i &lt; len; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 40</span>         dateObj[arrStr[i]] = arr[i + 1<span style="color: #000000;">];
</span><span style="color: #008080;"> 41</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 42</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> Date(dateObj['y'], dateObj['m'] - 1, dateObj['d'<span style="color: #000000;">]);
</span><span style="color: #008080;"> 43</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 44</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 45</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 46</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 47</span> <span style="color: #008000;">  * @description将日期格式化为字符串
</span><span style="color: #008080;"> 48</span> <span style="color: #008000;">  * @return {string} 常用格式化字符串
</span><span style="color: #008080;"> 49</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 50</span>   format: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (date, format) {
</span><span style="color: #008080;"> 51</span>     <span style="color: #0000ff;">if</span> (arguments.length &lt; 2 &amp;&amp; !<span style="color: #000000;">date.getTime) {
</span><span style="color: #008080;"> 52</span>       format =<span style="color: #000000;"> date;
</span><span style="color: #008080;"> 53</span>       date = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date();
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 55</span>     <span style="color: #0000ff;">typeof</span> format != 'string' &amp;&amp; (format = 'Y年M月D日 H时F分S秒'<span style="color: #000000;">);
</span><span style="color: #008080;"> 56</span>     <span style="color: #0000ff;">return</span> format.replace(/Y|y|M|m|D|d|H|h|F|f|S|s/g, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (a) {
</span><span style="color: #008080;"> 57</span>       <span style="color: #0000ff;">switch</span><span style="color: #000000;"> (a) {
</span><span style="color: #008080;"> 58</span>         <span style="color: #0000ff;">case</span> "y": <span style="color: #0000ff;">return</span> (date.getFullYear() + "").slice(2<span style="color: #000000;">);
</span><span style="color: #008080;"> 59</span>         <span style="color: #0000ff;">case</span> "Y": <span style="color: #0000ff;">return</span><span style="color: #000000;"> date.getFullYear();
</span><span style="color: #008080;"> 60</span>         <span style="color: #0000ff;">case</span> "m": <span style="color: #0000ff;">return</span> date.getMonth() + 1<span style="color: #000000;">;
</span><span style="color: #008080;"> 61</span>         <span style="color: #0000ff;">case</span> "M": <span style="color: #0000ff;">return</span> dateUtil.formatNum(date.getMonth() + 1<span style="color: #000000;">);
</span><span style="color: #008080;"> 62</span>         <span style="color: #0000ff;">case</span> "d": <span style="color: #0000ff;">return</span><span style="color: #000000;"> date.getDate();
</span><span style="color: #008080;"> 63</span>         <span style="color: #0000ff;">case</span> "D": <span style="color: #0000ff;">return</span><span style="color: #000000;"> dateUtil.formatNum(date.getDate());
</span><span style="color: #008080;"> 64</span>         <span style="color: #0000ff;">case</span> "h": <span style="color: #0000ff;">return</span><span style="color: #000000;"> date.getHours();
</span><span style="color: #008080;"> 65</span>         <span style="color: #0000ff;">case</span> "H": <span style="color: #0000ff;">return</span><span style="color: #000000;"> dateUtil.formatNum(date.getHours());
</span><span style="color: #008080;"> 66</span>         <span style="color: #0000ff;">case</span> "f": <span style="color: #0000ff;">return</span><span style="color: #000000;"> date.getMinutes();
</span><span style="color: #008080;"> 67</span>         <span style="color: #0000ff;">case</span> "F": <span style="color: #0000ff;">return</span><span style="color: #000000;"> dateUtil.formatNum(date.getMinutes());
</span><span style="color: #008080;"> 68</span>         <span style="color: #0000ff;">case</span> "s": <span style="color: #0000ff;">return</span><span style="color: #000000;"> date.getSeconds();
</span><span style="color: #008080;"> 69</span>         <span style="color: #0000ff;">case</span> "S": <span style="color: #0000ff;">return</span><span style="color: #000000;"> dateUtil.formatNum(date.getSeconds());
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">    });
</span><span style="color: #008080;"> 72</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 73</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 是否为为日期对象，该方法可能有坑，使用需要慎重</span>
<span style="color: #008080;"> 74</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 日期对象</span>
<span style="color: #008080;"> 75</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @return {boolean} 返回值</span>
<span style="color: #008080;"> 76</span>   isDate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (d) {
</span><span style="color: #008080;"> 77</span>     <span style="color: #0000ff;">if</span> ((<span style="color: #0000ff;">typeof</span> d == 'object') &amp;&amp; (d <span style="color: #0000ff;">instanceof</span> Date)) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 78</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 79</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 80</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 是否为闰年</span>
<span style="color: #008080;"> 81</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 可能是年份或者为一个date时间</span>
<span style="color: #008080;"> 82</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @return {boolean} 返回值</span>
<span style="color: #008080;"> 83</span>   isLeapYear: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (year) {
</span><span style="color: #008080;"> 84</span>     <span style="color: #008000;">//</span><span style="color: #008000;">传入为时间格式需要处理</span>
<span style="color: #008080;"> 85</span>     <span style="color: #0000ff;">if</span> (dateUtil.isDate(year)) year =<span style="color: #000000;"> year.getFullYear()
</span><span style="color: #008080;"> 86</span>     <span style="color: #0000ff;">if</span> ((year % 4 == 0 &amp;&amp; year % 100 != 0) || (year % 400 == 0)) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 87</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 88</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 89</span> 
<span style="color: #008080;"> 90</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 获取一个月份的天数</span>
<span style="color: #008080;"> 91</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 可能是年份或者为一个date时间</span>
<span style="color: #008080;"> 92</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 月份</span>
<span style="color: #008080;"> 93</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @return {num} 返回天数</span>
<span style="color: #008080;"> 94</span>   getDaysOfMonth: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (year, month) {
</span><span style="color: #008080;"> 95</span>     <span style="color: #008000;">//</span><span style="color: #008000;">自动减一以便操作</span>
<span style="color: #008080;"> 96</span>     month--<span style="color: #000000;">;
</span><span style="color: #008080;"> 97</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (dateUtil.isDate(year)) {
</span><span style="color: #008080;"> 98</span>       month = year.getMonth(); <span style="color: #008000;">//</span><span style="color: #008000;">注意此处月份要加1，所以我们要减一</span>
<span style="color: #008080;"> 99</span>       year =<span style="color: #000000;"> year.getFullYear();
</span><span style="color: #008080;">100</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">101</span>     <span style="color: #0000ff;">return</span> [31, dateUtil.isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31<span style="color: #000000;">][month];
</span><span style="color: #008080;">102</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">103</span> 
<span style="color: #008080;">104</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 获取一个月份1号是星期几，注意此时的月份传入时需要自主减一</span>
<span style="color: #008080;">105</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 可能是年份或者为一个date时间</span>
<span style="color: #008080;">106</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param year {num} 月份</span>
<span style="color: #008080;">107</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @return {num} 当月一号为星期几0-6</span>
<span style="color: #008080;">108</span>   getBeginDayOfMouth: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (year, month) {
</span><span style="color: #008080;">109</span>     <span style="color: #008000;">//</span><span style="color: #008000;">自动减一以便操作</span>
<span style="color: #008080;">110</span>     month--<span style="color: #000000;">;
</span><span style="color: #008080;">111</span>     <span style="color: #0000ff;">if</span> ((<span style="color: #0000ff;">typeof</span> year == 'object') &amp;&amp; (year <span style="color: #0000ff;">instanceof</span><span style="color: #000000;"> Date)) {
</span><span style="color: #008080;">112</span>       month =<span style="color: #000000;"> year.getMonth(); 
</span><span style="color: #008080;">113</span>       year =<span style="color: #000000;"> year.getFullYear();
</span><span style="color: #008080;">114</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">115</span>     <span style="color: #0000ff;">var</span> d = <span style="color: #0000ff;">new</span> Date(year, month, 1<span style="color: #000000;">);
</span><span style="color: #008080;">116</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> d.getDay();
</span><span style="color: #008080;">117</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">118</span> };</pre>
</div>
<span class="cnblogs_code_collapse">Util</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('1a354855-5db3-49ab-956e-7244fe34e9b5')"><img id="code_img_closed_1a354855-5db3-49ab-956e-7244fe34e9b5" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_1a354855-5db3-49ab-956e-7244fe34e9b5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1a354855-5db3-49ab-956e-7244fe34e9b5',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_1a354855-5db3-49ab-956e-7244fe34e9b5" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> "use strict"<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #008000;">//</span><span style="color: #008000;"> ------------------华丽的分割线--------------------- //</span>
<span style="color: #008080;">  4</span> 
<span style="color: #008080;">  5</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 正式的声明Dalmatian框架的命名空间</span>
<span style="color: #008080;">  6</span> <span style="color: #0000ff;">var</span> Dalmatian = Dalmatian ||<span style="color: #000000;"> {};
</span><span style="color: #008080;">  7</span> 
<span style="color: #008080;">  8</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 定义默认的template方法来自于underscore</span>
<span style="color: #008080;">  9</span> Dalmatian.template =<span style="color: #000000;"> _.template;
</span><span style="color: #008080;"> 10</span> Dalmatian.View =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;"> 11</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;"> 12</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;"> 13</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;"> 14</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initRoot();
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 18</span> 
<span style="color: #008080;"> 19</span>   _initRoot: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 20</span>     <span style="color: #008000;">//</span><span style="color: #008000;">根据html生成的dom包装对象</span>
<span style="color: #008080;"> 21</span>     <span style="color: #008000;">//</span><span style="color: #008000;">有一种场景是用户的view本身就是一个只有一个包裹器的结构，他不想要多余的包裹器</span>
<span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">this</span>.root = $(<span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultContainerTemplate);
</span><span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">this</span>.root.attr('id', <span style="color: #0000ff;">this</span><span style="color: #000000;">.viewid);
</span><span style="color: #008080;"> 24</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 25</span> 
<span style="color: #008080;"> 26</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;"> 27</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 28</span> 
<span style="color: #008080;"> 29</span>     <span style="color: #0000ff;">var</span> DEFAULT_CONTAINER_TEMPLATE = '&lt;section class="view" id="&lt;%=viewid%&gt;"&gt;&lt;%=html%&gt;&lt;/section&gt;'<span style="color: #000000;">;
</span><span style="color: #008080;"> 30</span> 
<span style="color: #008080;"> 31</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description view状态机</span>
<span style="color: #008080;"> 32</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.statusSet = {};</span>
<span style="color: #008080;"> 33</span> 
<span style="color: #008080;"> 34</span>     <span style="color: #0000ff;">this</span>.defaultContainerTemplate =<span style="color: #000000;"> DEFAULT_CONTAINER_TEMPLATE;
</span><span style="color: #008080;"> 35</span> 
<span style="color: #008080;"> 36</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;"> 37</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description template集合，根据status做template的map</span>
<span style="color: #008080;"> 38</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @example</span>
<span style="color: #008080;"> 39</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    { 0: '&lt;ul&gt;&lt;%_.each(list, function(item){%&gt;&lt;li&gt;&lt;%=item.name%&gt;&lt;/li&gt;&lt;%});%&gt;&lt;/ul&gt;' }</span>
<span style="color: #008080;"> 40</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.templateSet = {};</span>
<span style="color: #008080;"> 41</span> 
<span style="color: #008080;"> 42</span>     <span style="color: #0000ff;">this</span>.viewid = _.uniqueId('dalmatian-view-'<span style="color: #000000;">);
</span><span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 45</span> 
<span style="color: #008080;"> 46</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;"> 47</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;"> 48</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;"> 49</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;"> 50</span> 
<span style="color: #008080;"> 51</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 52</span> 
<span style="color: #008080;"> 53</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通过模板和数据渲染具体的View</span>
<span style="color: #008080;"> 54</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} View的状态参数</span>
<span style="color: #008080;"> 55</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} 匹配View的数据格式的具体数据</span>
<span style="color: #008080;"> 56</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param callback {functiion} 执行完成之后的回调</span>
<span style="color: #008080;"> 57</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (status, data, callback) {
</span><span style="color: #008080;"> 58</span> 
<span style="color: #008080;"> 59</span>     <span style="color: #0000ff;">var</span> templateSelected = <span style="color: #0000ff;">this</span><span style="color: #000000;">.templateSet[status];
</span><span style="color: #008080;"> 60</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (templateSelected) {
</span><span style="color: #008080;"> 61</span> 
<span style="color: #008080;"> 62</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> @description 渲染view</span>
<span style="color: #008080;"> 63</span>       <span style="color: #0000ff;">var</span> templateFn =<span style="color: #000000;"> Dalmatian.template(templateSelected);
</span><span style="color: #008080;"> 64</span>       <span style="color: #0000ff;">this</span>.html =<span style="color: #000000;"> templateFn(data);
</span><span style="color: #008080;"> 65</span> 
<span style="color: #008080;"> 66</span>       <span style="color: #008000;">//</span><span style="color: #008000;">这里减少一次js编译</span>
<span style="color: #008080;"> 67</span> <span style="color: #008000;">//</span><span style="color: #008000;">      this.root.html('');</span>
<span style="color: #008080;"> 68</span> <span style="color: #008000;">//</span><span style="color: #008000;">      this.root.append(this.html);</span>
<span style="color: #008080;"> 69</span> 
<span style="color: #008080;"> 70</span>       <span style="color: #0000ff;">this</span>.currentStatus =<span style="color: #000000;"> status;
</span><span style="color: #008080;"> 71</span> 
<span style="color: #008080;"> 72</span>       _.callmethod(callback, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 73</span> 
<span style="color: #008080;"> 74</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.html;
</span><span style="color: #008080;"> 75</span> 
<span style="color: #008080;"> 76</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 78</span> 
<span style="color: #008080;"> 79</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;"> 80</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可以被复写，当status和data分别发生变化时候</span>
<span style="color: #008080;"> 81</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} view的状态值</span>
<span style="color: #008080;"> 82</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} viewmodel的数据</span>
<span style="color: #008080;"> 83</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (status, data) {
</span><span style="color: #008080;"> 84</span> 
<span style="color: #008080;"> 85</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.currentStatus || <span style="color: #0000ff;">this</span>.currentStatus !==<span style="color: #000000;"> status) {
</span><span style="color: #008080;"> 86</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.render(status, data);
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;"> 90</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可复写部分，当数据发生变化但是状态没有发生变化时，页面仅仅变化的可以是局部显示</span>
<span style="color: #008080;"> 91</span>     <span style="color: #008000;">//</span><span style="color: #008000;">              可以通过获取this.html进行修改</span>
<span style="color: #008080;"> 92</span>     _.callmethod(<span style="color: #0000ff;">this</span>.onUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">, data);
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">  }
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">});
</span><span style="color: #008080;"> 95</span> 
<span style="color: #008080;"> 96</span> Dalmatian.Adapter =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;"> 97</span> 
<span style="color: #008080;"> 98</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;"> 99</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">100</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">101</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">102</span> 
<span style="color: #008080;">103</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">104</span> 
<span style="color: #008080;">105</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;">106</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">107</span>     <span style="color: #0000ff;">this</span>.observers =<span style="color: #000000;"> [];
</span><span style="color: #008080;">108</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    this.viewmodel = {};</span>
<span style="color: #008080;">109</span>     <span style="color: #0000ff;">this</span>.datamodel =<span style="color: #000000;"> {};
</span><span style="color: #008080;">110</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">111</span> 
<span style="color: #008080;">112</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">113</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">114</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">115</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">116</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">117</span> 
<span style="color: #008080;">118</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">119</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置</span>
<span style="color: #008080;">120</span>   format: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (datamodel) {
</span><span style="color: #008080;">121</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> datamodel;
</span><span style="color: #008080;">122</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">123</span> 
<span style="color: #008080;">124</span>   getViewModel: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">125</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.format(<span style="color: #0000ff;">this</span><span style="color: #000000;">.datamodel);
</span><span style="color: #008080;">126</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">127</span> 
<span style="color: #008080;">128</span>   registerObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewcontroller) {
</span><span style="color: #008080;">129</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 检查队列中如果没有viewcontroller，从队列尾部推入</span>
<span style="color: #008080;">130</span>     <span style="color: #0000ff;">if</span> (!_.contains(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller)) {
</span><span style="color: #008080;">131</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.observers.push(viewcontroller);
</span><span style="color: #008080;">132</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">133</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">134</span> 
<span style="color: #008080;">135</span>   unregisterObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewcontroller) {
</span><span style="color: #008080;">136</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从observers的队列中剔除viewcontroller</span>
<span style="color: #008080;">137</span>     <span style="color: #0000ff;">this</span>.observers = _.without(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller);
</span><span style="color: #008080;">138</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">139</span> 
<span style="color: #008080;">140</span>   <span style="color: #008000;">//</span><span style="color: #008000;">统一设置所有观察者的状态，因为对应观察者也许根本不具备相关状态，所以这里需要处理</span>
<span style="color: #008080;">141</span> <span style="color: #008000;">//</span><span style="color: #008000;">  setStatus: function (status) {</span>
<span style="color: #008080;">142</span> <span style="color: #008000;">//</span><span style="color: #008000;">    _.each(this.observers, function (viewcontroller) {</span>
<span style="color: #008080;">143</span> <span style="color: #008000;">//</span><span style="color: #008000;">      if (_.isObject(viewcontroller))</span>
<span style="color: #008080;">144</span> <span style="color: #008000;">//</span><span style="color: #008000;">        viewcontroller.setViewStatus(status);</span>
<span style="color: #008080;">145</span> <span style="color: #008000;">//</span><span style="color: #008000;">    });</span>
<span style="color: #008080;">146</span> <span style="color: #008000;">//</span><span style="color: #008000;">  },</span>
<span style="color: #008080;">147</span> 
<span style="color: #008080;">148</span>   notifyDataChanged: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">149</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通知所有注册的观察者被观察者的数据发生变化</span>
<span style="color: #008080;">150</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span><span style="color: #000000;">.getViewModel();
</span><span style="color: #008080;">151</span>     _.each(<span style="color: #0000ff;">this</span>.observers, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (viewcontroller) {
</span><span style="color: #008080;">152</span>       <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isObject(viewcontroller))
</span><span style="color: #008080;">153</span> <span style="color: #000000;">        _.callmethod(viewcontroller.update, viewcontroller, [data]);
</span><span style="color: #008080;">154</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">155</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">156</span> <span style="color: #000000;">});
</span><span style="color: #008080;">157</span> 
<span style="color: #008080;">158</span> Dalmatian.ViewController =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;">159</span> 
<span style="color: #008080;">160</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">161</span> 
<span style="color: #008080;">162</span>     <span style="color: #008000;">//</span><span style="color: #008000;">用户设置的容器选择器，或者dom结构</span>
<span style="color: #008080;">163</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.container;
</span><span style="color: #008080;">164</span>     <span style="color: #008000;">//</span><span style="color: #008000;">根元素</span>
<span style="color: #008080;">165</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el;
</span><span style="color: #008080;">166</span> 
<span style="color: #008080;">167</span>     <span style="color: #008000;">//</span><span style="color: #008000;">一定会出现</span>
<span style="color: #008080;">168</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.view;
</span><span style="color: #008080;">169</span>     <span style="color: #008000;">//</span><span style="color: #008000;">可能会出现</span>
<span style="color: #008080;">170</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter;
</span><span style="color: #008080;">171</span>     <span style="color: #008000;">//</span><span style="color: #008000;">初始化的时候便需要设置view的状态，否则会渲染失败，这里给一个默认值</span>
<span style="color: #008080;">172</span>     <span style="color: #0000ff;">this</span>.viewstatus = 'init'<span style="color: #000000;">;
</span><span style="color: #008080;">173</span> 
<span style="color: #008080;">174</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">175</span> 
<span style="color: #008080;">176</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;">177</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">178</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">179</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">180</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._handleAdapter();
</span><span style="color: #008080;">181</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.create();
</span><span style="color: #008080;">182</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">183</span> 
<span style="color: #008080;">184</span>   <span style="color: #008000;">//</span><span style="color: #008000;">处理dataAdpter中的datamodel，为其注入view的默认容器数据</span>
<span style="color: #008080;">185</span>   _handleAdapter: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">186</span>     <span style="color: #008000;">//</span><span style="color: #008000;">不存在就不予理睬</span>
<span style="color: #008080;">187</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.adapter) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">188</span>     <span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">189</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">190</span> 
<span style="color: #008080;">191</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">192</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">193</span>     <span style="color: #0000ff;">if</span> (!options) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">194</span> 
<span style="color: #008080;">195</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._verify(options);
</span><span style="color: #008080;">196</span> 
<span style="color: #008080;">197</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">198</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">199</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">200</span> 
<span style="color: #008080;">201</span>   setViewStatus: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (status) {
</span><span style="color: #008080;">202</span>     <span style="color: #0000ff;">this</span>.viewstatus =<span style="color: #000000;"> status;
</span><span style="color: #008080;">203</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">204</span> 
<span style="color: #008080;">205</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 验证参数</span>
<span style="color: #008080;">206</span>   _verify: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">207</span>     <span style="color: #008000;">//</span><span style="color: #008000;">这个underscore方法新框架在报错</span>
<span style="color: #008080;">208</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    if (!_.property('view')(options) &amp;&amp; (!this.view)) throw Error('view必须在实例化的时候传入ViewController');</span>
<span style="color: #008080;">209</span>     <span style="color: #0000ff;">if</span> (options.view &amp;&amp; (!<span style="color: #0000ff;">this</span>.view)) <span style="color: #0000ff;">throw</span> Error('view必须在实例化的时候传入ViewController'<span style="color: #000000;">);
</span><span style="color: #008080;">210</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">211</span> 
<span style="color: #008080;">212</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 当数据发生变化时调用onViewUpdate，如果onViewUpdate方法不存在的话，直接调用render方法重绘</span>
<span style="color: #008080;">213</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;">214</span> 
<span style="color: #008080;">215</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    _.callmethod(this.hide, this);</span>
<span style="color: #008080;">216</span> 
<span style="color: #008080;">217</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span><span style="color: #000000;">.onViewUpdate) {
</span><span style="color: #008080;">218</span>       _.callmethod(<span style="color: #0000ff;">this</span>.onViewUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">, [data]);
</span><span style="color: #008080;">219</span>       <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">220</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">221</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;">222</span> 
<span style="color: #008080;">223</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    _.callmethod(this.show, this);</span>
<span style="color: #008080;">224</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">225</span> 
<span style="color: #008080;">226</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">227</span> <span style="color: #008000;">  * @override
</span><span style="color: #008080;">228</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">229</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">230</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation  这个方法需要被复写</span>
<span style="color: #008080;">231</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span>.viewstatus, <span style="color: #0000ff;">this</span>.adapter &amp;&amp; <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.getViewModel());
</span><span style="color: #008080;">232</span>     <span style="color: #0000ff;">this</span>.view.root.html(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.html);
</span><span style="color: #008080;">233</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">234</span> 
<span style="color: #008080;">235</span>   _create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">236</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;">237</span> 
<span style="color: #008080;">238</span>     <span style="color: #008000;">//</span><span style="color: #008000;">render 结束后构建好根元素dom结构</span>
<span style="color: #008080;">239</span>     <span style="color: #0000ff;">this</span>.view.root.html(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.html);
</span><span style="color: #008080;">240</span>     <span style="color: #0000ff;">this</span>.$el = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.root;
</span><span style="color: #008080;">241</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">242</span> 
<span style="color: #008080;">243</span>   create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">244</span> 
<span style="color: #008080;">245</span>     <span style="color: #008000;">//</span><span style="color: #008000;">l_wang这块不是很明白</span>
<span style="color: #008080;">246</span>     <span style="color: #008000;">//</span><span style="color: #008000;">是否检查映射关系，不存在则recreate，但是在这里dom结构未必在document上</span>
<span style="color: #008080;">247</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    if (!$('#' + this.view.viewid)[0]) {</span>
<span style="color: #008080;">248</span>     <span style="color: #008000;">//</span><span style="color: #008000;">      return _.callmethod(this.recreate, this);</span>
<span style="color: #008080;">249</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    }</span>
<span style="color: #008080;">250</span> 
<span style="color: #008080;">251</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 在create方法调用前后设置onViewBeforeCreate和onViewAfterCreate两个回调</span>
<span style="color: #008080;">252</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._create, 'onViewBeforeCreate', 'onViewAfterCreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">253</span> 
<span style="color: #008080;">254</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">255</span> 
<span style="color: #008080;">256</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">257</span> <span style="color: #008000;">  * @description 如果进入create判断是否需要update一下页面，sync view和viewcontroller的数据
</span><span style="color: #008080;">258</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">259</span>   _recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">260</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.update();
</span><span style="color: #008080;">261</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">262</span> 
<span style="color: #008080;">263</span>   recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">264</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._recreate, 'onViewBeforeRecreate', 'onViewAfterRecreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">265</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">266</span> 
<span style="color: #008080;">267</span>   <span style="color: #008000;">//</span><span style="color: #008000;">事件注册点</span>
<span style="color: #008080;">268</span>   bindEvents: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (events) {
</span><span style="color: #008080;">269</span>     <span style="color: #0000ff;">if</span> (!(events || (events = _.result(<span style="color: #0000ff;">this</span>, 'events')))) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">270</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.unBindEvents();
</span><span style="color: #008080;">271</span> 
<span style="color: #008080;">272</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 解析event参数的正则</span>
<span style="color: #008080;">273</span>     <span style="color: #0000ff;">var</span> delegateEventSplitter = /^(\S+)\s*(.*)$/<span style="color: #000000;">;
</span><span style="color: #008080;">274</span>     <span style="color: #0000ff;">var</span><span style="color: #000000;"> key, method, match, eventName, selector;
</span><span style="color: #008080;">275</span> 
<span style="color: #008080;">276</span>     <span style="color: #008000;">//</span><span style="color: #008000;">注意，此处做简单的字符串数据解析即可，不做实际业务</span>
<span style="color: #008080;">277</span>     <span style="color: #0000ff;">for</span> (key <span style="color: #0000ff;">in</span><span style="color: #000000;"> events) {
</span><span style="color: #008080;">278</span>       method =<span style="color: #000000;"> events[key];
</span><span style="color: #008080;">279</span>       <span style="color: #0000ff;">if</span> (!_.isFunction(method)) method = <span style="color: #0000ff;">this</span><span style="color: #000000;">[events[key]];
</span><span style="color: #008080;">280</span>       <span style="color: #0000ff;">if</span> (!method) <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
</span><span style="color: #008080;">281</span> 
<span style="color: #008080;">282</span>       match =<span style="color: #000000;"> key.match(delegateEventSplitter);
</span><span style="color: #008080;">283</span>       eventName = match[1], selector = match[2<span style="color: #000000;">];
</span><span style="color: #008080;">284</span>       method = _.bind(method, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">285</span>       eventName += '.delegateEvents' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid;
</span><span style="color: #008080;">286</span> 
<span style="color: #008080;">287</span>       <span style="color: #0000ff;">if</span> (selector === ''<span style="color: #000000;">) {
</span><span style="color: #008080;">288</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el.on(eventName, method);
</span><span style="color: #008080;">289</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">290</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el.on(eventName, selector, method);
</span><span style="color: #008080;">291</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">292</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">293</span> 
<span style="color: #008080;">294</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">295</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">296</span> 
<span style="color: #008080;">297</span>   <span style="color: #008000;">//</span><span style="color: #008000;">取消所有事件</span>
<span style="color: #008080;">298</span>   unBindEvents: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">299</span>     <span style="color: #0000ff;">this</span>.$el.off('.delegateEvents' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">300</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">301</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">302</span> 
<span style="color: #008080;">303</span>   _show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">304</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.bindEvents();
</span><span style="color: #008080;">305</span>     $(<span style="color: #0000ff;">this</span>.container).append(<span style="color: #0000ff;">this</span><span style="color: #000000;">.$el);
</span><span style="color: #008080;">306</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el.show();
</span><span style="color: #008080;">307</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">308</span> 
<span style="color: #008080;">309</span>   show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">310</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._show, 'onViewBeforeShow', 'onViewAfterShow', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">311</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">312</span> 
<span style="color: #008080;">313</span>   _hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">314</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.forze();
</span><span style="color: #008080;">315</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el.hide();
</span><span style="color: #008080;">316</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">317</span> 
<span style="color: #008080;">318</span>   hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">319</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._hide, 'onViewBeforeHide', 'onViewAfterHide', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">320</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">321</span> 
<span style="color: #008080;">322</span>   _forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">323</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.unBindEvents();
</span><span style="color: #008080;">324</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">325</span> 
<span style="color: #008080;">326</span>   forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">327</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._forze, 'onViewBeforeForzen', 'onViewAfterForzen', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">328</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">329</span> 
<span style="color: #008080;">330</span>   _destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">331</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.unBindEvents();
</span><span style="color: #008080;">332</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.$el.remove();
</span><span style="color: #008080;">333</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    delete this;</span>
<span style="color: #008080;">334</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">335</span> 
<span style="color: #008080;">336</span>   destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">337</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._destory, 'onViewBeforeDestory', 'onViewAfterDestory', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">338</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">339</span> });</pre>
</div>
<span class="cnblogs_code_collapse">完整MVC想法</span></div>
<p>代码效果如下：</p>
<p><img src="17580529797547.png" alt=""></p>
<p><img src="428562210302528.png" alt=""></p>
<p>每次点击刷新数据时候会模拟一次Ajax操作，将datamodel中的数据改变，然后会触发视图改变</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> <span style="color: #000000;">  events: {
</span><span style="color: #008080;">2</span>     'click .cui-btns-sure': <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">3</span>       <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span>.$el.find('#ajax_data'<span style="color: #000000;">).val();
</span><span style="color: #008080;">4</span>       data = eval('(' + data + ')'<span style="color: #000000;">);
</span><span style="color: #008080;">5</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">._handleAjax(data);
</span><span style="color: #008080;">6</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">7</span>   }</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span>   _handleAjax: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">this</span>.setViewStatus('loading'<span style="color: #000000;">);
</span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.ajaxLoading();
</span><span style="color: #008080;">4</span>     getAjaxData($.proxy(<span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;">5</span>       <span style="color: #0000ff;">this</span>.setViewStatus('ajaxSuc'<span style="color: #000000;">);
</span><span style="color: #008080;">6</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.ajaxSuc(data);
</span><span style="color: #008080;">7</span>     }, <span style="color: #0000ff;">this</span><span style="color: #000000;">), data);
</span><span style="color: #008080;">8</span>   },</pre>
</div>
<div class="cnblogs_code">
<pre>  ajaxSuc: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
    </span><span style="color: #0000ff;">this</span>.datamodel.ajaxData =<span style="color: #000000;"> data;
    </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.notifyDataChanged();
  }</span></pre>
</div>
<p>中间又一次状态变化，将视图变为loading状态，一次数据请求成功，我们要做的是，重写viewController的render方法</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;">这里用户明确知道自己有没有viewdata</span>
<span style="color: #008080;"> 3</span>     //<span style="color: #0000ff;">var</span> viewdata = <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.getViewModel();
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">var</span> wrapperSet =<span style="color: #000000;"> {
</span><span style="color: #008080;"> 5</span>       loading: '.cui-error-tips'<span style="color: #000000;">,
</span><span style="color: #008080;"> 6</span>       ajaxSuc: '.cui-error-tips'
<span style="color: #008080;"> 7</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 8</span>     <span style="color: #008000;">//</span><span style="color: #008000;">view具有唯一包裹器</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">var</span> root = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.root;
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">var</span> selector = wrapperSet[<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewstatus];
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (selector) {
</span><span style="color: #008080;">13</span>       root =<span style="color: #000000;"> root.find(selector);
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span>.viewstatus, <span style="color: #0000ff;">this</span>.adapter &amp;&amp; <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.getViewModel());
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     root.html(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.html);
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>   },</pre>
</div>
<p>这块逻辑需要被用户重写，因为具体每次渲染后，形成的html装载在什么位置，我们并不能确定</p>
<p>这里我们再写一个例子，看一看共享一个Adapter的效果</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('a815d81e-8e19-4563-acb7-a24846545da6')"><img id="code_img_closed_a815d81e-8e19-4563-acb7-a24846545da6" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_a815d81e-8e19-4563-acb7-a24846545da6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a815d81e-8e19-4563-acb7-a24846545da6',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_a815d81e-8e19-4563-acb7-a24846545da6" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">doctype html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>ToDoList<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/css/flat-ui.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 11</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 12</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 13</span> 
<span style="color: #008080;"> 14</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">=" border: 1px solid black; margin: 10px; padding: 10px; "</span><span style="color: #0000ff;">&gt;</span>上下组件共享Adapter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 15</span> 
<span style="color: #008080;"> 16</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="list"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 17</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 18</span> 
<span style="color: #008080;"> 19</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-todolist"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 20</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">section class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">row</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 21</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">col-xs-9</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 22</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">form action</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">""</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 23</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">legend</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">To Do List </span><span style="background-color: #f5f5f5; color: #000000;">--</span><span style="background-color: #f5f5f5; color: #000000;"> Input</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">legend&gt;</span>
<span style="color: #008080;"> 24</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">input type</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">text</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> placeholer</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">ToDoList</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> id</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">todoinput</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 25</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">button class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">btn btn-primary</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> data</span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">action</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">add</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">添加</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">button&gt;</span>
<span style="color: #008080;"> 26</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">form&gt;</span>
<span style="color: #008080;"> 27</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul id</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">todolist</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 28</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">_.each(list, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(item){</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 29</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">item.content </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;"> 30</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">})</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 31</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;"> 32</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 33</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">section&gt;</span>
<span style="color: #008080;"> 34</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 35</span> 
<span style="color: #008080;"> 36</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-list"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 37</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 38</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;">(</span><span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">, len </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> list.length; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> len; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 39</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">list[i].content </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span> <span style="background-color: #f5f5f5; color: #000000;">-</span> <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">span index</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;%=i %&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">删除</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">span&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 40</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">}</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 41</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;"> 42</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/underscore.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 45</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/zepto.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 46</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/underscore-extend.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 47</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/mvc.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 48</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> View </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;"> 51</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 52</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设置默认属性</span>
<span style="color: #008080;"> 53</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;"> 54</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.templateSet </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 55</span> <span style="background-color: #f5f5f5; color: #000000;">          init: $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-todolist</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html()
</span><span style="color: #008080;"> 56</span> <span style="background-color: #f5f5f5; color: #000000;">        };
</span><span style="color: #008080;"> 57</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;"> 58</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 59</span> 
<span style="color: #008080;"> 60</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> Adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;"> 61</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 62</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;"> 63</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 64</span> <span style="background-color: #f5f5f5; color: #000000;">          list: [{content: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">测试数据01</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">}, {content: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">测试数据02</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">}]
</span><span style="color: #008080;"> 65</span> <span style="background-color: #f5f5f5; color: #000000;">        };
</span><span style="color: #008080;"> 66</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 67</span> 
<span style="color: #008080;"> 68</span> <span style="background-color: #f5f5f5; color: #000000;">      addItem: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (item) {
</span><span style="color: #008080;"> 69</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel.list.push(item);
</span><span style="color: #008080;"> 70</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.notifyDataChanged();
</span><span style="color: #008080;"> 71</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 72</span> 
<span style="color: #008080;"> 73</span> <span style="background-color: #f5f5f5; color: #000000;">      removeItem: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (index) {
</span><span style="color: #008080;"> 74</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.datamodel.list.splice(index, </span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;"> 75</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.notifyDataChanged();
</span><span style="color: #008080;"> 76</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;"> 77</span> 
<span style="color: #008080;"> 78</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 79</span> 
<span style="color: #008080;"> 80</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Adapter();
</span><span style="color: #008080;"> 81</span> 
<span style="color: #008080;"> 82</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> Controller </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;"> 83</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 84</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;"> 85</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> View();
</span><span style="color: #008080;"> 86</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> adapter;
</span><span style="color: #008080;"> 87</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.container </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">.container</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;"> 88</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 89</span> 
<span style="color: #008080;"> 90</span> <span style="background-color: #f5f5f5; color: #000000;">      render: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;"> 91</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.render(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.getViewModel());
</span><span style="color: #008080;"> 92</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.root.html(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.html);
</span><span style="color: #008080;"> 93</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 94</span> 
<span style="color: #008080;"> 95</span> <span style="background-color: #f5f5f5; color: #000000;">      events: {
</span><span style="color: #008080;"> 96</span>         <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click button</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">action</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
<span style="color: #008080;"> 97</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 98</span> <span style="background-color: #f5f5f5; color: #000000;">      action: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;"> 99</span> <span style="background-color: #f5f5f5; color: #000000;">        e.preventDefault();
</span><span style="color: #008080;">100</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> target </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(e.currentTarget).attr(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">data-action</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">101</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> strategy </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">102</span>           <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">add</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">103</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> value </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#todoinput</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).val();
</span><span style="color: #008080;">104</span>             <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.addItem({ content: value });
</span><span style="color: #008080;">105</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> s </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">106</span> <span style="background-color: #f5f5f5; color: #000000;">          }
</span><span style="color: #008080;">107</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">108</span> <span style="background-color: #f5f5f5; color: #000000;">        strategy[target].apply(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">, [e]);
</span><span style="color: #008080;">109</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;">110</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">111</span> 
<span style="color: #008080;">112</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> controller </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Controller();
</span><span style="color: #008080;">113</span> <span style="background-color: #f5f5f5; color: #000000;">    controller.show();
</span><span style="color: #008080;">114</span> 
<span style="color: #008080;">115</span> 
<span style="color: #008080;">116</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> LView </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;">117</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;">118</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设置默认属性</span>
<span style="color: #008080;">119</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;">120</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.templateSet </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">121</span> <span style="background-color: #f5f5f5; color: #000000;">          init: $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-list</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html()
</span><span style="color: #008080;">122</span> <span style="background-color: #f5f5f5; color: #000000;">        };
</span><span style="color: #008080;">123</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;">124</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">125</span> 
<span style="color: #008080;">126</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> LController </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;">127</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;">128</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;">129</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> LView();
</span><span style="color: #008080;">130</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> adapter;
</span><span style="color: #008080;">131</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.container </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">.list</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">132</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;">133</span> 
<span style="color: #008080;">134</span> <span style="background-color: #f5f5f5; color: #000000;">      render: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">135</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.render(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.getViewModel());
</span><span style="color: #008080;">136</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.root.html(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.html);
</span><span style="color: #008080;">137</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;">138</span> 
<span style="color: #008080;">139</span> <span style="background-color: #f5f5f5; color: #000000;">      events: {
</span><span style="color: #008080;">140</span>         <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">click span</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">action</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
<span style="color: #008080;">141</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;">142</span> <span style="background-color: #f5f5f5; color: #000000;">      action: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (e) {
</span><span style="color: #008080;">143</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> index </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(e.currentTarget).attr(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">index</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">144</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.removeItem(index);
</span><span style="color: #008080;">145</span> 
<span style="color: #008080;">146</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;">147</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">148</span> 
<span style="color: #008080;">149</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> lcontroller </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> LController();
</span><span style="color: #008080;">150</span> <span style="background-color: #f5f5f5; color: #000000;">    lcontroller.show();
</span><span style="color: #008080;">151</span> 
<span style="color: #008080;">152</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">153</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">154</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><img src="24793848493572.png" alt=""></p>
<p><img src="15327627348635.png" alt=""></p>
</div>
<p><span style="line-height: 1.5;">可以看到，上下的变化根源是数据操作，每次数据的变化是共享的</span></p>
<h1>结语</h1>
<p>今天更正了上一次留下来的wrapperSet思维，这里对自己所知的MVC做了一次梳理</p>
<p>然后框架在一次次修改中逐步成型了，是个好现象，慢慢来吧</p>
</div>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptzdyxhxzsdyjxyzyddf/index.html">javascript中的一些核心知识点以及需要注意的地方</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]webappdyhzlyzydqdyhdpyjlkkb/index.html">[置顶]【webapp的优化整理】要做移动前端优化的朋友进来看看吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]yddjrwtyjjavascriptsjjzxjsjydjr/index.html">[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntzhb30fzxhsygruntdbqddm/index.html">【grunt整合版】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdyd30fzxhsygruntdbqddm/index.html">【grunt第一弹】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdsdgruntzqdsjxmzdyy/index.html">【grunt第三弹】grunt在前端实际项目中的应用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntded30fzxhsygruntdbqddm02/index.html">【grunt第二弹】30分钟学会使用grunt打包前端代码（02）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxtpyddhadlqs/index.html">【IScroll深入学习】突破移动端黑暗的利器（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxjjIScrollynzz/index.html">【IScroll深入学习】解决IScroll疑难杂症</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx00mniScroll/index.html">【iScroll源码学习00】模拟iScroll</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx01zbjd/index.html">【iScroll源码学习01】准备阶段</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx02fjiScrollsghxsjd/index.html">【iScroll源码学习02】分解iScroll三个核心事件点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx03iScrollsjjzygdtdsx/index.html">【iScroll源码学习03】iScroll事件机制与滚动条的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx04flIScrollhx/index.html">【iScroll源码学习04】分离IScroll核心</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdytyyjc/index.html">【javascript培训第一天】语言基础</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdstcybl/index.html">【javascript培训第三天】查遗补漏</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdetDOMyBOM/index.html">【javascript培训第二天】DOM与BOM</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk01mkhbc/index.html">【javascript激增的思考01】模块化编程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk02mkhyMVC/index.html">【javascript激增的思考02】模块化与MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk03MVVMyKnockout/index.html">【javascript激增的思考03】MVVM与Knockout</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk04MVCyBackbonejs(beta)/index.html">【javascript激增的思考04】MVC与Backbonejs(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptmxdxzlrwmyqltkdzb01/index.html">【javascript面向对象之路】让我们一起来坦克大战吧01</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/NodeJSxxbj04xwfbxt/index.html">【NodeJS学习笔记04】新闻发布系统</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx01ljzgrequireJSdjg/index.html">【requireJS源码学习01】了解整个requireJS的结构</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx02datamainjzdsx/index.html">【requireJS源码学习02】datamain加载的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx03xjrequireJSdjzlc/index.html">【requireJS源码学习03】细究requireJS的加载流程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjkfygjdrlcjs/index.html">【UI插件】开发一个简单日历插件（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjjddrlcjxxxMVCsx/index.html">【UI插件】简单的日历插件（下）——学习MVC思想</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()/index.html">【zepto学习笔记01】核心方法$()</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()b/index.html">【zepto学习笔记01】核心方法$()（补）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj02lsd/index.html">【zepto学习笔记02】零碎点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj03sjjz/index.html">【zepto学习笔记03】事件机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmsztjavascriptzdjc/index.html">【一次面试】再谈javascript中的继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone01mxModel/index.html">【再探backbone01】模型Model</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone02jhCollection/index.html">【再探backbone02】集合Collection</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone03bkydyyysltgym/index.html">【再探backbone03】博客园单页应用实例（提供源码）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone04dyyydjslycl/index.html">【再探backbone04】单页应用的基石路由处理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ctUnderscorezsmbyq/index.html">【初探Underscore】再说模版引擎</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzAjaxjsxnszddAjax/index.html">【初窥javascript奥秘之Ajax】简述下你所知道的Ajax？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjmpnxnwmyqmdp/index.html">【初窥javascript奥秘之事件冒泡】那些年我们一起冒的泡</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjjzldtygdj/index.html">【初窥javascript奥秘之事件机制】论“点透”与“鬼点击”</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzrrzmbddthisnzdxzthiszxnlm/index.html">【初窥javascript奥秘之让人捉摸不定的this】你知道现在this指向哪里吗？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzbbydxbdhlqbcl/index.html">【初窥javascript奥秘之闭包】叶大侠病都好了，求不踩了：）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzmxdxfzyjc/index.html">【初窥javascript奥秘之面向对象】封装与继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/qdmdsjdjgjdnzdljm/index.html">【前端盲点】事件的几个阶段你真的了解么？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyviewymodelxgsl/index.html">【单页应用】view与model相关梳理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyyqldyyybsxjdwbgns/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyqjkzqappyggxsm/index.html">【单页应用】全局控制器app应该干些什么？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyywmgrhclkjdcccjgx/index.html">【单页应用】我们该如何处理框架弹出层层级关系？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyljMVC/index.html">【单页应用】理解MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyztxjzviewzjygrhtx/index.html">【单页应用之通信机制】view之间应该如何通信</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyjkzHistoryxsHistorydgdyyydm/index.html">【单页应用巨坑之History】细数History带给单页应用的噩梦</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtszeptofindysyjiosdcjpknrnhtt/index.html">【小贴士】zeptofind元素以及ios弹出键盘可能让你很头疼</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgytransitionEndanimatedygyqgs/index.html">【小贴士】关于transitionEndanimate的一个有趣故事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgzzdbbysjwtdzzmp/index.html">【小贴士】工作中的”闭包“与事件委托的”阻止冒泡“</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtstytjavascriptzdreplace/index.html">【小贴士】探一探javascript中的replace</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsxnjpyfixeddgydddt/index.html">【小贴士】虚拟键盘与fixed带给移动端的痛！</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ttjavascriptsjjzdcsxyl/index.html">【探讨】javascript事件机制底层实现原理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mkhbcljrequireJSsxygjddmkjzq/index.html">【模块化编程】理解requireJS实现一个简单的模块加载器</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zyJavaScriptmfjmtsdqlxkjzbfgndcljz/index.html">【转】【译】JavaScript魔法揭秘探索当前流行框架中部分功能的处理机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl01javascriptcszds/index.html">【追寻javascript高手之路01】javascript参数知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl02blzyyzds/index.html">【追寻javascript高手之路02】变量、作用域知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl03javascriptdxdld/index.html">【追寻javascript高手之路03】javascript对象大乱斗</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl04ljprototype/index.html">【追寻javascript高手之路04】理解prototype</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl05ljsjl/index.html">【追寻javascript高手之路05】理解事件流</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj04zxzzsj(2)/index.html">【重构笔记04】重新组织数据(2)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj05jhtjbds/index.html">【重构笔记05】简化条件表达式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj06jhhsdy/index.html">【重构笔记06】简化函数调用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmshgttbxysjfl/index.html">一次面试回顾——探讨表现与数据分离</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dhzwebappzdxz/index.html">动画在webapp中的现状</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ysandriodlqhthdomclicksjqtsxwttj/index.html">原生andriod浏览器回退后dom（click）事件全体失效问题探究</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/scsbdjxysdsbsjytouchsjdnxs/index.html">手持设备点击响应速度，鼠标事件与touch事件的那些事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mnbjQueryzeptohxymfx/index.html">迷你版jQuery——zepto核心源码分析</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dbsgzdlwmlyqxjdddomxzqb/index.html">都别说工资低了，我们来一起写简单的dom选择器吧！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>