<!DOCTYPE html>

<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="android,ios" />
        <meta name="keywords" content="android,ios" />

        <title>叶小钗</title>
        <style type='text/css'>
            body {
                background-color: #CCC;
            }
        </style>
        <link rel="stylesheet" href="../../../css/bootstrap.css" />
    </head>

    <body>
        <div class="container">

            <h1>叶小钗</h1>

            <div class='navbar navbar-inverse'>
                <div class='navbar-inner nav-collapse' style="height: auto;">
                    <ul class="nav">
                              				<li><a href="http://songboriceboy.github.io/xxoo/html/blade/index.html">blade</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/css/index.html">css</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/HTML5&CSS3/index.html">HTML5&CSS3</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/index.html">javascript</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Javaxx/index.html">Java学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/nodejs/index.html">nodejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/requirejs/index.html">requirejs</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/Webqd/index.html">Web前端</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/xxgw/index.html">学习感悟</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/gzdd/index.html">工作点滴</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/jkxx/index.html">接口学习</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/wfl/index.html">未分类</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/ydkf/index.html">移动开发</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/sjms/index.html">设计模式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/mst/index.html">面试题</a></li>
    				                      </ul>
                </div>
            </div>

            <div id='content' class='row-fluid'>

                <div class='span9 main'>
				<div style="color:blue" align=center>【UI插件】简单的日历插件（下）——学习MVC思想</div><br><h1>前言</h1>
<p>我们上次写了一个简单的日历插件，但是只是一个半成品，而且做完后发现一些问题，于是我们今天尝试来解决这些问题</p>
<p>PS：距离上次貌似很久了</p>
<p>上次，我们大概遇到哪些问题呢：</p>
<p>① 既然想做一套UI库，那么就应该考虑其它UI库的接入问题</p>
<p>这个意思就是，我们的系统中所有UI插件应该有一些统一行为，我们如果希望统一为所有的插件加一点什么东西，需要有位置可加</p>
<p>这个意味着，可能我们所有的插件需要继承至一个抽象的UI类，并且该类提供了通用的几个事件点</p>
<p>② 上次做的日历插件虽然说是简单，其耦合还是比较严重的（其实也说不上，但是人总有想装B的时候）</p>
<p>这个怎么说呢，就日历而言，我们可以将之分成三个部分</p>
<p>1 日历核心部分，用于生产静态html</p>
<p>2 日历数据部分，用于显示各个特殊信息，比如节日什么的</p>
<p>3 日历事件部分，现在的想法便是可以将事件相关给抽象出来</p>
<p>目的便是html/data/events 分开一点点，这个该怎么做呢？这是我们今天该思考的问题</p>
<p>事情多了就什么都不能解决，所以我们今天暂时便处理以上两个问题即可</p>
<h1>MVC的学习</h1>
<p>由于我们会依赖于underscore，所以，我们这里有一个underscore的扩展，加一些我们自己需要的东西</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('181bbec8-2b19-4315-846f-e9fa4f0fd1d2')"><img id="code_img_closed_181bbec8-2b19-4315-846f-e9fa4f0fd1d2" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_181bbec8-2b19-4315-846f-e9fa4f0fd1d2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('181bbec8-2b19-4315-846f-e9fa4f0fd1d2',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_181bbec8-2b19-4315-846f-e9fa4f0fd1d2" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> (<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 全局可能用到的变量</span>
<span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">var</span> slice =<span style="color: #000000;"> arr.slice;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">var</span> method = method ||<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">10</span> <span style="color: #008000;">  * @description inherit方法，js的继承，默认为两个参数
</span><span style="color: #008080;">11</span> <span style="color: #008000;">  * @param {function} supClass 可选，要继承的类
</span><span style="color: #008080;">12</span> <span style="color: #008000;">  * @param {object} subProperty 被创建类的成员
</span><span style="color: #008080;">13</span> <span style="color: #008000;">  * @return {function} 被创建的类
</span><span style="color: #008080;">14</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span>   method.inherit = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 参数检测，该继承方法，只支持一个参数创建类，或者两个参数继承类</span>
<span style="color: #008080;">18</span>     <span style="color: #0000ff;">if</span> (arguments.length === 0 || arguments.length &gt; 2) <span style="color: #0000ff;">throw</span> '参数错误'<span style="color: #000000;">;
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>     <span style="color: #0000ff;">var</span> parent = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 将参数转换为数组</span>
<span style="color: #008080;">23</span>     <span style="color: #0000ff;">var</span> properties =<span style="color: #000000;"> slice.call(arguments);
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 如果第一个参数为类（function），那么就将之取出</span>
<span style="color: #008080;">26</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> properties[0] === 'function'<span style="color: #000000;">)
</span><span style="color: #008080;">27</span>       parent =<span style="color: #000000;"> properties.shift();
</span><span style="color: #008080;">28</span>     properties = properties[0<span style="color: #000000;">];
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 创建新类用于返回</span>
<span style="color: #008080;">31</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> klass() {
</span><span style="color: #008080;">32</span>       <span style="color: #0000ff;">if</span> (_.isFunction(<span style="color: #0000ff;">this</span><span style="color: #000000;">.initialize))
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">this</span>.initialize.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span>     klass.superclass =<span style="color: #000000;"> parent;
</span><span style="color: #008080;">37</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses = [];</span>
<span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (parent) {
</span><span style="color: #008080;">40</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> @description 中间过渡类，防止parent的构造函数被执行</span>
<span style="color: #008080;">41</span>       <span style="color: #0000ff;">var</span> subclass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;">42</span>       subclass.prototype =<span style="color: #000000;"> parent.prototype;
</span><span style="color: #008080;">43</span>       klass.prototype = <span style="color: #0000ff;">new</span><span style="color: #000000;"> subclass();
</span><span style="color: #008080;">44</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses.push(klass);</span>
<span style="color: #008080;">45</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">46</span> 
<span style="color: #008080;">47</span>     <span style="color: #0000ff;">var</span> ancestor = klass.superclass &amp;&amp;<span style="color: #000000;"> klass.superclass.prototype;
</span><span style="color: #008080;">48</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> properties) {
</span><span style="color: #008080;">49</span>       <span style="color: #0000ff;">var</span> value =<span style="color: #000000;"> properties[k];
</span><span style="color: #008080;">50</span> 
<span style="color: #008080;">51</span>       <span style="color: #008000;">//</span><span style="color: #008000;">满足条件就重写</span>
<span style="color: #008080;">52</span>       <span style="color: #0000ff;">if</span> (ancestor &amp;&amp; <span style="color: #0000ff;">typeof</span> value == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;">53</span>         <span style="color: #0000ff;">var</span> argslist = /^\s*function\s*\(([^\(\)]*?)\)\s*?\{/i.exec(value.toString())[1].replace(/\s/i, '').split(','<span style="color: #000000;">);
</span><span style="color: #008080;">54</span>         <span style="color: #008000;">//</span><span style="color: #008000;">只有在第一个参数为$super情况下才需要处理（是否具有重复方法需要用户自己决定）</span>
<span style="color: #008080;">55</span>         <span style="color: #0000ff;">if</span> (argslist[0] === '$super' &amp;&amp;<span style="color: #000000;"> ancestor[k]) {
</span><span style="color: #008080;">56</span>           value = (<span style="color: #0000ff;">function</span><span style="color: #000000;"> (methodName, fn) {
</span><span style="color: #008080;">57</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">58</span>               <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">59</span>               <span style="color: #0000ff;">var</span> args = [<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">60</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> ancestor[methodName].apply(scope, arguments);
</span><span style="color: #008080;">61</span> <span style="color: #000000;">              } ];
</span><span style="color: #008080;">62</span>               <span style="color: #0000ff;">return</span> fn.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, args.concat(slice.call(arguments)));
</span><span style="color: #008080;">63</span> <span style="color: #000000;">            };
</span><span style="color: #008080;">64</span> <span style="color: #000000;">          })(k, value);
</span><span style="color: #008080;">65</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">66</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">67</span> 
<span style="color: #008080;">68</span>       <span style="color: #008000;">//</span><span style="color: #008000;">此处对对象进行扩展，当前原型链已经存在该对象，便进行扩展</span>
<span style="color: #008080;">69</span>       <span style="color: #0000ff;">if</span> (_.isObject(klass.prototype[k]) &amp;&amp; _.isObject(value) &amp;&amp; (<span style="color: #0000ff;">typeof</span> klass.prototype[k] != 'function' &amp;&amp; <span style="color: #0000ff;">typeof</span> value != 'fuction'<span style="color: #000000;">)) {
</span><span style="color: #008080;">70</span>         <span style="color: #008000;">//</span><span style="color: #008000;">原型链是共享的，这里不好办</span>
<span style="color: #008080;">71</span>         <span style="color: #0000ff;">var</span> temp =<span style="color: #000000;"> {};
</span><span style="color: #008080;">72</span> <span style="color: #000000;">        _.extend(temp, klass.prototype[k]);
</span><span style="color: #008080;">73</span> <span style="color: #000000;">        _.extend(temp, value);
</span><span style="color: #008080;">74</span>         klass.prototype[k] =<span style="color: #000000;"> temp;
</span><span style="color: #008080;">75</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">76</span>         klass.prototype[k] =<span style="color: #000000;"> value;
</span><span style="color: #008080;">77</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">78</span> 
<span style="color: #008080;">79</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">80</span> 
<span style="color: #008080;">81</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">klass.prototype.initialize)
</span><span style="color: #008080;">82</span>       klass.prototype.initialize = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;">83</span> 
<span style="color: #008080;">84</span>     klass.prototype.constructor =<span style="color: #000000;"> klass;
</span><span style="color: #008080;">85</span> 
<span style="color: #008080;">86</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> klass;
</span><span style="color: #008080;">87</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">88</span> 
<span style="color: #008080;">89</span> <span style="color: #000000;">  _.extend(_, method);
</span><span style="color: #008080;">90</span> 
<span style="color: #008080;">91</span> })(window);</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="line-height: 1.5;">对的，以上是我们前面实现的继承，我们将之扩展至underscore上，以后以此实现继承</span></p>
<p>其次，我们便需要思考如何分离我们的数据/模板/事件了</p>
<h2>View/Adapter/ViewController</h2>
<p>俗话说，大树底下好乘凉，事实上我一些想法来自于我的老大，我老大又借鉴了原来的ios开发，所以这里形成了一些东西，不知道是否合理，我们拿出来看看</p>
<h3>View</h3>
<p>首先，无论如何我们的应用都会有一个view的存在，我们认为view只做简单的页面渲染就好，与之有关的数据/事件什么的，我们不予关注</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('90599099-b96a-4f6e-aa8b-c0ddfb20897e')"><img id="code_img_closed_90599099-b96a-4f6e-aa8b-c0ddfb20897e" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_90599099-b96a-4f6e-aa8b-c0ddfb20897e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('90599099-b96a-4f6e-aa8b-c0ddfb20897e',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_90599099-b96a-4f6e-aa8b-c0ddfb20897e" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 正式的声明Dalmatian框架的命名空间</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">var</span> Dalmatian = Dalmatian ||<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 定义默认的template方法来自于underscore</span>
<span style="color: #008080;"> 5</span> Dalmatian.template =<span style="color: #000000;"> _.template;
</span><span style="color: #008080;"> 6</span> Dalmatian.View =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;"> 7</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;"> 8</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;">15</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">var</span> DEFAULT_CONTAINER_TEMPLATE = '&lt;section class="view" id="&lt;%=viewid%&gt;"&gt;&lt;%=html%&gt;&lt;/section&gt;'<span style="color: #000000;">;
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description view状态机</span>
<span style="color: #008080;">20</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.statusSet = {};</span>
<span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     <span style="color: #0000ff;">this</span>.defaultContainerTemplate =<span style="color: #000000;"> DEFAULT_CONTAINER_TEMPLATE;
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">25</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description template集合，根据status做template的map</span>
<span style="color: #008080;">26</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @example</span>
<span style="color: #008080;">27</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    { 0: '&lt;ul&gt;&lt;%_.each(list, function(item){%&gt;&lt;li&gt;&lt;%=item.name%&gt;&lt;/li&gt;&lt;%});%&gt;&lt;/ul&gt;' }</span>
<span style="color: #008080;">28</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.templateSet = {};</span>
<span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>     <span style="color: #0000ff;">this</span>.viewid = _.uniqueId('dalmatian-view-'<span style="color: #000000;">);
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">35</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">36</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">37</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">40</span> 
<span style="color: #008080;">41</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通过模板和数据渲染具体的View</span>
<span style="color: #008080;">42</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} View的状态参数</span>
<span style="color: #008080;">43</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} 匹配View的数据格式的具体数据</span>
<span style="color: #008080;">44</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param callback {functiion} 执行完成之后的回调</span>
<span style="color: #008080;">45</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;">(status, data, callback) {
</span><span style="color: #008080;">46</span> 
<span style="color: #008080;">47</span>     <span style="color: #0000ff;">var</span> templateSelected = <span style="color: #0000ff;">this</span><span style="color: #000000;">.templateSet[status];
</span><span style="color: #008080;">48</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (templateSelected) {
</span><span style="color: #008080;">49</span> 
<span style="color: #008080;">50</span>       <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">51</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> @description 渲染view</span>
<span style="color: #008080;">52</span>         <span style="color: #0000ff;">var</span> templateFn =<span style="color: #000000;"> Dalmatian.template(templateSelected);
</span><span style="color: #008080;">53</span>         <span style="color: #0000ff;">this</span>.html =<span style="color: #000000;"> templateFn(data);
</span><span style="color: #008080;">54</span> 
<span style="color: #008080;">55</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> @description 在view外层加入外壳</span>
<span style="color: #008080;">56</span>         templateFn = Dalmatian.template(<span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultContainerTemplate);
</span><span style="color: #008080;">57</span>         <span style="color: #0000ff;">this</span>.html =<span style="color: #000000;"> templateFn({
</span><span style="color: #008080;">58</span>           viewid: <span style="color: #0000ff;">this</span><span style="color: #000000;">.viewid,
</span><span style="color: #008080;">59</span>           html: <span style="color: #0000ff;">this</span><span style="color: #000000;">.html
</span><span style="color: #008080;">60</span> <span style="color: #000000;">        });
</span><span style="color: #008080;">61</span> 
<span style="color: #008080;">62</span>         <span style="color: #0000ff;">this</span>.currentStatus =<span style="color: #000000;"> status;
</span><span style="color: #008080;">63</span> 
<span style="color: #008080;">64</span>         _.callmethod(callback, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">65</span> 
<span style="color: #008080;">66</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">67</span> 
<span style="color: #008080;">68</span>       } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">69</span> 
<span style="color: #008080;">70</span>         <span style="color: #0000ff;">throw</span><span style="color: #000000;"> e;
</span><span style="color: #008080;">71</span> 
<span style="color: #008080;">72</span>       } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">73</span> 
<span style="color: #008080;">74</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">75</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">76</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">77</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">78</span> 
<span style="color: #008080;">79</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">80</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可以被复写，当status和data分别发生变化时候</span>
<span style="color: #008080;">81</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} view的状态值</span>
<span style="color: #008080;">82</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} viewmodel的数据</span>
<span style="color: #008080;">83</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;">(status, data) {
</span><span style="color: #008080;">84</span> 
<span style="color: #008080;">85</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.currentStatus || <span style="color: #0000ff;">this</span>.currentStatus !==<span style="color: #000000;"> status) {
</span><span style="color: #008080;">86</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.render(status, data);
</span><span style="color: #008080;">87</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">88</span> 
<span style="color: #008080;">89</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">90</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可复写部分，当数据发生变化但是状态没有发生变化时，页面仅仅变化的可以是局部显示</span>
<span style="color: #008080;">91</span>     <span style="color: #008000;">//</span><span style="color: #008000;">              可以通过获取this.html进行修改</span>
<span style="color: #008080;">92</span>     _.callmethod(<span style="color: #0000ff;">this</span>.onUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">93</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">94</span> });</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="line-height: 1.5;">从代码上看，我们需要注意几个事情：</span></p>
<p>① View会生成静态HTML</p>
<p>② View会根据当前状态、当前数据生成静态HTML</p>
<p>所以，我们的View事实上只会生成静态HTML，不同的是他会根据不同的状态生成不同的HTML，比如初始状态和加载结束状态</p>
<p>有了View便缺不了数据，也就是所谓的Model，我们这里给他取一个名字，Adapter</p>
<h3>Adapter</h3>
<div class="cnblogs_code" onclick="cnblogs_code_show('4fd7f15b-f7e7-4d0d-a293-7c0759000689')"><img id="code_img_closed_4fd7f15b-f7e7-4d0d-a293-7c0759000689" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_4fd7f15b-f7e7-4d0d-a293-7c0759000689" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4fd7f15b-f7e7-4d0d-a293-7c0759000689',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_4fd7f15b-f7e7-4d0d-a293-7c0759000689" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> Dalmatian.Adapter =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;"> 4</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;">11</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">this</span>.observers =<span style="color: #000000;"> [];
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">this</span>.viewmodel =<span style="color: #000000;"> {};
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">this</span>.datamodel =<span style="color: #000000;"> {};
</span><span style="color: #008080;">15</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">18</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">19</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">20</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">21</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置</span>
<span style="color: #008080;">24</span>   format: <span style="color: #0000ff;">function</span><span style="color: #000000;">(origindata){
</span><span style="color: #008080;">25</span>     <span style="color: #0000ff;">this</span>.datamodel =<span style="color: #000000;"> origindata;
</span><span style="color: #008080;">26</span>     <span style="color: #0000ff;">this</span>.viewmodel = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parse(origindata);
</span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.viewmodel;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">31</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description parse方法用来将datamodel转化为viewmodel，必须被重写</span>
<span style="color: #008080;">32</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;">(origindata) {
</span><span style="color: #008080;">33</span>     <span style="color: #0000ff;">throw</span> Error('方法必须被重写'<span style="color: #000000;">);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span>   registerObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">37</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 检查队列中如果没有viewcontroller，从队列尾部推入</span>
<span style="color: #008080;">38</span>     <span style="color: #0000ff;">if</span> (!_.contains(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller)) {
</span><span style="color: #008080;">39</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.observers.push(viewcontroller);
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span>   unregisterObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">44</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从observers的队列中剔除viewcontroller</span>
<span style="color: #008080;">45</span>     <span style="color: #0000ff;">this</span>.observers = _.without(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller);
</span><span style="color: #008080;">46</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">47</span> 
<span style="color: #008080;">48</span>   notifyDataChanged: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">49</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通知所有注册的观察者被观察者的数据发生变化</span>
<span style="color: #008080;">50</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span>.format(<span style="color: #0000ff;">this</span><span style="color: #000000;">.datamodel);
</span><span style="color: #008080;">51</span>     _.each(<span style="color: #0000ff;">this</span>.observers, <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">52</span>       <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isObject(viewcontroller))
</span><span style="color: #008080;">53</span> <span style="color: #000000;">        _.callmethod(viewcontroller.update, viewcontroller, [data]);
</span><span style="color: #008080;">54</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">55</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">56</span> });</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="font-size: 14px; line-height: 1.5;">Adapter由以下几个关键组成：</span></p>
<p>① View观察者</p>
<p>② 数据模型，便是原始的数据</p>
<p>③ viewModel，便是view实际需要的数据</p>
<p>并且每一次数据的改变会通知观察的view，触发其update，所以Adapter的组成也比较干脆，并不复杂</p>
<p>但是，我们的view仍然没有事件，而且Adapter也没有与view联系起来，这个时候我们缺少一个要件，他的名字是Controller</p>
<h3>ViewController</h3>
<p>控制器是链接模型与视图的桥梁，我们这里也不例外，核心动作皆会在控制器处完成</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('66970188-173f-4b89-b15b-86ced2bc9c65')"><img id="code_img_closed_66970188-173f-4b89-b15b-86ced2bc9c65" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_66970188-173f-4b89-b15b-86ced2bc9c65" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('66970188-173f-4b89-b15b-86ced2bc9c65',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_66970188-173f-4b89-b15b-86ced2bc9c65" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> Dalmatian.ViewController =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;">  4</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">  5</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">  6</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.create();
</span><span style="color: #008080;">  7</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;"> 10</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;"> 11</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._verify(options);
</span><span style="color: #008080;"> 12</span> 
<span style="color: #008080;"> 13</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;"> 14</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;"> 15</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 验证参数</span>
<span style="color: #008080;"> 18</span>   _verify: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">if</span> (!_.property('view')(options)) <span style="color: #0000ff;">throw</span> Error('view必须在实例化的时候传入ViewController'<span style="color: #000000;">);
</span><span style="color: #008080;"> 20</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 21</span> 
<span style="color: #008080;"> 22</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 当数据发生变化时调用onViewUpdate，如果onViewUpdate方法不存在的话，直接调用render方法重绘</span>
<span style="color: #008080;"> 23</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;"> 24</span> 
<span style="color: #008080;"> 25</span>     _.callmethod(<span style="color: #0000ff;">this</span>.hide, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span>     <span style="color: #0000ff;">if</span> (!_.callmethod(<span style="color: #0000ff;">this</span>.onViewUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">, [data])) {
</span><span style="color: #008080;"> 28</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;"> 29</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 30</span> 
<span style="color: #008080;"> 31</span>     _.callmethod(<span style="color: #0000ff;">this</span>.show, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 33</span> 
<span style="color: #008080;"> 34</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 35</span> <span style="color: #008000;">  * @description 传入事件对象，解析之，解析event，返回对象{events: [{target: '#btn', event:'click', callback: handler}]}
</span><span style="color: #008080;"> 36</span> <span style="color: #008000;">  * @param events {obj} 事件对象，默认传入唯一id
</span><span style="color: #008080;"> 37</span> <span style="color: #008000;">  * @param namespace 事件命名空间
</span><span style="color: #008080;"> 38</span> <span style="color: #008000;">  * @return {obj}
</span><span style="color: #008080;"> 39</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 40</span>   parseEvents: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (events) {
</span><span style="color: #008080;"> 41</span> 
<span style="color: #008080;"> 42</span>     <span style="color: #008000;">//</span><span style="color: #008000;">用于返回的事件对象</span>
<span style="color: #008080;"> 43</span>     <span style="color: #0000ff;">var</span> eventArr =<span style="color: #000000;"> [];
</span><span style="color: #008080;"> 44</span>     <span style="color: #008000;">//</span><span style="color: #008000;">注意，此处做简单的字符串数据解析即可，不做实际业务</span>
<span style="color: #008080;"> 45</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> key <span style="color: #0000ff;">in</span><span style="color: #000000;"> events) {
</span><span style="color: #008080;"> 46</span>       <span style="color: #0000ff;">var</span> method =<span style="color: #000000;"> events[key];
</span><span style="color: #008080;"> 47</span>       <span style="color: #0000ff;">if</span> (!_.isFunction(method)) method = <span style="color: #0000ff;">this</span><span style="color: #000000;">[events[key]];
</span><span style="color: #008080;"> 48</span>       <span style="color: #0000ff;">if</span> (!method) <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span>       <span style="color: #0000ff;">var</span> match =<span style="color: #000000;"> key.match(delegateEventSplitter);
</span><span style="color: #008080;"> 51</span>       <span style="color: #0000ff;">var</span> eventName = match[1<span style="color: #000000;">],
</span><span style="color: #008080;"> 52</span>         selector = match[2<span style="color: #000000;">];
</span><span style="color: #008080;"> 53</span>       method = _.bind(method, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 54</span>       eventName += '.delegateEvents' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid;
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">      eventArr.push({
</span><span style="color: #008080;"> 56</span> <span style="color: #000000;">        target: selector,
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">        event: eventName,
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">        callback: method
</span><span style="color: #008080;"> 59</span> <span style="color: #000000;">      });
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 61</span> 
<span style="color: #008080;"> 62</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> eventArr;
</span><span style="color: #008080;"> 63</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 64</span> 
<span style="color: #008080;"> 65</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 66</span> <span style="color: #008000;">   * @override
</span><span style="color: #008080;"> 67</span> <span style="color: #008000;">   *
</span><span style="color: #008080;"> 68</span>    <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 69</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 70</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation  这个方法需要被复写</span>
<span style="color: #008080;"> 71</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> var data = this.adapter.format(this.origindata);</span>
<span style="color: #008080;"> 72</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.view.render(this.viewstatus, data);</span>
<span style="color: #008080;"> 73</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 74</span> 
<span style="color: #008080;"> 75</span>   _create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 76</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 78</span> 
<span style="color: #008080;"> 79</span>   create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 80</span> 
<span style="color: #008080;"> 81</span>     <span style="color: #0000ff;">var</span> $element = selectDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;"> 82</span>     <span style="color: #0000ff;">if</span> (domImplement($element, 'get', <span style="color: #0000ff;">false</span>, [0<span style="color: #000000;">])) {
</span><span style="color: #008080;"> 83</span>       <span style="color: #0000ff;">return</span> _.callmethod(<span style="color: #0000ff;">this</span>.recreate, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 84</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 85</span> 
<span style="color: #008080;"> 86</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 在create方法调用前后设置onViewBeforeCreate和onViewAfterCreate两个回调</span>
<span style="color: #008080;"> 87</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._create, 'onViewBeforeCreate', 'onViewAfterCreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 90</span> 
<span style="color: #008080;"> 91</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 92</span> <span style="color: #008000;">  * @description 如果进入create判断是否需要update一下页面，sync view和viewcontroller的数据
</span><span style="color: #008080;"> 93</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 94</span>   _recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 95</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.update();
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 97</span> 
<span style="color: #008080;"> 98</span>   recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 99</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._recreate, 'onViewBeforeRecreate', 'onViewAfterRecreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">100</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span>   _bind: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">103</span>     <span style="color: #0000ff;">this</span>.viewcontent = createDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.html);
</span><span style="color: #008080;">104</span> 
<span style="color: #008080;">105</span>     <span style="color: #0000ff;">var</span> eventsList = <span style="color: #0000ff;">this</span>.parseEvents(<span style="color: #0000ff;">this</span><span style="color: #000000;">.events);
</span><span style="color: #008080;">106</span> 
<span style="color: #008080;">107</span>     <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">108</span>     _.each(eventsList, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (item) {
</span><span style="color: #008080;">109</span> 
<span style="color: #008080;">110</span>       <span style="color: #0000ff;">if</span> (item.target === ''<span style="color: #000000;">) {
</span><span style="color: #008080;">111</span>         eventmethod(scope.viewcontent, 'on'<span style="color: #000000;">, item.event, item.callback, scope);
</span><span style="color: #008080;">112</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">113</span>         eventmethod(scope.viewcontent, 'on'<span style="color: #000000;">, item.event, item.callback, scope, item.target);
</span><span style="color: #008080;">114</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">115</span> 
<span style="color: #008080;">116</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">117</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">118</span> 
<span style="color: #008080;">119</span>   bind: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">120</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._bind, 'onViewBeforeBind', 'onViewAfterBind', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">121</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">122</span> 
<span style="color: #008080;">123</span>   _show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">124</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">125</span> 
<span style="color: #008080;">126</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 需要剔除码？</span>
<span style="color: #008080;">127</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> if ((!$element || $element.length === 0) &amp;&amp; this.viewcontent) {</span>
<span style="color: #008080;">128</span>       <span style="color: #0000ff;">var</span> $container = selectDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.container);
</span><span style="color: #008080;">129</span>       domImplement($container, 'html', <span style="color: #0000ff;">false</span>, [<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewcontent]);
</span><span style="color: #008080;">130</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> }</span>
<span style="color: #008080;">131</span> 
<span style="color: #008080;">132</span>     domImplement($element, 'show'<span style="color: #000000;">);
</span><span style="color: #008080;">133</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">134</span> 
<span style="color: #008080;">135</span>   show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">136</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.bind();
</span><span style="color: #008080;">137</span> 
<span style="color: #008080;">138</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._show, 'onViewBeforeShow', 'onViewAfterShow', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">139</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">140</span> 
<span style="color: #008080;">141</span>   _hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">142</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">143</span>     domImplement($element, 'hide'<span style="color: #000000;">);
</span><span style="color: #008080;">144</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">145</span> 
<span style="color: #008080;">146</span>   hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">147</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._hide, 'onViewBeforeHide', 'onViewAfterHide', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">148</span> 
<span style="color: #008080;">149</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.forze();
</span><span style="color: #008080;">150</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">151</span> 
<span style="color: #008080;">152</span>   _forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">153</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">154</span>     domImplement($element, 'off'<span style="color: #000000;">);
</span><span style="color: #008080;">155</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">156</span> 
<span style="color: #008080;">157</span>   forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">158</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._forze, 'onViewBeforeForzen', 'onViewAfterForzen', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">159</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">160</span> 
<span style="color: #008080;">161</span>   _destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">162</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid).remove();
</span><span style="color: #008080;">163</span>     domImplement($element, 'remove'<span style="color: #000000;">);
</span><span style="color: #008080;">164</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">165</span> 
<span style="color: #008080;">166</span>   destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">167</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._destory, 'onViewBeforeDestory', 'onViewAfterDestory', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">168</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">169</span> });</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="line-height: 1.5;">control这里便有所不同，会稍微复杂一点点</span></p>
<p>① 首先，他会验证自己是否含有view参数，我们这里要求一个控制器必须对应一个view，如果没有指定的话便认为错误</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">if</span> (!_.property('view')(options)) <span style="color: #0000ff;">throw</span> Error('view必须在实例化的时候传入ViewController');</pre>
</div>
<p>② 然后主要有几个关键事件点，第一个是create</p>
<p>PS：这里会区分是否二次创建该View，这个判断事实上不应该通过dom是否存在来判断，这里后期优化</p>
<p>create调用便会调用view的render方法，然后便会构建相关的dom结构，并且append到container中</p>
<p>③ 第二个关键事件点为show，调用时，dom会真正的显示，并且绑定事件</p>
<p>PS：事件这块借鉴的Backbone的机制，全部绑定值根元素，具体优化后面再说吧</p>
<p>④ 除此之外还有hide、forze（解除事件句柄，释放资源）、destroy等不详说了</p>
<p><img src="32636517357094.png" alt=""></p>
<p>说了这么多都是扯淡，我们下面以两个简单的例子做一次说明</p>
<h1><span style="line-height: 1.5;">实例说明</span></h1>
<h2><span style="line-height: 1.5;">MVC学习完整代码</span></h2>
<p><span style="color: #ff0000;"><strong><span style="line-height: 1.5;">有不对的地方请提出</span></strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('c15c0d57-0531-4b0e-bcde-11f82b169da7')"><img id="code_img_closed_c15c0d57-0531-4b0e-bcde-11f82b169da7" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_c15c0d57-0531-4b0e-bcde-11f82b169da7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c15c0d57-0531-4b0e-bcde-11f82b169da7',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_c15c0d57-0531-4b0e-bcde-11f82b169da7" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> "use strict"<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 本框架默认是以来于zepto。这里构建了基础的方法层,当用户使用其他框架时，可能需要复写这几个基础方法</span>
<span style="color: #008080;">  4</span> 
<span style="color: #008080;">  5</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 解析event参数的正则</span>
<span style="color: #008080;">  6</span> <span style="color: #0000ff;">var</span> delegateEventSplitter = /^(\S+)\s*(.*)$/<span style="color: #000000;">;
</span><span style="color: #008080;">  7</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Regular expression used to split event strings.</span>
<span style="color: #008080;">  8</span> <span style="color: #0000ff;">var</span> eventSplitter = /\s+/<span style="color: #000000;">;
</span><span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span> <span style="color: #008000;">//</span><span style="color: #008000;"> ----------------------------------------------------</span>
<span style="color: #008080;"> 11</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 从backbone中借鉴而来，用来多事件绑定的events</span>
<span style="color: #008080;"> 12</span> 
<span style="color: #008080;"> 13</span> <span style="color: #008000;">//</span><span style="color: #008000;"> Implement fancy features of the Events API such as multiple event</span>
<span style="color: #008080;"> 14</span> <span style="color: #008000;">//</span><span style="color: #008000;"> names `"change blur"` and jQuery-style event maps `{change: action}`</span>
<span style="color: #008080;"> 15</span> <span style="color: #008000;">//</span><span style="color: #008000;"> in terms of the existing API.</span>
<span style="color: #008080;"> 16</span> <span style="color: #0000ff;">var</span> eventoperator = <span style="color: #0000ff;">function</span><span style="color: #000000;">(obj, action, name, rest) {
</span><span style="color: #008080;"> 17</span>   <span style="color: #0000ff;">if</span> (!name) <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 18</span> 
<span style="color: #008080;"> 19</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> Handle event maps.</span>
<span style="color: #008080;"> 20</span>   <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> name === 'object'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 21</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> key <span style="color: #0000ff;">in</span><span style="color: #000000;"> name) {
</span><span style="color: #008080;"> 22</span> <span style="color: #000000;">      obj[action].apply(obj, [key, name[key]].concat(rest));
</span><span style="color: #008080;"> 23</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 24</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 25</span> <span style="color: #000000;">  }
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> Handle space separated event names.</span>
<span style="color: #008080;"> 28</span>   <span style="color: #0000ff;">if</span><span style="color: #000000;"> (eventSplitter.test(name)) {
</span><span style="color: #008080;"> 29</span>     <span style="color: #0000ff;">var</span> names =<span style="color: #000000;"> name.split(eventSplitter);
</span><span style="color: #008080;"> 30</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, length = names.length; i &lt; length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 31</span> <span style="color: #000000;">      obj[action].apply(obj, [names[i]].concat(rest));
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 33</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 34</span> <span style="color: #000000;">  }
</span><span style="color: #008080;"> 35</span> 
<span style="color: #008080;"> 36</span>   <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 37</span> <span style="color: #000000;">};
</span><span style="color: #008080;"> 38</span> <span style="color: #008000;">//</span><span style="color: #008000;"> ----------------------------------------------------</span>
<span style="color: #008080;"> 39</span> 
<span style="color: #008080;"> 40</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 默认使用zepto的事件委托机制</span>
<span style="color: #008080;"> 41</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> eventmethod(obj, action, name, callback, context, subobj) {
</span><span style="color: #008080;"> 42</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> _.bind(callback, context || this);</span>
<span style="color: #008080;"> 43</span> 
<span style="color: #008080;"> 44</span>   <span style="color: #0000ff;">var</span> delegate = <span style="color: #0000ff;">function</span><span style="color: #000000;">(target, eventName, eventCallback, subtarget) {
</span><span style="color: #008080;"> 45</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (subtarget) {
</span><span style="color: #008080;"> 46</span> <span style="color: #000000;">      target.on(eventName, subtarget, eventCallback);
</span><span style="color: #008080;"> 47</span>     }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 48</span> <span style="color: #000000;">      target.on(eventName, eventCallback);
</span><span style="color: #008080;"> 49</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 50</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 51</span> 
<span style="color: #008080;"> 52</span>   <span style="color: #0000ff;">var</span> undelegate = <span style="color: #0000ff;">function</span><span style="color: #000000;">(target, eventName, eventCallback, subtarget) {
</span><span style="color: #008080;"> 53</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (subtarget) {
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">      target.off(eventName, subtarget, eventCallback);
</span><span style="color: #008080;"> 55</span>     }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 56</span> <span style="color: #000000;">      target.off(eventName, eventCallback);
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 59</span> 
<span style="color: #008080;"> 60</span>   <span style="color: #0000ff;">var</span> trigger = <span style="color: #0000ff;">function</span><span style="color: #000000;">(target, eventName, subtarget) {
</span><span style="color: #008080;"> 61</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (subtarget) {
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">      target.find(subtarget).trigger(eventName);
</span><span style="color: #008080;"> 63</span>     }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">      target.trigger(eventName);
</span><span style="color: #008080;"> 65</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 66</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 67</span> 
<span style="color: #008080;"> 68</span>   <span style="color: #0000ff;">var</span> map =<span style="color: #000000;"> {
</span><span style="color: #008080;"> 69</span>     'on'<span style="color: #000000;">: delegate,
</span><span style="color: #008080;"> 70</span>     'bind'<span style="color: #000000;">: delegate,
</span><span style="color: #008080;"> 71</span>     'off'<span style="color: #000000;">: undelegate,
</span><span style="color: #008080;"> 72</span>     'unbind'<span style="color: #000000;">: undelegate,
</span><span style="color: #008080;"> 73</span>     'trigger'<span style="color: #000000;">: trigger
</span><span style="color: #008080;"> 74</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 75</span> 
<span style="color: #008080;"> 76</span>   <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isFunction(map[action])) {
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">    map[action](obj, name, callback, subobj);
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">  }
</span><span style="color: #008080;"> 79</span> 
<span style="color: #008080;"> 80</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 81</span> 
<span style="color: #008080;"> 82</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 选择器</span>
<span style="color: #008080;"> 83</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> selectDom(selector) {
</span><span style="color: #008080;"> 84</span>   <span style="color: #0000ff;">return</span><span style="color: #000000;"> $(selector);
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 86</span> 
<span style="color: #008080;"> 87</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> domImplement($element, action, context, param) {
</span><span style="color: #008080;"> 88</span>   <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isFunction($element[action]))
</span><span style="color: #008080;"> 89</span>     $element[action].apply(context ||<span style="color: #000000;"> $element, param);
</span><span style="color: #008080;"> 90</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 91</span> 
<span style="color: #008080;"> 92</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> createDom (html) {
</span><span style="color: #008080;"> 93</span>   <span style="color: #0000ff;">return</span><span style="color: #000000;"> $(html);
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 95</span> 
<span style="color: #008080;"> 96</span> <span style="color: #008000;">//</span><span style="color: #008000;"> --------------------------------------------------- //</span>
<span style="color: #008080;"> 97</span> <span style="color: #008000;">//</span><span style="color: #008000;"> ------------------华丽的分割线--------------------- //</span>
<span style="color: #008080;"> 98</span> 
<span style="color: #008080;"> 99</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 正式的声明Dalmatian框架的命名空间</span>
<span style="color: #008080;">100</span> <span style="color: #0000ff;">var</span> Dalmatian = Dalmatian ||<span style="color: #000000;"> {};
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span> <span style="color: #008000;">//</span><span style="color: #008000;"> @description 定义默认的template方法来自于underscore</span>
<span style="color: #008080;">103</span> Dalmatian.template =<span style="color: #000000;"> _.template;
</span><span style="color: #008080;">104</span> Dalmatian.View =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;">105</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;">106</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">107</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">108</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">109</span> 
<span style="color: #008080;">110</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">111</span> 
<span style="color: #008080;">112</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;">113</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">114</span> 
<span style="color: #008080;">115</span>     <span style="color: #0000ff;">var</span> DEFAULT_CONTAINER_TEMPLATE = '&lt;section class="view" id="&lt;%=viewid%&gt;"&gt;&lt;%=html%&gt;&lt;/section&gt;'<span style="color: #000000;">;
</span><span style="color: #008080;">116</span> 
<span style="color: #008080;">117</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description view状态机</span>
<span style="color: #008080;">118</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.statusSet = {};</span>
<span style="color: #008080;">119</span> 
<span style="color: #008080;">120</span>     <span style="color: #0000ff;">this</span>.defaultContainerTemplate =<span style="color: #000000;"> DEFAULT_CONTAINER_TEMPLATE;
</span><span style="color: #008080;">121</span> 
<span style="color: #008080;">122</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">123</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description template集合，根据status做template的map</span>
<span style="color: #008080;">124</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @example</span>
<span style="color: #008080;">125</span>     <span style="color: #008000;">//</span><span style="color: #008000;">    { 0: '&lt;ul&gt;&lt;%_.each(list, function(item){%&gt;&lt;li&gt;&lt;%=item.name%&gt;&lt;/li&gt;&lt;%});%&gt;&lt;/ul&gt;' }</span>
<span style="color: #008080;">126</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.templateSet = {};</span>
<span style="color: #008080;">127</span> 
<span style="color: #008080;">128</span>     <span style="color: #0000ff;">this</span>.viewid = _.uniqueId('dalmatian-view-'<span style="color: #000000;">);
</span><span style="color: #008080;">129</span> 
<span style="color: #008080;">130</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">131</span> 
<span style="color: #008080;">132</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">133</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">134</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">135</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">136</span> 
<span style="color: #008080;">137</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">138</span> 
<span style="color: #008080;">139</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通过模板和数据渲染具体的View</span>
<span style="color: #008080;">140</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} View的状态参数</span>
<span style="color: #008080;">141</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} 匹配View的数据格式的具体数据</span>
<span style="color: #008080;">142</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param callback {functiion} 执行完成之后的回调</span>
<span style="color: #008080;">143</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;">(status, data, callback) {
</span><span style="color: #008080;">144</span> 
<span style="color: #008080;">145</span>     <span style="color: #0000ff;">var</span> templateSelected = <span style="color: #0000ff;">this</span><span style="color: #000000;">.templateSet[status];
</span><span style="color: #008080;">146</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (templateSelected) {
</span><span style="color: #008080;">147</span> 
<span style="color: #008080;">148</span>       <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">149</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> @description 渲染view</span>
<span style="color: #008080;">150</span>         <span style="color: #0000ff;">var</span> templateFn =<span style="color: #000000;"> Dalmatian.template(templateSelected);
</span><span style="color: #008080;">151</span>         <span style="color: #0000ff;">this</span>.html =<span style="color: #000000;"> templateFn(data);
</span><span style="color: #008080;">152</span> 
<span style="color: #008080;">153</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> @description 在view外层加入外壳</span>
<span style="color: #008080;">154</span>         templateFn = Dalmatian.template(<span style="color: #0000ff;">this</span><span style="color: #000000;">.defaultContainerTemplate);
</span><span style="color: #008080;">155</span>         <span style="color: #0000ff;">this</span>.html =<span style="color: #000000;"> templateFn({
</span><span style="color: #008080;">156</span>           viewid: <span style="color: #0000ff;">this</span><span style="color: #000000;">.viewid,
</span><span style="color: #008080;">157</span>           html: <span style="color: #0000ff;">this</span><span style="color: #000000;">.html
</span><span style="color: #008080;">158</span> <span style="color: #000000;">        });
</span><span style="color: #008080;">159</span> 
<span style="color: #008080;">160</span>         <span style="color: #0000ff;">this</span>.currentStatus =<span style="color: #000000;"> status;
</span><span style="color: #008080;">161</span> 
<span style="color: #008080;">162</span>         _.callmethod(callback, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">163</span> 
<span style="color: #008080;">164</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">165</span> 
<span style="color: #008080;">166</span>       } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">167</span> 
<span style="color: #008080;">168</span>         <span style="color: #0000ff;">throw</span><span style="color: #000000;"> e;
</span><span style="color: #008080;">169</span> 
<span style="color: #008080;">170</span>       } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">171</span> 
<span style="color: #008080;">172</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">173</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">174</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">175</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">176</span> 
<span style="color: #008080;">177</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">178</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可以被复写，当status和data分别发生变化时候</span>
<span style="color: #008080;">179</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param status {enum} view的状态值</span>
<span style="color: #008080;">180</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @param data {object} viewmodel的数据</span>
<span style="color: #008080;">181</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;">(status, data) {
</span><span style="color: #008080;">182</span> 
<span style="color: #008080;">183</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #0000ff;">this</span>.currentStatus || <span style="color: #0000ff;">this</span>.currentStatus !==<span style="color: #000000;"> status) {
</span><span style="color: #008080;">184</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.render(status, data);
</span><span style="color: #008080;">185</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">186</span> 
<span style="color: #008080;">187</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">188</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 可复写部分，当数据发生变化但是状态没有发生变化时，页面仅仅变化的可以是局部显示</span>
<span style="color: #008080;">189</span>     <span style="color: #008000;">//</span><span style="color: #008000;">              可以通过获取this.html进行修改</span>
<span style="color: #008080;">190</span>     _.callmethod(<span style="color: #0000ff;">this</span>.onUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">191</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">192</span> <span style="color: #000000;">});
</span><span style="color: #008080;">193</span> 
<span style="color: #008080;">194</span> Dalmatian.Adapter =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;">195</span> 
<span style="color: #008080;">196</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;">197</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">198</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">199</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">200</span> 
<span style="color: #008080;">201</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">202</span> 
<span style="color: #008080;">203</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置默认属性</span>
<span style="color: #008080;">204</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">205</span>     <span style="color: #0000ff;">this</span>.observers =<span style="color: #000000;"> [];
</span><span style="color: #008080;">206</span>     <span style="color: #0000ff;">this</span>.viewmodel =<span style="color: #000000;"> {};
</span><span style="color: #008080;">207</span>     <span style="color: #0000ff;">this</span>.datamodel =<span style="color: #000000;"> {};
</span><span style="color: #008080;">208</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">209</span> 
<span style="color: #008080;">210</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">211</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;">(options) {
</span><span style="color: #008080;">212</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">213</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">214</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">215</span> 
<span style="color: #008080;">216</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 设置</span>
<span style="color: #008080;">217</span>   format: <span style="color: #0000ff;">function</span><span style="color: #000000;">(origindata){
</span><span style="color: #008080;">218</span>     <span style="color: #0000ff;">this</span>.datamodel =<span style="color: #000000;"> origindata;
</span><span style="color: #008080;">219</span>     <span style="color: #0000ff;">this</span>.viewmodel = <span style="color: #0000ff;">this</span><span style="color: #000000;">.parse(origindata);
</span><span style="color: #008080;">220</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.viewmodel;
</span><span style="color: #008080;">221</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">222</span> 
<span style="color: #008080;">223</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @override</span>
<span style="color: #008080;">224</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description parse方法用来将datamodel转化为viewmodel，必须被重写</span>
<span style="color: #008080;">225</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;">(origindata) {
</span><span style="color: #008080;">226</span>     <span style="color: #0000ff;">throw</span> Error('方法必须被重写'<span style="color: #000000;">);
</span><span style="color: #008080;">227</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">228</span> 
<span style="color: #008080;">229</span>   registerObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">230</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 检查队列中如果没有viewcontroller，从队列尾部推入</span>
<span style="color: #008080;">231</span>     <span style="color: #0000ff;">if</span> (!_.contains(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller)) {
</span><span style="color: #008080;">232</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.observers.push(viewcontroller);
</span><span style="color: #008080;">233</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">234</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">235</span> 
<span style="color: #008080;">236</span>   unregisterObserver: <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">237</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从observers的队列中剔除viewcontroller</span>
<span style="color: #008080;">238</span>     <span style="color: #0000ff;">this</span>.observers = _.without(<span style="color: #0000ff;">this</span><span style="color: #000000;">.observers, viewcontroller);
</span><span style="color: #008080;">239</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">240</span> 
<span style="color: #008080;">241</span>   notifyDataChanged: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">242</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 通知所有注册的观察者被观察者的数据发生变化</span>
<span style="color: #008080;">243</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span>.format(<span style="color: #0000ff;">this</span><span style="color: #000000;">.datamodel);
</span><span style="color: #008080;">244</span>     _.each(<span style="color: #0000ff;">this</span>.observers, <span style="color: #0000ff;">function</span><span style="color: #000000;">(viewcontroller) {
</span><span style="color: #008080;">245</span>       <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isObject(viewcontroller))
</span><span style="color: #008080;">246</span> <span style="color: #000000;">        _.callmethod(viewcontroller.update, viewcontroller, [data]);
</span><span style="color: #008080;">247</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">248</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">249</span> <span style="color: #000000;">});
</span><span style="color: #008080;">250</span> 
<span style="color: #008080;">251</span> Dalmatian.ViewController =<span style="color: #000000;"> _.inherit({
</span><span style="color: #008080;">252</span> 
<span style="color: #008080;">253</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 构造函数入口</span>
<span style="color: #008080;">254</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">255</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.handleOptions(options);
</span><span style="color: #008080;">256</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.create();
</span><span style="color: #008080;">257</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">258</span> 
<span style="color: #008080;">259</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 操作构造函数传入操作</span>
<span style="color: #008080;">260</span>   handleOptions: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">261</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._verify(options);
</span><span style="color: #008080;">262</span> 
<span style="color: #008080;">263</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 从形参中获取key和value绑定在this上</span>
<span style="color: #008080;">264</span>     <span style="color: #0000ff;">if</span> (_.isObject(options)) _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">, options);
</span><span style="color: #008080;">265</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">266</span> 
<span style="color: #008080;">267</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 验证参数</span>
<span style="color: #008080;">268</span>   _verify: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">269</span>     <span style="color: #0000ff;">if</span> (!_.property('view')(options)) <span style="color: #0000ff;">throw</span> Error('view必须在实例化的时候传入ViewController'<span style="color: #000000;">);
</span><span style="color: #008080;">270</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">271</span> 
<span style="color: #008080;">272</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 当数据发生变化时调用onViewUpdate，如果onViewUpdate方法不存在的话，直接调用render方法重绘</span>
<span style="color: #008080;">273</span>   update: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;">274</span> 
<span style="color: #008080;">275</span>     _.callmethod(<span style="color: #0000ff;">this</span>.hide, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">276</span> 
<span style="color: #008080;">277</span>     <span style="color: #0000ff;">if</span> (!_.callmethod(<span style="color: #0000ff;">this</span>.onViewUpdate, <span style="color: #0000ff;">this</span><span style="color: #000000;">, [data])) {
</span><span style="color: #008080;">278</span>       <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;">279</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">280</span> 
<span style="color: #008080;">281</span>     _.callmethod(<span style="color: #0000ff;">this</span>.show, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">282</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">283</span> 
<span style="color: #008080;">284</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">285</span> <span style="color: #008000;">  * @description 传入事件对象，解析之，解析event，返回对象{events: [{target: '#btn', event:'click', callback: handler}]}
</span><span style="color: #008080;">286</span> <span style="color: #008000;">  * @param events {obj} 事件对象，默认传入唯一id
</span><span style="color: #008080;">287</span> <span style="color: #008000;">  * @param namespace 事件命名空间
</span><span style="color: #008080;">288</span> <span style="color: #008000;">  * @return {obj}
</span><span style="color: #008080;">289</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">290</span>   parseEvents: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (events) {
</span><span style="color: #008080;">291</span> 
<span style="color: #008080;">292</span>     <span style="color: #008000;">//</span><span style="color: #008000;">用于返回的事件对象</span>
<span style="color: #008080;">293</span>     <span style="color: #0000ff;">var</span> eventArr =<span style="color: #000000;"> [];
</span><span style="color: #008080;">294</span>     <span style="color: #008000;">//</span><span style="color: #008000;">注意，此处做简单的字符串数据解析即可，不做实际业务</span>
<span style="color: #008080;">295</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> key <span style="color: #0000ff;">in</span><span style="color: #000000;"> events) {
</span><span style="color: #008080;">296</span>       <span style="color: #0000ff;">var</span> method =<span style="color: #000000;"> events[key];
</span><span style="color: #008080;">297</span>       <span style="color: #0000ff;">if</span> (!_.isFunction(method)) method = <span style="color: #0000ff;">this</span><span style="color: #000000;">[events[key]];
</span><span style="color: #008080;">298</span>       <span style="color: #0000ff;">if</span> (!method) <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
</span><span style="color: #008080;">299</span> 
<span style="color: #008080;">300</span>       <span style="color: #0000ff;">var</span> match =<span style="color: #000000;"> key.match(delegateEventSplitter);
</span><span style="color: #008080;">301</span>       <span style="color: #0000ff;">var</span> eventName = match[1<span style="color: #000000;">],
</span><span style="color: #008080;">302</span>         selector = match[2<span style="color: #000000;">];
</span><span style="color: #008080;">303</span>       method = _.bind(method, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">304</span>       eventName += '.delegateEvents' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid;
</span><span style="color: #008080;">305</span> <span style="color: #000000;">      eventArr.push({
</span><span style="color: #008080;">306</span> <span style="color: #000000;">        target: selector,
</span><span style="color: #008080;">307</span> <span style="color: #000000;">        event: eventName,
</span><span style="color: #008080;">308</span> <span style="color: #000000;">        callback: method
</span><span style="color: #008080;">309</span> <span style="color: #000000;">      });
</span><span style="color: #008080;">310</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">311</span> 
<span style="color: #008080;">312</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> eventArr;
</span><span style="color: #008080;">313</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">314</span> 
<span style="color: #008080;">315</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">316</span> <span style="color: #008000;">   * @override
</span><span style="color: #008080;">317</span> <span style="color: #008000;">   *
</span><span style="color: #008080;">318</span>    <span style="color: #008000;">*/</span>
<span style="color: #008080;">319</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">320</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation  这个方法需要被复写</span>
<span style="color: #008080;">321</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> var data = this.adapter.format(this.origindata);</span>
<span style="color: #008080;">322</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> this.view.render(this.viewstatus, data);</span>
<span style="color: #008080;">323</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">324</span> 
<span style="color: #008080;">325</span>   _create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">326</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.render();
</span><span style="color: #008080;">327</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">328</span> 
<span style="color: #008080;">329</span>   create: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">330</span> 
<span style="color: #008080;">331</span>     <span style="color: #0000ff;">var</span> $element = selectDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">332</span>     <span style="color: #0000ff;">if</span> (domImplement($element, 'get', <span style="color: #0000ff;">false</span>, [0<span style="color: #000000;">])) {
</span><span style="color: #008080;">333</span>       <span style="color: #0000ff;">return</span> _.callmethod(<span style="color: #0000ff;">this</span>.recreate, <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">334</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">335</span> 
<span style="color: #008080;">336</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 在create方法调用前后设置onViewBeforeCreate和onViewAfterCreate两个回调</span>
<span style="color: #008080;">337</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._create, 'onViewBeforeCreate', 'onViewAfterCreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">338</span> 
<span style="color: #008080;">339</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">340</span> 
<span style="color: #008080;">341</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">342</span> <span style="color: #008000;">  * @description 如果进入create判断是否需要update一下页面，sync view和viewcontroller的数据
</span><span style="color: #008080;">343</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">344</span>   _recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">345</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.update();
</span><span style="color: #008080;">346</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">347</span> 
<span style="color: #008080;">348</span>   recreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">349</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._recreate, 'onViewBeforeRecreate', 'onViewAfterRecreate', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">350</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">351</span> 
<span style="color: #008080;">352</span>   _bind: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">353</span>     <span style="color: #0000ff;">this</span>.viewcontent = createDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.view.html);
</span><span style="color: #008080;">354</span> 
<span style="color: #008080;">355</span>     <span style="color: #0000ff;">var</span> eventsList = <span style="color: #0000ff;">this</span>.parseEvents(<span style="color: #0000ff;">this</span><span style="color: #000000;">.events);
</span><span style="color: #008080;">356</span> 
<span style="color: #008080;">357</span>     <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">358</span>     _.each(eventsList, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (item) {
</span><span style="color: #008080;">359</span> 
<span style="color: #008080;">360</span>       <span style="color: #0000ff;">if</span> (item.target === ''<span style="color: #000000;">) {
</span><span style="color: #008080;">361</span>         eventmethod(scope.viewcontent, 'on'<span style="color: #000000;">, item.event, item.callback, scope);
</span><span style="color: #008080;">362</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">363</span>         eventmethod(scope.viewcontent, 'on'<span style="color: #000000;">, item.event, item.callback, scope, item.target);
</span><span style="color: #008080;">364</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">365</span> 
<span style="color: #008080;">366</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">367</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">368</span> 
<span style="color: #008080;">369</span>   bind: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">370</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._bind, 'onViewBeforeBind', 'onViewAfterBind', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">371</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">372</span> 
<span style="color: #008080;">373</span>   _show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">374</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">375</span> 
<span style="color: #008080;">376</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @notation 需要剔除码？</span>
<span style="color: #008080;">377</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> if ((!$element || $element.length === 0) &amp;&amp; this.viewcontent) {</span>
<span style="color: #008080;">378</span>       <span style="color: #0000ff;">var</span> $container = selectDom(<span style="color: #0000ff;">this</span><span style="color: #000000;">.container);
</span><span style="color: #008080;">379</span>       domImplement($container, 'html', <span style="color: #0000ff;">false</span>, [<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewcontent]);
</span><span style="color: #008080;">380</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> }</span>
<span style="color: #008080;">381</span> 
<span style="color: #008080;">382</span>     domImplement($element, 'show'<span style="color: #000000;">);
</span><span style="color: #008080;">383</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">384</span> 
<span style="color: #008080;">385</span>   show: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">386</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.bind();
</span><span style="color: #008080;">387</span> 
<span style="color: #008080;">388</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._show, 'onViewBeforeShow', 'onViewAfterShow', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">389</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">390</span> 
<span style="color: #008080;">391</span>   _hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">392</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">393</span>     domImplement($element, 'hide'<span style="color: #000000;">);
</span><span style="color: #008080;">394</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">395</span> 
<span style="color: #008080;">396</span>   hide: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">397</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._hide, 'onViewBeforeHide', 'onViewAfterHide', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">398</span> 
<span style="color: #008080;">399</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.forze();
</span><span style="color: #008080;">400</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">401</span> 
<span style="color: #008080;">402</span>   _forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">403</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid);
</span><span style="color: #008080;">404</span>     domImplement($element, 'off'<span style="color: #000000;">);
</span><span style="color: #008080;">405</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">406</span> 
<span style="color: #008080;">407</span>   forze: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">408</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._forze, 'onViewBeforeForzen', 'onViewAfterForzen', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">409</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">410</span> 
<span style="color: #008080;">411</span>   _destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">412</span>     <span style="color: #0000ff;">var</span> $element = selectDom('#' + <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.viewid).remove();
</span><span style="color: #008080;">413</span>     domImplement($element, 'remove'<span style="color: #000000;">);
</span><span style="color: #008080;">414</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">415</span> 
<span style="color: #008080;">416</span>   destory: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">417</span>     _.wrapmethod(<span style="color: #0000ff;">this</span>._destory, 'onViewBeforeDestory', 'onViewAfterDestory', <span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">418</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">419</span> });</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3>underscore扩展</h3>
<div class="cnblogs_code" onclick="cnblogs_code_show('0dc464ff-18aa-4747-85df-e80fb2708cb8')"><img id="code_img_closed_0dc464ff-18aa-4747-85df-e80fb2708cb8" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_0dc464ff-18aa-4747-85df-e80fb2708cb8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0dc464ff-18aa-4747-85df-e80fb2708cb8',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_0dc464ff-18aa-4747-85df-e80fb2708cb8" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> (<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 全局可能用到的变量</span>
<span style="color: #008080;">  4</span>   <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [];
</span><span style="color: #008080;">  5</span>   <span style="color: #0000ff;">var</span> slice =<span style="color: #000000;"> arr.slice;
</span><span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span>   <span style="color: #0000ff;">var</span> method = method ||<span style="color: #000000;"> {};
</span><span style="color: #008080;">  8</span> 
<span style="color: #008080;">  9</span> 
<span style="color: #008080;"> 10</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 11</span> <span style="color: #008000;">  * @description inherit方法，js的继承，默认为两个参数
</span><span style="color: #008080;"> 12</span> <span style="color: #008000;">  * @param {function} supClass 可选，要继承的类
</span><span style="color: #008080;"> 13</span> <span style="color: #008000;">  * @param {object} subProperty 被创建类的成员
</span><span style="color: #008080;"> 14</span> <span style="color: #008000;">  * @return {function} 被创建的类
</span><span style="color: #008080;"> 15</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 16</span>   method.inherit = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 17</span> 
<span style="color: #008080;"> 18</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 参数检测，该继承方法，只支持一个参数创建类，或者两个参数继承类</span>
<span style="color: #008080;"> 19</span>     <span style="color: #0000ff;">if</span> (arguments.length === 0 || arguments.length &gt; 2) <span style="color: #0000ff;">throw</span> '参数错误'<span style="color: #000000;">;
</span><span style="color: #008080;"> 20</span> 
<span style="color: #008080;"> 21</span>     <span style="color: #0000ff;">var</span> parent = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 22</span> 
<span style="color: #008080;"> 23</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 将参数转换为数组</span>
<span style="color: #008080;"> 24</span>     <span style="color: #0000ff;">var</span> properties =<span style="color: #000000;"> slice.call(arguments);
</span><span style="color: #008080;"> 25</span> 
<span style="color: #008080;"> 26</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 如果第一个参数为类（function），那么就将之取出</span>
<span style="color: #008080;"> 27</span>     <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> properties[0] === 'function'<span style="color: #000000;">)
</span><span style="color: #008080;"> 28</span>       parent =<span style="color: #000000;"> properties.shift();
</span><span style="color: #008080;"> 29</span>     properties = properties[0<span style="color: #000000;">];
</span><span style="color: #008080;"> 30</span> 
<span style="color: #008080;"> 31</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> @description 创建新类用于返回</span>
<span style="color: #008080;"> 32</span>     <span style="color: #0000ff;">function</span><span style="color: #000000;"> klass() {
</span><span style="color: #008080;"> 33</span>       <span style="color: #0000ff;">if</span> (_.isFunction(<span style="color: #0000ff;">this</span><span style="color: #000000;">.initialize))
</span><span style="color: #008080;"> 34</span>         <span style="color: #0000ff;">this</span>.initialize.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, arguments);
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 36</span> 
<span style="color: #008080;"> 37</span>     klass.superclass =<span style="color: #000000;"> parent;
</span><span style="color: #008080;"> 38</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses = [];</span>
<span style="color: #008080;"> 39</span> 
<span style="color: #008080;"> 40</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (parent) {
</span><span style="color: #008080;"> 41</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> @description 中间过渡类，防止parent的构造函数被执行</span>
<span style="color: #008080;"> 42</span>       <span style="color: #0000ff;">var</span> subclass = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 43</span>       subclass.prototype =<span style="color: #000000;"> parent.prototype;
</span><span style="color: #008080;"> 44</span>       klass.prototype = <span style="color: #0000ff;">new</span><span style="color: #000000;"> subclass();
</span><span style="color: #008080;"> 45</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> parent.subclasses.push(klass);</span>
<span style="color: #008080;"> 46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 47</span> 
<span style="color: #008080;"> 48</span>     <span style="color: #0000ff;">var</span> ancestor = klass.superclass &amp;&amp;<span style="color: #000000;"> klass.superclass.prototype;
</span><span style="color: #008080;"> 49</span>     <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> properties) {
</span><span style="color: #008080;"> 50</span>       <span style="color: #0000ff;">var</span> value =<span style="color: #000000;"> properties[k];
</span><span style="color: #008080;"> 51</span> 
<span style="color: #008080;"> 52</span>       <span style="color: #008000;">//</span><span style="color: #008000;">满足条件就重写</span>
<span style="color: #008080;"> 53</span>       <span style="color: #0000ff;">if</span> (ancestor &amp;&amp; <span style="color: #0000ff;">typeof</span> value == 'function'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 54</span>         <span style="color: #0000ff;">var</span> argslist = /^\s*function\s*\(([^\(\)]*?)\)\s*?\{/i.exec(value.toString())[1].replace(/\s/i, '').split(','<span style="color: #000000;">);
</span><span style="color: #008080;"> 55</span>         <span style="color: #008000;">//</span><span style="color: #008000;">只有在第一个参数为$super情况下才需要处理（是否具有重复方法需要用户自己决定）</span>
<span style="color: #008080;"> 56</span>         <span style="color: #0000ff;">if</span> (argslist[0] === '$super' &amp;&amp;<span style="color: #000000;"> ancestor[k]) {
</span><span style="color: #008080;"> 57</span>           value = (<span style="color: #0000ff;">function</span><span style="color: #000000;"> (methodName, fn) {
</span><span style="color: #008080;"> 58</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 59</span>               <span style="color: #0000ff;">var</span> scope = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 60</span>               <span style="color: #0000ff;">var</span> args = [<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 61</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> ancestor[methodName].apply(scope, arguments);
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">              } ];
</span><span style="color: #008080;"> 63</span>               <span style="color: #0000ff;">return</span> fn.apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, args.concat(slice.call(arguments)));
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">            };
</span><span style="color: #008080;"> 65</span> <span style="color: #000000;">          })(k, value);
</span><span style="color: #008080;"> 66</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 67</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 68</span> 
<span style="color: #008080;"> 69</span>       <span style="color: #008000;">//</span><span style="color: #008000;">此处对对象进行扩展，当前原型链已经存在该对象，便进行扩展</span>
<span style="color: #008080;"> 70</span>       <span style="color: #0000ff;">if</span> (_.isObject(klass.prototype[k]) &amp;&amp; _.isObject(value) &amp;&amp; (<span style="color: #0000ff;">typeof</span> klass.prototype[k] != 'function' &amp;&amp; <span style="color: #0000ff;">typeof</span> value != 'fuction'<span style="color: #000000;">)) {
</span><span style="color: #008080;"> 71</span>         <span style="color: #008000;">//</span><span style="color: #008000;">原型链是共享的，这里不好办</span>
<span style="color: #008080;"> 72</span>         <span style="color: #0000ff;">var</span> temp =<span style="color: #000000;"> {};
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">        _.extend(temp, klass.prototype[k]);
</span><span style="color: #008080;"> 74</span> <span style="color: #000000;">        _.extend(temp, value);
</span><span style="color: #008080;"> 75</span>         klass.prototype[k] =<span style="color: #000000;"> temp;
</span><span style="color: #008080;"> 76</span>       } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 77</span>         klass.prototype[k] =<span style="color: #000000;"> value;
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">      }
</span><span style="color: #008080;"> 79</span> 
<span style="color: #008080;"> 80</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 81</span> 
<span style="color: #008080;"> 82</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">klass.prototype.initialize)
</span><span style="color: #008080;"> 83</span>       klass.prototype.initialize = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 84</span> 
<span style="color: #008080;"> 85</span>     klass.prototype.constructor =<span style="color: #000000;"> klass;
</span><span style="color: #008080;"> 86</span> 
<span style="color: #008080;"> 87</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> klass;
</span><span style="color: #008080;"> 88</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 89</span> 
<span style="color: #008080;"> 90</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> @description 返回需要的函数</span>
<span style="color: #008080;"> 91</span>   method.getNeedFn = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, scope) {
</span><span style="color: #008080;"> 92</span>     scope = scope ||<span style="color: #000000;"> window;
</span><span style="color: #008080;"> 93</span>     <span style="color: #0000ff;">if</span> (_.isFunction(key)) <span style="color: #0000ff;">return</span><span style="color: #000000;"> key;
</span><span style="color: #008080;"> 94</span>     <span style="color: #0000ff;">if</span> (_.isFunction(scope[key])) <span style="color: #0000ff;">return</span><span style="color: #000000;"> scope[key];
</span><span style="color: #008080;"> 95</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> () { };
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">  };
</span><span style="color: #008080;"> 97</span> 
<span style="color: #008080;"> 98</span>   method.callmethod = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (method, scope, params) {
</span><span style="color: #008080;"> 99</span>     scope = scope || <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">100</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;"> (_.isFunction(method)) {
</span><span style="color: #008080;">101</span> <span style="color: #000000;">      method.apply(scope, params);
</span><span style="color: #008080;">102</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">103</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">104</span> 
<span style="color: #008080;">105</span>     <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">106</span> <span style="color: #000000;">  };
</span><span style="color: #008080;">107</span> 
<span style="color: #008080;">108</span>   <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">109</span> <span style="color: #008000;">  * @description 在fn方法的前后通过键值设置两个传入的回调
</span><span style="color: #008080;">110</span> <span style="color: #008000;">  * @param fn {function} 调用的方法
</span><span style="color: #008080;">111</span> <span style="color: #008000;">  * @param beforeFnKey {string} 从context对象中获得的函数指针的键值，该函数在fn前执行
</span><span style="color: #008080;">112</span> <span style="color: #008000;">  * @param afterFnKey {string} 从context对象中获得的函数指针的键值，该函数在fn后执行
</span><span style="color: #008080;">113</span> <span style="color: #008000;">  * @param context {object} 执行环节的上下文
</span><span style="color: #008080;">114</span> <span style="color: #008000;">  * @return {function}
</span><span style="color: #008080;">115</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">116</span>   method.wrapmethod = method.insert = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (fn, beforeFnKey, afterFnKey, context) {
</span><span style="color: #008080;">117</span> 
<span style="color: #008080;">118</span>     <span style="color: #0000ff;">var</span> scope = context || <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">119</span>     <span style="color: #0000ff;">var</span> action = _.wrap(fn, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (func) {
</span><span style="color: #008080;">120</span> 
<span style="color: #008080;">121</span> <span style="color: #000000;">      _.callmethod(_.getNeedFn(beforeFnKey, scope), scope);
</span><span style="color: #008080;">122</span> 
<span style="color: #008080;">123</span> <span style="color: #000000;">      func.call(scope);
</span><span style="color: #008080;">124</span> 
<span style="color: #008080;">125</span> <span style="color: #000000;">      _.callmethod(_.getNeedFn(afterFnKey, scope), scope);
</span><span style="color: #008080;">126</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">127</span> 
<span style="color: #008080;">128</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> _.callmethod(action, scope);
</span><span style="color: #008080;">129</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">130</span> 
<span style="color: #008080;">131</span> 
<span style="color: #008080;">132</span> <span style="color: #000000;">  _.extend(_, method);
</span><span style="color: #008080;">133</span> 
<span style="color: #008080;">134</span> })(window);</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2><span style="line-height: 1.5;">简单alert框</span></h2>
<p><span style="line-height: 1.5;">首先我们来做一个简单的alert框，这个框在我们点击界面时候弹出一个提示，提示文字由文本框给出</span></p>
<p><span style="line-height: 1.5;">第一步便是简单的HTML了</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('9fcf64f3-29b1-42ba-bcf3-d39d7a66fa1a')"><img id="code_img_closed_9fcf64f3-29b1-42ba-bcf3-d39d7a66fa1a" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_9fcf64f3-29b1-42ba-bcf3-d39d7a66fa1a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9fcf64f3-29b1-42ba-bcf3-d39d7a66fa1a',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_9fcf64f3-29b1-42ba-bcf3-d39d7a66fa1a" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">doctype html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>ToDoList<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/css/flat-ui.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="../style/main.css"</span><span style="color: #ff0000;"> rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">10</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #800000;">  .cui-alert </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> auto</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> position</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> static</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #800000;">  .txt </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> #cfcfcf 1px solid</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 80%</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;">13</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="addmsg"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="txt"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">19</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="addbtn"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="btn"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">20</span>     show message<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">21</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-alert"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">22</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> cui-alert</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">23</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-pop-box</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">24</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-bd</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">25</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">p class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-error-tips</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">content</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">p&gt;</span>
<span style="color: #008080;">26</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-roller-btns</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">27</span>               <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-flexbd cui-btns-cancel</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">cancel</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">28</span>               <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui-flexbd cui-btns-sure</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">confirm</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">29</span>             <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">30</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">31</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">32</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">33</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">34</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/underscore-min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">35</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/zepto.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">36</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/underscore.extend.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">37</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/mvc.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">38</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="ui.alert.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">39</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">40</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>因为该插件本身比较简单，不存在状态值便会，所以view定义如此即可</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> htmltemplate = $('#template-alert'<span style="color: #000000;">).html();
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">var</span> AlertView =<span style="color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">  templateSet: {
</span><span style="color: #008080;"> 5</span>     0<span style="color: #000000;">: htmltemplate
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #000000;">  statusSet: {
</span><span style="color: #008080;"> 9</span>     STATUS_INIT: 0
<span style="color: #008080;">10</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">11</span> });</pre>
</div>
<p>Adapter也比较简单</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">var</span> Adapter =<span style="color: #000000;"> _.inherit(Dalmatian.Adapter, {
  parse: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
  }
});</span></pre>
</div>
<p>现在重点便是controller了</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> Controller =<span style="color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;"> 2</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.viewmodel;
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewstatus, data);
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>   set: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">this</span>.adapter.datamodel.content =<span style="color: #000000;"> options.content;
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.notifyDataChanged();
</span><span style="color: #008080;">10</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #000000;">  events: {
</span><span style="color: #008080;">13</span>     "click .cui-btns-cancel": "cancelaction"
<span style="color: #008080;">14</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>   cancelaction: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.onCancelBtnClick();
</span><span style="color: #008080;">18</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>   attr: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (key, value) {
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">this</span>[key] =<span style="color: #000000;"> value;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">23</span> });</pre>
</div>
<p>这里有个不一样的地方便是，这里有一个Adapter的set方法，set之后会改变其状态，这里会发生一次通知view更新的动作</p>
<p>最后我们将之串联起来</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AlertView()
</span><span style="color: #0000ff;">var</span> adapter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Adapter();
</span><span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller({
  view: view,
  adapter: adapter,
  container: </span>'.container'<span style="color: #000000;">,
  onViewBeforeCreate: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {

    </span><span style="color: #0000ff;">var</span> origindata =<span style="color: #000000;"> {
      content: </span>'fuck'<span style="color: #000000;">,
      confirm: </span>'confirmbtn'<span style="color: #000000;">,
      cancel: </span>'cancelbtn'<span style="color: #000000;">
    }

    </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.format(origindata);

    </span><span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
    </span><span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.statusSet.STATUS_INIT;
  },
  onCancelBtnClick: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    alert(</span>'cancel 2'<span style="color: #000000;">)
  }
});</span></pre>
</div>
<p>然后我们写一段业务代码</p>
<div class="cnblogs_code">
<pre><span style="color: #008080;">1</span> $('#addbtn').on('click', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">2</span>   <span style="color: #0000ff;">var</span> content = $('#addmsg'<span style="color: #000000;">).val();
</span><span style="color: #008080;">3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> adapter.datamodel.content = content;</span>
<span style="color: #008080;">4</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> adapter.notifyDataChanged();</span>
<span style="color: #008080;">5</span> <span style="color: #000000;">  controller.set({ content: content });
</span><span style="color: #008080;">6</span> <span style="color: #000000;">  controller.show();
</span><span style="color: #008080;">7</span> });</pre>
</div>
<p>基本完成我们的操作了</p>
<p><img src="42426928977488.png" alt="">&nbsp;</p>
<p><img src="3600668341101.png" alt=""></p>
<p>事实上，我对这段代码并不是十分满意，于是，我们这里做一次简单重构：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('d25d97b5-a27a-4fb0-948a-6fb02cf4520c')"><img id="code_img_closed_d25d97b5-a27a-4fb0-948a-6fb02cf4520c" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_d25d97b5-a27a-4fb0-948a-6fb02cf4520c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d25d97b5-a27a-4fb0-948a-6fb02cf4520c',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_d25d97b5-a27a-4fb0-948a-6fb02cf4520c" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> htmltemplate = $('#template-alert'<span style="color: #000000;">).html();
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">var</span> AlertView =<span style="color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">  templateSet: {
</span><span style="color: #008080;"> 5</span>     0<span style="color: #000000;">: htmltemplate
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 7</span>   
<span style="color: #008080;"> 8</span> <span style="color: #000000;">  statusSet: {
</span><span style="color: #008080;"> 9</span>     STATUS_INIT: 0
<span style="color: #008080;">10</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">11</span> <span style="color: #000000;">});
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #0000ff;">var</span> Adapter =<span style="color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;">15</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">18</span> <span style="color: #000000;">});
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span> <span style="color: #0000ff;">var</span> Controller =<span style="color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;">21</span>   <span style="color: #008000;">//</span><span style="color: #008000;">设置默认信息</span>
<span style="color: #008080;">22</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">23</span>     <span style="color: #0000ff;">this</span>.origindata =<span style="color: #000000;"> {
</span><span style="color: #008080;">24</span>       content: ''<span style="color: #000000;">,
</span><span style="color: #008080;">25</span>       confirm: '确定'<span style="color: #000000;">,
</span><span style="color: #008080;">26</span>       cancel: '取消'
<span style="color: #008080;">27</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">28</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> ($super, opts) {
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    $super(opts);
</span><span style="color: #008080;">33</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._init();
</span><span style="color: #008080;">34</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span>   <span style="color: #008000;">//</span><span style="color: #008000;">基础数据处理</span>
<span style="color: #008080;">37</span>   _init: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">this</span>.adapter.format(<span style="color: #0000ff;">this</span><span style="color: #000000;">.origindata);
</span><span style="color: #008080;">39</span>     <span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">40</span>     <span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.statusSet.STATUS_INIT;
</span><span style="color: #008080;">41</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">44</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.viewmodel;
</span><span style="color: #008080;">45</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewstatus, data);
</span><span style="color: #008080;">46</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">47</span> 
<span style="color: #008080;">48</span>   set: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (options) {
</span><span style="color: #008080;">49</span>     _.extend(<span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.datamodel, options);
</span><span style="color: #008080;">50</span> <span style="color: #008000;">//</span><span style="color: #008000;">    this.adapter.datamodel.content = options.content;</span>
<span style="color: #008080;">51</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.notifyDataChanged();
</span><span style="color: #008080;">52</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">53</span> 
<span style="color: #008080;">54</span> <span style="color: #000000;">  events: {
</span><span style="color: #008080;">55</span>     "click .cui-btns-cancel": "cancelaction"
<span style="color: #008080;">56</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span>   cancelaction: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">59</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.onCancelBtnClick();
</span><span style="color: #008080;">60</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">61</span> <span style="color: #000000;">});
</span><span style="color: #008080;">62</span> 
<span style="color: #008080;">63</span> <span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> AlertView()
</span><span style="color: #008080;">64</span> <span style="color: #0000ff;">var</span> adapter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Adapter();
</span><span style="color: #008080;">65</span> 
<span style="color: #008080;">66</span> <span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller({
</span><span style="color: #008080;">67</span> <span style="color: #000000;">  view: view,
</span><span style="color: #008080;">68</span> <span style="color: #000000;">  adapter: adapter,
</span><span style="color: #008080;">69</span>   container: '.container'<span style="color: #000000;">,
</span><span style="color: #008080;">70</span>   onCancelBtnClick: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">71</span>     alert('cancel 2'<span style="color: #000000;">)
</span><span style="color: #008080;">72</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">73</span> <span style="color: #000000;">});
</span><span style="color: #008080;">74</span> 
<span style="color: #008080;">75</span> $('#addbtn').on('click', <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">76</span>   <span style="color: #0000ff;">var</span> content = $('#addmsg'<span style="color: #000000;">).val();
</span><span style="color: #008080;">77</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> adapter.datamodel.content = content;</span>
<span style="color: #008080;">78</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> adapter.notifyDataChanged();</span>
<span style="color: #008080;">79</span>   controller.set({ content: content, confirm: '确定1'<span style="color: #000000;"> });
</span><span style="color: #008080;">80</span> <span style="color: #000000;">  controller.show();
</span><span style="color: #008080;">81</span> });</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>这个例子结束后，我们来写另一个例子</p>
<h2>todolist</h2>
<p><span style="line-height: 1.5;">Backbone有一个todoList，我们这里也来写一个阉割版的，因为若是今天全部时间来写这个，后面就没法继续了</span></p>
<p><span style="line-height: 1.5;">这个例子事实上也比较简单了，首先看我们的HTML结构</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('00bed11d-4876-42d3-b58b-829c057dc3f3')"><img id="code_img_closed_00bed11d-4876-42d3-b58b-829c057dc3f3" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_00bed11d-4876-42d3-b58b-829c057dc3f3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('00bed11d-4876-42d3-b58b-829c057dc3f3',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_00bed11d-4876-42d3-b58b-829c057dc3f3" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">doctype html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>ToDoList<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/css/flat-ui.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/underscore-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-todolist"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">section class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">row</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">15</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">col-xs-9</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">16</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">form action</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">""</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">17</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">legend</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">To Do List </span><span style="background-color: #f5f5f5; color: #000000;">--</span><span style="background-color: #f5f5f5; color: #000000;"> Input</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">legend&gt;</span>
<span style="color: #008080;">18</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">input type</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">text</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> placeholer</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">ToDoList</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> id</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">todoinput</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">19</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">button class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">btn btn-primary</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> data</span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">action</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">add</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">添加</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">button&gt;</span>
<span style="color: #008080;">20</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">form&gt;</span>
<span style="color: #008080;">21</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul id</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">todolist</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;">22</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">_.each(list, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(item){</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;">23</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">item.content </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;">24</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">})</span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;">25</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;">26</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;">27</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">section&gt;</span>
<span style="color: #008080;">28</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">29</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/underscore-min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">30</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/zepto.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">31</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/underscore.extend.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">32</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/mvc.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">33</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="demo.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">34</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">35</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>其次是我们的js</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f0a62097-f96e-4e18-9730-c593579b977b')"><img id="code_img_closed_f0a62097-f96e-4e18-9730-c593579b977b" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_f0a62097-f96e-4e18-9730-c593579b977b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f0a62097-f96e-4e18-9730-c593579b977b',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_f0a62097-f96e-4e18-9730-c593579b977b" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> htmltemplate = $('#template-todolist'<span style="color: #000000;">).html();
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">var</span> view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Dalmatian.View({
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">  templateSet: {
</span><span style="color: #008080;"> 5</span>     0<span style="color: #000000;">:htmltemplate
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">  statusSet: {
</span><span style="color: #008080;"> 8</span>     STATUS_INIT: 0
<span style="color: #008080;"> 9</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">10</span> <span style="color: #000000;">});
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #0000ff;">var</span> Adapter =<span style="color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;">13</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (origindata) {
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> origindata;
</span><span style="color: #008080;">15</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">});
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span> <span style="color: #0000ff;">var</span> Controller =<span style="color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;">19</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">20</span>     console.log('controller-render'<span style="color: #000000;">)
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.viewmodel;
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewstatus, data);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span> <span style="color: #000000;">  events: {
</span><span style="color: #008080;">26</span>     'click button': 'action'
<span style="color: #008080;">27</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span>   action: <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    e.preventDefault();
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>     <span style="color: #0000ff;">var</span> target = $(e.currentTarget).attr('data-action'<span style="color: #000000;">);
</span><span style="color: #008080;">33</span>     <span style="color: #0000ff;">var</span> strategy =<span style="color: #000000;"> {
</span><span style="color: #008080;">34</span>       'add': <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">var</span> value = $('#todoinput'<span style="color: #000000;">).val();
</span><span style="color: #008080;">36</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.datamodel.list.push({ content: value });
</span><span style="color: #008080;">37</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> this.adapter.parse(this.adapter.datamodel);</span>
<span style="color: #008080;">38</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.notifyDataChanged();
</span><span style="color: #008080;">39</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span>     strategy[target].apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, [e]);
</span><span style="color: #008080;">43</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">44</span> <span style="color: #000000;">})
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span> <span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller({
</span><span style="color: #008080;">47</span> <span style="color: #000000;">  view: view,
</span><span style="color: #008080;">48</span>   adapter:  <span style="color: #0000ff;">new</span><span style="color: #000000;"> Adapter(),
</span><span style="color: #008080;">49</span>   container: '.container'<span style="color: #000000;">,
</span><span style="color: #008080;">50</span>   onViewBeforeCreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">51</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.format({
</span><span style="color: #008080;">52</span> <span style="color: #000000;">      list: []
</span><span style="color: #008080;">53</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">54</span>     <span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">55</span>     <span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.statusSet.STATUS_INIT
</span><span style="color: #008080;">56</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">57</span> <span style="color: #000000;">});
</span><span style="color: #008080;">58</span> 
<span style="color: #008080;">59</span> controller.show();</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><img src="43753126521667.png" alt=""></p>
<p><img src="28794026911651.png" alt=""></p>
<h2>阶段总结</h2>
<p><span style="line-height: 1.5;">MVC的学习暂时到这里，我们下面继续日历的的东西，虽然我与老大商量后形成了一些自己觉得不错的东西，但是真正使用过程中还是发现一些问题</span></p>
<p><span style="line-height: 1.5;">① 第一个我认为比较大的问题是viewController中的代码，比如</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller({
  view: view,
  adapter:  </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Adapter(),
  container: </span>'.container'<span style="color: #000000;">,
  onViewBeforeCreate: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.format({
      list: []
    });
    </span><span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
    </span><span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.statusSet.STATUS_INIT
  }
});</span></pre>
</div>
<p>以及</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller({
  view: view,
  adapter: adapter,
  container: </span>'.container'<span style="color: #000000;">,
  onCancelBtnClick: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
    alert(</span>'cancel 2'<span style="color: #000000;">)
  }
});</span></pre>
</div>
<p>事实上这些代码不应该存在于此，真实情况下我所构想的viewController不会在实例化时候还有如此多的业务相关信息，viewController在实例化时候只应该包含系统级的东西</p>
<p>比如Controller释放出来的接口，比如全局消息监听什么的，显然我们上面代码中的做法是有问题的，这些东西事实上应该在定义ViewController类时，在继承处得到处理</p>
<p>不应该在实例化时候处理，我们viewController实例化时候应该有更重要的使命，这些留待下面解决</p>
<p>上面要表达的意思是，事实上我们ViewController是最后继承下来是需要干业务的事情，所以他应该在几个事件点将要干的事情做完，比如TodoList应该是这样的</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('9c9d689f-bc8f-4cda-ac62-7fe0f4aef4bb')"><img id="code_img_closed_9c9d689f-bc8f-4cda-ac62-7fe0f4aef4bb" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_9c9d689f-bc8f-4cda-ac62-7fe0f4aef4bb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9c9d689f-bc8f-4cda-ac62-7fe0f4aef4bb',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_9c9d689f-bc8f-4cda-ac62-7fe0f4aef4bb" class="cnblogs_code_hide">
<pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> htmltemplate = $('#template-todolist'<span style="color: #000000;">).html();
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">var</span> Adapter =<span style="color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;"> 4</span>   parse: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (origindata) {
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> origindata;
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  }
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">});
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">var</span> Controller =<span style="color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>   <span style="color: #008000;">//</span><span style="color: #008000;">设置默认信息</span>
<span style="color: #008080;">12</span>   _initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">this</span>.view = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Dalmatian.View({
</span><span style="color: #008080;">14</span> <span style="color: #000000;">      templateSet: {
</span><span style="color: #008080;">15</span>         0<span style="color: #000000;">: htmltemplate
</span><span style="color: #008080;">16</span> <span style="color: #000000;">      },
</span><span style="color: #008080;">17</span> <span style="color: #000000;">      statusSet: {
</span><span style="color: #008080;">18</span>         STATUS_INIT: 0
<span style="color: #008080;">19</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">this</span>.adapter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Adapter();
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span>   initialize: <span style="color: #0000ff;">function</span><span style="color: #000000;"> ($super, opts) {
</span><span style="color: #008080;">26</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">._initialize();
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    $super(opts);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>   render: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">31</span>     console.log('controller-render'<span style="color: #000000;">)
</span><span style="color: #008080;">32</span>     <span style="color: #0000ff;">var</span> data = <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.viewmodel;
</span><span style="color: #008080;">33</span>     <span style="color: #0000ff;">this</span>.view.render(<span style="color: #0000ff;">this</span><span style="color: #000000;">.viewstatus, data);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span>   container: '.container'<span style="color: #000000;">,
</span><span style="color: #008080;">38</span>   onViewBeforeCreate: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">39</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.format({
</span><span style="color: #008080;">40</span> <span style="color: #000000;">      list: []
</span><span style="color: #008080;">41</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">42</span>     <span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #008080;">43</span>     <span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span><span style="color: #000000;">.view.statusSet.STATUS_INIT
</span><span style="color: #008080;">44</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span> <span style="color: #000000;">  events: {
</span><span style="color: #008080;">47</span>     'click button': 'action'
<span style="color: #008080;">48</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">49</span> 
<span style="color: #008080;">50</span>   action: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    e.preventDefault();
</span><span style="color: #008080;">52</span> 
<span style="color: #008080;">53</span>     <span style="color: #0000ff;">var</span> target = $(e.currentTarget).attr('data-action'<span style="color: #000000;">);
</span><span style="color: #008080;">54</span>     <span style="color: #0000ff;">var</span> strategy =<span style="color: #000000;"> {
</span><span style="color: #008080;">55</span>       'add': <span style="color: #0000ff;">function</span><span style="color: #000000;"> (e) {
</span><span style="color: #008080;">56</span>         <span style="color: #0000ff;">var</span> value = $('#todoinput'<span style="color: #000000;">).val();
</span><span style="color: #008080;">57</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.datamodel.list.push({ content: value });
</span><span style="color: #008080;">58</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> this.adapter.parse(this.adapter.datamodel);</span>
<span style="color: #008080;">59</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.adapter.notifyDataChanged();
</span><span style="color: #008080;">60</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">61</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">62</span> 
<span style="color: #008080;">63</span>     strategy[target].apply(<span style="color: #0000ff;">this</span><span style="color: #000000;">, [e]);
</span><span style="color: #008080;">64</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">65</span> <span style="color: #000000;">})
</span><span style="color: #008080;">66</span> 
<span style="color: #008080;">67</span> <span style="color: #0000ff;">var</span> controller = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Controller();
</span><span style="color: #008080;">68</span> 
<span style="color: #008080;">69</span> controller.show();</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>这样的话，业务应该的代码事实上写到了类的几个事件点中了，这些会在实例化时不同的状态被触发，所以根本不必在实例化时做任何操作</p>
<p>实例化时候应该有他的作用，因为继承到这一层的时候，该业务类便专注于处理这个业务了</p>
<h1>简单日历</h1>
<p><span style="line-height: 1.5;">上次，我们的日历基本都成型了，今天我们便根据前面的想法为他做一次封装......</span></p>
<p><span style="line-height: 1.5;">PS：想想有点很傻很天真的感觉......</span><span style="line-height: 1.5;">现在的问题是要将原来一个基本算总体的东西，分成三个部分，说实话这样封装的结构首先是让人阅读上稍微困难了</span></p>
<p><span style="line-height: 1.5;">首先仍然是定义view的事情，首先一来就遇到个比较烦的地方，因为之前我们将模板分的很细：</span></p>
<p><span style="line-height: 1.5;">① 星期显示模板</span></p>
<p><span style="line-height: 1.5;">② 月模板</span></p>
<p><span style="line-height: 1.5;">③ 日模板</span></p>
<p><span style="line-height: 1.5;">所以，我们这里便不太好区分，而且还有一定嵌套关系，这里小钗费了一点功夫......</span></p>
<p><span style="line-height: 1.5;">由这块的操作，我们甚至可以调整原来view的逻辑，优化由此一点一点慢慢就开始了......</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('97f234e4-31ae-4cf2-85ee-f05d8f64ed59')"><img id="code_img_closed_97f234e4-31ae-4cf2-85ee-f05d8f64ed59" class="code_img_closed" src="43570758473519.gif" alt=""><img id="code_img_opened_97f234e4-31ae-4cf2-85ee-f05d8f64ed59" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('97f234e4-31ae-4cf2-85ee-f05d8f64ed59',event)" src="16365178109279.gif" alt="">
<div id="cnblogs_code_open_97f234e4-31ae-4cf2-85ee-f05d8f64ed59" class="cnblogs_code_hide">
<pre><span style="color: #008080;">  1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">doctype html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  5</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>ToDoList<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  6</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  7</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/bootstrap/css/bootstrap.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="http://designmodo.github.io/Flat-UI/css/flat-ui.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">  9</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="../style/main.css"</span><span style="color: #ff0000;"> rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;"> 10</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 11</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui-alert </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> auto</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> position</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> static</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 12</span> <span style="background-color: #f5f5f5; color: #800000;">    .txt </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> #cfcfcf 1px solid</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 10px 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 80%</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 13</span> <span style="background-color: #f5f5f5; color: #800000;">    ul, li </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 14</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui_calendar, .cui_week </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> list-style</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> none</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 15</span> <span style="background-color: #f5f5f5; color: #800000;">    .cui_calendar li, .cui_week li </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;"> float</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> left</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 14%</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> overflow</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> hidden</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> padding</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 4px 0</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;"> text-align</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> center</span><span style="background-color: #f5f5f5; color: #000000;">;</span> <span style="background-color: #f5f5f5; color: #000000;">}</span>
<span style="color: #008080;"> 16</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 17</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 18</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 19</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">article </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 20</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">article</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 21</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="template-calendar"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 22</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui_week</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 23</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span> <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">, day </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 24</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;">(day </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; day </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span> <span style="background-color: #f5f5f5; color: #000000;">7</span><span style="background-color: #f5f5f5; color: #000000;">; day</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) { </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 25</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 26</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">weekDayItemTmpt[day] </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;"> 27</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">} </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 28</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;"> 29</span> 
<span style="color: #008080;"> 30</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">ul class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui_calendar</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span>
<span style="color: #008080;"> 31</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span> <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;">(i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> beginWeek; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) { </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 32</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui_invalid</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;"> 33</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;"> } </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 34</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span> <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;">(i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> days; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) { </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 35</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;"> day </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 36</span>           <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">li class</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">cui_calendar_item</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> data</span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">date</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;%=year%&gt;-&lt;%=month + 1%&gt;-&lt;%=day%&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&gt;&lt;%=</span><span style="background-color: #f5f5f5; color: #000000;">day </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">li&gt;</span>
<span style="color: #008080;"> 37</span>       <span style="background-color: #f5f5f5; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;"> } </span><span style="background-color: #f5f5f5; color: #000000;">%&gt;</span>
<span style="color: #008080;"> 38</span>     <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">ul&gt;</span>
<span style="color: #008080;"> 39</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 40</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/underscore-min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 41</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="../../vendor/zepto.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 42</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/underscore.extend.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 43</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/util.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 44</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="../../src/mvc.js"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 45</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 46</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> tmpt </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#template-calendar</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).html();
</span><span style="color: #008080;"> 47</span> 
<span style="color: #008080;"> 48</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarView </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.View, {
</span><span style="color: #008080;"> 49</span> <span style="background-color: #f5f5f5; color: #000000;">      templateSet: {
</span><span style="color: #008080;"> 50</span>         <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">: tmpt
</span><span style="color: #008080;"> 51</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 52</span> 
<span style="color: #008080;"> 53</span> <span style="background-color: #f5f5f5; color: #000000;">      statusSet: {
</span><span style="color: #008080;"> 54</span> <span style="background-color: #f5f5f5; color: #000000;">        STATUS_INIT: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;"> 55</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;"> 56</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 57</span> 
<span style="color: #008080;"> 58</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarAdapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.Adapter, {
</span><span style="color: #008080;"> 59</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super) {
</span><span style="color: #008080;"> 60</span> <span style="background-color: #f5f5f5; color: #000000;">        $super();
</span><span style="color: #008080;"> 61</span> 
<span style="color: #008080;"> 62</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">默认显示方案，可以根据参数修改</span>
<span style="color: #008080;"> 63</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">任意一个model发生改变皆会引起update</span>
<span style="color: #008080;"> 64</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.weekDayItemTmpt </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> [</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">日</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">一</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">二</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">三</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">四</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">五</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">六</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">];
</span><span style="color: #008080;"> 65</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 66</span> 
<span style="color: #008080;"> 67</span>       <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">该次重新，viewmodel的数据完全来源与parse中多定义</span>
<span style="color: #008080;"> 68</span> <span style="background-color: #f5f5f5; color: #000000;">      parse: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
</span><span style="color: #008080;"> 69</span>         <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> _.extend({
</span><span style="color: #008080;"> 70</span> <span style="background-color: #f5f5f5; color: #000000;">          weekDayItemTmpt: </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.weekDayItemTmpt
</span><span style="color: #008080;"> 71</span> <span style="background-color: #f5f5f5; color: #000000;">        }, data);
</span><span style="color: #008080;"> 72</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;"> 73</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 74</span> 
<span style="color: #008080;"> 75</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarController </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _.inherit(Dalmatian.ViewController, {
</span><span style="color: #008080;"> 76</span> 
<span style="color: #008080;"> 77</span> <span style="background-color: #f5f5f5; color: #000000;">      _initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;"> 78</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarView();
</span><span style="color: #008080;"> 79</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarAdapter();
</span><span style="color: #008080;"> 80</span> 
<span style="color: #008080;"> 81</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">默认业务数据</span>
<span style="color: #008080;"> 82</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.dateObj </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date();
</span><span style="color: #008080;"> 83</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.container </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">.container</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;"> 84</span> 
<span style="color: #008080;"> 85</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> s </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;"> 86</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 87</span> 
<span style="color: #008080;"> 88</span> <span style="background-color: #f5f5f5; color: #000000;">      initialize: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> ($super, opts) {
</span><span style="color: #008080;"> 89</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">._initialize();
</span><span style="color: #008080;"> 90</span> <span style="background-color: #f5f5f5; color: #000000;">        $super(opts);
</span><span style="color: #008080;"> 91</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;"> 92</span> 
<span style="color: #008080;"> 93</span> <span style="background-color: #f5f5f5; color: #000000;">      onViewBeforeCreate: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;"> 94</span> 
<span style="color: #008080;"> 95</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">使用adpter之前必须注册监听以及格式化viewModel，此操作应该封装起来</span>
<span style="color: #008080;"> 96</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.registerObserver(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;"> 97</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.format(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">._getMonthData(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.dateObj.getFullYear(), </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.dateObj.getMonth()));
</span><span style="color: #008080;"> 98</span> 
<span style="color: #008080;"> 99</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">view显示之前必定会给予状态，此应该封装</span>
<span style="color: #008080;">100</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.statusSet.STATUS_INIT;
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> s </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">103</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;">104</span> 
<span style="color: #008080;">105</span> <span style="background-color: #f5f5f5; color: #000000;">      render: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
</span><span style="color: #008080;">106</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">该操作可封装</span>
<span style="color: #008080;">107</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> data </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.adapter.viewmodel;
</span><span style="color: #008080;">108</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.view.render(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.viewstatus, data);
</span><span style="color: #008080;">109</span> <span style="background-color: #f5f5f5; color: #000000;">      },
</span><span style="color: #008080;">110</span> 
<span style="color: #008080;">111</span>       <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">根据传入年月，返回该月相关数据</span>
<span style="color: #008080;">112</span> <span style="background-color: #f5f5f5; color: #000000;">      _getMonthData: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (year, month) {
</span><span style="color: #008080;">113</span>         <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.date </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date(year, month);
</span><span style="color: #008080;">114</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> d </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date(year, month);
</span><span style="color: #008080;">115</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">description 获取天数</span>
<span style="color: #008080;">116</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> days </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> dateUtil.getDaysOfMonth(d);
</span><span style="color: #008080;">117</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">description 获取那个月第一天时星期几</span>
<span style="color: #008080;">118</span>         <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> _beginWeek </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> dateUtil.getBeginDayOfMouth(d);
</span><span style="color: #008080;">119</span>         <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">120</span> <span style="background-color: #f5f5f5; color: #000000;">          year: d.getFullYear(),
</span><span style="color: #008080;">121</span> <span style="background-color: #f5f5f5; color: #000000;">          month: d.getMonth(),
</span><span style="color: #008080;">122</span> <span style="background-color: #f5f5f5; color: #000000;">          beginWeek: _beginWeek,
</span><span style="color: #008080;">123</span> <span style="background-color: #f5f5f5; color: #000000;">          days: days
</span><span style="color: #008080;">124</span> <span style="background-color: #f5f5f5; color: #000000;">        };
</span><span style="color: #008080;">125</span> <span style="background-color: #f5f5f5; color: #000000;">      }
</span><span style="color: #008080;">126</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">127</span> 
<span style="color: #008080;">128</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> calendar </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> CalendarController();
</span><span style="color: #008080;">129</span> <span style="background-color: #f5f5f5; color: #000000;">    calendar.show();
</span><span style="color: #008080;">130</span>   
<span style="color: #008080;">131</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">132</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">133</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><img src="15240696222444.png" alt=""></p>
<p>首次调整后，大概的东西出来了，这样一次操作后就会发现之前定义的MVC一些不合理的地方</p>
<p>① 操作Adapter有parse与format两个地方，我们用着用着就会分不清，应该只对外暴露一个借口</p>
<p>② Controller处操作Adapter以及view也会有多个地方事实上有一些必定会发生的流程我们应该封装起来，类似：</p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">//</span><span style="color: #008000;">使用adpter之前必须注册监听以及格式化viewModel，此操作应该封装起来</span>
<span style="color: #0000ff;">this</span>.adapter.registerObserver(<span style="color: #0000ff;">this</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">this</span>.adapter.format(<span style="color: #0000ff;">this</span>._getMonthData(<span style="color: #0000ff;">this</span>.dateObj.getFullYear(), <span style="color: #0000ff;">this</span><span style="color: #000000;">.dateObj.getMonth()));

</span><span style="color: #008000;">//</span><span style="color: #008000;">view显示之前必定会给予状态，此应该封装</span>
<span style="color: #0000ff;">this</span>.viewstatus = <span style="color: #0000ff;">this</span>.view.statusSet.STATUS_INIT;</pre>
</div>
<p>③ 整个MVC的逻辑还是有一些不太清晰的地方，这个留待后续调整</p>
<p>这个时候我们将之前的一些借口加入进来，比如我们的handleDay</p>
<div class="cnblogs_code">
<pre>handleDay: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (dateStr, fn) {
  </span><span style="color: #0000ff;">if</span> (dateUtil.isDate(dateStr)) dateStr = dateUtil.format(dateStr, 'Y-m-d'<span style="color: #000000;">);
  </span><span style="color: #0000ff;">var</span> el = <span style="color: #0000ff;">this</span>.viewcontent.find('[data-date="' + dateStr + '"]'<span style="color: #000000;">);

  </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> fn == 'function') fn(el, dateUtil.parse(dateStr, 'y-m-d'), <span style="color: #0000ff;">this</span><span style="color: #000000;">);

}</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">var</span> calendar = <span style="color: #0000ff;">new</span><span style="color: #000000;"> CalendarController();
calendar.show();

calendar.handleDay(</span><span style="color: #0000ff;">new</span> Date(), <span style="color: #0000ff;">function</span><span style="color: #000000;"> (el, date, calendar) {
  el.html(</span>'今天'<span style="color: #000000;">);
});</span></pre>
</div>
<p><img src="39426955639466.png" alt=""></p>
<p>现在如果有事件绑定的话，便注册至viewController即可，我这里便暂时结束了</p>
<h1>结语</h1>
<p><span style="line-height: 1.5;">通过今天的学习，我将与我老大研究出来的MVC的东东搞了出来，事实证明还是需要有一些优化的......</span></p>
<p><span style="line-height: 1.5;">今天状态不是太好，今天暂时到此，剩下的我们后面点来，这块还有很多东西要清理呢。。。。。。</span></p>
                </div>

                <div class='span3 sidebar'>
                    <h2>导航栏</h2>
                    <ul class="nav nav-tabs nav-stacked">
                             				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptzdyxhxzsdyjxyzyddf/index.html">javascript中的一些核心知识点以及需要注意的地方</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]webappdyhzlyzydqdyhdpyjlkkb/index.html">[置顶]【webapp的优化整理】要做移动前端优化的朋友进来看看吧</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/[zd]yddjrwtyjjavascriptsjjzxjsjydjr/index.html">[置顶]【移动端兼容问题研究】javascript事件机制详解（涉及移动兼容）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntzhb30fzxhsygruntdbqddm/index.html">【grunt整合版】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdyd30fzxhsygruntdbqddm/index.html">【grunt第一弹】30分钟学会使用grunt打包前端代码</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntdsdgruntzqdsjxmzdyy/index.html">【grunt第三弹】grunt在前端实际项目中的应用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/gruntded30fzxhsygruntdbqddm02/index.html">【grunt第二弹】30分钟学会使用grunt打包前端代码（02）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxtpyddhadlqs/index.html">【IScroll深入学习】突破移动端黑暗的利器（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/IScrollsrxxjjIScrollynzz/index.html">【IScroll深入学习】解决IScroll疑难杂症</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx00mniScroll/index.html">【iScroll源码学习00】模拟iScroll</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx01zbjd/index.html">【iScroll源码学习01】准备阶段</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx02fjiScrollsghxsjd/index.html">【iScroll源码学习02】分解iScroll三个核心事件点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx03iScrollsjjzygdtdsx/index.html">【iScroll源码学习03】iScroll事件机制与滚动条的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/iScrollymxx04flIScrollhx/index.html">【iScroll源码学习04】分离IScroll核心</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdytyyjc/index.html">【javascript培训第一天】语言基础</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdstcybl/index.html">【javascript培训第三天】查遗补漏</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptpxdetDOMyBOM/index.html">【javascript培训第二天】DOM与BOM</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk01mkhbc/index.html">【javascript激增的思考01】模块化编程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk02mkhyMVC/index.html">【javascript激增的思考02】模块化与MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk03MVVMyKnockout/index.html">【javascript激增的思考03】MVVM与Knockout</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptjzdsk04MVCyBackbonejs(beta)/index.html">【javascript激增的思考04】MVC与Backbonejs(beta)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/javascriptmxdxzlrwmyqltkdzb01/index.html">【javascript面向对象之路】让我们一起来坦克大战吧01</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/NodeJSxxbj04xwfbxt/index.html">【NodeJS学习笔记04】新闻发布系统</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx01ljzgrequireJSdjg/index.html">【requireJS源码学习01】了解整个requireJS的结构</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx02datamainjzdsx/index.html">【requireJS源码学习02】datamain加载的实现</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/requireJSymxx03xjrequireJSdjzlc/index.html">【requireJS源码学习03】细究requireJS的加载流程</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjkfygjdrlcjs/index.html">【UI插件】开发一个简单日历插件（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/UIcjjddrlcjxxxMVCsx/index.html">【UI插件】简单的日历插件（下）——学习MVC思想</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()/index.html">【zepto学习笔记01】核心方法$()</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj01hxff$()b/index.html">【zepto学习笔记01】核心方法$()（补）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj02lsd/index.html">【zepto学习笔记02】零碎点</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zeptoxxbj03sjjz/index.html">【zepto学习笔记03】事件机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmsztjavascriptzdjc/index.html">【一次面试】再谈javascript中的继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone01mxModel/index.html">【再探backbone01】模型Model</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone02jhCollection/index.html">【再探backbone02】集合Collection</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone03bkydyyysltgym/index.html">【再探backbone03】博客园单页应用实例（提供源码）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ztbackbone04dyyydjslycl/index.html">【再探backbone04】单页应用的基石路由处理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ctUnderscorezsmbyq/index.html">【初探Underscore】再说模版引擎</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzAjaxjsxnszddAjax/index.html">【初窥javascript奥秘之Ajax】简述下你所知道的Ajax？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjmpnxnwmyqmdp/index.html">【初窥javascript奥秘之事件冒泡】那些年我们一起冒的泡</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzsjjzldtygdj/index.html">【初窥javascript奥秘之事件机制】论“点透”与“鬼点击”</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzrrzmbddthisnzdxzthiszxnlm/index.html">【初窥javascript奥秘之让人捉摸不定的this】你知道现在this指向哪里吗？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzbbydxbdhlqbcl/index.html">【初窥javascript奥秘之闭包】叶大侠病都好了，求不踩了：）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ckjavascriptamzmxdxfzyjc/index.html">【初窥javascript奥秘之面向对象】封装与继承</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/qdmdsjdjgjdnzdljm/index.html">【前端盲点】事件的几个阶段你真的了解么？？？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyviewymodelxgsl/index.html">【单页应用】view与model相关梳理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyyqldyyybsxjdwbgns/index.html">【单页应用】一起来单页应用吧，实现简单微博功能！（上）</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyqjkzqappyggxsm/index.html">【单页应用】全局控制器app应该干些什么？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyywmgrhclkjdcccjgx/index.html">【单页应用】我们该如何处理框架弹出层层级关系？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyljMVC/index.html">【单页应用】理解MVC</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyztxjzviewzjygrhtx/index.html">【单页应用之通信机制】view之间应该如何通信</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dyyyjkzHistoryxsHistorydgdyyydm/index.html">【单页应用巨坑之History】细数History带给单页应用的噩梦</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtszeptofindysyjiosdcjpknrnhtt/index.html">【小贴士】zeptofind元素以及ios弹出键盘可能让你很头疼</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgytransitionEndanimatedygyqgs/index.html">【小贴士】关于transitionEndanimate的一个有趣故事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsgzzdbbysjwtdzzmp/index.html">【小贴士】工作中的”闭包“与事件委托的”阻止冒泡“</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtstytjavascriptzdreplace/index.html">【小贴士】探一探javascript中的replace</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/xtsxnjpyfixeddgydddt/index.html">【小贴士】虚拟键盘与fixed带给移动端的痛！</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ttjavascriptsjjzdcsxyl/index.html">【探讨】javascript事件机制底层实现原理</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mkhbcljrequireJSsxygjddmkjzq/index.html">【模块化编程】理解requireJS实现一个简单的模块加载器</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zyJavaScriptmfjmtsdqlxkjzbfgndcljz/index.html">【转】【译】JavaScript魔法揭秘探索当前流行框架中部分功能的处理机制</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl01javascriptcszds/index.html">【追寻javascript高手之路01】javascript参数知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl02blzyyzds/index.html">【追寻javascript高手之路02】变量、作用域知多少？</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl03javascriptdxdld/index.html">【追寻javascript高手之路03】javascript对象大乱斗</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl04ljprototype/index.html">【追寻javascript高手之路04】理解prototype</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zxjavascriptgszl05ljsjl/index.html">【追寻javascript高手之路05】理解事件流</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj04zxzzsj(2)/index.html">【重构笔记04】重新组织数据(2)</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj05jhtjbds/index.html">【重构笔记05】简化条件表达式</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/zgbj06jhhsdy/index.html">【重构笔记06】简化函数调用</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ycmshgttbxysjfl/index.html">一次面试回顾——探讨表现与数据分离</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dhzwebappzdxz/index.html">动画在webapp中的现状</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/ysandriodlqhthdomclicksjqtsxwttj/index.html">原生andriod浏览器回退后dom（click）事件全体失效问题探究</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/scsbdjxysdsbsjytouchsjdnxs/index.html">手持设备点击响应速度，鼠标事件与touch事件的那些事</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/mnbjQueryzeptohxymfx/index.html">迷你版jQuery——zepto核心源码分析</a></li>
    				          				<li><a href="http://songboriceboy.github.io/xxoo/html/javascript/dbsgzdlwmlyqxjdddomxzqb/index.html">都别说工资低了，我们来一起写简单的dom选择器吧！</a></li>
    				                                         
                    </ul>
                </div>
            </div>

        </div>
    </body>
</html>